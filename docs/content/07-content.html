<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Bulbulia">
<meta name="dcterms.date" content="2023-04-22">

<title>PSYC 434 Conducting Research Across Cultures: Trimester 1, 2024 – Causal Inference: Effect-Modification and Interaction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PSYC 434 Conducting Research Across Cultures: Trimester 1, 2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../content/course-outline.html"> 
<span class="menu-text">Course Outline</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../content/glossary.pdf">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/course-outline.html">
 <span class="dropdown-text">Course Outline</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/01-content.html">
 <span class="dropdown-text">Week 1: Course Introduction - R (installing packages)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/02-content.html">
 <span class="dropdown-text">Week 2: Causal Diagrams - Elementary Structures and Rules - R (using the interface)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/03-content.html">
 <span class="dropdown-text">Week 3: Causal Diagrams - Confounding Bias - R (regression/simulation)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/04-content.html">
 <span class="dropdown-text">Week 4: Causal Diagrams - Interaction, Measurement Bias, Selection Bias - R (regression/simulation)</span></a>
  </li>  
        <li class="dropdown-header">Week 5: Quiz - R (regression/simulation/reporting)</li>
        <li>
    <a class="dropdown-item" href="../content/06-content.html">
 <span class="dropdown-text">Week 6: Causal Inference - Key Concepts ATE - R (regression/simulation: ATE)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/06-content.html">
 <span class="dropdown-text">Week 7: Causal Inference - Key Concept CATE - R (regression/simulation: ATE)</span></a>
  </li>  
        <li class="dropdown-header">Week 8: Causal Inference - Estimation of ATE and CATE - R and LaTeX</li>
        <li class="dropdown-header">Week 9: Quiz - R</li>
        <li class="dropdown-header">Week 10: Measurement Matters - Factor Analysis, CFA, MultiGroup CFA, Partial Invariance - R</li>
        <li class="dropdown-header">Week 11: Measurement + External Validity in Causal Inference - R (writing introduction/method section)</li>
        <li class="dropdown-header">Week 12: Missing Data Workflows - Quarto Documents Seminar - Workflows</li>
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causal Inference: Effect-Modification and Interaction</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Joseph Bulbulia <a href="mailto:joseph.bulbulia@vuw.ac.nz" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-5861-2056" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Victoria University of Wellington, New Zealand
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 22, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#review" id="toc-review" class="nav-link active" data-scroll-target="#review">Review</a></li>
  <li><a href="#concepts" id="toc-concepts" class="nav-link" data-scroll-target="#concepts">Concepts</a></li>
  <li><a href="#old-material" id="toc-old-material" class="nav-link" data-scroll-target="#old-material">OLD MATERIAL</a></li>
  <li><a href="#what-is-interaction" id="toc-what-is-interaction" class="nav-link" data-scroll-target="#what-is-interaction">What is interaction?</a>
  <ul class="collapse">
  <li><a href="#what-is-it-to-compare-causal-effects-in-groups" id="toc-what-is-it-to-compare-causal-effects-in-groups" class="nav-link" data-scroll-target="#what-is-it-to-compare-causal-effects-in-groups">What is it to compare causal effects in groups?</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Required</strong> - <span class="citation" data-cites="hernan2024WHATIF">(<a href="#ref-hernan2024WHATIF" role="doc-biblioref">Hernan and Robins 2024</a>)</span> Chapters 4-5 <a href="https://www.dropbox.com/scl/fi/9hy6xw1g1o4yz94ip8cvd/hernanrobins_WhatIf_2jan24.pdf?rlkey=8eaw6lqhmes7ddepuriwk5xk9&amp;dl=0">link</a></p>
<p><strong>Optional</strong> - <span class="citation" data-cites="vanderweele2007FOURTYPESOFEFFECT">(<a href="#ref-vanderweele2007FOURTYPESOFEFFECT" role="doc-biblioref">Tyler J. VanderWeele and Robins 2007a</a>)</span> <a href="https://www.dropbox.com/scl/fi/drytp2ui2b8o9jplh4bm9/four_types_of_effect_modification__a.6.pdf?rlkey=mb9nl599v93m6kyyo69iv5nz1&amp;dl=0">link</a> - <span class="citation" data-cites="vanderweele2009distinction">(<a href="#ref-vanderweele2009distinction" role="doc-biblioref">Tyler J. VanderWeele 2009</a>)</span> <a href="https://www.dropbox.com/scl/fi/srpynr0dvjcndveplcydn/OutcomeWide_StatisticalScience.pdf?rlkey=h4fv32oyjegdfl3jq9u1fifc3&amp;dl=0">link</a></p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key concepts for the test(s):
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Effect Modification</strong></li>
<li><strong>Interaction/Moderation</strong></li>
<li><strong>Heterogeneous Treatment Effects</strong></li>
<li><strong>Causal Mediation</strong></li>
</ul>
</div>
</div>
<section id="review" class="level2">
<h2 class="anchored" data-anchor-id="review">Review</h2>
</section>
<section id="concepts" class="level2">
<h2 class="anchored" data-anchor-id="concepts">Concepts</h2>
<section id="interaction-as-a-joint-intervention" class="level4">
<h4 class="anchored" data-anchor-id="interaction-as-a-joint-intervention">Interaction as a joint intervention</h4>
<p>This form of interaction occurs when the combined effect of two interventions (or treatments) is different from what would be expected based on their individual effects.</p>
<p>Consider two treatments, denoted as <span class="math inline">A</span> and <span class="math inline">B</span>, and their outcome as <span class="math inline">Y</span>. A joint intervention causal interaction implies that the effect of <span class="math inline">A</span> and <span class="math inline">B</span> together on <span class="math inline">Y</span> (denoted as <span class="math inline">Y(A,B)</span>) is not merely the sum of their individual effects.</p>
<p>For instance, consider the effect of beliefs in Big Gods (exposure <span class="math inline">A</span>) on social complexity (outcome <span class="math inline">Y</span>), potentially influenced by a culture’s monumental architecture (exposure <span class="math inline">B</span>). To assess the individual and combined effects of <span class="math inline">A</span> and <span class="math inline">B</span>, we look for evidence of causal interaction on the difference scale. Evidence for interaction would be present if the following inequality were to hold:</p>
<p><span class="math display">\bigg(\underbrace{\mathbb{E}[Y(1,1)]}_{\text{joint exposure}} - \underbrace{\mathbb{E}[Y(0,0)]}_{\text{neither exposed}}\bigg) - \bigg[ \bigg(\underbrace{\mathbb{E}[Y(1,0)]}_{\text{only A exposed}} - \underbrace{\mathbb{E}[Y(0,0)]}_{\text{neither exposed}}\bigg) + \bigg(\underbrace{\mathbb{E}[Y(0,1)]}_{\text{only B exposed}} - \underbrace{\mathbb{E}[Y(0,0)]}_{\text{neither exposed}} \bigg)\bigg] \neq 0 </span></p>
<p>This equation simplifies to</p>
<p><span class="math display"> \underbrace{\mathbb{E}[Y(1,1)]}_{\text{joint exposure}} - \underbrace{\mathbb{E}[Y(1,0)]}_{\text{only A exposed}} - \underbrace{\mathbb{E}[Y(0,1)]}_{\text{only B exposed}} + \underbrace{\mathbb{E}[Y(0,0)]}_{\text{neither exposed}} \neq 0 </span></p>
<p>A positive value would indicate evidence for additive interaction. A negative value would indicate evidence for sub-additive interaction. A value near zero would imply no reliable evidence for interaction.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-interaction" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-content_files/figure-html/fig-dag-interaction-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-interaction-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: This diagram presents the individual and joint effects of two exposures, A and B, on outcome Y. We assume that A and B are causally independent. If either exposure affects the other, then we may conduct effect-modification analysis or mediation analysis, but we should avoid causal interaction analysis. The diagram includes confounders L and W. Control for these confounders is necessary to close the backdoor paths that relate each exposure, A and B, to the outcome. Each exposure has equal status in our model: Y(a,b) = Y(b,a). The red path denotes paths of confounding.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-interaction" class="quarto-xref">Figure&nbsp;1</a> clarifies the need to evaluate two sources of counfounding, one for each intervention (<span class="math inline">A</span> and <span class="math inline">B</span>). The graph resembles others we have considered. By adjusting for <span class="math inline">L_{0}</span> we obtain an unbiased estimate of the <span class="math inline">A\to Y</span> path. By adjusting for <span class="math inline">W_{0}</span> we obtain an unbiased estimate of the <span class="math inline">B\to Y</span> path. As indicated in <a href="#fig-dag-interaction-solved" class="quarto-xref">Figure&nbsp;2</a>, we must condition on both <span class="math inline">L_{0}</span> and <span class="math inline">W_{0}</span> to identify causal interaction conceived as a joint interaction.</p>
<p>An important complication is that evidence for causal interaction may differ depending on the measurement scale one chooses to assess it <span class="citation" data-cites="vanderweele2014">Tyler J. VanderWeele (<a href="#ref-vanderweele2012" role="doc-biblioref">2012</a>)</span>. Evidence for the strength of a causal effect estimate for interaction in the presence of effect-modification will differ depending on whether the effect is measured on the ratio scale as opposed to the difference scale (see: <span class="citation" data-cites="vanderweele2014">Tyler J. VanderWeele and Knol (<a href="#ref-vanderweele2014" role="doc-biblioref">2014</a>)</span>, who recommends using the causal difference scale for most policy settings.)</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-interaction-solved" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-interaction-solved-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-content_files/figure-html/fig-dag-interaction-solved-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-interaction-solved-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: We adjust for confounding in causal interaction analysis by adjusting for all confounders of the A to Y path as well as all for the B to Y path. The box over the confounders indicates the biasing paths are closed.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Again we arrange <a href="#fig-dag-interaction-solved" class="quarto-xref">Figure&nbsp;2</a> to follow the assumed sequence of causation. Doing so better clarifies demands for data quality – the timing of the events must be ensured. Data collection should also draw on expert knowledge about how <span class="math inline">A</span> and <span class="math inline">B</span> may be related over time; measurements of <span class="math inline">A</span> and <span class="math inline">B</span> should be taken within intervals in which <span class="math inline">A</span> and <span class="math inline">B</span> are unlikely to affect each other.</p>
</section>
<section id="interaction-as-effect-modification-of-a-single-intervention" class="level4">
<h4 class="anchored" data-anchor-id="interaction-as-effect-modification-of-a-single-intervention">3.1.4 Interaction as effect-modification of a single intervention</h4>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-effect-modification" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-effect-modification-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-content_files/figure-html/fig-dag-effect-modification-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-effect-modification-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: A simple sequentially ordered graph depicting effect-modification. We are interested in G as an effect-modifier of A on Y. A must not affect G (although G may affect A, we do not suppose such an effect). The blue path indicates effect-modification of A by G. The red path indicates an open backdoor path. We draw a box around G to indicate that we are conditioning on G in our model. We are interested in estimating the effect of A on Y. We must close all backdoor paths between A and Y, in this case, by conditioning on L. We are not interested in the effect of double intervention of G and A. Hence, we do not need to condition on Z to close the backdoor path from G to Y.
</figcaption>
</figure>
</div>
</div>
</div>
<p>It is often scientifically interesting to consider whether treatment effects vary over levels of other variable without imagining a double intervention. We call a variable over which the treatment effect varies, an ‘effect-modifier’ or an ‘effect-measure modifier.’ We call the phenomenon of variation in the effect of the exposure over levels of a covariate, ‘effect-modification,’ or ‘effect-measure modification’ or ’treatment effect heterogeneity. The counterfactual contrasts required to estimate effect-modification differ from those of a joint intervention. Suppose <span class="math inline">A</span> is the treatment, <span class="math inline">G</span> is the modifier, and <span class="math inline">Y</span> is the outcome. effect-modification assesses whether the effect of <span class="math inline">A</span> on <span class="math inline">Y</span> is different across levels of <span class="math inline">G</span> (i.e., whether the effect of <span class="math inline">A</span> on <span class="math inline">Y</span> is different when <span class="math inline">G = g1</span> compared to when <span class="math inline">G = g2</span>).</p>
<p><a href="#fig-dag-effect-modification" class="quarto-xref">Figure&nbsp;3</a> consider whether effect-modification of <span class="math inline">A</span> on <span class="math inline">Y</span> across levels of <span class="math inline">G</span>. Because we are not interested in the causal effect of <span class="math inline">G</span> as such, but rather, how the effect of <span class="math inline">A</span> varies across <span class="math inline">G</span>, we would not need to adjust <span class="math inline">G</span> by <span class="math inline">Z</span>. However, as we shall consider in the next section, the presence and absence of effect-modification may depend on other variables in a causal network, as well as on which other variables investigators condition on in their models. To foreshadow, we suppose that <span class="math inline">Z</span>, a parent of <span class="math inline">G</span>, is an effect-modifier of <span class="math inline">A</span> on <span class="math inline">Y</span>. Were we to include <span class="math inline">Z</span> in the model, the effect estimate for <span class="math inline">G</span> on <span class="math inline">Y</span> may be attenuated or erased. There is here no clear fact of the matter about whether and how much <span class="math inline">G</span> is an effect-modifier outside of researcher modelling decisions. I remind readers: <em>with absolute power comes absolute responsibility.</em></p>
<p>To better understand the interest of effect-modification, again consider a study investigating whether beliefs in big Gods affect social complexity. Suppose we compare two distinct geographical groups: North American societies (<span class="math inline">G=1</span>) and Continental societies (<span class="math inline">G=2</span>). Suppose we want to examine the causal effect of changing the exposure from <span class="math inline">A = 0</span> to <span class="math inline">A = 1</span> within each group and then compare these effects across the groups. The relevant causal contrasts are given as follows:</p>
<ol type="1">
<li><strong>Causal effect within North American societies (</strong><span class="math inline">G=1</span>): <span class="math display">\hat{\tau}_{g1} = \hat{\mathbb{E}}[Y(1)|G=1] - \hat{\mathbb{E}}[Y(0)|G=1]</span></li>
</ol>
<p>Here, <span class="math inline">\hat{\tau}_{g1}</span> represents the estimated causal effect of changing the exposure from <span class="math inline">A = 0</span> to <span class="math inline">A = 1</span> within the North American societies.</p>
<ol start="2" type="1">
<li><p><strong>Causal effect within Continental societies (</strong><span class="math inline">G=2</span>):</p>
<p><span class="math display">\hat{\tau}_{g2} = \hat{\mathbb{E}}[Y(1)|G=2] - \hat{\mathbb{E}}[Y(0)|G=2]</span></p>
<p>Similarly, <span class="math inline">\hat{\tau}_{g2}</span> denotes the estimated causal effect for the Continental societies.</p></li>
<li><p><strong>Comparing causal effects across groups</strong>:</p>
<p><span class="math display">\hat{\gamma} = \hat{\tau}_{g1} - \hat{\tau}_{g2}</span></p></li>
</ol>
<p>The estimated quantity <span class="math inline">\hat{\gamma}</span> computes the difference in the causal estimands between the two groups. A nonzero <span class="math inline">\hat{\gamma}</span> indicates effect-modification, suggesting that the effect of changing the exposure differs between the two groups. If we were to observe that <span class="math inline">\hat{\gamma} \neq 0</span>, this would provide evidence for variability in the effect of the exposure on the outcome in different groups. Note that the causal effect for one group might be indistinguishable from zero, and yet we might nevertheless find evidence for effect-modification if the comparison group exhibits reliably different responses from the contrast group that is indistinguishable from zero.</p>
</section>
<section id="evidence-for-effect-modification-is-relative-to-inclusion-of-other-variables-in-the-model" class="level4">
<h4 class="anchored" data-anchor-id="evidence-for-effect-modification-is-relative-to-inclusion-of-other-variables-in-the-model">3.1.5 Evidence for effect-modification is relative to inclusion of other variables in the model</h4>
<p>The ‘sharp-null hypothesis’ states there is no effect of the exposure on the outcome for any unit in the target population. Unless the ‘sharp-null hypothesis’ is false, there may be effect-modification. For any study worth conducting, we cannot evaluate whether the sharp-null hypothesis is false. If we could the experiment would be otiose. Therefore, we must assume the possibility of effect-modification. Notably, whether a variable is an effect-modifier also depends on which other variables are included in the model. That is, just as for the concept of a ‘confounder’, where a variable is an ‘effect-modifier’ cannot be stated without reference to an assumed causal order and an explicit statement about which other variables will be included in the model <span class="citation" data-cites="vanderweele2012">(<a href="#ref-vanderweele2012" role="doc-biblioref">Tyler J. VanderWeele 2012</a>)</span>.</p>
<p><a href="#fig-eff-mod-rel" class="quarto-xref">Figure&nbsp;4</a> presents a scenario in which the marginal association between <span class="math inline">A</span> and <span class="math inline">Y</span> is unbiased. The exposure <span class="math inline">A</span> is unconditionally associated with <span class="math inline">Y</span>. Recall our convention <span class="math inline">\boxedblue{G}</span> denotes effect-modification with conditioning and <span class="math inline">\circleblue{Z}</span> indicates effect-modification without conditioning. This graph states that the conditional association of <span class="math inline">A</span> on <span class="math inline">Y</span> varies within levels of <span class="math inline">\boxedblue{G}</span> (which is conditioned on), and furthermore that <span class="math inline">G</span> is an <em>effect-modifier by proxy</em> <span class="citation" data-cites="vanderweele2009distinction">(<a href="#ref-vanderweele2009distinction" role="doc-biblioref">Tyler J. VanderWeele 2009</a>)</span>. Here, <span class="math inline">\circleblue{Z}</span> fully mediates the association of <span class="math inline">G</span> and <span class="math inline">Y</span>. That is <span class="math inline">\circleblue{Z}</span> causes both <span class="math inline">G</span> and <span class="math inline">Y</span>, and <span class="math inline">G</span> has no causal effect on <span class="math inline">Y</span>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-eff-mod-rel" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-eff-mod-rel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-content_files/figure-html/fig-eff-mod-rel-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-eff-mod-rel-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Consider a randomised experiment. There is no confounding. Here, the marginal association between A and Y provides an unbiased estimate for the causal effect of A on Y. Does the conditional association of A on Y vary within levels of G? The causal diagram allows for a classification of G as an effect modifier of A on Y by proxy. G modifies A’s effect on Y in virtue of G’s relationship to Z, which, according to this graph, is a direct effect modifier for the effect of A on Y.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-effect-modification-4" class="quarto-xref">Figure&nbsp;5</a> presents the same a randomised experiment as in the previous causal diagram. We again assume that there is no confounding of the marginal association between the exposure, <span class="math inline">A</span>, and the outcome, <span class="math inline">Y</span>. However, suppose we were to adjust for <span class="math inline">Z</span> and ask, does the conditional association of <span class="math inline">A</span> on <span class="math inline">Y</span> vary within levels of <span class="math inline">G</span>, after adjusting for <span class="math inline">Z</span>? That is, does <span class="math inline">G</span> remain an effect-modifier of the exposure on the outcome? <span class="citation" data-cites="vanderweele2007">Tyler J. VanderWeele and Robins (<a href="#ref-vanderweele2007" role="doc-biblioref">2007b</a>)</span> proved that for effect-modification to occur, at least one other arrow besides the treatment must enter into the outcome. According to <a href="#fig-dag-effect-modification-4" class="quarto-xref">Figure&nbsp;5</a>, the only arrow into <span class="math inline">Y</span> other than <span class="math inline">A</span> arrives from <span class="math inline">Z</span>. Because <span class="math inline">Y</span> is independent of <span class="math inline">G</span> conditional on <span class="math inline">Z</span> we may infer that <span class="math inline">G</span> is no longer an effect modifier for the effect of <span class="math inline">A</span> on <span class="math inline">Y</span>. Viewed another way, <span class="math inline">G</span> no longer co-varies with <span class="math inline">Y</span> conditional on <span class="math inline">Z</span> and so cannot act as an effect-modifier.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-effect-modification-4" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-effect-modification-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-content_files/figure-html/fig-dag-effect-modification-4-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-effect-modification-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Conditioning on Z renders G independent of Y. G is no longer an effect modifier after conditioning on Z because G is independent of Y. Although Z is an unconditional effect modifier, G is not.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-effect-modification-5" class="quarto-xref">Figure&nbsp;6</a> presents the same a randomised experiment as in the previous graph. If we do not condition on <span class="math inline">B</span>, then <span class="math inline">G</span> will not modify the effect of <span class="math inline">A</span> on <span class="math inline">Y</span> because <span class="math inline">G</span> will not be associated with <span class="math inline">Y</span>. However, if we were to condition on <span class="math inline">B</span>, then both <span class="math inline">B</span> (an effect modifier by proxy) and <span class="math inline">G</span> may become effect-modifiers for the causal effect of <span class="math inline">A</span> on <span class="math inline">Y</span>. In this setting, both <span class="math inline">B</span> and <span class="math inline">G</span> are conditional effect-modifiers.</p>
<p>Note that casual graphs help us to evaluate classifications of conditional and unconditional effect modifiers. They may also help to clarify conditions in which conditioning on unconditional effect-modifiers may remove conditional effect-modification. However we cannot not tell from a causal diagram whether the ancestors of an unconditional effect-modifier will be conditional effect-modifiers for the effect of the exposure on the outcome; see: <span class="citation" data-cites="vanderweele2007">Tyler J. VanderWeele and Robins (<a href="#ref-vanderweele2007" role="doc-biblioref">2007b</a>)</span>, also <span class="citation" data-cites="suzuki2013counterfactual">Suzuki et al. (<a href="#ref-suzuki2013counterfactual" role="doc-biblioref">2013</a>)</span>. Causal diagrams express non-parametric relations. I have adopted an off-label colouring convention to denote instances of effect-modification to highlight possible pathways for effect-modification, which may be relative to other variables in a model.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-effect-modification-5" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-effect-modification-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-content_files/figure-html/fig-dag-effect-modification-5-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-effect-modification-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Blue path denotes effect-modification for G by conditioning on B. Both B and G are conditional effect modifiers.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-effect-modification-5b" class="quarto-xref">Figure&nbsp;7</a> reveals the relativity of effect-modification. If investigators do not condition on <span class="math inline">B</span>, then <span class="math inline">G</span> cannot be a conditional effect-modifier because <span class="math inline">G</span> would then be independent of <span class="math inline">Z</span> because <span class="math inline">B</span> is a collider. However, as we observed in <a href="#fig-dag-effect-modification-5" class="quarto-xref">Figure&nbsp;6</a>, conditioning on <span class="math inline">B</span>, a collider, may open a path for effect-modification of <span class="math inline">G</span> by <span class="math inline">Z</span>. Both <span class="math inline">B</span> and <span class="math inline">G</span> are conditional effect modifiers.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-effect-modification-5b" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-effect-modification-5b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-content_files/figure-html/fig-dag-effect-modification-5b-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-effect-modification-5b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Blue path denotes effect-modification. Here G is not an effect modifier because B, a common effect (collider) of G and Z, is not conditioned on. Any conditional effect modification for G would require conditioning on B, and not-conditioning on G. Otherwise G will be d-separated from Y.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-effect-modification-5c" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-effect-modification-5c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="07-content_files/figure-html/fig-dag-effect-modification-5c-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-effect-modification-5c-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Blue path denotes effect-modification. Neither, G nor B are unconditional effect-modifiers for the effect of A on Y after Z is conditioned upon. If investigators condition on Z, the causal diagram implies they will not find evidence for effect-modification by B or G, which are conditionally independent of Y once Z is conditioned upon.
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-dag-effect-modification-5c" class="quarto-xref">Figure&nbsp;8</a> considers the implications of conditioning on <span class="math inline">Z</span>, which is the only unconditional effect-modifier on the graph. If <span class="math inline">Z</span> is measured, conditioning on <span class="math inline">Z</span> will remove effect-modification for <span class="math inline">B</span> and <span class="math inline">G</span> because <span class="math inline">B,G\coprod Y |Z</span>. This examples again reveals the context dependency of effect-modification. Here, causal diagrams are useful for clarifying features of dependent and independent effect modification. For further discussion, see: <span class="citation" data-cites="suzuki2013counterfactual">Suzuki et al. (<a href="#ref-suzuki2013counterfactual" role="doc-biblioref">2013</a>)</span>; <span class="citation" data-cites="vanderweele2009distinction">Tyler J. VanderWeele (<a href="#ref-vanderweele2009distinction" role="doc-biblioref">2009</a>)</span>.</p>
</section>
</section>
<section id="old-material" class="level2">
<h2 class="anchored" data-anchor-id="old-material">OLD MATERIAL</h2>
</section>
<section id="what-is-interaction" class="level2">
<h2 class="anchored" data-anchor-id="what-is-interaction">What is interaction?</h2>
<section id="what-is-it-to-compare-causal-effects-in-groups" class="level3">
<h3 class="anchored" data-anchor-id="what-is-it-to-compare-causal-effects-in-groups">What is it to compare causal effects in groups?</h3>
<p><span class="math display">\hat{\gamma} = \overbrace{\big( \hat{E}[Y(a)|G=g] - \hat{E}[Y(a^{\prime})|G=g] \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}[Y(a^{\prime})|G=g^{\prime}]- \hat{E}[Y(a)|G=g^{\prime}]\big)}^{\hat{\delta_{g^{\prime}}}}</span></p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-hernan2024WHATIF" class="csl-entry" role="listitem">
Hernan, M. A., and J. M. Robins. 2024. <em>Causal Inference: What If?</em> Chapman &amp; Hall/CRC Monographs on Statistics &amp; Applied Probab. Taylor &amp; Francis. <a href="https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/">https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/</a>.
</div>
<div id="ref-suzuki2013counterfactual" class="csl-entry" role="listitem">
Suzuki, Etsuji, Toshiharu Mitsuhashi, Toshihide Tsuda, and Eiji Yamamoto. 2013. <span>“A Counterfactual Approach to Bias and Effect Modification in Terms of Response Types.”</span> <em>BMC Medical Research Methodology</em> 13 (1): 1–17.
</div>
<div id="ref-vanderweele2009distinction" class="csl-entry" role="listitem">
VanderWeele, Tyler J. 2009. <span>“On the Distinction Between Interaction and Effect Modification.”</span> <em>Epidemiology</em>, 863–71.
</div>
<div id="ref-vanderweele2012" class="csl-entry" role="listitem">
VanderWeele, Tyler J. 2012. <span>“Confounding and Effect Modification: Distribution and Measure.”</span> <em>Epidemiologic Methods</em> 1 (1): 55–82. <a href="https://doi.org/10.1515/2161-962X.1004">https://doi.org/10.1515/2161-962X.1004</a>.
</div>
<div id="ref-vanderweele2014" class="csl-entry" role="listitem">
VanderWeele, Tyler J, and Mirjam J Knol. 2014. <span>“A Tutorial on Interaction.”</span> <em>Epidemiologic Methods</em> 3 (1): 3372.
</div>
<div id="ref-vanderweele2007" class="csl-entry" role="listitem">
VanderWeele, Tyler J., and James M. Robins. 2007b. <span>“Four types of effect modification: a classification based on directed acyclic graphs.”</span> <em>Epidemiology (Cambridge, Mass.)</em> 18 (5): 561–68. <a href="https://doi.org/10.1097/EDE.0b013e318127181b">https://doi.org/10.1097/EDE.0b013e318127181b</a>.
</div>
<div id="ref-vanderweele2007FOURTYPESOFEFFECT" class="csl-entry" role="listitem">
———. 2007a. <span>“Four types of effect modification: a classification based on directed acyclic graphs.”</span> <em>Epidemiology (Cambridge, Mass.)</em> 18 (5): 561–68. <a href="https://doi.org/10.1097/EDE.0b013e318127181b">https://doi.org/10.1097/EDE.0b013e318127181b</a>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>