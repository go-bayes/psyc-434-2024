<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.523">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Bulbulia">
<meta name="dcterms.date" content="2023-05-30">

<title>PSYC 434 Conducting Research Across Cultures: Trimester 1, 2024 - Template: Causal Estimatation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../site_libs/table1-1.0/table1_defaults.css" rel="stylesheet">
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PSYC 434 Conducting Research Across Cultures: Trimester 1, 2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../content/01-content.html">
 <span class="dropdown-text">Week 1: Course Introduction - R (installing packages)</span></a>
  </li>  
        <li class="dropdown-header">Week 2: Causal Diagrams - Elementary Structures and Rules - R (using the interface/simulating data)</li>
        <li class="dropdown-header">Week 3: Causal Diagrams - Confounding Bias - R (regression/simulation)</li>
        <li class="dropdown-header">Week 4: Causal Diagrams - Interaction, Measurement Bias, Selection Bias - R (regression/simulation)</li>
        <li class="dropdown-header">Week 5: Quiz - R (regression/simulation/reporting)</li>
        <li class="dropdown-header">Week 6: Causal Inference - Key Concepts ATE - R (regression/simulation: ATE)</li>
        <li class="dropdown-header">Week 7: Causal Inference - Key Concept CATE - R (regression/simulation: ATE)</li>
        <li class="dropdown-header">Week 8: Causal Inference - Estimation of ATE and CATE - R and LaTeX</li>
        <li class="dropdown-header">Week 9: Quiz - R</li>
        <li class="dropdown-header">Week 10: Measurement Matters - Factor Analysis, CFA, MultiGroup CFA, Partial Invariance - R</li>
        <li class="dropdown-header">Week 11: Measurement + External Validity in Causal Inference - R (writing introduction/method section)</li>
        <li class="dropdown-header">Week 12: Missing Data Workflows - Quarto Documents Seminar - Workflows</li>
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Template: Causal Estimatatio</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i></button></div></div>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Joseph Bulbulia <a href="mailto:joseph.bulbulia@vuw.ac.nz" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-5861-2056" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Victoria University of Wellington, New Zealand
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 30, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intoduction" id="toc-intoduction" class="nav-link active" data-scroll-target="#intoduction">Intoduction</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a></li>
  <li><a href="#example-anlaysis-week-10" id="toc-example-anlaysis-week-10" class="nav-link" data-scroll-target="#example-anlaysis-week-10">Example anlaysis (week 10)</a></li>
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load Libraries</a>
  <ul class="collapse">
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import data</a></li>
  <li><a href="#find-column-names" id="toc-find-column-names" class="nav-link" data-scroll-target="#find-column-names">Find column names</a></li>
  <li><a href="#transform-indicators" id="toc-transform-indicators" class="nav-link" data-scroll-target="#transform-indicators">Transform indicators</a></li>
  <li><a href="#inspect-your-data" id="toc-inspect-your-data" class="nav-link" data-scroll-target="#inspect-your-data">Inspect your data</a></li>
  <li><a href="#investigate-assumption-of-positivity" id="toc-investigate-assumption-of-positivity" class="nav-link" data-scroll-target="#investigate-assumption-of-positivity">Investigate assumption of positivity:</a></li>
  </ul></li>
  <li><a href="#draw-dag" id="toc-draw-dag" class="nav-link" data-scroll-target="#draw-dag">Draw Dag</a>
  <ul class="collapse">
  <li><a href="#create-wide-data-frame-for-analysis" id="toc-create-wide-data-frame-for-analysis" class="nav-link" data-scroll-target="#create-wide-data-frame-for-analysis">Create wide data frame for analysis</a></li>
  </ul></li>
  <li><a href="#descriptive-table" id="toc-descriptive-table" class="nav-link" data-scroll-target="#descriptive-table">Descriptive table</a>
  <ul class="collapse">
  <li><a href="#calculate-propensity-scores" id="toc-calculate-propensity-scores" class="nav-link" data-scroll-target="#calculate-propensity-scores">Calculate propensity scores</a></li>
  <li><a href="#example-summary-nz-euro-propensity-scores." id="toc-example-summary-nz-euro-propensity-scores." class="nav-link" data-scroll-target="#example-summary-nz-euro-propensity-scores.">Example Summary NZ Euro Propensity scores.</a></li>
  <li><a href="#example-summary-maori-propensity-scores." id="toc-example-summary-maori-propensity-scores." class="nav-link" data-scroll-target="#example-summary-maori-propensity-scores.">Example Summary Maori Propensity scores.</a></li>
  <li><a href="#more-data-wrangling" id="toc-more-data-wrangling" class="nav-link" data-scroll-target="#more-data-wrangling">More data wrangling</a></li>
  </ul></li>
  <li><a href="#anxiety-analysis-and-results" id="toc-anxiety-analysis-and-results" class="nav-link" data-scroll-target="#anxiety-analysis-and-results">Anxiety Analysis and Results</a></li>
  <li><a href="#table-of-subgroup-results-plus-evalues" id="toc-table-of-subgroup-results-plus-evalues" class="nav-link" data-scroll-target="#table-of-subgroup-results-plus-evalues">Table of Subgroup Results plus Evalues</a></li>
  <li><a href="#graph-of-the-result" id="toc-graph-of-the-result" class="nav-link" data-scroll-target="#graph-of-the-result">Graph of the result</a>
  <ul class="collapse">
  <li><a href="#report-the-anxiety-result." id="toc-report-the-anxiety-result." class="nav-link" data-scroll-target="#report-the-anxiety-result.">Report the anxiety result.</a></li>
  <li><a href="#estimate-the-subgroup-contrast" id="toc-estimate-the-subgroup-contrast" class="nav-link" data-scroll-target="#estimate-the-subgroup-contrast">Estimate the subgroup contrast</a></li>
  </ul></li>
  <li><a href="#depression-analysis-and-results" id="toc-depression-analysis-and-results" class="nav-link" data-scroll-target="#depression-analysis-and-results">Depression Analysis and Results</a>
  <ul class="collapse">
  <li><a href="#report-anxiety-results" id="toc-report-anxiety-results" class="nav-link" data-scroll-target="#report-anxiety-results">Report anxiety results</a></li>
  <li><a href="#graph-anxiety-result" id="toc-graph-anxiety-result" class="nav-link" data-scroll-target="#graph-anxiety-result">Graph Anxiety result</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  <li><a href="#estimate-the-subgroup-contrast-1" id="toc-estimate-the-subgroup-contrast-1" class="nav-link" data-scroll-target="#estimate-the-subgroup-contrast-1">Estimate the subgroup contrast</a></li>
  <li><a href="#discusion" id="toc-discusion" class="nav-link" data-scroll-target="#discusion">Discusion</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<section id="intoduction" class="level2">
<h2 class="anchored" data-anchor-id="intoduction">Intoduction</h2>
<p>Answer the following:</p>
<ul>
<li>State the Question: is my question clearly stated? If not, state it.</li>
<li>Relevance of the Question: Have I explained its importance? If not, explain.</li>
<li>Subgroup Analysis: Does my question involve a subgroup (e.g., cultural group)? If not, develop a subgroup analysis question.</li>
<li>Causality of the Question: Is my question causal? Briefly explain what this means with reference to the potential outcomes framework.</li>
<li>State how you will use time-series data to address causality.</li>
<li>Define your exposure.</li>
<li>Define your outcome(s)</li>
<li>Explain how the the exposure and outcome is relevant to your question.</li>
<li>Define your causal estimand (see: lecture 9). Hint: it is ATE_g_risk difference = E[Y(1)-(0)|G,L], where G is your multiple-group indicator and L is your set of baseline confounders.</li>
</ul>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<ul>
<li>Consider any ethical implications.</li>
<li>Explain the sample. Provide descriptive statistics</li>
<li>Discuss inclusion criteria.</li>
<li>Discuss how your sample relates to the “source population” (lecture 9.)</li>
<li>Explain NZAVS measures. State the questions used in the items</li>
<li>In your own words describe how the data meet the following assumptions required for causal inference:</li>
<li>Positivity: Can we intervene on the exposure at all levels of the covariates? Use the code I provided to test whether there is change in the exposure from the baseline in the source population(s)</li>
<li>Consistency: Can I interpret what it means to intervene on the exposure?</li>
<li>Exchangeability: Are different versions of the exposure conditionally exchangeable given measured baseline confounders? This requires stating baseline confounders and explaining how they may be related to both the exposure and outcome. As part of this, <strong>you must explain why the baseline measure of your exposure and outcome are included as potential confounders.</strong></li>
<li>Note: Unmeasured Confounders: Does previous science suggest the presence of unmeasured confounders? (e.g.&nbsp;childhood exposures that are not measured).</li>
<li>Draw a causal diagram: Have I drawn a causal diagram (DAG) to highlight both measured and unmeasured sources of confounding?</li>
<li>Measurement Error: Have I described potential biases from measurement errors? Return to lecture 11.</li>
<li>State that you do not have missing data in this synthetic dataset, but that ordinarily missing data would need to be handled.</li>
<li>State what your estimator will be. Note I’ve given you the following text to modify:</li>
</ul>
<blockquote class="blockquote">
<p>The Doubly Robust Estimation method for Subgroup Analysis Estimator is a sophisticated tool combining features of both IPTW and G-computation methods, providing unbiased estimates if either the propensity score or outcome model is correctly specified. The process involves five main steps:</p>
</blockquote>
<blockquote class="blockquote">
<p>Step 1 involves the estimation of the propensity score, a measure of the conditional probability of exposure given the covariates and the subgroup indicator. This score is calculated using statistical models such as logistic regression, with the model choice depending on the nature of the data and exposure. Weights for each individual are then calculated using this propensity score. These weights depend on the exposure status and are computed differently for exposed and unexposed individuals. The estimation of propensity scores is performed separately within each subgroup stratum.</p>
</blockquote>
<blockquote class="blockquote">
<p>Step 2 focuses on fitting a weighted outcome model, making use of the previously calculated weights from the propensity scores. This model estimates the outcome conditional on exposure, covariates, and subgroup, integrating the weights into the estimation process. Unlike in propensity score model estimation, covariates are included as variables in the outcome model. This inclusion makes the method doubly robust - providing a consistent effect estimate if either the propensity score or the outcome model is correctly specified, thereby reducing the assumption of correct model specification.</p>
</blockquote>
<blockquote class="blockquote">
<p>Step 3 entails the simulation of potential outcomes for each individual in each subgroup. These hypothetical scenarios assume universal exposure to the intervention within each subgroup, regardless of actual exposure levels. The expectation of potential outcomes is calculated for each individual in each subgroup, using individual-specific weights. These scenarios are performed for both the current and alternative interventions.</p>
</blockquote>
<blockquote class="blockquote">
<p>Step 4 is the estimation of the average causal effect for each subgroup, achieved by comparing the computed expected values of potential outcomes under each intervention level. The difference represents the average causal effect of changing the exposure within each subgroup.</p>
</blockquote>
<blockquote class="blockquote">
<p>Step 5 involves comparing differences in causal effects across groups by calculating the differences in the estimated causal effects between different subgroups. Confidence intervals and standard errors for these calculations are determined using simulation-based inference methods (Greifer et al.&nbsp;2023). This step allows for a comprehensive comparison of the impact of different interventions across various subgroups, while encorporating uncertainty.</p>
</blockquote>
<!-- Also see the appendix [here](https://go-bayes.github.io/psych-434-2023/content/09-content.html#comprehensive-checklist-for-detailed-reporting-of-a-causal-inferenctial-study-e.g.-assessment-3-option-2) -->
<ul>
<li>State what E-values are and how you will use them to clarify the risk of unmeasured confounding.</li>
</ul>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<ul>
<li>Use the scripts I have provided as a template for your analysis.</li>
<li>Propensity Score Reporting: Detail the process of propensity score derivation, including the model used and any variable transformations: e.g.: <code>A ~ x1 + x2 + x3 + ....</code> using logistic regression, all continuous predictors were transformed to z-scores
<ul>
<li>WeightIt Package Utilisation: Explicitly mention the use of the ‘WeightIt’ package in R, including any specific options or parameters used in the propensity score estimation process <span class="citation" data-cites="greifer2023a">(<a href="#ref-greifer2023a" role="doc-biblioref">Greifer 2023</a>)</span>.</li>
<li>Report if different methods were used to obtain propensity scores, and the reasons behind the choice of methods such as ‘ebal’, ‘energy’, and ‘ps’.</li>
<li>If your exposure is continuous only the ‘energy’ option was used for propensity score estimation.</li>
<li>Subgroup Estimation: Confirm that the propensity scores for subgroups were estimated separately, and discuss how the weights were subsequently combined with the original data.</li>
<li>Covariate Balance: Include a Love plot to visually represent covariate balance on the exposure both before and after weighting. The script will generate these plots.</li>
<li>Weighting Algorithm Statistics: Report the statistics for the weighting algorithms as provided by the WeightIt package, including any measures of balance or fit. The script I gave you will generate this information</li>
</ul></li>
</ul>
<p>Example:</p>
<blockquote class="blockquote">
<p>We estimated propensity scores by fitting a model for the exposure A as it is predicted by the set of baseline covariates defined by L. Because we are interested in effect modification by group, we fit different propensity score models for within strata of G using the <code>subgroup</code> command of the <code>WeightIt</code> package. Thus the propensity score is the the probability of receiving a value of a treatment (A=a) conditional on the covariates L, and stratum within G. We compared balance using the following methods of weighting: “ebal” or entropy balancing, “energy” or energy balancing, and “ps” or traditional inverse probability of weighting balancing. Of these methods “ebal” performed the best. Table X and Figure Y present the results of the ebalancing method.</p>
</blockquote>
<ul>
<li><p>Interpretation of Propensity Scores: we interpret the proposensity scores as yeilding good balance across the exposure conditions.</p></li>
<li><p>Outcome Regression Model: Clearly report the type of regression model used to estimate outcome model coefficients (e.g., linear regression, Poisson, binomial), and mention if the exposure was interacted with the baseline covariates. Do not report model coefficients as these have no interpretation. Example</p></li>
</ul>
<blockquote class="blockquote">
<p>We fit a linear model using maximum likelihood estimation with the outcome Y predicted by the exposure A. We interacted the exposure with all baseline confounders L. Continuous baseline confounders were converted to z-scores, whereas categorical exposures were not. Also interacted with all baseline confounders was a term for the subgroup interactoin. This allowed uas to flexibily fit non-linearities for the modification of the effect of the exposure within levels of the levels of the cultural group strata of interest. We note that model coefficients have no interpretation in this context so are not reported. The remaining steps of Doubly-Robust estimation were performed as outlined in the <em>Method</em> section. We calculated confidence intervals and standard errors, using the <code>clarify</code> package in R, which relies on simulation based inference for these quantities of interest <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span></p>
</blockquote>
<ul>
<li>Report the causal estimates.
<ul>
<li>ATE contrasts for groups in setting the exposure to for each group in setting level A = a and A = a*</li>
<li>differences between groups in the magnitude of the effects. (ATE_group 1 - ATE_group_2)</li>
</ul></li>
<li>Report the E-value: how sensitive are your results to unmeasured confounding? Hint I gave you code that will create a table for you: See <a href="https://go-bayes.github.io/psych-434-2023/content/10-content.html">here</a></li>
</ul>
<p><code>table_depression &lt;- tab_ate_subgroup_rd(table_estimates_depression, delta = 1, sd = 1)</code></p>
</section>
<section id="discussion" class="level2">
<h2 class="anchored" data-anchor-id="discussion">Discussion</h2>
<p>Make sure to hit these points:</p>
<p>Consider the following ideas about what to discuss in one’s findings. The order of exposition might be different.</p>
<ol type="1">
<li><p><strong>Summary of results</strong>: What did you find?</p></li>
<li><p><strong>Interpretation of E-values:</strong> Interpret the E-values used for sensitivity analysis. State what they represent in terms of the robustness of the findings to potential unmeasured confounding.</p></li>
<li><p><strong>Causal Effect Interpretation:</strong> What is the interest of the effect, if any, if an effect was observed? Interpret the average causal effect of changing the exposure level within each subgroup, and discuss its relevance to the research question.</p></li>
<li><p><strong>Comparison of Subgroups:</strong> Discuss how differences in causal effect estimates between different subgroups, if observed, or if not observed, contribute to the overall findings of the study.</p></li>
<li><p><strong>Uncertainty and Confidence Intervals:</strong> Consider the uncertainty around the estimated causal effects, and interpret the confidence intervals to understand the precision of the estimates.</p></li>
<li><p><strong>Generalisability and Transportability:</strong> Reflect on the generalizability of the study results to other contexts or populations. Discuss any factors that might influence the transportability of the causal effects found in the study. (Again see lecture 9.)</p></li>
<li><p><strong>Assumptions and Limitations:</strong> Reflect on the assumptions made during the study and identify any limitations in the methodology that could affect the interpretation of results. State that the implications of different intervention levels on potential outcomes are not analysed.</p></li>
<li><p><strong>Theoretical Relevance</strong>: How are these findings relevant to existing theories.</p></li>
<li><p><strong>Replication and Future Research:</strong> Consider how the study could be replicated or expanded upon in future research, and how the findings contribute to the existing body of knowledge in the field.</p></li>
<li><p><strong>Real-world Implications:</strong> Discuss the real-world implications of the findings, and how they could be applied in policy, practice, or further research.</p></li>
</ol>
</section>
<section id="example-anlaysis-week-10" class="level2">
<h2 class="anchored" data-anchor-id="example-anlaysis-week-10">Example anlaysis (week 10)</h2>
</section>
<section id="load-libraries" class="level2">
<h2 class="anchored" data-anchor-id="load-libraries">Load Libraries</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/libs2.R"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/funs.R"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/experimental_funs.R"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#  If you haven't already, you should have created a folder called "data", in your Rstudio project. If not, download this file, add it to your the folder called "data" in your Rstudio project. # "https://www.dropbox.com/s/vwqijg4ha17hbs1/nzavs_dat_synth_t10_t12?dl=0"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="import-data" class="level3">
<h3 class="anchored" data-anchor-id="import-data">Import data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will read the synthetic data into Rstudio.  Note that the arrow package allows us to have lower memory demands in the storage and retrieval of data.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>nzavs_synth <span class="ot">&lt;-</span> arrow<span class="sc">::</span><span class="fu">read_parquet</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"nzavs_dat_synth_t10_t12"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="find-column-names" class="level3">
<h3 class="anchored" data-anchor-id="find-column-names">Find column names</h3>
</section>
<section id="transform-indicators" class="level3">
<h3 class="anchored" data-anchor-id="transform-indicators">Transform indicators</h3>
<ul>
<li>What is the effect of exercise as measured by the NZAVS exercise scale on (1) depression and (2) anxiety.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># questions are:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_depressed,</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel so depressed that nothing could cheer you up?</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_hopeless,</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel hopeless?</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_nervous,</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel nervous?</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_effort,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel that everything was an effort?</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_restless,</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel restless or fidgety ?</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_worthless  # During the last 30 days, how often did you feel worthless?</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>dt_start <span class="ot">&lt;-</span> nzavs_synth <span class="sc">%&gt;%</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see week 10 appendix 1 for a detailed explanation of how we obtain these 2 x factors</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">kessler_latent_depression =</span> <span class="fu">mean</span>(</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(kessler_depressed, kessler_hopeless, kessler_effort),</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">kessler_latent_anxiety  =</span> <span class="fu">mean</span>(<span class="fu">c</span>(</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>      kessler_effort, kessler_nervous, kessler_restless</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Coarsen 'hours_exercise' into categories</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">hours_exercise_coarsen =</span> <span class="fu">cut</span>(</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>      hours_exercise,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Hours spent exercising/ physical activity</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">200</span>),</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"inactive"</span>,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"active"</span>,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"very_active"</span>),</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Define thresholds for categories</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"(-1,3]"</span>, <span class="st">"(3,8]"</span>, <span class="st">"(8,200]"</span>),</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a binary 'urban' variable based on the 'rural_gch2018' variable</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">urban =</span> <span class="fu">factor</span>(</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>      rural_gch2018 <span class="sc">==</span> <span class="st">"medium_urban_accessibility"</span> <span class="sc">|</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Define urban condition</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        rural_gch2018 <span class="sc">==</span> <span class="st">"high_urban_accessibility"</span>,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>      <span class="st">"urban"</span>,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Label 'urban' if condition is met</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>      <span class="st">"rural"</span>  <span class="co"># Label 'rural' if condition is not met</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="inspect-your-data" class="level3">
<h3 class="anchored" data-anchor-id="inspect-your-data">Inspect your data</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do some checks</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(dt_start<span class="sc">$</span>hours_exercise)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(dt_start<span class="sc">$</span>hours_exercise)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># checks</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># justification for transforming exercise" has a very long tail</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt_start<span class="sc">$</span>hours_exercise, <span class="at">breaks =</span> <span class="dv">1000</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># consider only those cases below &lt; or = to 20</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">subset</span>(dt_start, hours_exercise <span class="sc">&lt;=</span> <span class="dv">20</span>)<span class="sc">$</span>hours_exercise)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">as.numeric</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="investigate-assumption-of-positivity" class="level3">
<h3 class="anchored" data-anchor-id="investigate-assumption-of-positivity">Investigate assumption of positivity:</h3>
<p>Recall the positive assumption:</p>
<p><strong>Positivity:</strong> Can we intervene on the exposure at all levels of the covariates?</p>
<p>These are the data by wave, but they don’t track who changed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  select only the baseline year and the exposure year.  That will give us change in the exposure. ()</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dt_exposure <span class="ot">&lt;-</span> dt_start <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select baseline year and exposure year</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="st">"2018"</span> <span class="sc">|</span> wave <span class="sc">==</span> <span class="st">"2019"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select variables of interest</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, wave, hours_exercise_coarsen,  eth_cat) <span class="sc">|&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the categorical variable needs to be numeric for us to use msm package to investigate change</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hours_exercise_coarsen_n =</span> <span class="fu">as.numeric</span>(hours_exercise_coarsen)) <span class="sc">|&gt;</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>dt_exposure <span class="sc">|&gt;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(hours_exercise_coarsen_n, eth_cat,  wave )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`2018`
 hours_exercise_coarsen_n euro māori pacific asian
                        1 3238   319      78   170
                        2 3790   341      81   130
                        3 1613   161      31    48

$`2019`
 hours_exercise_coarsen_n euro māori pacific asian
                        1 2880   307      79   143
                        2 3927   354      82   141
                        3 1834   160      29    64</code></pre>
</div>
</div>
<p>I’ve written a function called <code>transition_table</code> that will help us assess change in the exposure at the <em>individual level.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#   consider people going from active to vary active</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> msm<span class="sc">::</span><span class="fu">statetable.msm</span>(<span class="fu">round</span>(hours_exercise_coarsen_n, <span class="dv">0</span>), id, <span class="at">data =</span> dt_exposure)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for a function I wrote to create state tables</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>state_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Inactive"</span>, <span class="st">"Somewhat Active"</span>, <span class="st">"Active"</span>, <span class="st">"Extremely Active"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># transition table</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">transition_table</span>(out, state_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$explanation
[1] "This transition matrix describes the shifts from one state to another between the baseline wave and the following wave. The numbers in the cells represent the number of individuals who transitioned from one state (rows) to another (columns). For example, the cell in the first row and second column shows the number of individuals who transitioned from the first state (indicated by the left-most cell in the row) to the second state. The top left cell shows the number of individuals who remained in the first state."

$table


|      From       | Inactive | Somewhat Active | Active |
|:---------------:|:--------:|:---------------:|:------:|
|    Inactive     |   2186   |      1324       |  295   |
| Somewhat Active |   1019   |      2512       |  811   |
|     Active      |   204    |       668       |  981   |</code></pre>
</div>
</div>
<p>Next consider Māori only</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maori only</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>dt_exposure_maori <span class="ot">&lt;-</span> dt_exposure <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(eth_cat <span class="sc">==</span> <span class="st">"māori"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>out_m <span class="ot">&lt;-</span> msm<span class="sc">::</span><span class="fu">statetable.msm</span>(<span class="fu">round</span>(hours_exercise_coarsen_n, <span class="dv">0</span>), id, <span class="at">data =</span> dt_exposure_maori)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># with this little support we might consider parametric models</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>t_tab_m<span class="ot">&lt;-</span> <span class="fu">transition_table</span>( out_m, state_names)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#interpretation</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(t_tab_m<span class="sc">$</span>explanation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This transition matrix describes the shifts from one state to another between the baseline wave and the following wave. The numbers in the cells represent the number of individuals who transitioned from one state (rows) to another (columns). For example, the cell in the first row and second column shows the number of individuals who transitioned from the first state (indicated by the left-most cell in the row) to the second state. The top left cell shows the number of individuals who remained in the first state.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t_tab_m<span class="sc">$</span>table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

|      From       | Inactive | Somewhat Active | Active |
|:---------------:|:--------:|:---------------:|:------:|
|    Inactive     |   187    |       108       |   24   |
| Somewhat Active |    92    |       188       |   61   |
|     Active      |    28    |       58        |   75   |</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter euro</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dt_exposure_euro <span class="ot">&lt;-</span> dt_exposure <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(eth_cat <span class="sc">==</span> <span class="st">"euro"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co"># model change</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>out_e <span class="ot">&lt;-</span> msm<span class="sc">::</span><span class="fu">statetable.msm</span>(<span class="fu">round</span>(hours_exercise_coarsen_n, <span class="dv">0</span>), id, <span class="at">data =</span> dt_exposure_euro)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co"># creat transition table.</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>t_tab_e <span class="ot">&lt;-</span> <span class="fu">transition_table</span>( out_e, state_names)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#interpretation</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(t_tab_e<span class="sc">$</span>explanation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>This transition matrix describes the shifts from one state to another between the baseline wave and the following wave. The numbers in the cells represent the number of individuals who transitioned from one state (rows) to another (columns). For example, the cell in the first row and second column shows the number of individuals who transitioned from the first state (indicated by the left-most cell in the row) to the second state. The top left cell shows the number of individuals who remained in the first state.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t_tab_e<span class="sc">$</span>table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

|      From       | Inactive | Somewhat Active | Active |
|:---------------:|:--------:|:---------------:|:------:|
|    Inactive     |   1843   |      1136       |  259   |
| Somewhat Active |   870    |      2208       |  712   |
|     Active      |   167    |       583       |  863   |</code></pre>
</div>
</div>
<p>Overall we find evidence for change in the exposure variable. This suggest that we are ready to proceed with the next step of causal estimation.</p>
</section>
</section>
<section id="draw-dag" class="level2">
<h2 class="anchored" data-anchor-id="draw-dag">Draw Dag</h2>
<div class="cell" data-codefolding="true">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode tex code-with-copy"><code class="sourceCode latex"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{positioning}</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{shapes.geometric}</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{arrows}</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{decorations}</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\tikzstyle</span>{Arrow} = [-&gt;, thin, preaction = {decorate}]</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">\tikzset</span>{&gt;=latex}</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tikzpicture</span>}[{every node/.append style}=draw]</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">\node</span> [rectangle, draw=white] (U) at (0, 0) {U};</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">\node</span> [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L <span class="fu">\\</span>t0/A <span class="fu">\\</span>t0/Y};</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="fu">\node</span> [rectangle, draw=white] (A) at (4, 0) {t1/A};</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">\node</span> [ellipse, draw=white] (Y) at (6, 0) {t2/Y};</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, draw=black] (U) to (L);</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, draw=black] (L) to (A);</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, draw=red, dotted] (A) to (Y);</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, bend left=50, draw =black] (L) to (Y);</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, bend right=50, draw =black, dotted] (U) to (Y);</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, bend left=50, draw =black, dotted] (U) to (A);</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tikzpicture</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-dag-6" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="v_2_tempate_causal_estimation_files/figure-html/fig-dag-6-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Causal graph: three-wave panel design
</figcaption>
</figure>
</div>
</div>
</div>
<section id="create-wide-data-frame-for-analysis" class="level3">
<h3 class="anchored" data-anchor-id="create-wide-data-frame-for-analysis">Create wide data frame for analysis</h3>
<p>I’ve written a function</p>
<div class="cell" data-table="wide_data">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">############## ############## ############## ############## ############## ############## ############## ########</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="do">####  ####  ####  CREATE DATA FRAME FOR ANALYSIS ####  ####  ################## ############## ######## #########</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="do">############## ############## ############## ############## ############## ############## ############# #########</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># I have created a function that will put the data into the correct shape. Here are the steps.</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: choose baseline variables (confounders).  here we select standard demographic variablees plus personality variables.</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Note again that the function will automatically include the baseline exposure and basline outcome in the baseline variable confounder set so you don't need to include these. </span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># here are some plausible baseline confounders</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"edu"</span>,</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"male"</span>,</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"eth_cat"</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"employed"</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gen_cohort"</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nz_dep2018"</span>,</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nzsei13"</span>,</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"partner"</span>,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"parent"</span>,</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pol_orient"</span>,</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"urban"</span>,</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"agreeableness"</span>,</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conscientiousness"</span>,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"extraversion"</span>,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"honesty_humility"</span>,</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"openness"</span>,</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"neuroticism"</span>,</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"modesty"</span>,</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"religion_identification_level"</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2, select the exposure variable.  This is the "cause"</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>exposure_var <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"hours_exercise_coarsen"</span>)</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a><span class="do">## step 3. select the outcome variable.  These are the outcomes.</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>outcome_vars_reflective <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"kessler_latent_anxiety"</span>,</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"kessler_latent_depression"</span>)</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="co"># the function "create_wide_data" should be in your environment.</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a><span class="co"># If not, make sure to run the first line of code in this script once more.  You may ignore the warnings. or uncomment and run the code below</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a><span class="co"># source("https://raw.githubusercontent.com/go-bayes/templates/main/functions/funs.R")</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>dt_prepare <span class="ot">&lt;-</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_wide_data</span>(</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">dat_long =</span> dt_start,</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseline_vars =</span> baseline_vars,</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure_var =</span> exposure_var,</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_vars =</span> outcome_vars_reflective</span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(exclude_vars)

  # Now:
  data %&gt;% select(all_of(exclude_vars))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(t0_column_order)

  # Now:
  data %&gt;% select(all_of(t0_column_order))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ignore warning</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="descriptive-table" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="descriptive-table">Descriptive table</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I have created a function that will allow you to take a data frame and</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create a table</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">baseline_table</span>(dt_prepare, <span class="at">output_format =</span> <span class="st">"markdown"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"># but it is not very nice. Next up, is a better table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get data into shape</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dt_new <span class="ot">&lt;-</span> dt_prepare <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"t0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_all</span>( <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(., <span class="st">"^t0_"</span>, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="st">"baseline"</span>, <span class="fu">nrow</span>(dt_prepare)))) <span class="sc">|&gt;</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>(<span class="at">case =</span> <span class="st">"screaming_snake"</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create a formula string</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>baseline_vars_names <span class="ot">&lt;-</span> dt_new <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>WAVE) <span class="sc">%&gt;%</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>()</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>table_baseline_vars <span class="ot">&lt;-</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(baseline_vars_names, <span class="at">collapse =</span> <span class="st">"+"</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>formula_string_table_baseline <span class="ot">&lt;-</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"~"</span>, table_baseline_vars, <span class="st">"|WAVE"</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>table1<span class="sc">::</span><span class="fu">table1</span>(<span class="fu">as.formula</span>(formula_string_table_baseline),</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dt_new,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">overall =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="Rtable1">
<table class="Rtable1 table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th class="rowlabel firstrow lastrow" data-quarto-table-cell-role="th"></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">baseline<br>
<span class="stratn">(N=10000)</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowlabel firstrow">EDU</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>5.85 (2.59)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">6.96 [-0.128, 10.1]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">MALE</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Male</td>
<td>3905 (39.1%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Not_male</td>
<td class="lastrow">6095 (61.0%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">ETH_CAT</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">euro</td>
<td>8641 (86.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">māori</td>
<td>821 (8.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel">pacific</td>
<td>190 (1.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">asian</td>
<td class="lastrow">348 (3.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">EMPLOYED</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>0.836 (0.370)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.00 [0, 1.00]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">GEN_COHORT</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Gen_Silent: born&lt; 1946</td>
<td>166 (1.7%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965</td>
<td>4257 (42.6%)</td>
</tr>
<tr class="even">
<td class="rowlabel">GenX: born &gt;=1961 &amp; b.&lt; 1981</td>
<td>3493 (34.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">GenY: born &gt;=1981 &amp; b.&lt; 1996</td>
<td>1883 (18.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">GenZ: born &gt;= 1996</td>
<td class="lastrow">201 (2.0%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">NZ_DEP2018</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>4.46 (2.65)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">4.01 [0.835, 10.1]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">NZSEI13</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>57.0 (16.1)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">61.0 [9.91, 90.1]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">PARTNER</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>0.795 (0.404)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.00 [0, 1.00]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">PARENT</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>0.706 (0.456)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.00 [0, 1.00]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">POL_ORIENT</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>3.47 (1.40)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">3.09 [0.862, 7.14]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">URBAN</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">rural</td>
<td>1738 (17.4%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">urban</td>
<td class="lastrow">8262 (82.6%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">AGREEABLENESS</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>5.36 (0.986)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">5.48 [0.977, 7.13]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">CONSCIENTIOUSNESS</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>5.19 (1.03)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">5.28 [0.938, 7.16]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">EXTRAVERSION</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>3.85 (1.21)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">3.80 [0.861, 7.07]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">HONESTY_HUMILITY</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>5.52 (1.12)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">5.71 [1.14, 7.15]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">OPENNESS</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>5.06 (1.10)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">5.12 [0.899, 7.15]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">NEUROTICISM</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>3.41 (1.17)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">3.31 [0.860, 7.08]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">MODESTY</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>6.07 (0.860)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">6.24 [2.17, 7.17]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">RELIGION_IDENTIFICATION_LEVEL</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>2.19 (2.07)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.00 [1.00, 7.00]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">HOURS_EXERCISE_COARSEN</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">inactive</td>
<td>3805 (38.1%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">active</td>
<td>4342 (43.4%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">very_active</td>
<td class="lastrow">1853 (18.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">KESSLER_LATENT_ANXIETY</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>1.16 (0.719)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.03 [-0.0800, 4.03]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">KESSLER_LATENT_DEPRESSION</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>0.744 (0.686)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">0.646 [-0.0871, 4.02]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We need to do some more data wrangling, alas! Data wrangling is the majority of data analysis. The good news is that R makes wrangling relatively straightforward.</p>
<ol type="1">
<li><p><code>mutate(id = factor(1:nrow(dt_prepare)))</code>: This creates a new column called <code>id</code> that has unique identification factors for each row in the dataset. It ranges from 1 to the number of rows in the dataset.</p></li>
<li><p>The next <code>mutate</code> operation is used to convert the <code>t0_eth_cat</code>, <code>t0_urban</code>, and <code>t0_gen_cohort</code> variables to factor type, if they are not already.</p></li>
<li><p>The <code>filter</code> command is used to subset the dataset to only include rows where the <code>t0_eth_cat</code> is either “euro” or “māori”. The original dataset includes data with four different ethnic categories. This command filters out any row not related to these two groups.</p></li>
<li><p><code>ungroup()</code> ensures that there’s no grouping in the dataframe.</p></li>
<li><p>The <code>mutate(across(where(is.numeric), ~ scale(.x), .names = "{col}_z"))</code> step standardizes all numeric columns in the dataset by subtracting the mean and dividing by the standard deviation (a z-score transformation). The resulting columns are renamed to include “_z” at the end of their original names.</p></li>
<li><p>The <code>select</code> function is used to keep only specific columns: the <code>id</code> column, any columns that are factors, and any columns that end in “_z”.</p></li>
<li><p>The <code>relocate</code> functions re-order columns. The first <code>relocate</code> places the <code>id</code> column at the beginning. The next three <code>relocate</code> functions order the rest of the columns based on their names: those starting with “t0_” are placed before “t1_” columns, and those starting with “t2_” are placed after “t1_” columns.</p></li>
<li><p><code>droplevels()</code> removes unused factor levels in the dataframe.</p></li>
<li><p>Finally, <code>skimr::skim(dt)</code> will print out a summary of the data in the <code>dt</code> object using the skimr package. This provides a useful overview of the data, including data types and summary statistics.</p></li>
</ol>
<p>This function seems to be part of a data preparation pipeline in a longitudinal or panel analysis, where observations are ordered over time (indicated by t0_, t1_, t2_, etc.).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">### </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> SUBGROUP DATA ANALYSIS: DATA WRANGLING  </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt_prepare<span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dt_prepare))) <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_eth_cat =</span> <span class="fu">as.factor</span>(t0_eth_cat),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_urban =</span> <span class="fu">as.factor</span>(t0_urban),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_gen_cohort =</span> <span class="fu">as.factor</span>(t0_gen_cohort)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span> <span class="sc">|</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>                t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>) <span class="sc">|&gt;</span> <span class="co"># Too few asian and pacific</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform numeric variables into z scores (improves estimation)</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">scale</span>(.x), <span class="at">.names =</span> <span class="st">"{col}_z"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only factors and numeric values that are z-scores</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="co"># category is too sparse</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>         <span class="fu">where</span>(is.factor),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ends_with</span>(<span class="st">"_z"</span>), ) <span class="sc">|&gt;</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tidy data frame so that the columns are ordered by time (useful for more complex models)</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(id, <span class="at">.before =</span> <span class="fu">starts_with</span>(<span class="st">"t1_"</span>))   <span class="sc">|&gt;</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">"t0_"</span>), <span class="at">.before =</span> <span class="fu">starts_with</span>(<span class="st">"t1_"</span>))  <span class="sc">|&gt;</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">"t2_"</span>), <span class="at">.after =</span> <span class="fu">starts_with</span>(<span class="st">"t1_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># checks</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt<span class="sc">$</span>t2_kessler_latent_depression_z)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt<span class="sc">$</span>t2_kessler_latent_anxiety_z)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">|&gt;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(t0_eth_cat, t1_hours_exercise_coarsen ) <span class="sc">|&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise missingness</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>naniar<span class="sc">::</span><span class="fu">vis_miss</span>(dt)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co"># save your dataframe for future use</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># make dataframe</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">as.data.frame</span>(dt)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># save data</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="calculate-propensity-scores" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="calculate-propensity-scores">Calculate propensity scores</h3>
<p>Next we generate propensity scores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read  data -- you may start here if you need to repeat the analysis</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt"</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># get column names</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>baseline_vars_reflective_propensity <span class="ot">&lt;-</span> dt<span class="sc">|&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"t0"</span>), <span class="sc">-</span>t0_eth_cat) <span class="sc">|&gt;</span> <span class="fu">colnames</span>()</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># define our exposure</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="st">"t1_hours_exercise_coarsen"</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># define subclasses</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="st">"t0_eth_cat"</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure data is in a data frame format</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dt)</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># next we use our trick for creating a formula string, which will reduce our work</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>formula_str_prop <span class="ot">&lt;-</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(X,</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"~"</span>,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(baseline_vars_reflective_propensity, <span class="at">collapse =</span> <span class="st">"+"</span>))</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co"># this shows the exposure variable as predicted by the baseline confounders.</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>formula_str_prop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "t1_hours_exercise_coarsen ~ t0_male+t0_gen_cohort+t0_urban+t0_hours_exercise_coarsen+t0_edu_z+t0_employed_z+t0_nz_dep2018_z+t0_nzsei13_z+t0_partner_z+t0_parent_z+t0_pol_orient_z+t0_agreeableness_z+t0_conscientiousness_z+t0_extraversion_z+t0_honesty_humility_z+t0_openness_z+t0_neuroticism_z+t0_modesty_z+t0_religion_identification_level_z+t0_hours_exercise_log_z+t0_kessler_latent_anxiety_z+t0_kessler_latent_depression_z"</code></pre>
</div>
</div>
<p>For propensity score analysis, we will try several different approaches. We will want to select the method that produces the best balance.</p>
<p>I typically use <code>ps</code> (classical propensity scores), <code>ebal</code> and <code>energy</code>. The latter two in my experience yeild good balance. Also <code>energy</code> will work with <em>continuous</em> exposures.</p>
<p>For more information, see <a href="https://ngreifer.github.io/WeightIt/" class="uri">https://ngreifer.github.io/WeightIt/</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># traditional propensity scores-- note we select the ATT and we have a subgroup </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>dt_match_ps <span class="ot">&lt;-</span> <span class="fu">match_mi_general</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dt,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_vars =</span> baseline_vars_reflective_propensity,</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroup =</span> <span class="st">"t0_eth_cat"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ps"</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_match_ps, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ps"</span>))</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ebalance</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>dt_match_ebal <span class="ot">&lt;-</span> <span class="fu">match_mi_general</span>(</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dt,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_vars =</span> baseline_vars_reflective_propensity,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroup =</span> <span class="st">"t0_eth_cat"</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span>,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ebal"</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="co"># save output</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_match_ebal, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ebal"</span>))</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="do">## energy balance method</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>dt_match_energy <span class="ot">&lt;-</span> <span class="fu">match_mi_general</span>(</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dt,</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_vars =</span> baseline_vars_reflective_propensity,</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroup =</span> <span class="st">"t0_eth_cat"</span>,</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span>,</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">#focal = "high", # for use with ATT</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"energy"</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_match_energy, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_energy"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Results, first for Europeans</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#dt_match_energy &lt;- readRDS(here::here("data", "dt_match_energy"))</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>dt_match_ebal <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ebal"</span>))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#dt_match_ps &lt;- readRDS(here::here("data", "dt_match_ps"))</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># next we inspect balance. "Max.Diff.Adj" should ideally be less than .05, but less than .1 is ok. This is the standardised mean difference. The variance ratio should be less than 2. </span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># note that if the variables are unlikely to influence the outcome we can be less strict. </span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#See: Hainmueller, J. 2012. “Entropy Balancing for Causal Effects: A Multivariate Reweighting Method to Produce Balanced Samples in Observational Studies.” Political Analysis 20 (1): 25–46. https://doi.org/10.1093/pan/mpr025.</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Cole SR, Hernan MA. Constructing inverse probability weights for marginal structural models. American Journal of</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Epidemiology 2008; 168(6):656–664.</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Moving towards best practice when using inverse probability of treatment weighting (IPTW) using the propensity score to estimate causal treatment effects in observational studies</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Peter C. Austin, Elizabeth A. Stuart</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co"># https://onlinelibrary.wiley.com/doi/10.1002/sim.6607</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">#bal.tab(dt_match_energy$euro)   #  good</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_ebal<span class="sc">$</span>euro)   <span class="co">#  best</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balance summary across all treatment pairs
                                                      Type Max.Diff.Adj
t0_male_Not_male                                    Binary       0.0001
t0_gen_cohort_Gen_Silent: born&lt; 1946                Binary       0.0001
t0_gen_cohort_Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965  Binary       0.0001
t0_gen_cohort_GenX: born &gt;=1961 &amp; b.&lt; 1981          Binary       0.0001
t0_gen_cohort_GenY: born &gt;=1981 &amp; b.&lt; 1996          Binary       0.0001
t0_gen_cohort_GenZ: born &gt;= 1996                    Binary       0.0000
t0_urban_urban                                      Binary       0.0001
t0_hours_exercise_coarsen_inactive                  Binary       0.0000
t0_hours_exercise_coarsen_active                    Binary       0.0000
t0_hours_exercise_coarsen_very_active               Binary       0.0000
t0_edu_z                                           Contin.       0.0000
t0_employed_z                                      Contin.       0.0003
t0_nz_dep2018_z                                    Contin.       0.0000
t0_nzsei13_z                                       Contin.       0.0000
t0_partner_z                                       Contin.       0.0001
t0_parent_z                                        Contin.       0.0001
t0_pol_orient_z                                    Contin.       0.0000
t0_agreeableness_z                                 Contin.       0.0000
t0_conscientiousness_z                             Contin.       0.0000
t0_extraversion_z                                  Contin.       0.0000
t0_honesty_humility_z                              Contin.       0.0001
t0_openness_z                                      Contin.       0.0000
t0_neuroticism_z                                   Contin.       0.0001
t0_modesty_z                                       Contin.       0.0001
t0_religion_identification_level_z                 Contin.       0.0001
t0_kessler_latent_anxiety_z                        Contin.       0.0001
t0_kessler_latent_depression_z                     Contin.       0.0000

Effective sample sizes
           inactive  active very_active
Unadjusted  2880.   3927.       1834.  
Adjusted    1855.89 3659.59     1052.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#bal.tab(dt_match_ps$euro)   #  not as good</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># here we show only the best tab, but you should put all information into an appendix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Results for Maori</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># who only Ebal</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#bal.tab(dt_match_energy$māori)   #  good</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_ebal<span class="sc">$</span>māori)   <span class="co">#  best</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Balance summary across all treatment pairs
                                                      Type Max.Diff.Adj
t0_male_Not_male                                    Binary       0.0000
t0_gen_cohort_Gen_Silent: born&lt; 1946                Binary       0.0000
t0_gen_cohort_Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965  Binary       0.0000
t0_gen_cohort_GenX: born &gt;=1961 &amp; b.&lt; 1981          Binary       0.0000
t0_gen_cohort_GenY: born &gt;=1981 &amp; b.&lt; 1996          Binary       0.0000
t0_gen_cohort_GenZ: born &gt;= 1996                    Binary       0.0000
t0_urban_urban                                      Binary       0.0000
t0_hours_exercise_coarsen_inactive                  Binary       0.0000
t0_hours_exercise_coarsen_active                    Binary       0.0000
t0_hours_exercise_coarsen_very_active               Binary       0.0000
t0_edu_z                                           Contin.       0.0000
t0_employed_z                                      Contin.       0.0001
t0_nz_dep2018_z                                    Contin.       0.0000
t0_nzsei13_z                                       Contin.       0.0000
t0_partner_z                                       Contin.       0.0002
t0_parent_z                                        Contin.       0.0001
t0_pol_orient_z                                    Contin.       0.0000
t0_agreeableness_z                                 Contin.       0.0001
t0_conscientiousness_z                             Contin.       0.0000
t0_extraversion_z                                  Contin.       0.0000
t0_honesty_humility_z                              Contin.       0.0000
t0_openness_z                                      Contin.       0.0000
t0_neuroticism_z                                   Contin.       0.0000
t0_modesty_z                                       Contin.       0.0000
t0_religion_identification_level_z                 Contin.       0.0001
t0_kessler_latent_anxiety_z                        Contin.       0.0000
t0_kessler_latent_depression_z                     Contin.       0.0001

Effective sample sizes
           inactive active very_active
Unadjusted   307.   354.        160.  
Adjusted     220.54 321.09       76.39</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#bal.tab(dt_match_ps$māori)   #  not good</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># code for summar</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sum_e <span class="ot">&lt;-</span> <span class="fu">summary</span>(dt_match_ebal<span class="sc">$</span>euro)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>sum_m <span class="ot">&lt;-</span> <span class="fu">summary</span>(dt_match_ebal<span class="sc">$</span>māori)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># summary euro</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>sum_e</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Summary of weights

- Weight ranges:

               Min                                  Max
inactive    0.2310 |---------------------------| 7.0511
active      0.5769  |----|                       1.9603
very_active 0.1601 |----------------------|      5.9191

- Units with the 5 most extreme weights by group:
                                               
               6560      9   7209   4878   5105
    inactive 5.1084 5.1312 5.1642 5.3517 7.0511
               3279   1867   4754   2783   7057
      active 1.7467 1.7654 1.7701 1.8692 1.9603
               5977   4293    700   2352   4765
 very_active 5.1495 5.3064 5.4829 5.7273 5.9191

- Weight statistics:

            Coef of Var   MAD Entropy # Zeros
inactive          0.743 0.536   0.212       0
active            0.270 0.248   0.036       0
very_active       0.862 0.637   0.302       0

- Effective Sample Sizes:

           inactive  active very_active
Unweighted  2880.   3927.       1834.  
Weighted    1855.89 3659.59     1052.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary maori</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>sum_m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Summary of weights

- Weight ranges:

               Min                                  Max
inactive    0.2213  |---------------|            3.8101
active      0.3995   |-----|                     1.9800
very_active 0.0719 |---------------------------| 6.2941

- Units with the 5 most extreme weights by group:
                                               
                296    322    355    758    812
    inactive 3.0104  3.407 3.6372 3.7101 3.8101
                 95    783    473    703    699
      active 1.8319 1.8387 1.9395 1.9436   1.98
                745    149     78    226    718
 very_active 4.0921 4.3405 4.4111 4.6833 6.2941

- Weight statistics:

            Coef of Var   MAD Entropy # Zeros
inactive          0.627 0.475   0.170       0
active            0.321 0.264   0.050       0
very_active       1.050 0.732   0.411       0

- Effective Sample Sizes:

           inactive active very_active
Unweighted   307.   354.        160.  
Weighted     220.54 321.09       76.39</code></pre>
</div>
</div>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>love_plot_e <span class="ot">&lt;-</span> <span class="fu">love.plot</span>(dt_match_ebal<span class="sc">$</span>euro,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>))<span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NZ Euro Weighting: method e-balance"</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>love_plot_e </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="page-columns page-full">
<figure class="figure page-columns page-full">
<p class="page-columns page-full"><img src="v_2_tempate_causal_estimation_files/figure-html/love_plot_euro-1.png" class="img-fluid figure-img column-page-right" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell page-columns page-full">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>love_plot_m <span class="ot">&lt;-</span> <span class="fu">love.plot</span>(dt_match_ebal<span class="sc">$</span>māori,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Māori Weighting: method e-balance"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>love_plot_m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display page-columns page-full">
<div class="page-columns page-full">
<figure class="figure page-columns page-full">
<p class="page-columns page-full"><img src="v_2_tempate_causal_estimation_files/figure-html/love_plot_maori-1.png" class="img-fluid figure-img column-page-right" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="example-summary-nz-euro-propensity-scores." class="level3">
<h3 class="anchored" data-anchor-id="example-summary-nz-euro-propensity-scores.">Example Summary NZ Euro Propensity scores.</h3>
<blockquote class="blockquote">
<p>We estimated propensity score analysis using entropy balancing, energy balancing and traditional propensity scores. Of these approaches, entropy balancing provided the best balance. The results indicate an excellent balance across all variables, with Max.Diff.Adj values significantly below the target threshold of 0.05 across a range of binary and continuous baseline confounders, including gender, generation cohort, urban_location, exercise hours (coarsened, baseline), education, employment status, depression, anxiety, and various personality traits. The Max.Diff.Adj values for all variables were well below the target threshold of 0.05, with most variables achieving a Max.Diff.Adj of 0.0001 or lower. This indicates a high level of balance across all treatment pairs.</p>
</blockquote>
<blockquote class="blockquote">
<p>The effective sample sizes were also adjusted using entropy balancing. The unadjusted sample sizes for the inactive, active, and very active groups were 2880, 3927, and 1834, respectively. After adjustment, the effective sample sizes were reduced to 1855.89, 3659.59, and 1052.01, respectively.</p>
</blockquote>
<blockquote class="blockquote">
<p>The weight ranges for the inactive, active, and very active groups varied, with the inactive group showing the widest range (0.2310 to 7.0511) and the active group showing the narrowest range (0.5769 to 1.9603). Despite these variations, the coefficient of variation, mean absolute deviation (MAD), and entropy were all within acceptable limits for each group, indicating a good balance of weights.</p>
</blockquote>
<blockquote class="blockquote">
<p>We also identified the units with the five most extreme weights by group. These units exhibited higher weights compared to the rest of the units in their respective groups, but they did not significantly affect the overall balance of weights.</p>
</blockquote>
<blockquote class="blockquote">
<p>We plotted these results using love plots, visually confirming both the balance in the propensity score model using entropy balanced weights, and the imbalance in the model that does not adjust for baseline confounders.</p>
</blockquote>
<blockquote class="blockquote">
<p>Overall, these findings support the use of entropy balancing in propensity score analysis to ensure a balanced distribution of covariates across treatment groups, conditional on the measured covariates included in the model.</p>
</blockquote>
</section>
<section id="example-summary-maori-propensity-scores." class="level3">
<h3 class="anchored" data-anchor-id="example-summary-maori-propensity-scores.">Example Summary Maori Propensity scores.</h3>
<p>Results:</p>
<blockquote class="blockquote">
<p>The entropy balancing method was also the best performing method that was applied to a subgroup analysis of the Māori population. Similar to the NZ European subgroup analysis, the method achieved a high level of balance across all treatment pairs for the Māori subgroup. The Max.Diff.Adj values for all variables were well below the target threshold of 0.05, with most variables achieving a Max.Diff.Adj of 0.0001 or lower. This indicates a high level of balance across all treatment pairs for the Māori subgroup.</p>
</blockquote>
<blockquote class="blockquote">
<p>The effective sample sizes for the Māori subgroup were also adjusted using entropy balancing. The unadjusted sample sizes for the inactive, active, and very active groups were 307, 354, and 160, respectively. After adjustment, the effective sample sizes were reduced to 220.54, 321.09, and 76.39, respectively</p>
</blockquote>
<blockquote class="blockquote">
<p>The weight ranges for the inactive, active, and very active groups in the Māori subgroup varied, with the inactive group showing the widest range (0.2213 to 3.8101) and the active group showing the narrowest range (0.3995 to 1.9800). Despite these variations, the coefficient of variation, mean absolute deviation (MAD), and entropy were all within acceptable limits for each group, indicating a good balance of weights.</p>
</blockquote>
<blockquote class="blockquote">
<p>The study also identified the units with the five most extreme weights by group for the Māori subgroup. These units exhibited higher weights compared to the rest of the units in their respective groups, but they did not significantly affect the overall balance of weights.</p>
</blockquote>
<blockquote class="blockquote">
<p>In conclusion, the results of the Māori subgroup analysis are consistent with the overall analysis. The entropy balancing method achieved a high level of balance across all treatment pairs, with Max.Diff.Adj values significantly below the target threshold. These findings support the use of entropy balancing in propensity score analysis to ensure a balanced distribution of covariates across treatment groups, even in subgroup analyses.</p>
</blockquote>
</section>
<section id="more-data-wrangling" class="level3">
<h3 class="anchored" data-anchor-id="more-data-wrangling">More data wrangling</h3>
<p>Note that we need to attach the <code>weights</code> from the propensity score model back to the data.</p>
<p>However, because our weighting analysis estimates a model for the <em>exposure</em>, we only need to do this analysis once, no matter how many outcomes we investigate. So there’s a little good news.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare nz_euro data</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>dt<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt"</span>)) <span class="co"># original data subset only nz europeans</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>dt_ref_e <span class="ot">&lt;-</span> <span class="fu">subset</span>(dt, t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span>) <span class="co"># original data subset only nz europeans</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add weights</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>dt_ref_e<span class="sc">$</span>weights <span class="ot">&lt;-</span> dt_match_ebal<span class="sc">$</span>euro<span class="sc">$</span>weights <span class="co"># get weights from the ps matching model,add to data</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare maori data</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>dt_ref_m <span class="ot">&lt;-</span> <span class="fu">subset</span>(dt, t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>)<span class="co"># original data subset only maori</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co"># add weights</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>dt_ref_m<span class="sc">$</span>weights <span class="ot">&lt;-</span> dt_match_ebal<span class="sc">$</span>māori<span class="sc">$</span>weights <span class="co"># get weights from the ps matching model, add to data</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data into one data frame</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>dt_ref_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dt_ref_e, dt_ref_m) <span class="co"># combine the data into one dataframe. </span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># save data for later use, if needed</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_ref_all, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"dt_ref_all"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="anxiety-analysis-and-results" class="level2">
<h2 class="anchored" data-anchor-id="anxiety-analysis-and-results">Anxiety Analysis and Results</h2>
<p>This is the analysis code</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we do not evaluate to save time</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="do">### SUBGROUP analysis</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span>  dt_ref_all</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span>  <span class="st">"t2_kessler_latent_anxiety_z"</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="st">"t1_hours_exercise_coarsen"</span> <span class="co"># already defined above</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> baseline_vars_reflective_propensity</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>treat_0 <span class="ot">=</span> <span class="st">"inactive"</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>treat_1 <span class="ot">=</span> <span class="st">"very_active"</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>estimand <span class="ot">=</span> <span class="st">"ATE"</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">=</span> <span class="st">"RD"</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>family <span class="ot">=</span> <span class="st">"gaussian"</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>continuous_X <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>splines <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="st">"t0_eth_cat"</span></span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co"># not we interact the subclass X treatment X covariates</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>    Y,</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"~"</span>,</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>    S,</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>    X ,</span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(baseline_vars_reflective_propensity, <span class="at">collapse =</span> <span class="st">"+"</span>),</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span>,</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># formula_str. # inspect on our own time </span></span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>fit_all_all  <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(formula_str),</span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights,</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># weights = if (!is.null(weight_var)) weight_var else NULL,</span></span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> family,</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate coefficients</span></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(clarify<span class="sc">::</span>sim)</span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>sim_model_all <span class="ot">&lt;-</span> <span class="fu">sim</span>(fit_all_all, <span class="at">n =</span> nsims, <span class="at">vcov =</span> <span class="st">"HC0"</span>)</span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in europeans</span></span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span>,</span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(sim_estimand_all_e)</span></span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a><span class="co"># note contrast of interest</span></span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e <span class="ot">&lt;-</span></span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_e, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span>)</span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(sim_estimand_all_m)</span></span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in māori</span></span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>,</span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a><span class="co">#m(sim_estimand_all_m)</span></span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m <span class="ot">&lt;-</span></span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_m, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span>)</span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange</span></span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_e) <span class="ot">&lt;-</span></span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_e), <span class="st">"e"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_m) <span class="ot">&lt;-</span></span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_m), <span class="st">"m"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( sim_estimand_all_e )</span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a>est_all_anxiety <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sim_estimand_all_m, sim_estimand_all_e)</span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a>est_all_anxiety <span class="ot">&lt;-</span> <span class="fu">transform</span>(est_all_anxiety, <span class="st">`</span><span class="at">RD_m - RD_e</span><span class="st">`</span> <span class="ot">=</span> RD_m <span class="sc">-</span> RD_e)</span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sim_estimand_all_e, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_e"</span>))</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sim_estimand_all_m, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_m"</span>))</span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(est_all_anxiety, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"est_all_anxiety"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="table-of-subgroup-results-plus-evalues" class="level2">
<h2 class="anchored" data-anchor-id="table-of-subgroup-results-plus-evalues">Table of Subgroup Results plus Evalues</h2>
<!-- > E[Y(1)]-E[Y(0)] presents the causal contrast between the expected value of the exposure were all within the target population {Group Var Here} to receive the exposure E[Y(1)] in comparison to the expected value of the exposure were to recieve the baseline treatment  E[Y(0)].  -->
<!-- > The Confidence interval for these estimates is between {2.5% column here} at the lower bound and {97.5% value here at the uppoer bound}.  -->
<!-- > E-values represent the minimum strength or magnitude of association that an unmeasured confounder would need to have with both treatment and outcome in order to explain the observed effect estimates conditional on measured covariates [@vanderweele2017]. -->
<!-- > With an observed risk ratio of RR = {E_Value Here}, an unmeasured confounder that was associated with both the outcome and the exposure by a risk ratio of {E_VAL_bound}-fold each, above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of {EVALUE HERE} - fold each could do so, but weaker joint confounder associations could not..[@vanderweele2017] -->
<p>I’ve created functions for reporting results so you can use this code, changing it to suit your analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># return stored estimates </span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_e"</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_m"</span>))</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create individual summaries </span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>sum_e <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim_estimand_all_e)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>sum_m <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim_estimand_all_m)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create individual tables</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>tab_e <span class="ot">&lt;-</span> <span class="fu">sub_tab_ate</span>(sum_e, <span class="at">new_name =</span> <span class="st">"NZ Euro Anxiety"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `dplyr::mutate()`.
ℹ In argument: `across(where(is.numeric), round, digits = 4)`.
Caused by warning:
! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
Supply arguments directly to `.fns` through an anonymous function instead.

  # Previously
  across(a:b, mean, na.rm = TRUE)

  # Now
  across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>tab_m <span class="ot">&lt;-</span> <span class="fu">sub_tab_ate</span>(sum_m, <span class="at">new_name =</span> <span class="st">"Māori Anxiety"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Confidence interval crosses the true value, so its E-value is 1.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># expand tables </span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>plot_e <span class="ot">&lt;-</span> <span class="fu">sub_group_tab</span>(tab_e, <span class="at">type=</span> <span class="st">"RD"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>plot_m <span class="ot">&lt;-</span> <span class="fu">sub_group_tab</span>(tab_m, <span class="at">type=</span> <span class="st">"RD"</span>)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>big_tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_e,plot_m)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># table for anxiety outcome --format as "markdown" if you are using quarto documents</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>big_tab <span class="sc">|&gt;</span> </span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format=</span><span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: right;">E[Y(1)]-E[Y(0)]</th>
<th style="text-align: right;">2.5 %</th>
<th style="text-align: right;">97.5 %</th>
<th style="text-align: right;">E_Value</th>
<th style="text-align: right;">E_Val_bound</th>
<th style="text-align: left;">Estimate</th>
<th style="text-align: left;">estimate_lab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">NZ Euro Anxiety</td>
<td style="text-align: right;">-0.077</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: right;">-0.022</td>
<td style="text-align: right;">1.352</td>
<td style="text-align: right;">1.167</td>
<td style="text-align: left;">negative</td>
<td style="text-align: left;">-0.077 (-0.131–0.022) [EV 1.352/1.167]</td>
</tr>
<tr class="even">
<td style="text-align: left;">Māori Anxiety</td>
<td style="text-align: right;">0.027</td>
<td style="text-align: right;">-0.114</td>
<td style="text-align: right;">0.188</td>
<td style="text-align: right;">1.183</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: left;">unreliable</td>
<td style="text-align: left;">0.027 (-0.114-0.188) [EV 1.183/1]</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="graph-of-the-result" class="level2">
<h2 class="anchored" data-anchor-id="graph-of-the-result">Graph of the result</h2>
<p>I’ve create a function you can use to graph your results. Here is the code, adjust to suit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group tables</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sub_group_plot_ate</span>(big_tab, <span class="at">title =</span> <span class="st">"Effect of Exercise on Anxiety"</span>, <span class="at">subtitle =</span> <span class="st">"Subgroup Analysis: NZ Euro and Māori"</span>, <span class="at">xlab =</span> <span class="st">"Groups"</span>, <span class="at">ylab =</span> <span class="st">"Effects"</span>,</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x_offset =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x_lim_lo =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x_lim_hi =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="v_2_tempate_causal_estimation_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="report-the-anxiety-result." class="level3">
<h3 class="anchored" data-anchor-id="report-the-anxiety-result.">Report the anxiety result.</h3>
<blockquote class="blockquote">
<p>For the New Zealand European group, our results suggest that exercise potentially reduces anxiety, with an estimated causal contrast value (E[Y(1)]-E[Y(0)]) of -0.077. The associated confidence interval, ranging from -0.131 to -0.022, does not cross zero, providing more certainty in our estimate.</p>
</blockquote>
<blockquote class="blockquote">
<p>E-values quantify the minimum strength of association that an unmeasured confounding variable would need to have with both the treatment and outcome, to fully explain away our observed effect. In this case, any unmeasured confounder would need to be associated with both exercise and anxiety reduction, with a risk ratio of at least 1.352 to explain away the observed effect, and at least 1.167 to shift the confidence interval to include a null effect.</p>
</blockquote>
<blockquote class="blockquote">
<p>Turning to the Māori group, the data suggest a possible reducing effect of exercise on anxiety, with a causal contrast value of 0.027. Yet, the confidence interval for this estimate (-0.114 to 0.188) also crosses zero, indicating similar uncertainties. An unmeasured confounder would need to have a risk ratio of at least 1.183 with both exercise and anxiety to account for our observed effect, and a risk ratio of at least 1 to render the confidence interval inclusive of a null effect.</p>
</blockquote>
<blockquote class="blockquote">
<p>Thus, while our analysis suggests that exercise could potentially reduce anxiety in both New Zealand Europeans and Māori, we advise caution in interpretation. The confidence intervals crossing zero reflect substantial uncertainties, and the possible impact of unmeasured confounding factors further complicates the picture.</p>
</blockquote>
<p>Here’s a function that will do much of this work for you. However, you’ll need to adjust it, and supply your own interpretation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|label: interpretation function</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>interpret_results_subgroup <span class="ot">&lt;-</span> <span class="cf">function</span>(df, outcome, exposure) {</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">report =</span> <span class="fu">case_when</span>(</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>        E_Val_bound <span class="sc">&gt;</span> <span class="fl">1.2</span> <span class="sc">&amp;</span> E_Val_bound <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">"For the "</span>, group, <span class="st">", our results suggest that "</span>, exposure, <span class="st">" may potentially influence "</span>, outcome, <span class="st">", with an estimated causal contrast value (E[Y(1)]-E[Y(0)]) of "</span>, <span class="st">`</span><span class="at">E[Y(1)]-E[Y(0)]</span><span class="st">`</span>, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The associated confidence interval, ranging from "</span>, <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>, <span class="st">" to "</span>, <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>, <span class="st">", does not cross zero, providing more certainty in our estimate. "</span>,</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The E-values indicate that any unmeasured confounder would need to have a minimum risk ratio of "</span>, E_Value, <span class="st">" with both the treatment and outcome to explain away the observed effect, and a minimum risk ratio of "</span>, E_Val_bound, <span class="st">" to shift the confidence interval to include the null effect. This suggests stronger confidence in our findings."</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        E_Val_bound <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">"For the "</span>, group, <span class="st">", our results suggest that "</span>, exposure, <span class="st">" may potentially influence "</span>, outcome, <span class="st">", with an estimated causal contrast value (E[Y(1)]-E[Y(0)]) of "</span>, <span class="st">`</span><span class="at">E[Y(1)]-E[Y(0)]</span><span class="st">`</span>, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The associated confidence interval, ranging from "</span>, <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>, <span class="st">" to "</span>, <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>, <span class="st">", does not cross zero, providing more certainty in our estimate. "</span>,</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">"With an observed risk ratio of RR = "</span>, E_Value, <span class="st">", an unmeasured confounder that was associated with both the outcome and the exposure by a risk ratio of "</span>, E_Val_bound, <span class="st">"-fold each, above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of "</span>, E_Val_bound, <span class="st">"-fold each could do so, but weaker joint confounder associations could not. Here we find stronger evidence that the result is robust to unmeasured confounding."</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>        E_Val_bound <span class="sc">&lt;</span> <span class="fl">1.2</span> <span class="sc">&amp;</span> E_Val_bound <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>          <span class="st">"For the "</span>, group, <span class="st">", our results suggest that "</span>, exposure, <span class="st">" may potentially influence "</span>, outcome, <span class="st">", with an estimated causal contrast value (E[Y(1)]-E[Y(0)]) of "</span>, <span class="st">`</span><span class="at">E[Y(1)]-E[Y(0)]</span><span class="st">`</span>, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The associated confidence interval, ranging from "</span>, <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>, <span class="st">" to "</span>, <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>, <span class="st">", does not cross zero, providing more certainty in our estimate. "</span>,</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The E-values indicate that any unmeasured confounder would need to have a minimum risk ratio of "</span>, E_Value, <span class="st">" with both the treatment and outcome to explain away the observed effect, and a minimum risk ratio of "</span>, E_Val_bound, <span class="st">" to shift the confidence interval to include the null effect. This suggests we should interpret these findings with caution given uncertainty in the model."</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>        E_Val_bound <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>          <span class="st">"For the "</span>, group, <span class="st">", the data suggests a potential effect of "</span>, exposure, <span class="st">" on "</span>, outcome, <span class="st">", with a causal contrast value of "</span>, <span class="st">`</span><span class="at">E[Y(1)]-E[Y(0)]</span><span class="st">`</span>, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>          <span class="st">"However, the confidence interval for this estimate, ranging from "</span>, <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>,<span class="st">" to "</span>, <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>, <span class="st">", crosses zero, indicating considerable uncertainties. The E-values indicate that an unmeasured confounder that is associated with both the "</span>, outcome, <span class="st">" and the "</span>, exposure, <span class="st">" by a risk ratio of "</span>, E_Value, <span class="st">" could explain away the observed associations, even after accounting for the measured confounders. "</span>,</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>          <span class="st">"This finding further reduces confidence in a true causal effect. Hence, while the estimates suggest a potential effect of "</span>, exposure, <span class="st">" on "</span>, outcome, <span class="st">" for the "</span>, group, <span class="st">", the substantial uncertainty and possible influence of unmeasured confounders mean these findings should be interpreted with caution."</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df<span class="sc">$</span>report)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You run the function like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interpret_results_subgroup</span>(big_tab, <span class="at">outcome =</span> <span class="st">"Anxiety"</span>, <span class="at">exposure =</span> <span class="st">"Excercise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "For the NZ Euro Anxiety, our results suggest that Excercise may potentially influence Anxiety, with an estimated causal contrast value (E[Y(1)]-E[Y(0)]) of -0.077.\nThe associated confidence interval, ranging from -0.131 to -0.022, does not cross zero, providing more certainty in our estimate. The E-values indicate that any unmeasured confounder would need to have a minimum risk ratio of 1.352 with both the treatment and outcome to explain away the observed effect, and a minimum risk ratio of 1.167 to shift the confidence interval to include the null effect. This suggests we should interpret these findings with caution given uncertainty in the model."                                                                                                                                      
[2] "For the Māori Anxiety, the data suggests a potential effect of Excercise on Anxiety, with a causal contrast value of 0.027.\nHowever, the confidence interval for this estimate, ranging from -0.114 to 0.188, crosses zero, indicating considerable uncertainties. The E-values indicate that an unmeasured confounder that is associated with both the Anxiety and the Excercise by a risk ratio of 1.183 could explain away the observed associations, even after accounting for the measured confounders. This finding further reduces confidence in a true causal effect. Hence, while the estimates suggest a potential effect of Excercise on Anxiety for the Māori Anxiety, the substantial uncertainty and possible influence of unmeasured confounders mean these findings should be interpreted with caution."</code></pre>
</div>
</div>
<p>Easy!</p>
</section>
<section id="estimate-the-subgroup-contrast" class="level3">
<h3 class="anchored" data-anchor-id="estimate-the-subgroup-contrast">Estimate the subgroup contrast</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculated above</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>est_all_anxiety <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"est_all_anxiety"</span>))</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make the sumamry into a dataframe so we can make a table</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(est_all_anxiety))</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get rownames for selecting the correct row</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RowName <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co"># select the correct row -- the group contrast</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(RowName <span class="sc">==</span> <span class="st">"RD_m - RD_e"</span>) </span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="co"># pring the filtered data frame</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>filtered_df  <span class="sc">|&gt;</span> </span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>RowName) <span class="sc">|&gt;</span> </span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="lightable-material lightable-striped lightable-hover table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2.5 %</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RD_m - RD_e</td>
<td style="text-align: right;">0.104</td>
<td style="text-align: right;">-0.042</td>
<td style="text-align: right;">0.279</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Another option for making the table using markdown. This would be useful if you were writing your article using qaurto.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>filtered_df  <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>RowName) <span class="sc">|&gt;</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">format =</span> <span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">2.5 %</th>
<th style="text-align: right;">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RD_m - RD_e</td>
<td style="text-align: right;">0.104</td>
<td style="text-align: right;">-0.042</td>
<td style="text-align: right;">0.279</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Report result along the following lines:</p>
<blockquote class="blockquote">
<p>The estimated reduction of anxiety from exercise is higher overall for New Zealand Europeans (RD_e) compared to Māori (RD_m). This is indicated by the estimated risk difference (RD_m - RD_e) of 0.104. However, there is uncertainty in this estimate, as the confidence interval (-0.042 to 0.279) crosses zero. This indicates that we cannot be confident that the difference in anxiety reduction between New Zealand Europeans and Māori is reliable. It’s possible that the true difference could be zero or even negative, suggesting higher anxiety reduction for Māori. Thus, while there’s an indication of higher anxiety reduction for New Zealand Europeans, the uncertainty in the estimate means we should interpret this difference with caution.</p>
</blockquote>
</section>
</section>
<section id="depression-analysis-and-results" class="level2">
<h2 class="anchored" data-anchor-id="depression-analysis-and-results">Depression Analysis and Results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">### SUBGROUP analysis</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dt_ref_all <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_ref_all"</span>))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># get column names</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>baseline_vars_reflective_propensity <span class="ot">&lt;-</span> dt<span class="sc">|&gt;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"t0"</span>), <span class="sc">-</span>t0_eth_cat) <span class="sc">|&gt;</span> <span class="fu">colnames</span>()</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span>  dt_ref_all</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span>  <span class="st">"t2_kessler_latent_depression_z"</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="st">"t1_hours_exercise_coarsen"</span> <span class="co"># already defined above</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> baseline_vars_reflective_propensity</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>treat_0 <span class="ot">=</span> <span class="st">"inactive"</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>treat_1 <span class="ot">=</span> <span class="st">"very_active"</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>estimand <span class="ot">=</span> <span class="st">"ATE"</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">=</span> <span class="st">"RD"</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>family <span class="ot">=</span> <span class="st">"gaussian"</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>continuous_X <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>splines <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="st">"t0_eth_cat"</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="co"># not we interact the subclass X treatment X covariates</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    Y,</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"~"</span>,</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>    S,</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>    X ,</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(baseline_vars_reflective_propensity, <span class="at">collapse =</span> <span class="st">"+"</span>),</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span>,</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>fit_all_dep  <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(formula_str),</span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights,</span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># weights = if (!is.null(weight_var)) weight_var else NULL,</span></span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> family,</span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a><span class="co"># coefs &lt;- coef(fit_all_dep)</span></span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a><span class="co"># table(is.na(coefs))#   </span></span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a><span class="co"># insight::get_varcov(fit_all_all)</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate coefficients</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(clarify<span class="sc">::</span>sim)</span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>sim_model_all <span class="ot">&lt;-</span> <span class="fu">sim</span>(fit_all_dep, <span class="at">n =</span> nsims, <span class="at">vcov =</span> <span class="st">"HC1"</span>)</span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in europeans</span></span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e_d <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span>,</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a><span class="co"># note contrast of interest</span></span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e_d <span class="ot">&lt;-</span></span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_e_d, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span>)</span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in māori</span></span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m_d <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>,</span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m_d <span class="ot">&lt;-</span></span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_m_d, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span>)</span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(sim_estimand_all_e_d)</span></span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(sim_estimand_all_m_d)</span></span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange</span></span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_e_d) <span class="ot">&lt;-</span></span>
<span id="cb54-91"><a href="#cb54-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_e_d), <span class="st">"e"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb54-92"><a href="#cb54-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_m_d) <span class="ot">&lt;-</span></span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_m_d), <span class="st">"m"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a>est_all_d <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sim_estimand_all_m_d, sim_estimand_all_e_d)</span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a>est_all_d <span class="ot">&lt;-</span> <span class="fu">transform</span>(est_all_d, <span class="st">`</span><span class="at">RD_m - RD_e</span><span class="st">`</span> <span class="ot">=</span> RD_m <span class="sc">-</span> RD_e)</span>
<span id="cb54-99"><a href="#cb54-99" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sim_estimand_all_m_d, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"sim_estimand_all_m_d"</span>))</span>
<span id="cb54-100"><a href="#cb54-100" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sim_estimand_all_e_d, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"sim_estimand_all_e_d"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="report-anxiety-results" class="level3">
<h3 class="anchored" data-anchor-id="report-anxiety-results">Report anxiety results</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># return stored estimates </span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e_d <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_e_d"</span>))</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m_d<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_m_d"</span>))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create individual summaries </span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>sum_e_d <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim_estimand_all_e_d)</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>sum_m_d <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim_estimand_all_m_d)</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create individual tables</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>tab_ed <span class="ot">&lt;-</span> <span class="fu">sub_tab_ate</span>(sum_e_d, <span class="at">new_name =</span> <span class="st">"NZ Euro Depression"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Confidence interval crosses the true value, so its E-value is 1.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>tab_md <span class="ot">&lt;-</span> <span class="fu">sub_tab_ate</span>(sum_m_d, <span class="at">new_name =</span> <span class="st">"Māori Depression"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Confidence interval crosses the true value, so its E-value is 1.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># expand tables </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>plot_ed <span class="ot">&lt;-</span> <span class="fu">sub_group_tab</span>(tab_ed, <span class="at">type=</span> <span class="st">"RD"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>plot_md <span class="ot">&lt;-</span> <span class="fu">sub_group_tab</span>(tab_md, <span class="at">type=</span> <span class="st">"RD"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>big_tab_d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_ed,plot_md)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># table for anxiety outcome --format as "markdown" if you are using quarto documents</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>big_tab_d <span class="sc">|&gt;</span> </span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format=</span><span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 16%">
<col style="width: 13%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">group</th>
<th style="text-align: right;">E[Y(1)]-E[Y(0)]</th>
<th style="text-align: right;">2.5 %</th>
<th style="text-align: right;">97.5 %</th>
<th style="text-align: right;">E_Value</th>
<th style="text-align: right;">E_Val_bound</th>
<th style="text-align: left;">Estimate</th>
<th style="text-align: left;">estimate_lab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">NZ Euro Depression</td>
<td style="text-align: right;">-0.039</td>
<td style="text-align: right;">-0.099</td>
<td style="text-align: right;">0.019</td>
<td style="text-align: right;">1.231</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">unreliable</td>
<td style="text-align: left;">-0.039 (-0.099-0.019) [EV 1.231/1]</td>
</tr>
<tr class="even">
<td style="text-align: left;">Māori Depression</td>
<td style="text-align: right;">0.028</td>
<td style="text-align: right;">-0.125</td>
<td style="text-align: right;">0.176</td>
<td style="text-align: right;">1.190</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">unreliable</td>
<td style="text-align: left;">0.028 (-0.125-0.176) [EV 1.19/1]</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="graph-anxiety-result" class="level3">
<h3 class="anchored" data-anchor-id="graph-anxiety-result">Graph Anxiety result</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># group tables</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sub_group_plot_ate</span>(big_tab_d, <span class="at">title =</span> <span class="st">"Effect of Exercise on Depression"</span>, <span class="at">subtitle =</span> <span class="st">"Subgroup Analysis: NZ Euro and Māori"</span>, <span class="at">xlab =</span> <span class="st">"Groups"</span>, <span class="at">ylab =</span> <span class="st">"Effects"</span>,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x_offset =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x_lim_lo =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x_lim_hi =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="v_2_tempate_causal_estimation_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation" class="level3">
<h3 class="anchored" data-anchor-id="interpretation">Interpretation</h3>
<p>Use the function, again, modify the outputs to fit with your study and results and provide your own interpretation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interpret_results_subgroup</span>(big_tab_d, <span class="at">exposure =</span> <span class="st">"Exercise"</span>, <span class="at">outcome =</span> <span class="st">"Depression"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "For the NZ Euro Depression, the data suggests a potential effect of Exercise on Depression, with a causal contrast value of -0.039.\nHowever, the confidence interval for this estimate, ranging from -0.099 to 0.019, crosses zero, indicating considerable uncertainties. The E-values indicate that an unmeasured confounder that is associated with both the Depression and the Exercise by a risk ratio of 1.231 could explain away the observed associations, even after accounting for the measured confounders. This finding further reduces confidence in a true causal effect. Hence, while the estimates suggest a potential effect of Exercise on Depression for the NZ Euro Depression, the substantial uncertainty and possible influence of unmeasured confounders mean these findings should be interpreted with caution."
[2] "For the Māori Depression, the data suggests a potential effect of Exercise on Depression, with a causal contrast value of 0.028.\nHowever, the confidence interval for this estimate, ranging from -0.125 to 0.176, crosses zero, indicating considerable uncertainties. The E-values indicate that an unmeasured confounder that is associated with both the Depression and the Exercise by a risk ratio of 1.19 could explain away the observed associations, even after accounting for the measured confounders. This finding further reduces confidence in a true causal effect. Hence, while the estimates suggest a potential effect of Exercise on Depression for the Māori Depression, the substantial uncertainty and possible influence of unmeasured confounders mean these findings should be interpreted with caution."      </code></pre>
</div>
</div>
</section>
<section id="estimate-the-subgroup-contrast-1" class="level3">
<h3 class="anchored" data-anchor-id="estimate-the-subgroup-contrast-1">Estimate the subgroup contrast</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculated above</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>est_all_d <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"est_all_d"</span>))</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make the sumamry into a dataframe so we can make a table</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>dfd <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(est_all_d))</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get rownames for selecting the correct row</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>dfd<span class="sc">$</span>RowName <span class="ot">&lt;-</span> <span class="fu">row.names</span>(dfd)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># select the correct row -- the group contrast</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>filtered_dfd <span class="ot">&lt;-</span> dfd <span class="sc">|&gt;</span> </span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(RowName <span class="sc">==</span> <span class="st">"RD_m - RD_e"</span>) </span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the filtered data frame</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>filtered_dfd  <span class="sc">|&gt;</span> </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>RowName) <span class="sc">|&gt;</span> </span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="lightable-material lightable-striped lightable-hover table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2.5 %</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">97.5 %</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RD_m - RD_e</td>
<td style="text-align: right;">0.068</td>
<td style="text-align: right;">-0.09</td>
<td style="text-align: right;">0.229</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Reporting might be:</p>
<blockquote class="blockquote">
<p>The estimated reduction of depression from exercise is higher overall for New Zealand Europeans (RD_e) compared to Māori (RD_m). This is suggested by the estimated risk difference (RD_m - RD_e) of 0.068. However, there is a degree of uncertainty in this estimate, as the confidence interval (-0.09 to 0.229) crosses zero. This suggests that we cannot be confident that the difference in depression reduction between New Zealand Europeans and Māori is statistically significant. It’s possible that the true difference could be zero or even negative, implying a greater depression reduction for Māori than New Zealand Europeans. Thus, while the results hint at a larger depression reduction for New Zealand Europeans, the uncertainty in this estimate urges us to interpret this difference with caution.</p>
</blockquote>
</section>
<section id="discusion" class="level3">
<h3 class="anchored" data-anchor-id="discusion">Discusion</h3>
<p>You’ll need to do this yourself. Here’s a start:</p>
<blockquote class="blockquote">
<p>In our study, we employed a robust statistical method that helps us estimate the impact of exercise on reducing anxiety among different population groups – New Zealand Europeans and Māori. This method has the advantage of providing reliable results even if our underlying assumptions aren’t entirely accurate – a likely scenario given the complexity of real-world data. However, this robustness comes with a trade-off: it gives us wider ranges of uncertainty in our estimates. This doesn’t mean the analysis is flawed; rather, it accurately represents our level of certainty given the data we have.</p>
</blockquote>
<section id="exercise-and-anxiety" class="level4">
<h4 class="anchored" data-anchor-id="exercise-and-anxiety"><strong>Exercise and Anxiety</strong></h4>
<blockquote class="blockquote">
<p>Our analysis suggests that exercise may have a greater effect in reducing anxiety among New Zealand Europeans compared to Māori. This conclusion comes from our primary causal estimate, the risk difference, which is 0.104. However, it’s crucial to consider our uncertainty in this value. We represent this uncertainty as a range, also known as a confidence interval. In this case, the interval ranges from -0.042 to 0.279. What this means is, given our current data and method, the true effect could plausibly be anywhere within this range. While our best estimate shows a higher reduction in anxiety for New Zealand Europeans, the range of plausible values includes zero and even negative values. This implies that the true effect could be no difference between the two groups or even a higher reduction in Māori. Hence, while there’s an indication of a difference, we should interpret it cautiously given the wide range of uncertainty.</p>
</blockquote>
<blockquote class="blockquote">
<p>Thus, although our analysis points towards a potential difference in how exercise reduces anxiety among these groups, the level of uncertainty means we should be careful about drawing firm conclusions. More research is needed to further explore these patterns.</p>
</blockquote>
</section>
<section id="exercise-and-depression" class="level4">
<h4 class="anchored" data-anchor-id="exercise-and-depression"><strong>Exercise and Depression</strong></h4>
<blockquote class="blockquote">
<p>In addition to anxiety, we also examined the effect of exercise on depression. We do not find evidence for reduction of depression from exercise in either group. We do not find evidence for the effect of weekly exercise – as self-reported – on depression.</p>
</blockquote>
</section>
<section id="proviso" class="level4">
<h4 class="anchored" data-anchor-id="proviso"><strong>Proviso</strong></h4>
<blockquote class="blockquote">
<p>It is important to bear in mind that statistical results are only one piece of a larger scientific puzzle about the relationship between excercise and well-being. Other pieces include understanding the context, incorporating subject matter knowledge, and considering the implications of the findings. In the present study, wide confidence intervals suggest the possibility of considerable individual differences.<span class="math inline">\dots</span> nevertheless, <span class="math inline">\dots</span></p>
</blockquote>
<p><strong>Again, you will need to come up with your own discussion, but follow the step-by-step instructions above as a guide.</strong></p>


<!-- -->


</section>
</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-greifer2023a" class="csl-entry" role="listitem">
Greifer, Noah. 2023. <em>WeightIt: Weighting for Covariate Balance in Observational Studies</em>.
</div>
<div id="ref-greifer2023" class="csl-entry" role="listitem">
Greifer, Noah, Steven Worthington, Stefano Iacus, and Gary King. 2023. <em>Clarify: Simulation-Based Inference for Regression Models</em>. <a href="https://iqss.github.io/clarify/">https://iqss.github.io/clarify/</a>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb64" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Template: Causal Estimatation"</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2023-MAY-30"</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="co">    name: Joseph Bulbulia</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co">    orcid: 0000-0002-5861-2056</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a><span class="co">    affiliation: Victoria University of Wellington, New Zealand</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co">    email: joseph.bulbulia@vuw.ac.nz</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="co">    corresponding: yes</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="co">    html-math-method: katex</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a><span class="co">    warnings: false</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="co">    error: false</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a><span class="co">    messages: false</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: solarized</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools:</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a><span class="co">      toggle: false</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a><span class="co">      caption: none</span></span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Intoduction</span></span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>Answer the following:</span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>State the Question: is my question clearly stated? If not, state it.</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Relevance of the Question: Have I explained its importance? If not, explain.</span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Subgroup Analysis: Does my question involve a subgroup (e.g., cultural group)? If not, develop a subgroup analysis question.</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Causality of the Question: Is my question causal? Briefly explain what this means with reference to the potential outcomes framework.</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>State how you will use time-series data to address causality.</span>
<span id="cb64-33"><a href="#cb64-33" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define your exposure.</span>
<span id="cb64-34"><a href="#cb64-34" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define your outcome(s)</span>
<span id="cb64-35"><a href="#cb64-35" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain how the the exposure and outcome is relevant to your question.</span>
<span id="cb64-36"><a href="#cb64-36" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define your causal estimand (see: lecture 9). Hint: it is ATE_g<span class="sc">\_</span>risk difference = E<span class="sc">\[</span>Y(1)-(0)\|G,L<span class="sc">\]</span>, where G is your multiple-group indicator and L is your set of baseline confounders.</span>
<span id="cb64-37"><a href="#cb64-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-38"><a href="#cb64-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## Methods</span></span>
<span id="cb64-39"><a href="#cb64-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-40"><a href="#cb64-40" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consider any ethical implications.</span>
<span id="cb64-41"><a href="#cb64-41" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain the sample. Provide descriptive statistics</span>
<span id="cb64-42"><a href="#cb64-42" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Discuss inclusion criteria.</span>
<span id="cb64-43"><a href="#cb64-43" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Discuss how your sample relates to the "source population" (lecture 9.)</span>
<span id="cb64-44"><a href="#cb64-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Explain NZAVS measures. State the questions used in the items</span>
<span id="cb64-45"><a href="#cb64-45" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In your own words describe how the data meet the following assumptions required for causal inference:</span>
<span id="cb64-46"><a href="#cb64-46" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Positivity: Can we intervene on the exposure at all levels of the covariates? Use the code I provided to test whether there is change in the exposure from the baseline in the source population(s)</span>
<span id="cb64-47"><a href="#cb64-47" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Consistency: Can I interpret what it means to intervene on the exposure?</span>
<span id="cb64-48"><a href="#cb64-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Exchangeability: Are different versions of the exposure conditionally exchangeable given measured baseline confounders? This requires stating baseline confounders and explaining how they may be related to both the exposure and outcome. As part of this, **you must explain why the baseline measure of your exposure and outcome are included as potential confounders.**</span>
<span id="cb64-49"><a href="#cb64-49" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Note: Unmeasured Confounders: Does previous science suggest the presence of unmeasured confounders? (e.g. childhood exposures that are not measured).</span>
<span id="cb64-50"><a href="#cb64-50" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Draw a causal diagram: Have I drawn a causal diagram (DAG) to highlight both measured and unmeasured sources of confounding?</span>
<span id="cb64-51"><a href="#cb64-51" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Measurement Error: Have I described potential biases from measurement errors? Return to lecture 11.</span>
<span id="cb64-52"><a href="#cb64-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>State that you do not have missing data in this synthetic dataset, but that ordinarily missing data would need to be handled.</span>
<span id="cb64-53"><a href="#cb64-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>State what your estimator will be. Note I've given you the following text to modify:</span>
<span id="cb64-54"><a href="#cb64-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-55"><a href="#cb64-55" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The Doubly Robust Estimation method for Subgroup Analysis Estimator is a sophisticated tool combining features of both IPTW and G-computation methods, providing unbiased estimates if either the propensity score or outcome model is correctly specified. The process involves five main steps:</span></span>
<span id="cb64-56"><a href="#cb64-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-57"><a href="#cb64-57" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Step 1 involves the estimation of the propensity score, a measure of the conditional probability of exposure given the covariates and the subgroup indicator. This score is calculated using statistical models such as logistic regression, with the model choice depending on the nature of the data and exposure. Weights for each individual are then calculated using this propensity score. These weights depend on the exposure status and are computed differently for exposed and unexposed individuals. The estimation of propensity scores is performed separately within each subgroup stratum.</span></span>
<span id="cb64-58"><a href="#cb64-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-59"><a href="#cb64-59" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Step 2 focuses on fitting a weighted outcome model, making use of the previously calculated weights from the propensity scores. This model estimates the outcome conditional on exposure, covariates, and subgroup, integrating the weights into the estimation process. Unlike in propensity score model estimation, covariates are included as variables in the outcome model. This inclusion makes the method doubly robust - providing a consistent effect estimate if either the propensity score or the outcome model is correctly specified, thereby reducing the assumption of correct model specification.</span></span>
<span id="cb64-60"><a href="#cb64-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-61"><a href="#cb64-61" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Step 3 entails the simulation of potential outcomes for each individual in each subgroup. These hypothetical scenarios assume universal exposure to the intervention within each subgroup, regardless of actual exposure levels. The expectation of potential outcomes is calculated for each individual in each subgroup, using individual-specific weights. These scenarios are performed for both the current and alternative interventions.</span></span>
<span id="cb64-62"><a href="#cb64-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-63"><a href="#cb64-63" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Step 4 is the estimation of the average causal effect for each subgroup, achieved by comparing the computed expected values of potential outcomes under each intervention level. The difference represents the average causal effect of changing the exposure within each subgroup.</span></span>
<span id="cb64-64"><a href="#cb64-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-65"><a href="#cb64-65" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Step 5 involves comparing differences in causal effects across groups by calculating the differences in the estimated causal effects between different subgroups. Confidence intervals and standard errors for these calculations are determined using simulation-based inference methods (Greifer et al. 2023). This step allows for a comprehensive comparison of the impact of different interventions across various subgroups, while encorporating uncertainty.</span></span>
<span id="cb64-66"><a href="#cb64-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-67"><a href="#cb64-67" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Also see the appendix [here](https://go-bayes.github.io/psych-434-2023/content/09-content.html#comprehensive-checklist-for-detailed-reporting-of-a-causal-inferenctial-study-e.g.-assessment-3-option-2) --&gt;</span></span>
<span id="cb64-68"><a href="#cb64-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-69"><a href="#cb64-69" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>State what E-values are and how you will use them to clarify the risk of unmeasured confounding.</span>
<span id="cb64-70"><a href="#cb64-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-71"><a href="#cb64-71" aria-hidden="true" tabindex="-1"></a><span class="fu">## Results</span></span>
<span id="cb64-72"><a href="#cb64-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-73"><a href="#cb64-73" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Use the scripts I have provided as a template for your analysis.</span>
<span id="cb64-74"><a href="#cb64-74" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Propensity Score Reporting: Detail the process of propensity score derivation, including the model used and any variable transformations: e.g.: <span class="in">`A ~ x1 + x2 + x3 + ....`</span> using logistic regression, all continuous predictors were transformed to z-scores</span>
<span id="cb64-75"><a href="#cb64-75" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>WeightIt Package Utilisation: Explicitly mention the use of the 'WeightIt' package in R, including any specific options or parameters used in the propensity score estimation process <span class="co">[</span><span class="ot">@greifer2023a</span><span class="co">]</span>.</span>
<span id="cb64-76"><a href="#cb64-76" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Report if different methods were used to obtain propensity scores, and the reasons behind the choice of methods such as 'ebal', 'energy', and 'ps'.</span>
<span id="cb64-77"><a href="#cb64-77" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If your exposure is continuous only the 'energy' option was used for propensity score estimation.</span>
<span id="cb64-78"><a href="#cb64-78" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Subgroup Estimation: Confirm that the propensity scores for subgroups were estimated separately, and discuss how the weights were subsequently combined with the original data.</span>
<span id="cb64-79"><a href="#cb64-79" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Covariate Balance: Include a Love plot to visually represent covariate balance on the exposure both before and after weighting. The script will generate these plots.</span>
<span id="cb64-80"><a href="#cb64-80" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Weighting Algorithm Statistics: Report the statistics for the weighting algorithms as provided by the WeightIt package, including any measures of balance or fit. The script I gave you will generate this information</span>
<span id="cb64-81"><a href="#cb64-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-82"><a href="#cb64-82" aria-hidden="true" tabindex="-1"></a>Example:</span>
<span id="cb64-83"><a href="#cb64-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-84"><a href="#cb64-84" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We estimated propensity scores by fitting a model for the exposure A as it is predicted by the set of baseline covariates defined by L. Because we are interested in effect modification by group, we fit different propensity score models for within strata of G using the </span><span class="in">`subgroup`</span><span class="at"> command of the </span><span class="in">`WeightIt`</span><span class="at"> package. Thus the propensity score is the the probability of receiving a value of a treatment (A=a) conditional on the covariates L, and stratum within G. We compared balance using the following methods of weighting: "ebal" or entropy balancing, "energy" or energy balancing, and "ps" or traditional inverse probability of weighting balancing. Of these methods "ebal" performed the best. Table X and Figure Y present the results of the ebalancing method.</span></span>
<span id="cb64-85"><a href="#cb64-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-86"><a href="#cb64-86" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Interpretation of Propensity Scores: we interpret the proposensity scores as yeilding good balance across the exposure conditions.</span>
<span id="cb64-87"><a href="#cb64-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-88"><a href="#cb64-88" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Outcome Regression Model: Clearly report the type of regression model used to estimate outcome model coefficients (e.g., linear regression, Poisson, binomial), and mention if the exposure was interacted with the baseline covariates. Do not report model coefficients as these have no interpretation. Example</span>
<span id="cb64-89"><a href="#cb64-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-90"><a href="#cb64-90" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We fit a linear model using maximum likelihood estimation with the outcome Y predicted by the exposure A. We interacted the exposure with all baseline confounders L. Continuous baseline confounders were converted to z-scores, whereas categorical exposures were not. Also interacted with all baseline confounders was a term for the subgroup interactoin. This allowed uas to flexibily fit non-linearities for the modification of the effect of the exposure within levels of the levels of the cultural group strata of interest. We note that model coefficients have no interpretation in this context so are not reported. The remaining steps of Doubly-Robust estimation were performed as outlined in the *Method* section. We calculated confidence intervals and standard errors, using the </span><span class="in">`clarify`</span><span class="at"> package in R, which relies on simulation based inference for these quantities of interest </span><span class="co">[</span><span class="ot">@greifer2023</span><span class="co">]</span></span>
<span id="cb64-91"><a href="#cb64-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-92"><a href="#cb64-92" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Report the causal estimates.</span>
<span id="cb64-93"><a href="#cb64-93" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>ATE contrasts for groups in setting the exposure to for each group in setting level A = a and A = a<span class="sc">\*</span></span>
<span id="cb64-94"><a href="#cb64-94" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>differences between groups in the magnitude of the effects. (ATE_group 1 - ATE_group_2)</span>
<span id="cb64-95"><a href="#cb64-95" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Report the E-value: how sensitive are your results to unmeasured confounding? Hint I gave you code that will create a table for you: See <span class="co">[</span><span class="ot">here</span><span class="co">](https://go-bayes.github.io/psych-434-2023/content/10-content.html)</span></span>
<span id="cb64-96"><a href="#cb64-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-97"><a href="#cb64-97" aria-hidden="true" tabindex="-1"></a><span class="in">`table_depression &lt;- tab_ate_subgroup_rd(table_estimates_depression, delta = 1, sd = 1)`</span></span>
<span id="cb64-98"><a href="#cb64-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-99"><a href="#cb64-99" aria-hidden="true" tabindex="-1"></a><span class="fu">## Discussion</span></span>
<span id="cb64-100"><a href="#cb64-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-101"><a href="#cb64-101" aria-hidden="true" tabindex="-1"></a>Make sure to hit these points:</span>
<span id="cb64-102"><a href="#cb64-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-103"><a href="#cb64-103" aria-hidden="true" tabindex="-1"></a>Consider the following ideas about what to discuss in one's findings. The order of exposition might be different.</span>
<span id="cb64-104"><a href="#cb64-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-105"><a href="#cb64-105" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Summary of results**: What did you find?</span>
<span id="cb64-106"><a href="#cb64-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-107"><a href="#cb64-107" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>**Interpretation of E-values:** Interpret the E-values used for sensitivity analysis. State what they represent in terms of the robustness of the findings to potential unmeasured confounding.</span>
<span id="cb64-108"><a href="#cb64-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-109"><a href="#cb64-109" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Causal Effect Interpretation:** What is the interest of the effect, if any, if an effect was observed? Interpret the average causal effect of changing the exposure level within each subgroup, and discuss its relevance to the research question.</span>
<span id="cb64-110"><a href="#cb64-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-111"><a href="#cb64-111" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Comparison of Subgroups:** Discuss how differences in causal effect estimates between different subgroups, if observed, or if not observed, contribute to the overall findings of the study.</span>
<span id="cb64-112"><a href="#cb64-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-113"><a href="#cb64-113" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Uncertainty and Confidence Intervals:** Consider the uncertainty around the estimated causal effects, and interpret the confidence intervals to understand the precision of the estimates.</span>
<span id="cb64-114"><a href="#cb64-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-115"><a href="#cb64-115" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Generalisability and Transportability:** Reflect on the generalizability of the study results to other contexts or populations. Discuss any factors that might influence the transportability of the causal effects found in the study. (Again see lecture 9.)</span>
<span id="cb64-116"><a href="#cb64-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-117"><a href="#cb64-117" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>**Assumptions and Limitations:** Reflect on the assumptions made during the study and identify any limitations in the methodology that could affect the interpretation of results. State that the implications of different intervention levels on potential outcomes are not analysed.</span>
<span id="cb64-118"><a href="#cb64-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-119"><a href="#cb64-119" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>**Theoretical Relevance**: How are these findings relevant to existing theories.</span>
<span id="cb64-120"><a href="#cb64-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-121"><a href="#cb64-121" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>**Replication and Future Research:** Consider how the study could be replicated or expanded upon in future research, and how the findings contribute to the existing body of knowledge in the field.</span>
<span id="cb64-122"><a href="#cb64-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-123"><a href="#cb64-123" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>**Real-world Implications:** Discuss the real-world implications of the findings, and how they could be applied in policy, practice, or further research.</span>
<span id="cb64-124"><a href="#cb64-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-125"><a href="#cb64-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example anlaysis (week 10)</span></span>
<span id="cb64-126"><a href="#cb64-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-127"><a href="#cb64-127" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load Libraries</span></span>
<span id="cb64-128"><a href="#cb64-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-131"><a href="#cb64-131" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-132"><a href="#cb64-132" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load_libraries</span></span>
<span id="cb64-133"><a href="#cb64-133" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false </span></span>
<span id="cb64-134"><a href="#cb64-134" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb64-135"><a href="#cb64-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-136"><a href="#cb64-136" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb64-137"><a href="#cb64-137" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/libs2.R"</span>)</span>
<span id="cb64-138"><a href="#cb64-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-139"><a href="#cb64-139" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb64-140"><a href="#cb64-140" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/funs.R"</span>)</span>
<span id="cb64-141"><a href="#cb64-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-142"><a href="#cb64-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-143"><a href="#cb64-143" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/experimental_funs.R"</span>)</span>
<span id="cb64-144"><a href="#cb64-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-145"><a href="#cb64-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-146"><a href="#cb64-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-147"><a href="#cb64-147" aria-hidden="true" tabindex="-1"></a><span class="co">#  If you haven't already, you should have created a folder called "data", in your Rstudio project. If not, download this file, add it to your the folder called "data" in your Rstudio project. # "https://www.dropbox.com/s/vwqijg4ha17hbs1/nzavs_dat_synth_t10_t12?dl=0"</span></span>
<span id="cb64-148"><a href="#cb64-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-149"><a href="#cb64-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-150"><a href="#cb64-150" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-151"><a href="#cb64-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-152"><a href="#cb64-152" aria-hidden="true" tabindex="-1"></a><span class="fu">### Import data</span></span>
<span id="cb64-153"><a href="#cb64-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-156"><a href="#cb64-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-157"><a href="#cb64-157" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: import_data</span></span>
<span id="cb64-158"><a href="#cb64-158" aria-hidden="true" tabindex="-1"></a><span class="co"># This will read the synthetic data into Rstudio.  Note that the arrow package allows us to have lower memory demands in the storage and retrieval of data.</span></span>
<span id="cb64-159"><a href="#cb64-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-160"><a href="#cb64-160" aria-hidden="true" tabindex="-1"></a>nzavs_synth <span class="ot">&lt;-</span> arrow<span class="sc">::</span><span class="fu">read_parquet</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"nzavs_dat_synth_t10_t12"</span>))</span>
<span id="cb64-161"><a href="#cb64-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-162"><a href="#cb64-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-163"><a href="#cb64-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-164"><a href="#cb64-164" aria-hidden="true" tabindex="-1"></a><span class="fu">### Find column names</span></span>
<span id="cb64-165"><a href="#cb64-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-168"><a href="#cb64-168" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-169"><a href="#cb64-169" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: colnames</span></span>
<span id="cb64-170"><a href="#cb64-170" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb64-171"><a href="#cb64-171" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb64-172"><a href="#cb64-172" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb64-173"><a href="#cb64-173" aria-hidden="true" tabindex="-1"></a><span class="do">## use colnames to inspect the variables</span></span>
<span id="cb64-174"><a href="#cb64-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-175"><a href="#cb64-175" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(nzavs_synth)</span>
<span id="cb64-176"><a href="#cb64-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-177"><a href="#cb64-177" aria-hidden="true" tabindex="-1"></a><span class="co"># more about the variables here: </span></span>
<span id="cb64-178"><a href="#cb64-178" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/go-bayes/psych-434-2023/blob/main/data/readme.qmd</span></span>
<span id="cb64-179"><a href="#cb64-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-180"><a href="#cb64-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-181"><a href="#cb64-181" aria-hidden="true" tabindex="-1"></a><span class="fu">### Transform indicators</span></span>
<span id="cb64-182"><a href="#cb64-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-183"><a href="#cb64-183" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the effect of exercise as measured by the NZAVS exercise scale on (1) depression and (2) anxiety.</span>
<span id="cb64-184"><a href="#cb64-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-187"><a href="#cb64-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-188"><a href="#cb64-188" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data_wrangling</span></span>
<span id="cb64-189"><a href="#cb64-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-190"><a href="#cb64-190" aria-hidden="true" tabindex="-1"></a><span class="co"># questions are:</span></span>
<span id="cb64-191"><a href="#cb64-191" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_depressed,</span></span>
<span id="cb64-192"><a href="#cb64-192" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel so depressed that nothing could cheer you up?</span></span>
<span id="cb64-193"><a href="#cb64-193" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_hopeless,</span></span>
<span id="cb64-194"><a href="#cb64-194" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel hopeless?</span></span>
<span id="cb64-195"><a href="#cb64-195" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_nervous,</span></span>
<span id="cb64-196"><a href="#cb64-196" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel nervous?</span></span>
<span id="cb64-197"><a href="#cb64-197" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_effort,</span></span>
<span id="cb64-198"><a href="#cb64-198" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel that everything was an effort?</span></span>
<span id="cb64-199"><a href="#cb64-199" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_restless,</span></span>
<span id="cb64-200"><a href="#cb64-200" aria-hidden="true" tabindex="-1"></a>      <span class="co"># # During the last 30 days, how often did you feel restless or fidgety ?</span></span>
<span id="cb64-201"><a href="#cb64-201" aria-hidden="true" tabindex="-1"></a>      <span class="co"># kessler_worthless  # During the last 30 days, how often did you feel worthless?</span></span>
<span id="cb64-202"><a href="#cb64-202" aria-hidden="true" tabindex="-1"></a>dt_start <span class="ot">&lt;-</span> nzavs_synth <span class="sc">%&gt;%</span></span>
<span id="cb64-203"><a href="#cb64-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">%&gt;%</span></span>
<span id="cb64-204"><a href="#cb64-204" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-205"><a href="#cb64-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-206"><a href="#cb64-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># see week 10 appendix 1 for a detailed explanation of how we obtain these 2 x factors</span></span>
<span id="cb64-207"><a href="#cb64-207" aria-hidden="true" tabindex="-1"></a>    <span class="at">kessler_latent_depression =</span> <span class="fu">mean</span>(</span>
<span id="cb64-208"><a href="#cb64-208" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(kessler_depressed, kessler_hopeless, kessler_effort),</span>
<span id="cb64-209"><a href="#cb64-209" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb64-210"><a href="#cb64-210" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb64-211"><a href="#cb64-211" aria-hidden="true" tabindex="-1"></a>    <span class="at">kessler_latent_anxiety  =</span> <span class="fu">mean</span>(<span class="fu">c</span>(</span>
<span id="cb64-212"><a href="#cb64-212" aria-hidden="true" tabindex="-1"></a>      kessler_effort, kessler_nervous, kessler_restless</span>
<span id="cb64-213"><a href="#cb64-213" aria-hidden="true" tabindex="-1"></a>    ), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-214"><a href="#cb64-214" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb64-215"><a href="#cb64-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb64-216"><a href="#cb64-216" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Coarsen 'hours_exercise' into categories</span></span>
<span id="cb64-217"><a href="#cb64-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-218"><a href="#cb64-218" aria-hidden="true" tabindex="-1"></a>    <span class="at">hours_exercise_coarsen =</span> <span class="fu">cut</span>(</span>
<span id="cb64-219"><a href="#cb64-219" aria-hidden="true" tabindex="-1"></a>      hours_exercise,</span>
<span id="cb64-220"><a href="#cb64-220" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Hours spent exercising/ physical activity</span></span>
<span id="cb64-221"><a href="#cb64-221" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">200</span>),</span>
<span id="cb64-222"><a href="#cb64-222" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"inactive"</span>,</span>
<span id="cb64-223"><a href="#cb64-223" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"active"</span>,</span>
<span id="cb64-224"><a href="#cb64-224" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"very_active"</span>),</span>
<span id="cb64-225"><a href="#cb64-225" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Define thresholds for categories</span></span>
<span id="cb64-226"><a href="#cb64-226" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"(-1,3]"</span>, <span class="st">"(3,8]"</span>, <span class="st">"(8,200]"</span>),</span>
<span id="cb64-227"><a href="#cb64-227" aria-hidden="true" tabindex="-1"></a>      <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb64-228"><a href="#cb64-228" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-229"><a href="#cb64-229" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb64-230"><a href="#cb64-230" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a binary 'urban' variable based on the 'rural_gch2018' variable</span></span>
<span id="cb64-231"><a href="#cb64-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">urban =</span> <span class="fu">factor</span>(</span>
<span id="cb64-232"><a href="#cb64-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(</span>
<span id="cb64-233"><a href="#cb64-233" aria-hidden="true" tabindex="-1"></a>      rural_gch2018 <span class="sc">==</span> <span class="st">"medium_urban_accessibility"</span> <span class="sc">|</span></span>
<span id="cb64-234"><a href="#cb64-234" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Define urban condition</span></span>
<span id="cb64-235"><a href="#cb64-235" aria-hidden="true" tabindex="-1"></a>        rural_gch2018 <span class="sc">==</span> <span class="st">"high_urban_accessibility"</span>,</span>
<span id="cb64-236"><a href="#cb64-236" aria-hidden="true" tabindex="-1"></a>      <span class="st">"urban"</span>,</span>
<span id="cb64-237"><a href="#cb64-237" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Label 'urban' if condition is met</span></span>
<span id="cb64-238"><a href="#cb64-238" aria-hidden="true" tabindex="-1"></a>      <span class="st">"rural"</span>  <span class="co"># Label 'rural' if condition is not met</span></span>
<span id="cb64-239"><a href="#cb64-239" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-240"><a href="#cb64-240" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb64-241"><a href="#cb64-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-242"><a href="#cb64-242" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-243"><a href="#cb64-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-244"><a href="#cb64-244" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inspect your data</span></span>
<span id="cb64-245"><a href="#cb64-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-248"><a href="#cb64-248" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-249"><a href="#cb64-249" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb64-250"><a href="#cb64-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb64-251"><a href="#cb64-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-252"><a href="#cb64-252" aria-hidden="true" tabindex="-1"></a><span class="co"># do some checks</span></span>
<span id="cb64-253"><a href="#cb64-253" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen)</span>
<span id="cb64-254"><a href="#cb64-254" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen)</span>
<span id="cb64-255"><a href="#cb64-255" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(dt_start<span class="sc">$</span>hours_exercise)</span>
<span id="cb64-256"><a href="#cb64-256" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>(dt_start<span class="sc">$</span>hours_exercise)</span>
<span id="cb64-257"><a href="#cb64-257" aria-hidden="true" tabindex="-1"></a><span class="co"># checks</span></span>
<span id="cb64-258"><a href="#cb64-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-259"><a href="#cb64-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-260"><a href="#cb64-260" aria-hidden="true" tabindex="-1"></a><span class="co"># justification for transforming exercise" has a very long tail</span></span>
<span id="cb64-261"><a href="#cb64-261" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt_start<span class="sc">$</span>hours_exercise, <span class="at">breaks =</span> <span class="dv">1000</span>)</span>
<span id="cb64-262"><a href="#cb64-262" aria-hidden="true" tabindex="-1"></a><span class="co"># consider only those cases below &lt; or = to 20</span></span>
<span id="cb64-263"><a href="#cb64-263" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">subset</span>(dt_start, hours_exercise <span class="sc">&lt;=</span> <span class="dv">20</span>)<span class="sc">$</span>hours_exercise)</span>
<span id="cb64-264"><a href="#cb64-264" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">as.numeric</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen))</span>
<span id="cb64-265"><a href="#cb64-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-266"><a href="#cb64-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-267"><a href="#cb64-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-268"><a href="#cb64-268" aria-hidden="true" tabindex="-1"></a><span class="fu">### Investigate assumption of positivity:</span></span>
<span id="cb64-269"><a href="#cb64-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-270"><a href="#cb64-270" aria-hidden="true" tabindex="-1"></a>Recall the positive assumption:</span>
<span id="cb64-271"><a href="#cb64-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-272"><a href="#cb64-272" aria-hidden="true" tabindex="-1"></a>**Positivity:** Can we intervene on the exposure at all levels of the covariates?</span>
<span id="cb64-273"><a href="#cb64-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-274"><a href="#cb64-274" aria-hidden="true" tabindex="-1"></a>These are the data by wave, but they don't track who changed.</span>
<span id="cb64-275"><a href="#cb64-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-278"><a href="#cb64-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-279"><a href="#cb64-279" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: prepare_exposure_data</span></span>
<span id="cb64-280"><a href="#cb64-280" aria-hidden="true" tabindex="-1"></a><span class="co">#  select only the baseline year and the exposure year.  That will give us change in the exposure. ()</span></span>
<span id="cb64-281"><a href="#cb64-281" aria-hidden="true" tabindex="-1"></a>dt_exposure <span class="ot">&lt;-</span> dt_start <span class="sc">|&gt;</span></span>
<span id="cb64-282"><a href="#cb64-282" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-283"><a href="#cb64-283" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select baseline year and exposure year</span></span>
<span id="cb64-284"><a href="#cb64-284" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="st">"2018"</span> <span class="sc">|</span> wave <span class="sc">==</span> <span class="st">"2019"</span>) <span class="sc">|&gt;</span></span>
<span id="cb64-285"><a href="#cb64-285" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-286"><a href="#cb64-286" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select variables of interest</span></span>
<span id="cb64-287"><a href="#cb64-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, wave, hours_exercise_coarsen,  eth_cat) <span class="sc">|&gt;</span></span>
<span id="cb64-288"><a href="#cb64-288" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb64-289"><a href="#cb64-289" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the categorical variable needs to be numeric for us to use msm package to investigate change</span></span>
<span id="cb64-290"><a href="#cb64-290" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hours_exercise_coarsen_n =</span> <span class="fu">as.numeric</span>(hours_exercise_coarsen)) <span class="sc">|&gt;</span></span>
<span id="cb64-291"><a href="#cb64-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb64-292"><a href="#cb64-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-293"><a href="#cb64-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-294"><a href="#cb64-294" aria-hidden="true" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb64-295"><a href="#cb64-295" aria-hidden="true" tabindex="-1"></a>dt_exposure <span class="sc">|&gt;</span></span>
<span id="cb64-296"><a href="#cb64-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(hours_exercise_coarsen_n, eth_cat,  wave )</span>
<span id="cb64-297"><a href="#cb64-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-298"><a href="#cb64-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-299"><a href="#cb64-299" aria-hidden="true" tabindex="-1"></a>I've written a function called <span class="in">`transition_table`</span> that will help us assess change in the exposure at the *individual level.*</span>
<span id="cb64-300"><a href="#cb64-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-303"><a href="#cb64-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-304"><a href="#cb64-304" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: transition_table</span></span>
<span id="cb64-305"><a href="#cb64-305" aria-hidden="true" tabindex="-1"></a><span class="co">#   consider people going from active to vary active</span></span>
<span id="cb64-306"><a href="#cb64-306" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> msm<span class="sc">::</span><span class="fu">statetable.msm</span>(<span class="fu">round</span>(hours_exercise_coarsen_n, <span class="dv">0</span>), id, <span class="at">data =</span> dt_exposure)</span>
<span id="cb64-307"><a href="#cb64-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-308"><a href="#cb64-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-309"><a href="#cb64-309" aria-hidden="true" tabindex="-1"></a><span class="co"># for a function I wrote to create state tables</span></span>
<span id="cb64-310"><a href="#cb64-310" aria-hidden="true" tabindex="-1"></a>state_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Inactive"</span>, <span class="st">"Somewhat Active"</span>, <span class="st">"Active"</span>, <span class="st">"Extremely Active"</span>)</span>
<span id="cb64-311"><a href="#cb64-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-312"><a href="#cb64-312" aria-hidden="true" tabindex="-1"></a><span class="co"># transition table</span></span>
<span id="cb64-313"><a href="#cb64-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-314"><a href="#cb64-314" aria-hidden="true" tabindex="-1"></a><span class="fu">transition_table</span>(out, state_names)</span>
<span id="cb64-315"><a href="#cb64-315" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-316"><a href="#cb64-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-317"><a href="#cb64-317" aria-hidden="true" tabindex="-1"></a>Next consider Māori only</span>
<span id="cb64-318"><a href="#cb64-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-321"><a href="#cb64-321" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-322"><a href="#cb64-322" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: maori_only_transition</span></span>
<span id="cb64-323"><a href="#cb64-323" aria-hidden="true" tabindex="-1"></a><span class="co"># Maori only</span></span>
<span id="cb64-324"><a href="#cb64-324" aria-hidden="true" tabindex="-1"></a>dt_exposure_maori <span class="ot">&lt;-</span> dt_exposure <span class="sc">|&gt;</span></span>
<span id="cb64-325"><a href="#cb64-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(eth_cat <span class="sc">==</span> <span class="st">"māori"</span>)</span>
<span id="cb64-326"><a href="#cb64-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-327"><a href="#cb64-327" aria-hidden="true" tabindex="-1"></a>out_m <span class="ot">&lt;-</span> msm<span class="sc">::</span><span class="fu">statetable.msm</span>(<span class="fu">round</span>(hours_exercise_coarsen_n, <span class="dv">0</span>), id, <span class="at">data =</span> dt_exposure_maori)</span>
<span id="cb64-328"><a href="#cb64-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-329"><a href="#cb64-329" aria-hidden="true" tabindex="-1"></a><span class="co"># with this little support we might consider parametric models</span></span>
<span id="cb64-330"><a href="#cb64-330" aria-hidden="true" tabindex="-1"></a>t_tab_m<span class="ot">&lt;-</span> <span class="fu">transition_table</span>( out_m, state_names)</span>
<span id="cb64-331"><a href="#cb64-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-332"><a href="#cb64-332" aria-hidden="true" tabindex="-1"></a><span class="co">#interpretation</span></span>
<span id="cb64-333"><a href="#cb64-333" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(t_tab_m<span class="sc">$</span>explanation)</span>
<span id="cb64-334"><a href="#cb64-334" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t_tab_m<span class="sc">$</span>table)</span>
<span id="cb64-335"><a href="#cb64-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-336"><a href="#cb64-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-337"><a href="#cb64-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-340"><a href="#cb64-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-341"><a href="#cb64-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: euro_only_transition</span></span>
<span id="cb64-342"><a href="#cb64-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-343"><a href="#cb64-343" aria-hidden="true" tabindex="-1"></a><span class="co"># filter euro</span></span>
<span id="cb64-344"><a href="#cb64-344" aria-hidden="true" tabindex="-1"></a>dt_exposure_euro <span class="ot">&lt;-</span> dt_exposure <span class="sc">|&gt;</span></span>
<span id="cb64-345"><a href="#cb64-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(eth_cat <span class="sc">==</span> <span class="st">"euro"</span>)</span>
<span id="cb64-346"><a href="#cb64-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-347"><a href="#cb64-347" aria-hidden="true" tabindex="-1"></a><span class="co"># model change</span></span>
<span id="cb64-348"><a href="#cb64-348" aria-hidden="true" tabindex="-1"></a>out_e <span class="ot">&lt;-</span> msm<span class="sc">::</span><span class="fu">statetable.msm</span>(<span class="fu">round</span>(hours_exercise_coarsen_n, <span class="dv">0</span>), id, <span class="at">data =</span> dt_exposure_euro)</span>
<span id="cb64-349"><a href="#cb64-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-350"><a href="#cb64-350" aria-hidden="true" tabindex="-1"></a><span class="co"># creat transition table.</span></span>
<span id="cb64-351"><a href="#cb64-351" aria-hidden="true" tabindex="-1"></a>t_tab_e <span class="ot">&lt;-</span> <span class="fu">transition_table</span>( out_e, state_names)</span>
<span id="cb64-352"><a href="#cb64-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-353"><a href="#cb64-353" aria-hidden="true" tabindex="-1"></a><span class="co">#interpretation</span></span>
<span id="cb64-354"><a href="#cb64-354" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(t_tab_e<span class="sc">$</span>explanation)</span>
<span id="cb64-355"><a href="#cb64-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-356"><a href="#cb64-356" aria-hidden="true" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb64-357"><a href="#cb64-357" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t_tab_e<span class="sc">$</span>table)</span>
<span id="cb64-358"><a href="#cb64-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-359"><a href="#cb64-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-360"><a href="#cb64-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-361"><a href="#cb64-361" aria-hidden="true" tabindex="-1"></a>Overall we find evidence for change in the exposure variable. This suggest that we are ready to proceed with the next step of causal estimation.</span>
<span id="cb64-362"><a href="#cb64-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-363"><a href="#cb64-363" aria-hidden="true" tabindex="-1"></a><span class="fu">## Draw Dag</span></span>
<span id="cb64-364"><a href="#cb64-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-367"><a href="#cb64-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb64-368"><a href="#cb64-368" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-6</span></span>
<span id="cb64-369"><a href="#cb64-369" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Causal graph: three-wave panel design"</span></span>
<span id="cb64-370"><a href="#cb64-370" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb64-371"><a href="#cb64-371" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: true</span></span>
<span id="cb64-372"><a href="#cb64-372" aria-hidden="true" tabindex="-1"></a><span class="in">#| codefolding: true</span></span>
<span id="cb64-373"><a href="#cb64-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-374"><a href="#cb64-374" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb64-375"><a href="#cb64-375" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb64-376"><a href="#cb64-376" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb64-377"><a href="#cb64-377" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb64-378"><a href="#cb64-378" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb64-379"><a href="#cb64-379" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb64-380"><a href="#cb64-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-381"><a href="#cb64-381" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb64-382"><a href="#cb64-382" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (U) at (0, 0) {U};</span></span>
<span id="cb64-383"><a href="#cb64-383" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y};</span></span>
<span id="cb64-384"><a href="#cb64-384" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (4, 0) {t1/A};</span></span>
<span id="cb64-385"><a href="#cb64-385" aria-hidden="true" tabindex="-1"></a><span class="in">\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};</span></span>
<span id="cb64-386"><a href="#cb64-386" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (U) to (L);</span></span>
<span id="cb64-387"><a href="#cb64-387" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (L) to (A);</span></span>
<span id="cb64-388"><a href="#cb64-388" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red, dotted] (A) to (Y);</span></span>
<span id="cb64-389"><a href="#cb64-389" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left=50, draw =black] (L) to (Y);</span></span>
<span id="cb64-390"><a href="#cb64-390" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend right=50, draw =black, dotted] (U) to (Y);</span></span>
<span id="cb64-391"><a href="#cb64-391" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left=50, draw =black, dotted] (U) to (A);</span></span>
<span id="cb64-392"><a href="#cb64-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-393"><a href="#cb64-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-394"><a href="#cb64-394" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb64-395"><a href="#cb64-395" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-396"><a href="#cb64-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-397"><a href="#cb64-397" aria-hidden="true" tabindex="-1"></a><span class="fu">### Create wide data frame for analysis</span></span>
<span id="cb64-398"><a href="#cb64-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-399"><a href="#cb64-399" aria-hidden="true" tabindex="-1"></a>I've written a function</span>
<span id="cb64-400"><a href="#cb64-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-403"><a href="#cb64-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-404"><a href="#cb64-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| table: wide_data</span></span>
<span id="cb64-405"><a href="#cb64-405" aria-hidden="true" tabindex="-1"></a><span class="do">############## ############## ############## ############## ############## ############## ############## ########</span></span>
<span id="cb64-406"><a href="#cb64-406" aria-hidden="true" tabindex="-1"></a><span class="do">####  ####  ####  CREATE DATA FRAME FOR ANALYSIS ####  ####  ################## ############## ######## #########</span></span>
<span id="cb64-407"><a href="#cb64-407" aria-hidden="true" tabindex="-1"></a><span class="do">############## ############## ############## ############## ############## ############## ############# #########</span></span>
<span id="cb64-408"><a href="#cb64-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-409"><a href="#cb64-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-410"><a href="#cb64-410" aria-hidden="true" tabindex="-1"></a><span class="co"># I have created a function that will put the data into the correct shape. Here are the steps.</span></span>
<span id="cb64-411"><a href="#cb64-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-412"><a href="#cb64-412" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: choose baseline variables (confounders).  here we select standard demographic variablees plus personality variables.</span></span>
<span id="cb64-413"><a href="#cb64-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-414"><a href="#cb64-414" aria-hidden="true" tabindex="-1"></a><span class="co"># Note again that the function will automatically include the baseline exposure and basline outcome in the baseline variable confounder set so you don't need to include these. </span></span>
<span id="cb64-415"><a href="#cb64-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-416"><a href="#cb64-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-417"><a href="#cb64-417" aria-hidden="true" tabindex="-1"></a><span class="co"># here are some plausible baseline confounders</span></span>
<span id="cb64-418"><a href="#cb64-418" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb64-419"><a href="#cb64-419" aria-hidden="true" tabindex="-1"></a>  <span class="st">"edu"</span>,</span>
<span id="cb64-420"><a href="#cb64-420" aria-hidden="true" tabindex="-1"></a>  <span class="st">"male"</span>,</span>
<span id="cb64-421"><a href="#cb64-421" aria-hidden="true" tabindex="-1"></a>  <span class="st">"eth_cat"</span>,</span>
<span id="cb64-422"><a href="#cb64-422" aria-hidden="true" tabindex="-1"></a>  <span class="st">"employed"</span>,</span>
<span id="cb64-423"><a href="#cb64-423" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gen_cohort"</span>,</span>
<span id="cb64-424"><a href="#cb64-424" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nz_dep2018"</span>,</span>
<span id="cb64-425"><a href="#cb64-425" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nzsei13"</span>,</span>
<span id="cb64-426"><a href="#cb64-426" aria-hidden="true" tabindex="-1"></a>  <span class="st">"partner"</span>,</span>
<span id="cb64-427"><a href="#cb64-427" aria-hidden="true" tabindex="-1"></a>  <span class="st">"parent"</span>,</span>
<span id="cb64-428"><a href="#cb64-428" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pol_orient"</span>,</span>
<span id="cb64-429"><a href="#cb64-429" aria-hidden="true" tabindex="-1"></a>  <span class="st">"urban"</span>,</span>
<span id="cb64-430"><a href="#cb64-430" aria-hidden="true" tabindex="-1"></a>  <span class="st">"agreeableness"</span>,</span>
<span id="cb64-431"><a href="#cb64-431" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conscientiousness"</span>,</span>
<span id="cb64-432"><a href="#cb64-432" aria-hidden="true" tabindex="-1"></a>  <span class="st">"extraversion"</span>,</span>
<span id="cb64-433"><a href="#cb64-433" aria-hidden="true" tabindex="-1"></a>  <span class="st">"honesty_humility"</span>,</span>
<span id="cb64-434"><a href="#cb64-434" aria-hidden="true" tabindex="-1"></a>  <span class="st">"openness"</span>,</span>
<span id="cb64-435"><a href="#cb64-435" aria-hidden="true" tabindex="-1"></a>  <span class="st">"neuroticism"</span>,</span>
<span id="cb64-436"><a href="#cb64-436" aria-hidden="true" tabindex="-1"></a>  <span class="st">"modesty"</span>,</span>
<span id="cb64-437"><a href="#cb64-437" aria-hidden="true" tabindex="-1"></a>  <span class="st">"religion_identification_level"</span></span>
<span id="cb64-438"><a href="#cb64-438" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-439"><a href="#cb64-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-440"><a href="#cb64-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-441"><a href="#cb64-441" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2, select the exposure variable.  This is the "cause"</span></span>
<span id="cb64-442"><a href="#cb64-442" aria-hidden="true" tabindex="-1"></a>exposure_var <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"hours_exercise_coarsen"</span>)</span>
<span id="cb64-443"><a href="#cb64-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-444"><a href="#cb64-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-445"><a href="#cb64-445" aria-hidden="true" tabindex="-1"></a><span class="do">## step 3. select the outcome variable.  These are the outcomes.</span></span>
<span id="cb64-446"><a href="#cb64-446" aria-hidden="true" tabindex="-1"></a>outcome_vars_reflective <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"kessler_latent_anxiety"</span>,</span>
<span id="cb64-447"><a href="#cb64-447" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"kessler_latent_depression"</span>)</span>
<span id="cb64-448"><a href="#cb64-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-449"><a href="#cb64-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-450"><a href="#cb64-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-451"><a href="#cb64-451" aria-hidden="true" tabindex="-1"></a><span class="co"># the function "create_wide_data" should be in your environment.</span></span>
<span id="cb64-452"><a href="#cb64-452" aria-hidden="true" tabindex="-1"></a><span class="co"># If not, make sure to run the first line of code in this script once more.  You may ignore the warnings. or uncomment and run the code below</span></span>
<span id="cb64-453"><a href="#cb64-453" aria-hidden="true" tabindex="-1"></a><span class="co"># source("https://raw.githubusercontent.com/go-bayes/templates/main/functions/funs.R")</span></span>
<span id="cb64-454"><a href="#cb64-454" aria-hidden="true" tabindex="-1"></a>dt_prepare <span class="ot">&lt;-</span></span>
<span id="cb64-455"><a href="#cb64-455" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_wide_data</span>(</span>
<span id="cb64-456"><a href="#cb64-456" aria-hidden="true" tabindex="-1"></a>    <span class="at">dat_long =</span> dt_start,</span>
<span id="cb64-457"><a href="#cb64-457" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseline_vars =</span> baseline_vars,</span>
<span id="cb64-458"><a href="#cb64-458" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure_var =</span> exposure_var,</span>
<span id="cb64-459"><a href="#cb64-459" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_vars =</span> outcome_vars_reflective</span>
<span id="cb64-460"><a href="#cb64-460" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-461"><a href="#cb64-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-462"><a href="#cb64-462" aria-hidden="true" tabindex="-1"></a><span class="co"># ignore warning</span></span>
<span id="cb64-463"><a href="#cb64-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-464"><a href="#cb64-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-465"><a href="#cb64-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-466"><a href="#cb64-466" aria-hidden="true" tabindex="-1"></a><span class="fu">## Descriptive table</span></span>
<span id="cb64-467"><a href="#cb64-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-470"><a href="#cb64-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-471"><a href="#cb64-471" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simple_table</span></span>
<span id="cb64-472"><a href="#cb64-472" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb64-473"><a href="#cb64-473" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb64-474"><a href="#cb64-474" aria-hidden="true" tabindex="-1"></a><span class="co"># I have created a function that will allow you to take a data frame and</span></span>
<span id="cb64-475"><a href="#cb64-475" aria-hidden="true" tabindex="-1"></a><span class="co"># create a table</span></span>
<span id="cb64-476"><a href="#cb64-476" aria-hidden="true" tabindex="-1"></a><span class="fu">baseline_table</span>(dt_prepare, <span class="at">output_format =</span> <span class="st">"markdown"</span>)</span>
<span id="cb64-477"><a href="#cb64-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-478"><a href="#cb64-478" aria-hidden="true" tabindex="-1"></a><span class="co"># but it is not very nice. Next up, is a better table</span></span>
<span id="cb64-479"><a href="#cb64-479" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-480"><a href="#cb64-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-483"><a href="#cb64-483" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-484"><a href="#cb64-484" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: table_better</span></span>
<span id="cb64-485"><a href="#cb64-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-486"><a href="#cb64-486" aria-hidden="true" tabindex="-1"></a><span class="co"># get data into shape</span></span>
<span id="cb64-487"><a href="#cb64-487" aria-hidden="true" tabindex="-1"></a>dt_new <span class="ot">&lt;-</span> dt_prepare <span class="sc">%&gt;%</span></span>
<span id="cb64-488"><a href="#cb64-488" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"t0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-489"><a href="#cb64-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_all</span>( <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(., <span class="st">"^t0_"</span>, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-490"><a href="#cb64-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="st">"baseline"</span>, <span class="fu">nrow</span>(dt_prepare)))) <span class="sc">|&gt;</span></span>
<span id="cb64-491"><a href="#cb64-491" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>(<span class="at">case =</span> <span class="st">"screaming_snake"</span>)</span>
<span id="cb64-492"><a href="#cb64-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-493"><a href="#cb64-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-494"><a href="#cb64-494" aria-hidden="true" tabindex="-1"></a><span class="co"># create a formula string</span></span>
<span id="cb64-495"><a href="#cb64-495" aria-hidden="true" tabindex="-1"></a>baseline_vars_names <span class="ot">&lt;-</span> dt_new <span class="sc">%&gt;%</span></span>
<span id="cb64-496"><a href="#cb64-496" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>WAVE) <span class="sc">%&gt;%</span></span>
<span id="cb64-497"><a href="#cb64-497" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>()</span>
<span id="cb64-498"><a href="#cb64-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-499"><a href="#cb64-499" aria-hidden="true" tabindex="-1"></a>table_baseline_vars <span class="ot">&lt;-</span></span>
<span id="cb64-500"><a href="#cb64-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(baseline_vars_names, <span class="at">collapse =</span> <span class="st">"+"</span>)</span>
<span id="cb64-501"><a href="#cb64-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-502"><a href="#cb64-502" aria-hidden="true" tabindex="-1"></a>formula_string_table_baseline <span class="ot">&lt;-</span></span>
<span id="cb64-503"><a href="#cb64-503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"~"</span>, table_baseline_vars, <span class="st">"|WAVE"</span>)</span>
<span id="cb64-504"><a href="#cb64-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-505"><a href="#cb64-505" aria-hidden="true" tabindex="-1"></a>table1<span class="sc">::</span><span class="fu">table1</span>(<span class="fu">as.formula</span>(formula_string_table_baseline),</span>
<span id="cb64-506"><a href="#cb64-506" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dt_new,</span>
<span id="cb64-507"><a href="#cb64-507" aria-hidden="true" tabindex="-1"></a>               <span class="at">overall =</span> <span class="cn">FALSE</span>)</span>
<span id="cb64-508"><a href="#cb64-508" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-509"><a href="#cb64-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-510"><a href="#cb64-510" aria-hidden="true" tabindex="-1"></a>We need to do some more data wrangling, alas! Data wrangling is the majority of data analysis. The good news is that R makes wrangling relatively straightforward.</span>
<span id="cb64-511"><a href="#cb64-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-512"><a href="#cb64-512" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span><span class="in">`mutate(id = factor(1:nrow(dt_prepare)))`</span>: This creates a new column called <span class="in">`id`</span> that has unique identification factors for each row in the dataset. It ranges from 1 to the number of rows in the dataset.</span>
<span id="cb64-513"><a href="#cb64-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-514"><a href="#cb64-514" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>The next <span class="in">`mutate`</span> operation is used to convert the <span class="in">`t0_eth_cat`</span>, <span class="in">`t0_urban`</span>, and <span class="in">`t0_gen_cohort`</span> variables to factor type, if they are not already.</span>
<span id="cb64-515"><a href="#cb64-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-516"><a href="#cb64-516" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>The <span class="in">`filter`</span> command is used to subset the dataset to only include rows where the <span class="in">`t0_eth_cat`</span> is either "euro" or "māori". The original dataset includes data with four different ethnic categories. This command filters out any row not related to these two groups.</span>
<span id="cb64-517"><a href="#cb64-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-518"><a href="#cb64-518" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span><span class="in">`ungroup()`</span> ensures that there's no grouping in the dataframe.</span>
<span id="cb64-519"><a href="#cb64-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-520"><a href="#cb64-520" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>The <span class="in">`mutate(across(where(is.numeric), ~ scale(.x), .names = "{col}_z"))`</span> step standardizes all numeric columns in the dataset by subtracting the mean and dividing by the standard deviation (a z-score transformation). The resulting columns are renamed to include "<span class="sc">\_</span>z" at the end of their original names.</span>
<span id="cb64-521"><a href="#cb64-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-522"><a href="#cb64-522" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>The <span class="in">`select`</span> function is used to keep only specific columns: the <span class="in">`id`</span> column, any columns that are factors, and any columns that end in "<span class="sc">\_</span>z".</span>
<span id="cb64-523"><a href="#cb64-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-524"><a href="#cb64-524" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>The <span class="in">`relocate`</span> functions re-order columns. The first <span class="in">`relocate`</span> places the <span class="in">`id`</span> column at the beginning. The next three <span class="in">`relocate`</span> functions order the rest of the columns based on their names: those starting with "t0<span class="sc">\_</span>" are placed before "t1<span class="sc">\_</span>" columns, and those starting with "t2<span class="sc">\_</span>" are placed after "t1<span class="sc">\_</span>" columns.</span>
<span id="cb64-525"><a href="#cb64-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-526"><a href="#cb64-526" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span><span class="in">`droplevels()`</span> removes unused factor levels in the dataframe.</span>
<span id="cb64-527"><a href="#cb64-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-528"><a href="#cb64-528" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>Finally, <span class="in">`skimr::skim(dt)`</span> will print out a summary of the data in the <span class="in">`dt`</span> object using the skimr package. This provides a useful overview of the data, including data types and summary statistics.</span>
<span id="cb64-529"><a href="#cb64-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-530"><a href="#cb64-530" aria-hidden="true" tabindex="-1"></a>This function seems to be part of a data preparation pipeline in a longitudinal or panel analysis, where observations are ordered over time (indicated by t0<span class="sc">\_</span>, t1<span class="sc">\_</span>, t2<span class="sc">\_</span>, etc.).</span>
<span id="cb64-531"><a href="#cb64-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-534"><a href="#cb64-534" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-535"><a href="#cb64-535" aria-hidden="true" tabindex="-1"></a><span class="do">### </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> SUBGROUP DATA ANALYSIS: DATA WRANGLING  </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span></span>
<span id="cb64-536"><a href="#cb64-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-537"><a href="#cb64-537" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt_prepare<span class="sc">|&gt;</span></span>
<span id="cb64-538"><a href="#cb64-538" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dt_prepare))) <span class="sc">|&gt;</span></span>
<span id="cb64-539"><a href="#cb64-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-540"><a href="#cb64-540" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_eth_cat =</span> <span class="fu">as.factor</span>(t0_eth_cat),</span>
<span id="cb64-541"><a href="#cb64-541" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_urban =</span> <span class="fu">as.factor</span>(t0_urban),</span>
<span id="cb64-542"><a href="#cb64-542" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_gen_cohort =</span> <span class="fu">as.factor</span>(t0_gen_cohort)</span>
<span id="cb64-543"><a href="#cb64-543" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb64-544"><a href="#cb64-544" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span> <span class="sc">|</span></span>
<span id="cb64-545"><a href="#cb64-545" aria-hidden="true" tabindex="-1"></a>                t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>) <span class="sc">|&gt;</span> <span class="co"># Too few asian and pacific</span></span>
<span id="cb64-546"><a href="#cb64-546" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb64-547"><a href="#cb64-547" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform numeric variables into z scores (improves estimation)</span></span>
<span id="cb64-548"><a href="#cb64-548" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">scale</span>(.x), <span class="at">.names =</span> <span class="st">"{col}_z"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-549"><a href="#cb64-549" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only factors and numeric values that are z-scores</span></span>
<span id="cb64-550"><a href="#cb64-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="co"># category is too sparse</span></span>
<span id="cb64-551"><a href="#cb64-551" aria-hidden="true" tabindex="-1"></a>         <span class="fu">where</span>(is.factor),</span>
<span id="cb64-552"><a href="#cb64-552" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ends_with</span>(<span class="st">"_z"</span>), ) <span class="sc">|&gt;</span></span>
<span id="cb64-553"><a href="#cb64-553" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tidy data frame so that the columns are ordered by time (useful for more complex models)</span></span>
<span id="cb64-554"><a href="#cb64-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(id, <span class="at">.before =</span> <span class="fu">starts_with</span>(<span class="st">"t1_"</span>))   <span class="sc">|&gt;</span></span>
<span id="cb64-555"><a href="#cb64-555" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">"t0_"</span>), <span class="at">.before =</span> <span class="fu">starts_with</span>(<span class="st">"t1_"</span>))  <span class="sc">|&gt;</span></span>
<span id="cb64-556"><a href="#cb64-556" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">"t2_"</span>), <span class="at">.after =</span> <span class="fu">starts_with</span>(<span class="st">"t1_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb64-557"><a href="#cb64-557" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb64-558"><a href="#cb64-558" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-559"><a href="#cb64-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-562"><a href="#cb64-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-563"><a href="#cb64-563" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: more-data-checks</span></span>
<span id="cb64-564"><a href="#cb64-564" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb64-565"><a href="#cb64-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-566"><a href="#cb64-566" aria-hidden="true" tabindex="-1"></a><span class="co"># checks</span></span>
<span id="cb64-567"><a href="#cb64-567" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt<span class="sc">$</span>t2_kessler_latent_depression_z)</span>
<span id="cb64-568"><a href="#cb64-568" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt<span class="sc">$</span>t2_kessler_latent_anxiety_z)</span>
<span id="cb64-569"><a href="#cb64-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-570"><a href="#cb64-570" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">|&gt;</span></span>
<span id="cb64-571"><a href="#cb64-571" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(t0_eth_cat, t1_hours_exercise_coarsen ) <span class="sc">|&gt;</span></span>
<span id="cb64-572"><a href="#cb64-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span>
<span id="cb64-573"><a href="#cb64-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-574"><a href="#cb64-574" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise missingness</span></span>
<span id="cb64-575"><a href="#cb64-575" aria-hidden="true" tabindex="-1"></a>naniar<span class="sc">::</span><span class="fu">vis_miss</span>(dt)</span>
<span id="cb64-576"><a href="#cb64-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-577"><a href="#cb64-577" aria-hidden="true" tabindex="-1"></a><span class="co"># save your dataframe for future use</span></span>
<span id="cb64-578"><a href="#cb64-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-579"><a href="#cb64-579" aria-hidden="true" tabindex="-1"></a><span class="co"># make dataframe</span></span>
<span id="cb64-580"><a href="#cb64-580" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">as.data.frame</span>(dt)</span>
<span id="cb64-581"><a href="#cb64-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-582"><a href="#cb64-582" aria-hidden="true" tabindex="-1"></a><span class="co"># save data</span></span>
<span id="cb64-583"><a href="#cb64-583" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt"</span>))</span>
<span id="cb64-584"><a href="#cb64-584" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-585"><a href="#cb64-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-586"><a href="#cb64-586" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculate propensity scores</span></span>
<span id="cb64-587"><a href="#cb64-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-588"><a href="#cb64-588" aria-hidden="true" tabindex="-1"></a>Next we generate propensity scores.</span>
<span id="cb64-589"><a href="#cb64-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-592"><a href="#cb64-592" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-593"><a href="#cb64-593" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propensity_score prepare</span></span>
<span id="cb64-594"><a href="#cb64-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-595"><a href="#cb64-595" aria-hidden="true" tabindex="-1"></a><span class="co"># read  data -- you may start here if you need to repeat the analysis</span></span>
<span id="cb64-596"><a href="#cb64-596" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt"</span>))</span>
<span id="cb64-597"><a href="#cb64-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-598"><a href="#cb64-598" aria-hidden="true" tabindex="-1"></a><span class="co"># get column names</span></span>
<span id="cb64-599"><a href="#cb64-599" aria-hidden="true" tabindex="-1"></a>baseline_vars_reflective_propensity <span class="ot">&lt;-</span> dt<span class="sc">|&gt;</span></span>
<span id="cb64-600"><a href="#cb64-600" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"t0"</span>), <span class="sc">-</span>t0_eth_cat) <span class="sc">|&gt;</span> <span class="fu">colnames</span>()</span>
<span id="cb64-601"><a href="#cb64-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-602"><a href="#cb64-602" aria-hidden="true" tabindex="-1"></a><span class="co"># define our exposure</span></span>
<span id="cb64-603"><a href="#cb64-603" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="st">"t1_hours_exercise_coarsen"</span></span>
<span id="cb64-604"><a href="#cb64-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-605"><a href="#cb64-605" aria-hidden="true" tabindex="-1"></a><span class="co"># define subclasses</span></span>
<span id="cb64-606"><a href="#cb64-606" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="st">"t0_eth_cat"</span></span>
<span id="cb64-607"><a href="#cb64-607" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-608"><a href="#cb64-608" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure data is in a data frame format</span></span>
<span id="cb64-609"><a href="#cb64-609" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dt)</span>
<span id="cb64-610"><a href="#cb64-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-611"><a href="#cb64-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-612"><a href="#cb64-612" aria-hidden="true" tabindex="-1"></a><span class="co"># next we use our trick for creating a formula string, which will reduce our work</span></span>
<span id="cb64-613"><a href="#cb64-613" aria-hidden="true" tabindex="-1"></a>formula_str_prop <span class="ot">&lt;-</span></span>
<span id="cb64-614"><a href="#cb64-614" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(X,</span>
<span id="cb64-615"><a href="#cb64-615" aria-hidden="true" tabindex="-1"></a>        <span class="st">"~"</span>,</span>
<span id="cb64-616"><a href="#cb64-616" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(baseline_vars_reflective_propensity, <span class="at">collapse =</span> <span class="st">"+"</span>))</span>
<span id="cb64-617"><a href="#cb64-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-618"><a href="#cb64-618" aria-hidden="true" tabindex="-1"></a><span class="co"># this shows the exposure variable as predicted by the baseline confounders.</span></span>
<span id="cb64-619"><a href="#cb64-619" aria-hidden="true" tabindex="-1"></a>formula_str_prop</span>
<span id="cb64-620"><a href="#cb64-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-621"><a href="#cb64-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-622"><a href="#cb64-622" aria-hidden="true" tabindex="-1"></a>For propensity score analysis, we will try several different approaches. We will want to select the method that produces the best balance.</span>
<span id="cb64-623"><a href="#cb64-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-624"><a href="#cb64-624" aria-hidden="true" tabindex="-1"></a>I typically use <span class="in">`ps`</span> (classical propensity scores), <span class="in">`ebal`</span> and <span class="in">`energy`</span>. The latter two in my experience yeild good balance. Also <span class="in">`energy`</span> will work with *continuous* exposures.</span>
<span id="cb64-625"><a href="#cb64-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-626"><a href="#cb64-626" aria-hidden="true" tabindex="-1"></a>For more information, see <span class="ot">&lt;https://ngreifer.github.io/WeightIt/&gt;</span></span>
<span id="cb64-627"><a href="#cb64-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-630"><a href="#cb64-630" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-631"><a href="#cb64-631" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: propensity_scores</span></span>
<span id="cb64-632"><a href="#cb64-632" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb64-633"><a href="#cb64-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-634"><a href="#cb64-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-635"><a href="#cb64-635" aria-hidden="true" tabindex="-1"></a><span class="co"># traditional propensity scores-- note we select the ATT and we have a subgroup </span></span>
<span id="cb64-636"><a href="#cb64-636" aria-hidden="true" tabindex="-1"></a>dt_match_ps <span class="ot">&lt;-</span> <span class="fu">match_mi_general</span>(</span>
<span id="cb64-637"><a href="#cb64-637" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dt,</span>
<span id="cb64-638"><a href="#cb64-638" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb64-639"><a href="#cb64-639" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_vars =</span> baseline_vars_reflective_propensity,</span>
<span id="cb64-640"><a href="#cb64-640" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroup =</span> <span class="st">"t0_eth_cat"</span>,</span>
<span id="cb64-641"><a href="#cb64-641" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span>,</span>
<span id="cb64-642"><a href="#cb64-642" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ps"</span></span>
<span id="cb64-643"><a href="#cb64-643" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-644"><a href="#cb64-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-645"><a href="#cb64-645" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_match_ps, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ps"</span>))</span>
<span id="cb64-646"><a href="#cb64-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-647"><a href="#cb64-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-648"><a href="#cb64-648" aria-hidden="true" tabindex="-1"></a><span class="co"># ebalance</span></span>
<span id="cb64-649"><a href="#cb64-649" aria-hidden="true" tabindex="-1"></a>dt_match_ebal <span class="ot">&lt;-</span> <span class="fu">match_mi_general</span>(</span>
<span id="cb64-650"><a href="#cb64-650" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dt,</span>
<span id="cb64-651"><a href="#cb64-651" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb64-652"><a href="#cb64-652" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_vars =</span> baseline_vars_reflective_propensity,</span>
<span id="cb64-653"><a href="#cb64-653" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroup =</span> <span class="st">"t0_eth_cat"</span>,</span>
<span id="cb64-654"><a href="#cb64-654" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span>,</span>
<span id="cb64-655"><a href="#cb64-655" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ebal"</span></span>
<span id="cb64-656"><a href="#cb64-656" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-657"><a href="#cb64-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-658"><a href="#cb64-658" aria-hidden="true" tabindex="-1"></a><span class="co"># save output</span></span>
<span id="cb64-659"><a href="#cb64-659" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_match_ebal, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ebal"</span>))</span>
<span id="cb64-660"><a href="#cb64-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-661"><a href="#cb64-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-662"><a href="#cb64-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-663"><a href="#cb64-663" aria-hidden="true" tabindex="-1"></a><span class="do">## energy balance method</span></span>
<span id="cb64-664"><a href="#cb64-664" aria-hidden="true" tabindex="-1"></a>dt_match_energy <span class="ot">&lt;-</span> <span class="fu">match_mi_general</span>(</span>
<span id="cb64-665"><a href="#cb64-665" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dt,</span>
<span id="cb64-666"><a href="#cb64-666" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb64-667"><a href="#cb64-667" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_vars =</span> baseline_vars_reflective_propensity,</span>
<span id="cb64-668"><a href="#cb64-668" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroup =</span> <span class="st">"t0_eth_cat"</span>,</span>
<span id="cb64-669"><a href="#cb64-669" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span>,</span>
<span id="cb64-670"><a href="#cb64-670" aria-hidden="true" tabindex="-1"></a>  <span class="co">#focal = "high", # for use with ATT</span></span>
<span id="cb64-671"><a href="#cb64-671" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"energy"</span></span>
<span id="cb64-672"><a href="#cb64-672" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-673"><a href="#cb64-673" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_match_energy, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_energy"</span>))</span>
<span id="cb64-674"><a href="#cb64-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-675"><a href="#cb64-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-676"><a href="#cb64-676" aria-hidden="true" tabindex="-1"></a>Results, first for Europeans</span>
<span id="cb64-677"><a href="#cb64-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-680"><a href="#cb64-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-681"><a href="#cb64-681" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: results_ps_analysis</span></span>
<span id="cb64-682"><a href="#cb64-682" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb64-683"><a href="#cb64-683" aria-hidden="true" tabindex="-1"></a><span class="co">#dt_match_energy &lt;- readRDS(here::here("data", "dt_match_energy"))</span></span>
<span id="cb64-684"><a href="#cb64-684" aria-hidden="true" tabindex="-1"></a>dt_match_ebal <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ebal"</span>))</span>
<span id="cb64-685"><a href="#cb64-685" aria-hidden="true" tabindex="-1"></a><span class="co">#dt_match_ps &lt;- readRDS(here::here("data", "dt_match_ps"))</span></span>
<span id="cb64-686"><a href="#cb64-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-687"><a href="#cb64-687" aria-hidden="true" tabindex="-1"></a><span class="co"># next we inspect balance. "Max.Diff.Adj" should ideally be less than .05, but less than .1 is ok. This is the standardised mean difference. The variance ratio should be less than 2. </span></span>
<span id="cb64-688"><a href="#cb64-688" aria-hidden="true" tabindex="-1"></a><span class="co"># note that if the variables are unlikely to influence the outcome we can be less strict. </span></span>
<span id="cb64-689"><a href="#cb64-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-690"><a href="#cb64-690" aria-hidden="true" tabindex="-1"></a><span class="co">#See: Hainmueller, J. 2012. “Entropy Balancing for Causal Effects: A Multivariate Reweighting Method to Produce Balanced Samples in Observational Studies.” Political Analysis 20 (1): 25–46. https://doi.org/10.1093/pan/mpr025.</span></span>
<span id="cb64-691"><a href="#cb64-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-692"><a href="#cb64-692" aria-hidden="true" tabindex="-1"></a><span class="co"># Cole SR, Hernan MA. Constructing inverse probability weights for marginal structural models. American Journal of</span></span>
<span id="cb64-693"><a href="#cb64-693" aria-hidden="true" tabindex="-1"></a><span class="co"># Epidemiology 2008; 168(6):656–664.</span></span>
<span id="cb64-694"><a href="#cb64-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-695"><a href="#cb64-695" aria-hidden="true" tabindex="-1"></a><span class="co"># Moving towards best practice when using inverse probability of treatment weighting (IPTW) using the propensity score to estimate causal treatment effects in observational studies</span></span>
<span id="cb64-696"><a href="#cb64-696" aria-hidden="true" tabindex="-1"></a><span class="co"># Peter C. Austin, Elizabeth A. Stuart</span></span>
<span id="cb64-697"><a href="#cb64-697" aria-hidden="true" tabindex="-1"></a><span class="co"># https://onlinelibrary.wiley.com/doi/10.1002/sim.6607</span></span>
<span id="cb64-698"><a href="#cb64-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-699"><a href="#cb64-699" aria-hidden="true" tabindex="-1"></a><span class="co">#bal.tab(dt_match_energy$euro)   #  good</span></span>
<span id="cb64-700"><a href="#cb64-700" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_ebal<span class="sc">$</span>euro)   <span class="co">#  best</span></span>
<span id="cb64-701"><a href="#cb64-701" aria-hidden="true" tabindex="-1"></a><span class="co">#bal.tab(dt_match_ps$euro)   #  not as good</span></span>
<span id="cb64-702"><a href="#cb64-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-703"><a href="#cb64-703" aria-hidden="true" tabindex="-1"></a><span class="co"># here we show only the best tab, but you should put all information into an appendix</span></span>
<span id="cb64-704"><a href="#cb64-704" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-705"><a href="#cb64-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-706"><a href="#cb64-706" aria-hidden="true" tabindex="-1"></a>Results for Maori</span>
<span id="cb64-707"><a href="#cb64-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-710"><a href="#cb64-710" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-711"><a href="#cb64-711" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: balance_tab_maori</span></span>
<span id="cb64-712"><a href="#cb64-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-713"><a href="#cb64-713" aria-hidden="true" tabindex="-1"></a><span class="co"># who only Ebal</span></span>
<span id="cb64-714"><a href="#cb64-714" aria-hidden="true" tabindex="-1"></a><span class="co">#bal.tab(dt_match_energy$māori)   #  good</span></span>
<span id="cb64-715"><a href="#cb64-715" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_ebal<span class="sc">$</span>māori)   <span class="co">#  best</span></span>
<span id="cb64-716"><a href="#cb64-716" aria-hidden="true" tabindex="-1"></a><span class="co">#bal.tab(dt_match_ps$māori)   #  not good</span></span>
<span id="cb64-717"><a href="#cb64-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-718"><a href="#cb64-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-719"><a href="#cb64-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-722"><a href="#cb64-722" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-723"><a href="#cb64-723" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: love_plots</span></span>
<span id="cb64-724"><a href="#cb64-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-725"><a href="#cb64-725" aria-hidden="true" tabindex="-1"></a><span class="co"># code for summar</span></span>
<span id="cb64-726"><a href="#cb64-726" aria-hidden="true" tabindex="-1"></a>sum_e <span class="ot">&lt;-</span> <span class="fu">summary</span>(dt_match_ebal<span class="sc">$</span>euro)</span>
<span id="cb64-727"><a href="#cb64-727" aria-hidden="true" tabindex="-1"></a>sum_m <span class="ot">&lt;-</span> <span class="fu">summary</span>(dt_match_ebal<span class="sc">$</span>māori)</span>
<span id="cb64-728"><a href="#cb64-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-729"><a href="#cb64-729" aria-hidden="true" tabindex="-1"></a><span class="co"># summary euro</span></span>
<span id="cb64-730"><a href="#cb64-730" aria-hidden="true" tabindex="-1"></a>sum_e</span>
<span id="cb64-731"><a href="#cb64-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-732"><a href="#cb64-732" aria-hidden="true" tabindex="-1"></a><span class="co"># summary maori</span></span>
<span id="cb64-733"><a href="#cb64-733" aria-hidden="true" tabindex="-1"></a>sum_m</span>
<span id="cb64-734"><a href="#cb64-734" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-735"><a href="#cb64-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-738"><a href="#cb64-738" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-739"><a href="#cb64-739" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: love_plot_euro</span></span>
<span id="cb64-740"><a href="#cb64-740" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page-right</span></span>
<span id="cb64-741"><a href="#cb64-741" aria-hidden="true" tabindex="-1"></a>love_plot_e <span class="ot">&lt;-</span> <span class="fu">love.plot</span>(dt_match_ebal<span class="sc">$</span>euro,</span>
<span id="cb64-742"><a href="#cb64-742" aria-hidden="true" tabindex="-1"></a>          <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb64-743"><a href="#cb64-743" aria-hidden="true" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>))<span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NZ Euro Weighting: method e-balance"</span>)</span>
<span id="cb64-744"><a href="#cb64-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-745"><a href="#cb64-745" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb64-746"><a href="#cb64-746" aria-hidden="true" tabindex="-1"></a>love_plot_e </span>
<span id="cb64-747"><a href="#cb64-747" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-748"><a href="#cb64-748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-751"><a href="#cb64-751" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-752"><a href="#cb64-752" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: love_plot_maori</span></span>
<span id="cb64-753"><a href="#cb64-753" aria-hidden="true" tabindex="-1"></a><span class="co">#| column: page-right</span></span>
<span id="cb64-754"><a href="#cb64-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-755"><a href="#cb64-755" aria-hidden="true" tabindex="-1"></a>love_plot_m <span class="ot">&lt;-</span> <span class="fu">love.plot</span>(dt_match_ebal<span class="sc">$</span>māori,</span>
<span id="cb64-756"><a href="#cb64-756" aria-hidden="true" tabindex="-1"></a>          <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb64-757"><a href="#cb64-757" aria-hidden="true" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Māori Weighting: method e-balance"</span>)</span>
<span id="cb64-758"><a href="#cb64-758" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb64-759"><a href="#cb64-759" aria-hidden="true" tabindex="-1"></a>love_plot_m</span>
<span id="cb64-760"><a href="#cb64-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-761"><a href="#cb64-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-762"><a href="#cb64-762" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example Summary NZ Euro Propensity scores.</span></span>
<span id="cb64-763"><a href="#cb64-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-764"><a href="#cb64-764" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We estimated propensity score analysis using entropy balancing, energy balancing and traditional propensity scores. Of these approaches, entropy balancing provided the best balance. The results indicate an excellent balance across all variables, with Max.Diff.Adj values significantly below the target threshold of 0.05 across a range of binary and continuous baseline confounders, including gender, generation cohort, urban_location, exercise hours (coarsened, baseline), education, employment status, depression, anxiety, and various personality traits. The Max.Diff.Adj values for all variables were well below the target threshold of 0.05, with most variables achieving a Max.Diff.Adj of 0.0001 or lower. This indicates a high level of balance across all treatment pairs.</span></span>
<span id="cb64-765"><a href="#cb64-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-766"><a href="#cb64-766" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The effective sample sizes were also adjusted using entropy balancing. The unadjusted sample sizes for the inactive, active, and very active groups were 2880, 3927, and 1834, respectively. After adjustment, the effective sample sizes were reduced to 1855.89, 3659.59, and 1052.01, respectively.</span></span>
<span id="cb64-767"><a href="#cb64-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-768"><a href="#cb64-768" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The weight ranges for the inactive, active, and very active groups varied, with the inactive group showing the widest range (0.2310 to 7.0511) and the active group showing the narrowest range (0.5769 to 1.9603). Despite these variations, the coefficient of variation, mean absolute deviation (MAD), and entropy were all within acceptable limits for each group, indicating a good balance of weights.</span></span>
<span id="cb64-769"><a href="#cb64-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-770"><a href="#cb64-770" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We also identified the units with the five most extreme weights by group. These units exhibited higher weights compared to the rest of the units in their respective groups, but they did not significantly affect the overall balance of weights.</span></span>
<span id="cb64-771"><a href="#cb64-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-772"><a href="#cb64-772" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We plotted these results using love plots, visually confirming both the balance in the propensity score model using entropy balanced weights, and the imbalance in the model that does not adjust for baseline confounders.</span></span>
<span id="cb64-773"><a href="#cb64-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-774"><a href="#cb64-774" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Overall, these findings support the use of entropy balancing in propensity score analysis to ensure a balanced distribution of covariates across treatment groups, conditional on the measured covariates included in the model.</span></span>
<span id="cb64-775"><a href="#cb64-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-776"><a href="#cb64-776" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example Summary Maori Propensity scores.</span></span>
<span id="cb64-777"><a href="#cb64-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-778"><a href="#cb64-778" aria-hidden="true" tabindex="-1"></a>Results:</span>
<span id="cb64-779"><a href="#cb64-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-780"><a href="#cb64-780" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The entropy balancing method was also the best performing method that was applied to a subgroup analysis of the Māori population. Similar to the NZ European subgroup analysis, the method achieved a high level of balance across all treatment pairs for the Māori subgroup. The Max.Diff.Adj values for all variables were well below the target threshold of 0.05, with most variables achieving a Max.Diff.Adj of 0.0001 or lower. This indicates a high level of balance across all treatment pairs for the Māori subgroup.</span></span>
<span id="cb64-781"><a href="#cb64-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-782"><a href="#cb64-782" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The effective sample sizes for the Māori subgroup were also adjusted using entropy balancing. The unadjusted sample sizes for the inactive, active, and very active groups were 307, 354, and 160, respectively. After adjustment, the effective sample sizes were reduced to 220.54, 321.09, and 76.39, respectively</span></span>
<span id="cb64-783"><a href="#cb64-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-784"><a href="#cb64-784" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The weight ranges for the inactive, active, and very active groups in the Māori subgroup varied, with the inactive group showing the widest range (0.2213 to 3.8101) and the active group showing the narrowest range (0.3995 to 1.9800). Despite these variations, the coefficient of variation, mean absolute deviation (MAD), and entropy were all within acceptable limits for each group, indicating a good balance of weights.</span></span>
<span id="cb64-785"><a href="#cb64-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-786"><a href="#cb64-786" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The study also identified the units with the five most extreme weights by group for the Māori subgroup. These units exhibited higher weights compared to the rest of the units in their respective groups, but they did not significantly affect the overall balance of weights.</span></span>
<span id="cb64-787"><a href="#cb64-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-788"><a href="#cb64-788" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In conclusion, the results of the Māori subgroup analysis are consistent with the overall analysis. The entropy balancing method achieved a high level of balance across all treatment pairs, with Max.Diff.Adj values significantly below the target threshold. These findings support the use of entropy balancing in propensity score analysis to ensure a balanced distribution of covariates across treatment groups, even in subgroup analyses.</span></span>
<span id="cb64-789"><a href="#cb64-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-790"><a href="#cb64-790" aria-hidden="true" tabindex="-1"></a><span class="fu">### More data wrangling</span></span>
<span id="cb64-791"><a href="#cb64-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-792"><a href="#cb64-792" aria-hidden="true" tabindex="-1"></a>Note that we need to attach the <span class="in">`weights`</span> from the propensity score model back to the data.</span>
<span id="cb64-793"><a href="#cb64-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-794"><a href="#cb64-794" aria-hidden="true" tabindex="-1"></a>However, because our weighting analysis estimates a model for the *exposure*, we only need to do this analysis once, no matter how many outcomes we investigate. So there's a little good news.</span>
<span id="cb64-795"><a href="#cb64-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-798"><a href="#cb64-798" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-799"><a href="#cb64-799" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: yet_more_wrangling</span></span>
<span id="cb64-800"><a href="#cb64-800" aria-hidden="true" tabindex="-1"></a><span class="co">#| </span></span>
<span id="cb64-801"><a href="#cb64-801" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare nz_euro data</span></span>
<span id="cb64-802"><a href="#cb64-802" aria-hidden="true" tabindex="-1"></a>dt<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt"</span>)) <span class="co"># original data subset only nz europeans</span></span>
<span id="cb64-803"><a href="#cb64-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-804"><a href="#cb64-804" aria-hidden="true" tabindex="-1"></a>dt_ref_e <span class="ot">&lt;-</span> <span class="fu">subset</span>(dt, t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span>) <span class="co"># original data subset only nz europeans</span></span>
<span id="cb64-805"><a href="#cb64-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-806"><a href="#cb64-806" aria-hidden="true" tabindex="-1"></a><span class="co"># add weights</span></span>
<span id="cb64-807"><a href="#cb64-807" aria-hidden="true" tabindex="-1"></a>dt_ref_e<span class="sc">$</span>weights <span class="ot">&lt;-</span> dt_match_ebal<span class="sc">$</span>euro<span class="sc">$</span>weights <span class="co"># get weights from the ps matching model,add to data</span></span>
<span id="cb64-808"><a href="#cb64-808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-809"><a href="#cb64-809" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare maori data</span></span>
<span id="cb64-810"><a href="#cb64-810" aria-hidden="true" tabindex="-1"></a>dt_ref_m <span class="ot">&lt;-</span> <span class="fu">subset</span>(dt, t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>)<span class="co"># original data subset only maori</span></span>
<span id="cb64-811"><a href="#cb64-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-812"><a href="#cb64-812" aria-hidden="true" tabindex="-1"></a><span class="co"># add weights</span></span>
<span id="cb64-813"><a href="#cb64-813" aria-hidden="true" tabindex="-1"></a>dt_ref_m<span class="sc">$</span>weights <span class="ot">&lt;-</span> dt_match_ebal<span class="sc">$</span>māori<span class="sc">$</span>weights <span class="co"># get weights from the ps matching model, add to data</span></span>
<span id="cb64-814"><a href="#cb64-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-815"><a href="#cb64-815" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data into one data frame</span></span>
<span id="cb64-816"><a href="#cb64-816" aria-hidden="true" tabindex="-1"></a>dt_ref_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dt_ref_e, dt_ref_m) <span class="co"># combine the data into one dataframe. </span></span>
<span id="cb64-817"><a href="#cb64-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-818"><a href="#cb64-818" aria-hidden="true" tabindex="-1"></a><span class="co"># save data for later use, if needed</span></span>
<span id="cb64-819"><a href="#cb64-819" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_ref_all, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"dt_ref_all"</span>))</span>
<span id="cb64-820"><a href="#cb64-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-821"><a href="#cb64-821" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-822"><a href="#cb64-822" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-823"><a href="#cb64-823" aria-hidden="true" tabindex="-1"></a><span class="fu">## Anxiety Analysis and Results</span></span>
<span id="cb64-824"><a href="#cb64-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-825"><a href="#cb64-825" aria-hidden="true" tabindex="-1"></a>This is the analysis code</span>
<span id="cb64-826"><a href="#cb64-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-829"><a href="#cb64-829" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-830"><a href="#cb64-830" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: model_anxiety</span></span>
<span id="cb64-831"><a href="#cb64-831" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb64-832"><a href="#cb64-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-833"><a href="#cb64-833" aria-hidden="true" tabindex="-1"></a><span class="co"># we do not evaluate to save time</span></span>
<span id="cb64-834"><a href="#cb64-834" aria-hidden="true" tabindex="-1"></a><span class="do">### SUBGROUP analysis</span></span>
<span id="cb64-835"><a href="#cb64-835" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span>  dt_ref_all</span>
<span id="cb64-836"><a href="#cb64-836" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span>  <span class="st">"t2_kessler_latent_anxiety_z"</span></span>
<span id="cb64-837"><a href="#cb64-837" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="st">"t1_hours_exercise_coarsen"</span> <span class="co"># already defined above</span></span>
<span id="cb64-838"><a href="#cb64-838" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> baseline_vars_reflective_propensity</span>
<span id="cb64-839"><a href="#cb64-839" aria-hidden="true" tabindex="-1"></a>treat_0 <span class="ot">=</span> <span class="st">"inactive"</span></span>
<span id="cb64-840"><a href="#cb64-840" aria-hidden="true" tabindex="-1"></a>treat_1 <span class="ot">=</span> <span class="st">"very_active"</span></span>
<span id="cb64-841"><a href="#cb64-841" aria-hidden="true" tabindex="-1"></a>estimand <span class="ot">=</span> <span class="st">"ATE"</span></span>
<span id="cb64-842"><a href="#cb64-842" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">=</span> <span class="st">"RD"</span></span>
<span id="cb64-843"><a href="#cb64-843" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb64-844"><a href="#cb64-844" aria-hidden="true" tabindex="-1"></a>family <span class="ot">=</span> <span class="st">"gaussian"</span></span>
<span id="cb64-845"><a href="#cb64-845" aria-hidden="true" tabindex="-1"></a>continuous_X <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb64-846"><a href="#cb64-846" aria-hidden="true" tabindex="-1"></a>splines <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb64-847"><a href="#cb64-847" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb64-848"><a href="#cb64-848" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="st">"t0_eth_cat"</span></span>
<span id="cb64-849"><a href="#cb64-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-850"><a href="#cb64-850" aria-hidden="true" tabindex="-1"></a><span class="co"># not we interact the subclass X treatment X covariates</span></span>
<span id="cb64-851"><a href="#cb64-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-852"><a href="#cb64-852" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span></span>
<span id="cb64-853"><a href="#cb64-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(</span>
<span id="cb64-854"><a href="#cb64-854" aria-hidden="true" tabindex="-1"></a>    Y,</span>
<span id="cb64-855"><a href="#cb64-855" aria-hidden="true" tabindex="-1"></a>    <span class="st">"~"</span>,</span>
<span id="cb64-856"><a href="#cb64-856" aria-hidden="true" tabindex="-1"></a>    S,</span>
<span id="cb64-857"><a href="#cb64-857" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb64-858"><a href="#cb64-858" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb64-859"><a href="#cb64-859" aria-hidden="true" tabindex="-1"></a>    X ,</span>
<span id="cb64-860"><a href="#cb64-860" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb64-861"><a href="#cb64-861" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb64-862"><a href="#cb64-862" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(baseline_vars_reflective_propensity, <span class="at">collapse =</span> <span class="st">"+"</span>),</span>
<span id="cb64-863"><a href="#cb64-863" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span>,</span>
<span id="cb64-864"><a href="#cb64-864" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span></span>
<span id="cb64-865"><a href="#cb64-865" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-866"><a href="#cb64-866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-867"><a href="#cb64-867" aria-hidden="true" tabindex="-1"></a>  <span class="co"># formula_str. # inspect on our own time </span></span>
<span id="cb64-868"><a href="#cb64-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-869"><a href="#cb64-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-870"><a href="#cb64-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-871"><a href="#cb64-871" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb64-872"><a href="#cb64-872" aria-hidden="true" tabindex="-1"></a>fit_all_all  <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb64-873"><a href="#cb64-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(formula_str),</span>
<span id="cb64-874"><a href="#cb64-874" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights,</span>
<span id="cb64-875"><a href="#cb64-875" aria-hidden="true" tabindex="-1"></a>  <span class="co"># weights = if (!is.null(weight_var)) weight_var else NULL,</span></span>
<span id="cb64-876"><a href="#cb64-876" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> family,</span>
<span id="cb64-877"><a href="#cb64-877" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df</span>
<span id="cb64-878"><a href="#cb64-878" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-879"><a href="#cb64-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-880"><a href="#cb64-880" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate coefficients</span></span>
<span id="cb64-881"><a href="#cb64-881" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(clarify<span class="sc">::</span>sim)</span>
<span id="cb64-882"><a href="#cb64-882" aria-hidden="true" tabindex="-1"></a>sim_model_all <span class="ot">&lt;-</span> <span class="fu">sim</span>(fit_all_all, <span class="at">n =</span> nsims, <span class="at">vcov =</span> <span class="st">"HC0"</span>)</span>
<span id="cb64-883"><a href="#cb64-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-884"><a href="#cb64-884" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in europeans</span></span>
<span id="cb64-885"><a href="#cb64-885" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb64-886"><a href="#cb64-886" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb64-887"><a href="#cb64-887" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb64-888"><a href="#cb64-888" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb64-889"><a href="#cb64-889" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span>,</span>
<span id="cb64-890"><a href="#cb64-890" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb64-891"><a href="#cb64-891" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-892"><a href="#cb64-892" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-893"><a href="#cb64-893" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(sim_estimand_all_e)</span></span>
<span id="cb64-894"><a href="#cb64-894" aria-hidden="true" tabindex="-1"></a><span class="co"># note contrast of interest</span></span>
<span id="cb64-895"><a href="#cb64-895" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e <span class="ot">&lt;-</span></span>
<span id="cb64-896"><a href="#cb64-896" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_e, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span>)</span>
<span id="cb64-897"><a href="#cb64-897" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-898"><a href="#cb64-898" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(sim_estimand_all_m)</span></span>
<span id="cb64-899"><a href="#cb64-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-900"><a href="#cb64-900" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in māori</span></span>
<span id="cb64-901"><a href="#cb64-901" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb64-902"><a href="#cb64-902" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb64-903"><a href="#cb64-903" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb64-904"><a href="#cb64-904" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb64-905"><a href="#cb64-905" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>,</span>
<span id="cb64-906"><a href="#cb64-906" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb64-907"><a href="#cb64-907" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-908"><a href="#cb64-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-909"><a href="#cb64-909" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb64-910"><a href="#cb64-910" aria-hidden="true" tabindex="-1"></a><span class="co">#m(sim_estimand_all_m)</span></span>
<span id="cb64-911"><a href="#cb64-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-912"><a href="#cb64-912" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m <span class="ot">&lt;-</span></span>
<span id="cb64-913"><a href="#cb64-913" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_m, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span>)</span>
<span id="cb64-914"><a href="#cb64-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-915"><a href="#cb64-915" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange</span></span>
<span id="cb64-916"><a href="#cb64-916" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_e) <span class="ot">&lt;-</span></span>
<span id="cb64-917"><a href="#cb64-917" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_e), <span class="st">"e"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb64-918"><a href="#cb64-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-919"><a href="#cb64-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-920"><a href="#cb64-920" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_m) <span class="ot">&lt;-</span></span>
<span id="cb64-921"><a href="#cb64-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_m), <span class="st">"m"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb64-922"><a href="#cb64-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-923"><a href="#cb64-923" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>( sim_estimand_all_e )</span>
<span id="cb64-924"><a href="#cb64-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-925"><a href="#cb64-925" aria-hidden="true" tabindex="-1"></a>est_all_anxiety <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sim_estimand_all_m, sim_estimand_all_e)</span>
<span id="cb64-926"><a href="#cb64-926" aria-hidden="true" tabindex="-1"></a>est_all_anxiety <span class="ot">&lt;-</span> <span class="fu">transform</span>(est_all_anxiety, <span class="st">`</span><span class="at">RD_m - RD_e</span><span class="st">`</span> <span class="ot">=</span> RD_m <span class="sc">-</span> RD_e)</span>
<span id="cb64-927"><a href="#cb64-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-928"><a href="#cb64-928" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sim_estimand_all_e, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_e"</span>))</span>
<span id="cb64-929"><a href="#cb64-929" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sim_estimand_all_m, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_m"</span>))</span>
<span id="cb64-930"><a href="#cb64-930" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(est_all_anxiety, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"est_all_anxiety"</span>))</span>
<span id="cb64-931"><a href="#cb64-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-932"><a href="#cb64-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-933"><a href="#cb64-933" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-934"><a href="#cb64-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-935"><a href="#cb64-935" aria-hidden="true" tabindex="-1"></a><span class="fu">## Table of Subgroup Results plus Evalues</span></span>
<span id="cb64-936"><a href="#cb64-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-937"><a href="#cb64-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-938"><a href="#cb64-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-939"><a href="#cb64-939" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &gt; E[Y(1)]-E[Y(0)] presents the causal contrast between the expected value of the exposure were all within the target population {Group Var Here} to receive the exposure E[Y(1)] in comparison to the expected value of the exposure were to recieve the baseline treatment  E[Y(0)].  --&gt;</span></span>
<span id="cb64-940"><a href="#cb64-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-941"><a href="#cb64-941" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &gt; The Confidence interval for these estimates is between {2.5% column here} at the lower bound and {97.5% value here at the uppoer bound}.  --&gt;</span></span>
<span id="cb64-942"><a href="#cb64-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-943"><a href="#cb64-943" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-944"><a href="#cb64-944" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &gt; E-values represent the minimum strength or magnitude of association that an unmeasured confounder would need to have with both treatment and outcome in order to explain the observed effect estimates conditional on measured covariates [@vanderweele2017]. --&gt;</span></span>
<span id="cb64-945"><a href="#cb64-945" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-946"><a href="#cb64-946" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- &gt; With an observed risk ratio of RR = {E_Value Here}, an unmeasured confounder that was associated with both the outcome and the exposure by a risk ratio of {E_VAL_bound}-fold each, above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of {EVALUE HERE} - fold each could do so, but weaker joint confounder associations could not..[@vanderweele2017] --&gt;</span></span>
<span id="cb64-947"><a href="#cb64-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-948"><a href="#cb64-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-949"><a href="#cb64-949" aria-hidden="true" tabindex="-1"></a>I've created functions for reporting results so you can use this code, changing it to suit your analysis.</span>
<span id="cb64-950"><a href="#cb64-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-953"><a href="#cb64-953" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-954"><a href="#cb64-954" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: summary_anxiety</span></span>
<span id="cb64-955"><a href="#cb64-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-956"><a href="#cb64-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-957"><a href="#cb64-957" aria-hidden="true" tabindex="-1"></a><span class="co"># return stored estimates </span></span>
<span id="cb64-958"><a href="#cb64-958" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_e"</span>))</span>
<span id="cb64-959"><a href="#cb64-959" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_m"</span>))</span>
<span id="cb64-960"><a href="#cb64-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-961"><a href="#cb64-961" aria-hidden="true" tabindex="-1"></a><span class="co"># create individual summaries </span></span>
<span id="cb64-962"><a href="#cb64-962" aria-hidden="true" tabindex="-1"></a>sum_e <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim_estimand_all_e)</span>
<span id="cb64-963"><a href="#cb64-963" aria-hidden="true" tabindex="-1"></a>sum_m <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim_estimand_all_m)</span>
<span id="cb64-964"><a href="#cb64-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-965"><a href="#cb64-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-966"><a href="#cb64-966" aria-hidden="true" tabindex="-1"></a><span class="co"># create individual tables</span></span>
<span id="cb64-967"><a href="#cb64-967" aria-hidden="true" tabindex="-1"></a>tab_e <span class="ot">&lt;-</span> <span class="fu">sub_tab_ate</span>(sum_e, <span class="at">new_name =</span> <span class="st">"NZ Euro Anxiety"</span>)</span>
<span id="cb64-968"><a href="#cb64-968" aria-hidden="true" tabindex="-1"></a>tab_m <span class="ot">&lt;-</span> <span class="fu">sub_tab_ate</span>(sum_m, <span class="at">new_name =</span> <span class="st">"Māori Anxiety"</span>)</span>
<span id="cb64-969"><a href="#cb64-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-970"><a href="#cb64-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-971"><a href="#cb64-971" aria-hidden="true" tabindex="-1"></a><span class="co"># expand tables </span></span>
<span id="cb64-972"><a href="#cb64-972" aria-hidden="true" tabindex="-1"></a>plot_e <span class="ot">&lt;-</span> <span class="fu">sub_group_tab</span>(tab_e, <span class="at">type=</span> <span class="st">"RD"</span>)</span>
<span id="cb64-973"><a href="#cb64-973" aria-hidden="true" tabindex="-1"></a>plot_m <span class="ot">&lt;-</span> <span class="fu">sub_group_tab</span>(tab_m, <span class="at">type=</span> <span class="st">"RD"</span>)</span>
<span id="cb64-974"><a href="#cb64-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-975"><a href="#cb64-975" aria-hidden="true" tabindex="-1"></a>big_tab <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_e,plot_m)</span>
<span id="cb64-976"><a href="#cb64-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-977"><a href="#cb64-977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-978"><a href="#cb64-978" aria-hidden="true" tabindex="-1"></a><span class="co"># table for anxiety outcome --format as "markdown" if you are using quarto documents</span></span>
<span id="cb64-979"><a href="#cb64-979" aria-hidden="true" tabindex="-1"></a>big_tab <span class="sc">|&gt;</span> </span>
<span id="cb64-980"><a href="#cb64-980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format=</span><span class="st">"markdown"</span>)</span>
<span id="cb64-981"><a href="#cb64-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-982"><a href="#cb64-982" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-983"><a href="#cb64-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-984"><a href="#cb64-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-985"><a href="#cb64-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-986"><a href="#cb64-986" aria-hidden="true" tabindex="-1"></a><span class="fu">## Graph of the result</span></span>
<span id="cb64-987"><a href="#cb64-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-988"><a href="#cb64-988" aria-hidden="true" tabindex="-1"></a>I've create a function you can use to graph your results. Here is the code, adjust to suit.</span>
<span id="cb64-989"><a href="#cb64-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-992"><a href="#cb64-992" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-993"><a href="#cb64-993" aria-hidden="true" tabindex="-1"></a><span class="co"># group tables</span></span>
<span id="cb64-994"><a href="#cb64-994" aria-hidden="true" tabindex="-1"></a><span class="fu">sub_group_plot_ate</span>(big_tab, <span class="at">title =</span> <span class="st">"Effect of Exercise on Anxiety"</span>, <span class="at">subtitle =</span> <span class="st">"Subgroup Analysis: NZ Euro and Māori"</span>, <span class="at">xlab =</span> <span class="st">"Groups"</span>, <span class="at">ylab =</span> <span class="st">"Effects"</span>,</span>
<span id="cb64-995"><a href="#cb64-995" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x_offset =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb64-996"><a href="#cb64-996" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x_lim_lo =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb64-997"><a href="#cb64-997" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x_lim_hi =</span> <span class="fl">1.5</span>)</span>
<span id="cb64-998"><a href="#cb64-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-999"><a href="#cb64-999" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1000"><a href="#cb64-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1001"><a href="#cb64-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">### Report the anxiety result.</span></span>
<span id="cb64-1002"><a href="#cb64-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1003"><a href="#cb64-1003" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1004"><a href="#cb64-1004" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; For the New Zealand European group, our results suggest that exercise potentially reduces anxiety, with an estimated causal contrast value (E</span><span class="co">[</span><span class="ot">Y(1)</span><span class="co">]</span><span class="at">-E</span><span class="co">[</span><span class="ot">Y(0)</span><span class="co">]</span><span class="at">) of -0.077. The associated confidence interval, ranging from -0.131 to -0.022, does not cross zero, providing more certainty in our estimate.</span></span>
<span id="cb64-1005"><a href="#cb64-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1006"><a href="#cb64-1006" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; E-values quantify the minimum strength of association that an unmeasured confounding variable would need to have with both the treatment and outcome, to fully explain away our observed effect. In this case, any unmeasured confounder would need to be associated with both exercise and anxiety reduction, with a risk ratio of at least 1.352 to explain away the observed effect, and at least 1.167 to shift the confidence interval to include a null effect.</span></span>
<span id="cb64-1007"><a href="#cb64-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1008"><a href="#cb64-1008" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Turning to the Māori group, the data suggest a possible reducing effect of exercise on anxiety, with a causal contrast value of 0.027. Yet, the confidence interval for this estimate (-0.114 to 0.188) also crosses zero, indicating similar uncertainties. An unmeasured confounder would need to have a risk ratio of at least 1.183 with both exercise and anxiety to account for our observed effect, and a risk ratio of at least 1 to render the confidence interval inclusive of a null effect.</span></span>
<span id="cb64-1009"><a href="#cb64-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1010"><a href="#cb64-1010" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Thus, while our analysis suggests that exercise could potentially reduce anxiety in both New Zealand Europeans and Māori, we advise caution in interpretation. The confidence intervals crossing zero reflect substantial uncertainties, and the possible impact of unmeasured confounding factors further complicates the picture.</span></span>
<span id="cb64-1011"><a href="#cb64-1011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1012"><a href="#cb64-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1013"><a href="#cb64-1013" aria-hidden="true" tabindex="-1"></a>Here's a function that will do much of this work for you. However, you'll need to adjust it, and supply your own interpretation.</span>
<span id="cb64-1014"><a href="#cb64-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1017"><a href="#cb64-1017" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-1018"><a href="#cb64-1018" aria-hidden="true" tabindex="-1"></a><span class="co">#|label: interpretation function</span></span>
<span id="cb64-1019"><a href="#cb64-1019" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb64-1020"><a href="#cb64-1020" aria-hidden="true" tabindex="-1"></a>interpret_results_subgroup <span class="ot">&lt;-</span> <span class="cf">function</span>(df, outcome, exposure) {</span>
<span id="cb64-1021"><a href="#cb64-1021" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb64-1022"><a href="#cb64-1022" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb64-1023"><a href="#cb64-1023" aria-hidden="true" tabindex="-1"></a>      <span class="at">report =</span> <span class="fu">case_when</span>(</span>
<span id="cb64-1024"><a href="#cb64-1024" aria-hidden="true" tabindex="-1"></a>        E_Val_bound <span class="sc">&gt;</span> <span class="fl">1.2</span> <span class="sc">&amp;</span> E_Val_bound <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb64-1025"><a href="#cb64-1025" aria-hidden="true" tabindex="-1"></a>          <span class="st">"For the "</span>, group, <span class="st">", our results suggest that "</span>, exposure, <span class="st">" may potentially influence "</span>, outcome, <span class="st">", with an estimated causal contrast value (E[Y(1)]-E[Y(0)]) of "</span>, <span class="st">`</span><span class="at">E[Y(1)]-E[Y(0)]</span><span class="st">`</span>, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb64-1026"><a href="#cb64-1026" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The associated confidence interval, ranging from "</span>, <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>, <span class="st">" to "</span>, <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>, <span class="st">", does not cross zero, providing more certainty in our estimate. "</span>,</span>
<span id="cb64-1027"><a href="#cb64-1027" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The E-values indicate that any unmeasured confounder would need to have a minimum risk ratio of "</span>, E_Value, <span class="st">" with both the treatment and outcome to explain away the observed effect, and a minimum risk ratio of "</span>, E_Val_bound, <span class="st">" to shift the confidence interval to include the null effect. This suggests stronger confidence in our findings."</span></span>
<span id="cb64-1028"><a href="#cb64-1028" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb64-1029"><a href="#cb64-1029" aria-hidden="true" tabindex="-1"></a>        E_Val_bound <span class="sc">&gt;=</span> <span class="dv">2</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb64-1030"><a href="#cb64-1030" aria-hidden="true" tabindex="-1"></a>          <span class="st">"For the "</span>, group, <span class="st">", our results suggest that "</span>, exposure, <span class="st">" may potentially influence "</span>, outcome, <span class="st">", with an estimated causal contrast value (E[Y(1)]-E[Y(0)]) of "</span>, <span class="st">`</span><span class="at">E[Y(1)]-E[Y(0)]</span><span class="st">`</span>, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb64-1031"><a href="#cb64-1031" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The associated confidence interval, ranging from "</span>, <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>, <span class="st">" to "</span>, <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>, <span class="st">", does not cross zero, providing more certainty in our estimate. "</span>,</span>
<span id="cb64-1032"><a href="#cb64-1032" aria-hidden="true" tabindex="-1"></a>          <span class="st">"With an observed risk ratio of RR = "</span>, E_Value, <span class="st">", an unmeasured confounder that was associated with both the outcome and the exposure by a risk ratio of "</span>, E_Val_bound, <span class="st">"-fold each, above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of "</span>, E_Val_bound, <span class="st">"-fold each could do so, but weaker joint confounder associations could not. Here we find stronger evidence that the result is robust to unmeasured confounding."</span></span>
<span id="cb64-1033"><a href="#cb64-1033" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb64-1034"><a href="#cb64-1034" aria-hidden="true" tabindex="-1"></a>        E_Val_bound <span class="sc">&lt;</span> <span class="fl">1.2</span> <span class="sc">&amp;</span> E_Val_bound <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb64-1035"><a href="#cb64-1035" aria-hidden="true" tabindex="-1"></a>          <span class="st">"For the "</span>, group, <span class="st">", our results suggest that "</span>, exposure, <span class="st">" may potentially influence "</span>, outcome, <span class="st">", with an estimated causal contrast value (E[Y(1)]-E[Y(0)]) of "</span>, <span class="st">`</span><span class="at">E[Y(1)]-E[Y(0)]</span><span class="st">`</span>, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb64-1036"><a href="#cb64-1036" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The associated confidence interval, ranging from "</span>, <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>, <span class="st">" to "</span>, <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>, <span class="st">", does not cross zero, providing more certainty in our estimate. "</span>,</span>
<span id="cb64-1037"><a href="#cb64-1037" aria-hidden="true" tabindex="-1"></a>          <span class="st">"The E-values indicate that any unmeasured confounder would need to have a minimum risk ratio of "</span>, E_Value, <span class="st">" with both the treatment and outcome to explain away the observed effect, and a minimum risk ratio of "</span>, E_Val_bound, <span class="st">" to shift the confidence interval to include the null effect. This suggests we should interpret these findings with caution given uncertainty in the model."</span></span>
<span id="cb64-1038"><a href="#cb64-1038" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb64-1039"><a href="#cb64-1039" aria-hidden="true" tabindex="-1"></a>        E_Val_bound <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">paste0</span>(</span>
<span id="cb64-1040"><a href="#cb64-1040" aria-hidden="true" tabindex="-1"></a>          <span class="st">"For the "</span>, group, <span class="st">", the data suggests a potential effect of "</span>, exposure, <span class="st">" on "</span>, outcome, <span class="st">", with a causal contrast value of "</span>, <span class="st">`</span><span class="at">E[Y(1)]-E[Y(0)]</span><span class="st">`</span>, <span class="st">".</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb64-1041"><a href="#cb64-1041" aria-hidden="true" tabindex="-1"></a>          <span class="st">"However, the confidence interval for this estimate, ranging from "</span>, <span class="st">`</span><span class="at">2.5 %</span><span class="st">`</span>,<span class="st">" to "</span>, <span class="st">`</span><span class="at">97.5 %</span><span class="st">`</span>, <span class="st">", crosses zero, indicating considerable uncertainties. The E-values indicate that an unmeasured confounder that is associated with both the "</span>, outcome, <span class="st">" and the "</span>, exposure, <span class="st">" by a risk ratio of "</span>, E_Value, <span class="st">" could explain away the observed associations, even after accounting for the measured confounders. "</span>,</span>
<span id="cb64-1042"><a href="#cb64-1042" aria-hidden="true" tabindex="-1"></a>          <span class="st">"This finding further reduces confidence in a true causal effect. Hence, while the estimates suggest a potential effect of "</span>, exposure, <span class="st">" on "</span>, outcome, <span class="st">" for the "</span>, group, <span class="st">", the substantial uncertainty and possible influence of unmeasured confounders mean these findings should be interpreted with caution."</span></span>
<span id="cb64-1043"><a href="#cb64-1043" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb64-1044"><a href="#cb64-1044" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb64-1045"><a href="#cb64-1045" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-1046"><a href="#cb64-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df<span class="sc">$</span>report)</span>
<span id="cb64-1047"><a href="#cb64-1047" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb64-1048"><a href="#cb64-1048" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1049"><a href="#cb64-1049" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1050"><a href="#cb64-1050" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1051"><a href="#cb64-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1052"><a href="#cb64-1052" aria-hidden="true" tabindex="-1"></a>You run the function like this: </span>
<span id="cb64-1053"><a href="#cb64-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1054"><a href="#cb64-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1057"><a href="#cb64-1057" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-1058"><a href="#cb64-1058" aria-hidden="true" tabindex="-1"></a><span class="fu">interpret_results_subgroup</span>(big_tab, <span class="at">outcome =</span> <span class="st">"Anxiety"</span>, <span class="at">exposure =</span> <span class="st">"Excercise"</span>)</span>
<span id="cb64-1059"><a href="#cb64-1059" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1060"><a href="#cb64-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1061"><a href="#cb64-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1062"><a href="#cb64-1062" aria-hidden="true" tabindex="-1"></a>Easy!</span>
<span id="cb64-1063"><a href="#cb64-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1064"><a href="#cb64-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1065"><a href="#cb64-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1066"><a href="#cb64-1066" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimate the subgroup contrast</span></span>
<span id="cb64-1067"><a href="#cb64-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1070"><a href="#cb64-1070" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-1071"><a href="#cb64-1071" aria-hidden="true" tabindex="-1"></a><span class="co"># calculated above</span></span>
<span id="cb64-1072"><a href="#cb64-1072" aria-hidden="true" tabindex="-1"></a>est_all_anxiety <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"est_all_anxiety"</span>))</span>
<span id="cb64-1073"><a href="#cb64-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1074"><a href="#cb64-1074" aria-hidden="true" tabindex="-1"></a><span class="co"># make the sumamry into a dataframe so we can make a table</span></span>
<span id="cb64-1075"><a href="#cb64-1075" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(est_all_anxiety))</span>
<span id="cb64-1076"><a href="#cb64-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1077"><a href="#cb64-1077" aria-hidden="true" tabindex="-1"></a><span class="co"># get rownames for selecting the correct row</span></span>
<span id="cb64-1078"><a href="#cb64-1078" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RowName <span class="ot">&lt;-</span> <span class="fu">row.names</span>(df)</span>
<span id="cb64-1079"><a href="#cb64-1079" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1080"><a href="#cb64-1080" aria-hidden="true" tabindex="-1"></a><span class="co"># select the correct row -- the group contrast</span></span>
<span id="cb64-1081"><a href="#cb64-1081" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb64-1082"><a href="#cb64-1082" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(RowName <span class="sc">==</span> <span class="st">"RD_m - RD_e"</span>) </span>
<span id="cb64-1083"><a href="#cb64-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1084"><a href="#cb64-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1085"><a href="#cb64-1085" aria-hidden="true" tabindex="-1"></a><span class="co"># pring the filtered data frame</span></span>
<span id="cb64-1086"><a href="#cb64-1086" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb64-1087"><a href="#cb64-1087" aria-hidden="true" tabindex="-1"></a>filtered_df  <span class="sc">|&gt;</span> </span>
<span id="cb64-1088"><a href="#cb64-1088" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>RowName) <span class="sc">|&gt;</span> </span>
<span id="cb64-1089"><a href="#cb64-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb64-1090"><a href="#cb64-1090" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) </span>
<span id="cb64-1091"><a href="#cb64-1091" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1092"><a href="#cb64-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1093"><a href="#cb64-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1094"><a href="#cb64-1094" aria-hidden="true" tabindex="-1"></a>Another option for making the table using markdown. This would be useful if you were writing your article using qaurto. </span>
<span id="cb64-1095"><a href="#cb64-1095" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1098"><a href="#cb64-1098" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-1099"><a href="#cb64-1099" aria-hidden="true" tabindex="-1"></a>filtered_df  <span class="sc">|&gt;</span> </span>
<span id="cb64-1100"><a href="#cb64-1100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>RowName) <span class="sc">|&gt;</span> </span>
<span id="cb64-1101"><a href="#cb64-1101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>, <span class="at">format =</span> <span class="st">"markdown"</span>)</span>
<span id="cb64-1102"><a href="#cb64-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1103"><a href="#cb64-1103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1104"><a href="#cb64-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1105"><a href="#cb64-1105" aria-hidden="true" tabindex="-1"></a>Report result along the following lines:</span>
<span id="cb64-1106"><a href="#cb64-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1107"><a href="#cb64-1107" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The estimated reduction of anxiety from exercise is higher overall for New Zealand Europeans (RD_e) compared to Māori (RD_m). This is indicated by the estimated risk difference (RD_m - RD_e) of 0.104. However, there is uncertainty in this estimate, as the confidence interval (-0.042 to 0.279) crosses zero. This indicates that we cannot be confident that the difference in anxiety reduction between New Zealand Europeans and Māori is reliable. It's possible that the true difference could be zero or even negative, suggesting higher anxiety reduction for Māori. Thus, while there's an indication of higher anxiety reduction for New Zealand Europeans, the uncertainty in the estimate means we should interpret this difference with caution.</span></span>
<span id="cb64-1108"><a href="#cb64-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1109"><a href="#cb64-1109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1110"><a href="#cb64-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1111"><a href="#cb64-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1112"><a href="#cb64-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1113"><a href="#cb64-1113" aria-hidden="true" tabindex="-1"></a><span class="fu">## Depression Analysis and Results</span></span>
<span id="cb64-1114"><a href="#cb64-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1117"><a href="#cb64-1117" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-1118"><a href="#cb64-1118" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb64-1119"><a href="#cb64-1119" aria-hidden="true" tabindex="-1"></a><span class="do">### SUBGROUP analysis</span></span>
<span id="cb64-1120"><a href="#cb64-1120" aria-hidden="true" tabindex="-1"></a>dt_ref_all <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_ref_all"</span>))</span>
<span id="cb64-1121"><a href="#cb64-1121" aria-hidden="true" tabindex="-1"></a><span class="co"># get column names</span></span>
<span id="cb64-1122"><a href="#cb64-1122" aria-hidden="true" tabindex="-1"></a>baseline_vars_reflective_propensity <span class="ot">&lt;-</span> dt<span class="sc">|&gt;</span></span>
<span id="cb64-1123"><a href="#cb64-1123" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"t0"</span>), <span class="sc">-</span>t0_eth_cat) <span class="sc">|&gt;</span> <span class="fu">colnames</span>()</span>
<span id="cb64-1124"><a href="#cb64-1124" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span>  dt_ref_all</span>
<span id="cb64-1125"><a href="#cb64-1125" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span>  <span class="st">"t2_kessler_latent_depression_z"</span></span>
<span id="cb64-1126"><a href="#cb64-1126" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="st">"t1_hours_exercise_coarsen"</span> <span class="co"># already defined above</span></span>
<span id="cb64-1127"><a href="#cb64-1127" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> baseline_vars_reflective_propensity</span>
<span id="cb64-1128"><a href="#cb64-1128" aria-hidden="true" tabindex="-1"></a>treat_0 <span class="ot">=</span> <span class="st">"inactive"</span></span>
<span id="cb64-1129"><a href="#cb64-1129" aria-hidden="true" tabindex="-1"></a>treat_1 <span class="ot">=</span> <span class="st">"very_active"</span></span>
<span id="cb64-1130"><a href="#cb64-1130" aria-hidden="true" tabindex="-1"></a>estimand <span class="ot">=</span> <span class="st">"ATE"</span></span>
<span id="cb64-1131"><a href="#cb64-1131" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">=</span> <span class="st">"RD"</span></span>
<span id="cb64-1132"><a href="#cb64-1132" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb64-1133"><a href="#cb64-1133" aria-hidden="true" tabindex="-1"></a>family <span class="ot">=</span> <span class="st">"gaussian"</span></span>
<span id="cb64-1134"><a href="#cb64-1134" aria-hidden="true" tabindex="-1"></a>continuous_X <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb64-1135"><a href="#cb64-1135" aria-hidden="true" tabindex="-1"></a>splines <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb64-1136"><a href="#cb64-1136" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb64-1137"><a href="#cb64-1137" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="st">"t0_eth_cat"</span></span>
<span id="cb64-1138"><a href="#cb64-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1139"><a href="#cb64-1139" aria-hidden="true" tabindex="-1"></a><span class="co"># not we interact the subclass X treatment X covariates</span></span>
<span id="cb64-1140"><a href="#cb64-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1141"><a href="#cb64-1141" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span></span>
<span id="cb64-1142"><a href="#cb64-1142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(</span>
<span id="cb64-1143"><a href="#cb64-1143" aria-hidden="true" tabindex="-1"></a>    Y,</span>
<span id="cb64-1144"><a href="#cb64-1144" aria-hidden="true" tabindex="-1"></a>    <span class="st">"~"</span>,</span>
<span id="cb64-1145"><a href="#cb64-1145" aria-hidden="true" tabindex="-1"></a>    S,</span>
<span id="cb64-1146"><a href="#cb64-1146" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb64-1147"><a href="#cb64-1147" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb64-1148"><a href="#cb64-1148" aria-hidden="true" tabindex="-1"></a>    X ,</span>
<span id="cb64-1149"><a href="#cb64-1149" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb64-1150"><a href="#cb64-1150" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb64-1151"><a href="#cb64-1151" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(baseline_vars_reflective_propensity, <span class="at">collapse =</span> <span class="st">"+"</span>),</span>
<span id="cb64-1152"><a href="#cb64-1152" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span>,</span>
<span id="cb64-1153"><a href="#cb64-1153" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span></span>
<span id="cb64-1154"><a href="#cb64-1154" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb64-1155"><a href="#cb64-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1156"><a href="#cb64-1156" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb64-1157"><a href="#cb64-1157" aria-hidden="true" tabindex="-1"></a>fit_all_dep  <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb64-1158"><a href="#cb64-1158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(formula_str),</span>
<span id="cb64-1159"><a href="#cb64-1159" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights,</span>
<span id="cb64-1160"><a href="#cb64-1160" aria-hidden="true" tabindex="-1"></a>  <span class="co"># weights = if (!is.null(weight_var)) weight_var else NULL,</span></span>
<span id="cb64-1161"><a href="#cb64-1161" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> family,</span>
<span id="cb64-1162"><a href="#cb64-1162" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df</span>
<span id="cb64-1163"><a href="#cb64-1163" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-1164"><a href="#cb64-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1165"><a href="#cb64-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1166"><a href="#cb64-1166" aria-hidden="true" tabindex="-1"></a><span class="co"># coefs &lt;- coef(fit_all_dep)</span></span>
<span id="cb64-1167"><a href="#cb64-1167" aria-hidden="true" tabindex="-1"></a><span class="co"># table(is.na(coefs))#   </span></span>
<span id="cb64-1168"><a href="#cb64-1168" aria-hidden="true" tabindex="-1"></a><span class="co"># insight::get_varcov(fit_all_all)</span></span>
<span id="cb64-1169"><a href="#cb64-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1170"><a href="#cb64-1170" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate coefficients</span></span>
<span id="cb64-1171"><a href="#cb64-1171" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(clarify<span class="sc">::</span>sim)</span>
<span id="cb64-1172"><a href="#cb64-1172" aria-hidden="true" tabindex="-1"></a>sim_model_all <span class="ot">&lt;-</span> <span class="fu">sim</span>(fit_all_dep, <span class="at">n =</span> nsims, <span class="at">vcov =</span> <span class="st">"HC1"</span>)</span>
<span id="cb64-1173"><a href="#cb64-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1174"><a href="#cb64-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1175"><a href="#cb64-1175" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in europeans</span></span>
<span id="cb64-1176"><a href="#cb64-1176" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e_d <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb64-1177"><a href="#cb64-1177" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb64-1178"><a href="#cb64-1178" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb64-1179"><a href="#cb64-1179" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb64-1180"><a href="#cb64-1180" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span>,</span>
<span id="cb64-1181"><a href="#cb64-1181" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb64-1182"><a href="#cb64-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1183"><a href="#cb64-1183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1184"><a href="#cb64-1184" aria-hidden="true" tabindex="-1"></a><span class="co"># note contrast of interest</span></span>
<span id="cb64-1185"><a href="#cb64-1185" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e_d <span class="ot">&lt;-</span></span>
<span id="cb64-1186"><a href="#cb64-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_e_d, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span>)</span>
<span id="cb64-1187"><a href="#cb64-1187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1188"><a href="#cb64-1188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1189"><a href="#cb64-1189" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in māori</span></span>
<span id="cb64-1190"><a href="#cb64-1190" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m_d <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb64-1191"><a href="#cb64-1191" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb64-1192"><a href="#cb64-1192" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb64-1193"><a href="#cb64-1193" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb64-1194"><a href="#cb64-1194" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>,</span>
<span id="cb64-1195"><a href="#cb64-1195" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span></span>
<span id="cb64-1196"><a href="#cb64-1196" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-1197"><a href="#cb64-1197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1198"><a href="#cb64-1198" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb64-1199"><a href="#cb64-1199" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m_d <span class="ot">&lt;-</span></span>
<span id="cb64-1200"><a href="#cb64-1200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_m_d, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span>)</span>
<span id="cb64-1201"><a href="#cb64-1201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1202"><a href="#cb64-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1203"><a href="#cb64-1203" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb64-1204"><a href="#cb64-1204" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(sim_estimand_all_e_d)</span></span>
<span id="cb64-1205"><a href="#cb64-1205" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(sim_estimand_all_m_d)</span></span>
<span id="cb64-1206"><a href="#cb64-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1207"><a href="#cb64-1207" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange</span></span>
<span id="cb64-1208"><a href="#cb64-1208" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_e_d) <span class="ot">&lt;-</span></span>
<span id="cb64-1209"><a href="#cb64-1209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_e_d), <span class="st">"e"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb64-1210"><a href="#cb64-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1211"><a href="#cb64-1211" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_m_d) <span class="ot">&lt;-</span></span>
<span id="cb64-1212"><a href="#cb64-1212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_m_d), <span class="st">"m"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb64-1213"><a href="#cb64-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1214"><a href="#cb64-1214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1215"><a href="#cb64-1215" aria-hidden="true" tabindex="-1"></a>est_all_d <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sim_estimand_all_m_d, sim_estimand_all_e_d)</span>
<span id="cb64-1216"><a href="#cb64-1216" aria-hidden="true" tabindex="-1"></a>est_all_d <span class="ot">&lt;-</span> <span class="fu">transform</span>(est_all_d, <span class="st">`</span><span class="at">RD_m - RD_e</span><span class="st">`</span> <span class="ot">=</span> RD_m <span class="sc">-</span> RD_e)</span>
<span id="cb64-1217"><a href="#cb64-1217" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sim_estimand_all_m_d, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"sim_estimand_all_m_d"</span>))</span>
<span id="cb64-1218"><a href="#cb64-1218" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sim_estimand_all_e_d, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"sim_estimand_all_e_d"</span>))</span>
<span id="cb64-1219"><a href="#cb64-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1220"><a href="#cb64-1220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1221"><a href="#cb64-1221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1222"><a href="#cb64-1222" aria-hidden="true" tabindex="-1"></a><span class="fu">### Report anxiety results</span></span>
<span id="cb64-1225"><a href="#cb64-1225" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-1226"><a href="#cb64-1226" aria-hidden="true" tabindex="-1"></a><span class="co"># return stored estimates </span></span>
<span id="cb64-1227"><a href="#cb64-1227" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e_d <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_e_d"</span>))</span>
<span id="cb64-1228"><a href="#cb64-1228" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m_d<span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"sim_estimand_all_m_d"</span>))</span>
<span id="cb64-1229"><a href="#cb64-1229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1230"><a href="#cb64-1230" aria-hidden="true" tabindex="-1"></a><span class="co"># create individual summaries </span></span>
<span id="cb64-1231"><a href="#cb64-1231" aria-hidden="true" tabindex="-1"></a>sum_e_d <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim_estimand_all_e_d)</span>
<span id="cb64-1232"><a href="#cb64-1232" aria-hidden="true" tabindex="-1"></a>sum_m_d <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim_estimand_all_m_d)</span>
<span id="cb64-1233"><a href="#cb64-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1234"><a href="#cb64-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1235"><a href="#cb64-1235" aria-hidden="true" tabindex="-1"></a><span class="co"># create individual tables</span></span>
<span id="cb64-1236"><a href="#cb64-1236" aria-hidden="true" tabindex="-1"></a>tab_ed <span class="ot">&lt;-</span> <span class="fu">sub_tab_ate</span>(sum_e_d, <span class="at">new_name =</span> <span class="st">"NZ Euro Depression"</span>)</span>
<span id="cb64-1237"><a href="#cb64-1237" aria-hidden="true" tabindex="-1"></a>tab_md <span class="ot">&lt;-</span> <span class="fu">sub_tab_ate</span>(sum_m_d, <span class="at">new_name =</span> <span class="st">"Māori Depression"</span>)</span>
<span id="cb64-1238"><a href="#cb64-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1239"><a href="#cb64-1239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1240"><a href="#cb64-1240" aria-hidden="true" tabindex="-1"></a><span class="co"># expand tables </span></span>
<span id="cb64-1241"><a href="#cb64-1241" aria-hidden="true" tabindex="-1"></a>plot_ed <span class="ot">&lt;-</span> <span class="fu">sub_group_tab</span>(tab_ed, <span class="at">type=</span> <span class="st">"RD"</span>)</span>
<span id="cb64-1242"><a href="#cb64-1242" aria-hidden="true" tabindex="-1"></a>plot_md <span class="ot">&lt;-</span> <span class="fu">sub_group_tab</span>(tab_md, <span class="at">type=</span> <span class="st">"RD"</span>)</span>
<span id="cb64-1243"><a href="#cb64-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1244"><a href="#cb64-1244" aria-hidden="true" tabindex="-1"></a>big_tab_d <span class="ot">&lt;-</span> <span class="fu">rbind</span>(plot_ed,plot_md)</span>
<span id="cb64-1245"><a href="#cb64-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1246"><a href="#cb64-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1247"><a href="#cb64-1247" aria-hidden="true" tabindex="-1"></a><span class="co"># table for anxiety outcome --format as "markdown" if you are using quarto documents</span></span>
<span id="cb64-1248"><a href="#cb64-1248" aria-hidden="true" tabindex="-1"></a>big_tab_d <span class="sc">|&gt;</span> </span>
<span id="cb64-1249"><a href="#cb64-1249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format=</span><span class="st">"markdown"</span>)</span>
<span id="cb64-1250"><a href="#cb64-1250" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1251"><a href="#cb64-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1252"><a href="#cb64-1252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1253"><a href="#cb64-1253" aria-hidden="true" tabindex="-1"></a><span class="fu">### Graph Anxiety result</span></span>
<span id="cb64-1254"><a href="#cb64-1254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1255"><a href="#cb64-1255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1258"><a href="#cb64-1258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-1259"><a href="#cb64-1259" aria-hidden="true" tabindex="-1"></a><span class="co"># group tables</span></span>
<span id="cb64-1260"><a href="#cb64-1260" aria-hidden="true" tabindex="-1"></a><span class="fu">sub_group_plot_ate</span>(big_tab_d, <span class="at">title =</span> <span class="st">"Effect of Exercise on Depression"</span>, <span class="at">subtitle =</span> <span class="st">"Subgroup Analysis: NZ Euro and Māori"</span>, <span class="at">xlab =</span> <span class="st">"Groups"</span>, <span class="at">ylab =</span> <span class="st">"Effects"</span>,</span>
<span id="cb64-1261"><a href="#cb64-1261" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x_offset =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb64-1262"><a href="#cb64-1262" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x_lim_lo =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb64-1263"><a href="#cb64-1263" aria-hidden="true" tabindex="-1"></a>                           <span class="at">x_lim_hi =</span> <span class="fl">1.5</span>)</span>
<span id="cb64-1264"><a href="#cb64-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1265"><a href="#cb64-1265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1266"><a href="#cb64-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1267"><a href="#cb64-1267" aria-hidden="true" tabindex="-1"></a><span class="fu">###  Interpretation</span></span>
<span id="cb64-1268"><a href="#cb64-1268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1269"><a href="#cb64-1269" aria-hidden="true" tabindex="-1"></a>Use the function, again, modify the outputs to fit with your study and results and provide your own interpretation. </span>
<span id="cb64-1270"><a href="#cb64-1270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1271"><a href="#cb64-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1274"><a href="#cb64-1274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-1275"><a href="#cb64-1275" aria-hidden="true" tabindex="-1"></a><span class="fu">interpret_results_subgroup</span>(big_tab_d, <span class="at">exposure =</span> <span class="st">"Exercise"</span>, <span class="at">outcome =</span> <span class="st">"Depression"</span>)</span>
<span id="cb64-1276"><a href="#cb64-1276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1277"><a href="#cb64-1277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1278"><a href="#cb64-1278" aria-hidden="true" tabindex="-1"></a><span class="fu">### Estimate the subgroup contrast</span></span>
<span id="cb64-1279"><a href="#cb64-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1280"><a href="#cb64-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1283"><a href="#cb64-1283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb64-1284"><a href="#cb64-1284" aria-hidden="true" tabindex="-1"></a><span class="co"># calculated above</span></span>
<span id="cb64-1285"><a href="#cb64-1285" aria-hidden="true" tabindex="-1"></a>est_all_d <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"est_all_d"</span>))</span>
<span id="cb64-1286"><a href="#cb64-1286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1287"><a href="#cb64-1287" aria-hidden="true" tabindex="-1"></a><span class="co"># make the sumamry into a dataframe so we can make a table</span></span>
<span id="cb64-1288"><a href="#cb64-1288" aria-hidden="true" tabindex="-1"></a>dfd <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">summary</span>(est_all_d))</span>
<span id="cb64-1289"><a href="#cb64-1289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1290"><a href="#cb64-1290" aria-hidden="true" tabindex="-1"></a><span class="co"># get rownames for selecting the correct row</span></span>
<span id="cb64-1291"><a href="#cb64-1291" aria-hidden="true" tabindex="-1"></a>dfd<span class="sc">$</span>RowName <span class="ot">&lt;-</span> <span class="fu">row.names</span>(dfd)</span>
<span id="cb64-1292"><a href="#cb64-1292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1293"><a href="#cb64-1293" aria-hidden="true" tabindex="-1"></a><span class="co"># select the correct row -- the group contrast</span></span>
<span id="cb64-1294"><a href="#cb64-1294" aria-hidden="true" tabindex="-1"></a>filtered_dfd <span class="ot">&lt;-</span> dfd <span class="sc">|&gt;</span> </span>
<span id="cb64-1295"><a href="#cb64-1295" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(RowName <span class="sc">==</span> <span class="st">"RD_m - RD_e"</span>) </span>
<span id="cb64-1296"><a href="#cb64-1296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1297"><a href="#cb64-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1298"><a href="#cb64-1298" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the filtered data frame</span></span>
<span id="cb64-1299"><a href="#cb64-1299" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb64-1300"><a href="#cb64-1300" aria-hidden="true" tabindex="-1"></a>filtered_dfd  <span class="sc">|&gt;</span> </span>
<span id="cb64-1301"><a href="#cb64-1301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>RowName) <span class="sc">|&gt;</span> </span>
<span id="cb64-1302"><a href="#cb64-1302" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb64-1303"><a href="#cb64-1303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) </span>
<span id="cb64-1304"><a href="#cb64-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1305"><a href="#cb64-1305" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb64-1306"><a href="#cb64-1306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1307"><a href="#cb64-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1308"><a href="#cb64-1308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1309"><a href="#cb64-1309" aria-hidden="true" tabindex="-1"></a>Reporting might be: </span>
<span id="cb64-1310"><a href="#cb64-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1311"><a href="#cb64-1311" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The estimated reduction of depression from exercise is higher overall for New Zealand Europeans (RD_e) compared to Māori (RD_m). This is suggested by the estimated risk difference (RD_m - RD_e) of 0.068. However, there is a degree of uncertainty in this estimate, as the confidence interval (-0.09 to 0.229) crosses zero. This suggests that we cannot be confident that the difference in depression reduction between New Zealand Europeans and Māori is statistically significant. It's possible that the true difference could be zero or even negative, implying a greater depression reduction for Māori than New Zealand Europeans. Thus, while the results hint at a larger depression reduction for New Zealand Europeans, the uncertainty in this estimate urges us to interpret this difference with caution.</span></span>
<span id="cb64-1312"><a href="#cb64-1312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1313"><a href="#cb64-1313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1314"><a href="#cb64-1314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1315"><a href="#cb64-1315" aria-hidden="true" tabindex="-1"></a><span class="fu">### Discusion </span></span>
<span id="cb64-1316"><a href="#cb64-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1317"><a href="#cb64-1317" aria-hidden="true" tabindex="-1"></a>You'll need to do this yourself. Here's a start: </span>
<span id="cb64-1318"><a href="#cb64-1318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1319"><a href="#cb64-1319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1320"><a href="#cb64-1320" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In our study, we employed a robust statistical method that helps us estimate the impact of exercise on reducing anxiety among different population groups – New Zealand Europeans and Māori. This method has the advantage of providing reliable results even if our underlying assumptions aren't entirely accurate – a likely scenario given the complexity of real-world data.  However, this robustness comes with a trade-off: it gives us wider ranges of uncertainty in our estimates. This doesn't mean the analysis is flawed; rather, it accurately represents our level of certainty given the data we have.</span></span>
<span id="cb64-1321"><a href="#cb64-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1322"><a href="#cb64-1322" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Exercise and Anxiety**</span></span>
<span id="cb64-1323"><a href="#cb64-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1324"><a href="#cb64-1324" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Our analysis suggests that exercise may have a greater effect in reducing anxiety among New Zealand Europeans compared to Māori. This conclusion comes from our primary causal estimate, the risk difference, which is 0.104. However, it's crucial to consider our uncertainty in this value. We represent this uncertainty as a range, also known as a confidence interval. In this case, the interval ranges from -0.042 to 0.279. What this means is, given our current data and method, the true effect could plausibly be anywhere within this range. While our best estimate shows a higher reduction in anxiety for New Zealand Europeans, the range of plausible values includes zero and even negative values. This implies that the true effect could be no difference between the two groups or even a higher reduction in Māori. Hence, while there's an indication of a difference, we should interpret it cautiously given the wide range of uncertainty.</span></span>
<span id="cb64-1325"><a href="#cb64-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1326"><a href="#cb64-1326" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Thus, although our analysis points towards a potential difference in how exercise reduces anxiety among these groups, the level of uncertainty means we should be careful about drawing firm conclusions. More research is needed to further explore these patterns.</span></span>
<span id="cb64-1327"><a href="#cb64-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1328"><a href="#cb64-1328" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Exercise and Depression**</span></span>
<span id="cb64-1329"><a href="#cb64-1329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1330"><a href="#cb64-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1331"><a href="#cb64-1331" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; In addition to anxiety, we also examined the effect of exercise on depression. We do not find evidence for reduction of depression from exercise in either group. We do not find evidence for the effect of weekly exercise -- as self-reported -- on depression. </span></span>
<span id="cb64-1332"><a href="#cb64-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1333"><a href="#cb64-1333" aria-hidden="true" tabindex="-1"></a><span class="fu">#### **Proviso**</span></span>
<span id="cb64-1334"><a href="#cb64-1334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1335"><a href="#cb64-1335" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; It is important to bear in mind that statistical results are only one piece of a larger scientific puzzle about the relationship between excercise and well-being. Other pieces include understanding the context, incorporating subject matter knowledge, and considering the implications of the findings. In the present study, wide confidence intervals suggest the possibility of considerable individual differences.$\dots$ nevertheless, $\dots$</span></span>
<span id="cb64-1336"><a href="#cb64-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1337"><a href="#cb64-1337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-1338"><a href="#cb64-1338" aria-hidden="true" tabindex="-1"></a>**Again, you will need to come up with your own discussion, but follow the step-by-step instructions above as a guide.**</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>