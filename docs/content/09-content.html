<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Bulbulia">
<meta name="dcterms.date" content="2024-05-06">

<title>PSYC 434 Conducting Research Across Cultures: Trimester 1, 2024 – Causal inference: a step by step guide</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PSYC 434 Conducting Research Across Cultures: Trimester 1, 2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../content/course-outline.html"> 
<span class="menu-text">Course Outline</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../content/glossary.pdf">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/course-outline.html">
 <span class="dropdown-text">Course Outline</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/01-content.html">
 <span class="dropdown-text">Week 1: Course Introduction - R (installing packages)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/02-content.html">
 <span class="dropdown-text">Week 2: Causal Diagrams - Elementary Structures and Rules - R (using the interface)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/03-content.html">
 <span class="dropdown-text">Week 3: Causal Diagrams - Confounding Bias - R (regression/simulation)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/04-content.html">
 <span class="dropdown-text">Week 4: Causal Diagrams - Interaction, Measurement Bias, Selection Bias - R (regression/simulation)</span></a>
  </li>  
        <li class="dropdown-header">Week 5: Quiz - R (regression/simulation/reporting)</li>
        <li>
    <a class="dropdown-item" href="../content/06-content.html">
 <span class="dropdown-text">Week 6: Causal Inference - Key Concepts ATE - R (regression/simulation: ATE)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/07-content.html">
 <span class="dropdown-text">Week 7: Causal Inference - Key Concept CATE - R (regression/simulation: ATE)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/08-content.html">
 <span class="dropdown-text">Week 8: Causal Inference - Estimation of ATE and CATE - R and LaTeX</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/09-content.html">
 <span class="dropdown-text">Week 9: Hands On: Full Analysis in R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/10-content.html">
 <span class="dropdown-text">Week 10: Working with Quarto Documents</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/11-content.html">
 <span class="dropdown-text">Week 11: Measurement: Factor Analysis, CFA, MultiGroup CFA, Partial Invariance</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/12-content.html">
 <span class="dropdown-text">Week 12: Measurement: Conceptual Problems</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Causal inference: a step by step guide</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Joseph Bulbulia <a href="mailto:joseph.bulbulia@vuw.ac.nz" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-5861-2056" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Victoria University of Wellington, New Zealand
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 6, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lab" id="toc-lab" class="nav-link active" data-scroll-target="#lab">LAB</a></li>
  <li><a href="#what-you-will-learn" id="toc-what-you-will-learn" class="nav-link" data-scroll-target="#what-you-will-learn">What You Will Learn</a></li>
  <li><a href="#part-1-new-content" id="toc-part-1-new-content" class="nav-link" data-scroll-target="#part-1-new-content">Part 1: New Content</a>
  <ul class="collapse">
  <li><a href="#modified-treatment-policies-and-e-values" id="toc-modified-treatment-policies-and-e-values" class="nav-link" data-scroll-target="#modified-treatment-policies-and-e-values">Modified Treatment Policies and E-values</a></li>
  <li><a href="#sensitivity-analysis-using-e-values" id="toc-sensitivity-analysis-using-e-values" class="nav-link" data-scroll-target="#sensitivity-analysis-using-e-values">Sensitivity Analysis using E-values</a></li>
  </ul></li>
  <li><a href="#part-2-guide-for-preparing-your-study" id="toc-part-2-guide-for-preparing-your-study" class="nav-link" data-scroll-target="#part-2-guide-for-preparing-your-study">Part 2 Guide For Preparing Your Study</a></li>
  <li><a href="#motivations-for-a-three-wave-longitudinal-design-for-observational-causal-inference." id="toc-motivations-for-a-three-wave-longitudinal-design-for-observational-causal-inference." class="nav-link" data-scroll-target="#motivations-for-a-three-wave-longitudinal-design-for-observational-causal-inference.">Motivations for a Three-Wave Longitudinal Design for Observational Causal Inference.</a>
  <ul class="collapse">
  <li><a href="#common-cause-of-exposure-and-outcome." id="toc-common-cause-of-exposure-and-outcome." class="nav-link" data-scroll-target="#common-cause-of-exposure-and-outcome.">Common cause of exposure and outcome.</a></li>
  <li><a href="#solution-adjust-for-confounder" id="toc-solution-adjust-for-confounder" class="nav-link" data-scroll-target="#solution-adjust-for-confounder">Solution: Adjust for Confounder</a></li>
  <li><a href="#bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2" id="toc-bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2" class="nav-link" data-scroll-target="#bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2">Bias: exposure at baseline is a common cause of the exposure at t1 and outcome at t2</a></li>
  <li><a href="#solution-adjust-for-confounder-at-baseline" id="toc-solution-adjust-for-confounder-at-baseline" class="nav-link" data-scroll-target="#solution-adjust-for-confounder-at-baseline">Solution: adjust for confounder at baseline</a></li>
  <li><a href="#a-more-thorough-confounding-control" id="toc-a-more-thorough-confounding-control" class="nav-link" data-scroll-target="#a-more-thorough-confounding-control">A more thorough confounding control</a></li>
  <li><a href="#generic-3-wave-panel-design-vanderweeele-2020" id="toc-generic-3-wave-panel-design-vanderweeele-2020" class="nav-link" data-scroll-target="#generic-3-wave-panel-design-vanderweeele-2020">Generic 3-wave panel design (VanderWeeele 2020)</a></li>
  </ul></li>
  <li><a href="#sensitivity-analysis" id="toc-sensitivity-analysis" class="nav-link" data-scroll-target="#sensitivity-analysis">Sensitivity analysis</a></li>
  <li><a href="#comprehensive-checklist-for-detailed-reporting-of-a-causal-inferenctial-study." id="toc-comprehensive-checklist-for-detailed-reporting-of-a-causal-inferenctial-study." class="nav-link" data-scroll-target="#comprehensive-checklist-for-detailed-reporting-of-a-causal-inferenctial-study.">Comprehensive Checklist for Detailed Reporting of a Causal Inferenctial Study.</a></li>
  <li><a href="#step-1-formulate-the-research-question" id="toc-step-1-formulate-the-research-question" class="nav-link" data-scroll-target="#step-1-formulate-the-research-question">STEP 1 Formulate the Research Question</a>
  <ul class="collapse">
  <li><a href="#d.-highlight-unmeasured-pre-treatment-covariates" id="toc-d.-highlight-unmeasured-pre-treatment-covariates" class="nav-link" data-scroll-target="#d.-highlight-unmeasured-pre-treatment-covariates">d.&nbsp;Highlight unmeasured pre-treatment covariates</a></li>
  <li><a href="#e.-choose-the-scale-for-a-causal-contrast" id="toc-e.-choose-the-scale-for-a-causal-contrast" class="nav-link" data-scroll-target="#e.-choose-the-scale-for-a-causal-contrast">e. Choose the scale for a causal contrast</a></li>
  <li><a href="#summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question" id="toc-summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question" class="nav-link" data-scroll-target="#summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question">Summary Step 1: Consider how much we need to do when asking a causal question!</a></li>
  </ul></li>
  <li><a href="#step-2-answer-a-causal-question" id="toc-step-2-answer-a-causal-question" class="nav-link" data-scroll-target="#step-2-answer-a-causal-question">STEP 2: ANSWER A CAUSAL QUESTION</a>
  <ul class="collapse">
  <li><a href="#include-the-measured-exposure-with-baseline-covariates" id="toc-include-the-measured-exposure-with-baseline-covariates" class="nav-link" data-scroll-target="#include-the-measured-exposure-with-baseline-covariates">Include the measured exposure with baseline covariates</a></li>
  <li><a href="#state-the-eligibility-criteria-for-participation" id="toc-state-the-eligibility-criteria-for-participation" class="nav-link" data-scroll-target="#state-the-eligibility-criteria-for-participation">State the eligibility criteria for participation</a></li>
  <li><a href="#determine-how-missing-data-will-be-handled" id="toc-determine-how-missing-data-will-be-handled" class="nav-link" data-scroll-target="#determine-how-missing-data-will-be-handled">Determine how missing data will be handled</a></li>
  <li><a href="#state-a-statistical-model" id="toc-state-a-statistical-model" class="nav-link" data-scroll-target="#state-a-statistical-model">State a statistical model</a></li>
  <li><a href="#reporting" id="toc-reporting" class="nav-link" data-scroll-target="#reporting">Reporting</a></li>
  <li><a href="#example-of-how-to-report-a-doubly-robust-method-in-your-report" id="toc-example-of-how-to-report-a-doubly-robust-method-in-your-report" class="nav-link" data-scroll-target="#example-of-how-to-report-a-doubly-robust-method-in-your-report">Example of how to report a doubly robust method in your report</a></li>
  <li><a href="#inference" id="toc-inference" class="nav-link" data-scroll-target="#inference">Inference</a></li>
  </ul></li>
  <li><a href="#appendix-a-details-of-estimation-approaches" id="toc-appendix-a-details-of-estimation-approaches" class="nav-link" data-scroll-target="#appendix-a-details-of-estimation-approaches">Appendix A: Details of Estimation Approaches</a>
  <ul class="collapse">
  <li><a href="#g-computation-for-subgroup-analysis-estimator" id="toc-g-computation-for-subgroup-analysis-estimator" class="nav-link" data-scroll-target="#g-computation-for-subgroup-analysis-estimator">G-computation for Subgroup Analysis Estimator</a></li>
  <li><a href="#inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-estimator" id="toc-inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-estimator" class="nav-link" data-scroll-target="#inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-estimator">Inverse Probability of Treatment Weighting (IPTW) for Subgroup Analysis Estimator</a></li>
  <li><a href="#doubly-robust-estimation-for-subgroup-analysis-estimator" id="toc-doubly-robust-estimation-for-subgroup-analysis-estimator" class="nav-link" data-scroll-target="#doubly-robust-estimation-for-subgroup-analysis-estimator">Doubly Robust Estimation for Subgroup Analysis Estimator</a></li>
  <li><a href="#doubly-robust-estimation-for-subgroup-analysis-estimator-1" id="toc-doubly-robust-estimation-for-subgroup-analysis-estimator-1" class="nav-link" data-scroll-target="#doubly-robust-estimation-for-subgroup-analysis-estimator-1">Doubly Robust Estimation for Subgroup Analysis Estimator</a></li>
  </ul></li>
  <li><a href="#appendix-b-g-computation-for-subgroup-analysis-estimator-with-non-additive-effects" id="toc-appendix-b-g-computation-for-subgroup-analysis-estimator-with-non-additive-effects" class="nav-link" data-scroll-target="#appendix-b-g-computation-for-subgroup-analysis-estimator-with-non-additive-effects">Appendix B: G-computation for Subgroup Analysis Estimator with Non-Additive Effects</a></li>
  <li><a href="#appendix-c-doubly-robust-estimation-for-subgroup-analysis-estimator-with-interaction" id="toc-appendix-c-doubly-robust-estimation-for-subgroup-analysis-estimator-with-interaction" class="nav-link" data-scroll-target="#appendix-c-doubly-robust-estimation-for-subgroup-analysis-estimator-with-interaction">Appendix C: Doubly Robust Estimation for Subgroup Analysis Estimator with Interaction</a></li>
  <li><a href="#appendix-d-marginal-structural-models-for-estimating-population-average-treatment-effect-with-interaction-doubly-robust" id="toc-appendix-d-marginal-structural-models-for-estimating-population-average-treatment-effect-with-interaction-doubly-robust" class="nav-link" data-scroll-target="#appendix-d-marginal-structural-models-for-estimating-population-average-treatment-effect-with-interaction-doubly-robust">Appendix D: Marginal Structural Models for Estimating Population Average Treatment Effect with Interaction (Doubly Robust)</a>
  <ul class="collapse">
  <li><a href="#machine-learning" id="toc-machine-learning" class="nav-link" data-scroll-target="#machine-learning">Machine Learning</a></li>
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">





<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Required</strong> - nil</p>
<p><strong>Optional</strong> - <span class="citation" data-cites="Bulbulia2024PracticalGuide">(<a href="#ref-Bulbulia2024PracticalGuide" role="doc-biblioref">J. A. Bulbulia 2024</a>)</span> <a href="https://osf.io/preprints/psyarxiv/uyg3d">link</a> - <span class="citation" data-cites="hoffman2023">(<a href="#ref-hoffman2023" role="doc-biblioref">Hoffman et al. 2023</a>)</span> <a href="https://arxiv.org/pdf/2304.09460.pdf">link</a> - <span class="citation" data-cites="vanderweele2020">(<a href="#ref-vanderweele2020" role="doc-biblioref">Tyler J. VanderWeele, Mathur, and Chen 2020</a>)</span> <a href="https://www.dropbox.com/scl/fi/srpynr0dvjcndveplcydn/OutcomeWide_StatisticalScience.pdf?rlkey=h4fv32oyjegdfl3jq9u1fifc3&amp;dl=0">link</a></p>
</div>
</div>
<div class="no-row-height column-margin column-container"></div><div class="no-row-height column-margin column-container"></div><div class="no-row-height column-margin column-container"><div id="ref-Bulbulia2024PracticalGuide" class="csl-entry" role="listitem">
Bulbulia, J. A. 2024. <span>“A Practical Guide to Causal Inference in Three-Wave Panel Studies.”</span> OSF. <a href="https://doi.org/10.31234/osf.io/uyg3d">https://doi.org/10.31234/osf.io/uyg3d</a>.
</div></div><div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Key concepts
</div>
</div>
<div class="callout-body-container callout-body">
<p>Doing a causal analysis</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Download the R script</li>
<li>Download the relevant libraries.</li>
<li>Will go through this script step-by-step.</li>
</ul>
</div>
</div>
<ul>
<li><p>Download the script and store in our R directory: <a href="https://raw.githubusercontent.com/go-bayes/psyc-434-2024/main/scripts/example_analysis.R">link to analysis script</a></p></li>
<li><p>Make sure you can install all libraries required of the manuscript template.</p></li>
<li><p>Come to the seminar prepared to work through the analysis</p></li>
</ul>
<section id="lab" class="level2">
<h2 class="anchored" data-anchor-id="lab">LAB</h2>
<ul>
<li><p>We start with our lab this week.</p></li>
<li><p>Here is a link to the workbook:</p></li>
</ul>
<p><a href="https://raw.githubusercontent.com/go-bayes/psyc-434-2024/main/scripts/example_analysis.R">link to template for option 2 assignment 3</a></p>
</section>
<section id="what-you-will-learn" class="level2">
<h2 class="anchored" data-anchor-id="what-you-will-learn">What You Will Learn</h2>
<ul>
<li><p><strong>Modified Treatment Policies</strong></p></li>
<li><p><strong>Setting up your analysis:</strong></p></li>
<li><p><strong>Data wrangling (review):</strong></p></li>
<li><p><strong>Demographic Tables (review):</strong></p></li>
<li><p><strong>Exploratory Tables and Graphs (review)</strong></p></li>
<li><p><strong>Computing inverse probability of censoring weights (IPCW) to handle attrition/missingness</strong></p></li>
<li><p><strong>Sensitivity Analysis: E-values</strong></p></li>
<li><p><strong>Causal Analysis using machine learning ensembles (Targeted Maximum Likelihood)</strong></p></li>
</ul>
</section>
<section id="part-1-new-content" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="part-1-new-content">Part 1: New Content</h2>
<section id="modified-treatment-policies-and-e-values" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="modified-treatment-policies-and-e-values">Modified Treatment Policies and E-values</h3>
<p>A modified treatment policy is a <em>flexible</em> intervention of the following form:</p>
<p><span class="math display">
\mathbf{d}^\lambda (a_1) = \begin{cases} 4 &amp; \text{if } a_1 &lt; 4 \\
a_1 &amp; \text{otherwise} \end{cases}
</span> <span class="math display">
\mathbf{d}^\phi (a_1) = \begin{cases} 0 &amp; \text{if } a_1 &gt; 0 \\
a_1 &amp; \text{otherwise} \end{cases}
</span></p>
<p><span class="math display"> g' = \text{Intervention 1 - Intervention 2} = E[Y(\mathbf{d}^\lambda) - Y(\mathbf{d}^\phi)] </span></p>
<p><span class="math display"> g'' = \text{Intervention 1 - Intervention 2} = E[Y(\mathbf{d}^\lambda) - Y(\mathbf{d}^\phi)] </span></p>
<p><span class="math display">
{\delta}(g) ={g'} - {g''}
</span></p>
<p>Rather than shifting an entire population into one of two states, the estimand flexibly shifts a population according to a pre-specified function.</p>
<p>see: <span class="citation" data-cites="hoffman2023">Hoffman et al. (<a href="#ref-hoffman2023" role="doc-biblioref">2023</a>)</span></p>
<div class="no-row-height column-margin column-container"></div></section>
<section id="sensitivity-analysis-using-e-values" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sensitivity-analysis-using-e-values">Sensitivity Analysis using E-values</h3>
<blockquote class="blockquote">
<p>The minimum strength of association on the risk ratio scale that an unmeasured confounder would need to have with both the exposure and the outcome, conditional on the measured covariates, to fully explain away a specific exposure-outcome association</p>
</blockquote>
<p>See: <span class="citation" data-cites="mathur2018">Mathur et al. (<a href="#ref-mathur2018" role="doc-biblioref">2018</a>)</span>; <span class="citation" data-cites="linden2020EVALUE">Linden, Mathur, and VanderWeele (<a href="#ref-linden2020EVALUE" role="doc-biblioref">2020</a>)</span>; <span class="citation" data-cites="vanderweele2017">Tyler J. VanderWeele and Ding (<a href="#ref-vanderweele2017" role="doc-biblioref">2017</a>)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="ref-mathur2018" class="csl-entry" role="listitem">
Mathur, Maya B, Peng Ding, Corinne A Riddell, and Tyler J VanderWeele. 2018. <span>“Website and r Package for Computing <span>E</span>-Values.”</span> <em>Epidemiology (Cambridge, Mass.)</em> 29 (5): e45.
</div></div><p>For example, suppose that the lower bound of the the E-value was 1.3 with the lower bound of the confidence interval = 1.12, we might then write:</p>
<blockquote class="blockquote">
<p>With an observed risk ratio of RR=1.3, an unmeasured confounder that was associated with both the outcome and the exposure by a risk ratio of 1.3-fold each (or 30%), above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of 1.12-fold (or 12%) each could do so, but weaker joint confounder associations could not.</p>
</blockquote>
<p>The equations are as follows (for risk ratios)</p>
<p><span class="math display">
E-value_{RR} = RR + \sqrt{RR \times (RR - 1)}
</span> <span class="math display">
E-value_{LCL} = LCL + \sqrt{LCL \times (LCL - 1)}
</span></p>
<p>Here is an R function that will calculate E-values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># evalue for risk ratio</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>calculate_e_value <span class="ot">&lt;-</span> <span class="cf">function</span>(rr, lcl) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  e_value_rr <span class="ot">=</span> rr <span class="sc">+</span> <span class="fu">sqrt</span>(rr<span class="sc">*</span>(rr <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  e_value_lcl <span class="ot">=</span> lcl <span class="sc">+</span> <span class="fu">sqrt</span>(lcl<span class="sc">*</span>(lcl <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">e_value_rr =</span> e_value_rr, <span class="at">e_value_lcl =</span> e_value_lcl)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># e.g. smoking causes cancer</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># finding   RR = 10.73 (95% CI: 8.02, 14.36)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>evalue_computed <span class="ot">&lt;-</span> <span class="fu">calculate_e_value</span>(<span class="fl">10.73</span>, <span class="fl">8.02</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#print</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>evalue_computed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$e_value_rr
[1] 20.94777

$e_value_lcl
[1] 15.52336</code></pre>
</div>
</div>
<p>We write:</p>
<blockquote class="blockquote">
<p>With an observed risk ratio of RR=10.7, an unmeasured confounder that was associated 20.9477737-fold each, above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of <code>e_value_rr$e_value_lcl</code>-fold each could do so, but weaker joint confounder associations could not.</p>
</blockquote>
<p>Note that in this class, most of the outcomes will be (standardised) continuous outcomes. Here’s a function and LaTeX code to describe the approximation.</p>
<p>This function takes a linear regression coefficient estimate (<code>est</code>), its standard error (<code>se</code>), the standard deviation of the outcome (<code>sd</code>), a contrast of interest in the exposure (<code>delta</code>, which defaults to 1), and a “true” standardized mean difference (true, which defaults to 0). It calculates the odds ratio using the formula from Chinn (2000) and VanderWeele (2017), and then uses this to calculate the E-value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#evalue for ols</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>compute_evalue_ols <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se, <span class="at">delta =</span> <span class="dv">1</span>, <span class="at">true =</span> <span class="dv">0</span>) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rescale estimate and SE to get a contrast of size delta</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  est <span class="ot">&lt;-</span> est <span class="sc">/</span> delta</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  se <span class="ot">&lt;-</span> se <span class="sc">/</span> delta</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute transformed odds ratio and ci's</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  odds_ratio <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">0.91</span> <span class="sc">*</span> est)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  lo <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">0.91</span> <span class="sc">*</span> est <span class="sc">-</span> <span class="fl">1.78</span> <span class="sc">*</span> se)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  hi <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">0.91</span> <span class="sc">*</span> est <span class="sc">+</span> <span class="fl">1.78</span> <span class="sc">*</span> se)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute E-Values based on the RR values</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  evalue_point_estimate <span class="ot">&lt;-</span> odds_ratio <span class="sc">*</span> <span class="fu">sqrt</span>(odds_ratio <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  evalue_lower_ci <span class="ot">&lt;-</span> lo <span class="sc">*</span> <span class="fu">sqrt</span>(lo <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the e-values</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">EValue_PointEstimate =</span> evalue_point_estimate,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">EValue_LowerCI =</span> evalue_lower_ci))</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># example:</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># suppose we have an estimate of 0.5, a standard error of 0.1, and a standard deviation of 1.</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># this would correspond to a half a standard deviation increase in the outcome per unit increase in the exposure.</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">compute_evalue_ols</span>(<span class="at">est =</span> <span class="fl">0.5</span>, <span class="at">se =</span> <span class="fl">0.1</span>, <span class="at">delta =</span> <span class="dv">1</span>)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>point_round <span class="ot">&lt;-</span> <span class="fu">round</span>(results<span class="sc">$</span>EValue_PointEstimate, <span class="dv">3</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>ci_round <span class="ot">&lt;-</span> <span class="fu">round</span>(results<span class="sc">$</span>EValue_LowerCI, <span class="dv">3</span>)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(point_round)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.53</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ci_round)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.009</code></pre>
</div>
</div>
<p>We write:</p>
<blockquote class="blockquote">
<p>With an observed risk ratio of 2.53, an unmeasured confounder that was associated with both the outcome and the exposure by a risk ratio of 2.53-fold each, above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of 2.009-fold each could do so, but weaker joint confounder associations could not.</p>
</blockquote>
<p>Note the E-values package will do the computational work for us and this is what we use in the <code>margot</code> package to obtain E-values for sensitivity analysis.</p>
</section>
</section>
<section id="part-2-guide-for-preparing-your-study" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="part-2-guide-for-preparing-your-study">Part 2 Guide For Preparing Your Study</h2>
<p>Recall that psychology begins with two questions.</p>
<blockquote class="blockquote">
<p>What do I want to know about thought and behaviour? What is the target population?</p>
</blockquote>
<p>In cross-cultural psychology, these questions relate to differences, and similarities, between groups.</p>
<p>Suppose we have asked a question. How can we address it using observational data?</p>
<p>Too fast.</p>
<p>Our question must be made precise.</p>
<p>Today we will consider how to make psychological questions precise, and how to answer them, using 3-wave panel designs <span class="citation" data-cites="vanderweele2020">(<a href="#ref-vanderweele2020" role="doc-biblioref">Tyler J. VanderWeele, Mathur, and Chen 2020</a>)</span>.</p>
<div class="no-row-height column-margin column-container"></div><p>The order is as follows:</p>
<ol type="1">
<li><strong>Motivate Three Wave Longitudinal Designs Using Causal Graphs</strong></li>
<li><strong>Checklist For Causal Estimation in Three Wave Longitudinal Designs</strong></li>
<li><strong>Explanation of the the Checklist</strong></li>
</ol>
</section>
<section id="motivations-for-a-three-wave-longitudinal-design-for-observational-causal-inference." class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="motivations-for-a-three-wave-longitudinal-design-for-observational-causal-inference.">Motivations for a Three-Wave Longitudinal Design for Observational Causal Inference.</h2>
<p>REVIEW: Causal Diagrammes (DAGS) are a remarkably powerful and simple tool for understanding confounding <a href="https://osf.io/b23k7">See here</a></p>
<section id="common-cause-of-exposure-and-outcome." class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="common-cause-of-exposure-and-outcome.">Common cause of exposure and outcome.</h3>
<p>Our question: does visiting a clinical psychologist reduce the 10 year incidence of heart attacks?</p>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-1" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="09-content_files/figure-html/fig-dag-1-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Common cause of exposure and outcome: example
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="solution-adjust-for-confounder" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="solution-adjust-for-confounder">Solution: Adjust for Confounder</h3>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-2" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="09-content_files/figure-html/fig-dag-2-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Solution to this problem.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="bias-exposure-at-baseline-is-a-common-cause-of-the-exposure-at-t1-and-outcome-at-t2">Bias: exposure at baseline is a common cause of the exposure at t1 and outcome at t2</h3>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-3" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="09-content_files/figure-html/fig-dag-3-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Causal graph reveals bias from pre-exosure indicator
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="solution-adjust-for-confounder-at-baseline" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="solution-adjust-for-confounder-at-baseline">Solution: adjust for confounder at baseline</h3>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-4" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="09-content_files/figure-html/fig-dag-4-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Solution to this problem
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="a-more-thorough-confounding-control" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="a-more-thorough-confounding-control">A more thorough confounding control</h3>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-5" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="09-content_files/figure-html/fig-dag-5-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Causal graph:more general panel design
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="generic-3-wave-panel-design-vanderweeele-2020" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="generic-3-wave-panel-design-vanderweeele-2020">Generic 3-wave panel design (VanderWeeele 2020)</h3>
<div class="cell page-columns page-full">
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-6" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="09-content_files/figure-html/fig-dag-6-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Causal graph: three-wave panel design
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sensitivity-analysis" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-analysis">Sensitivity analysis</h2>
</section>
<section id="comprehensive-checklist-for-detailed-reporting-of-a-causal-inferenctial-study." class="level2">
<h2 class="anchored" data-anchor-id="comprehensive-checklist-for-detailed-reporting-of-a-causal-inferenctial-study.">Comprehensive Checklist for Detailed Reporting of a Causal Inferenctial Study.</h2>
</section>
<section id="step-1-formulate-the-research-question" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="step-1-formulate-the-research-question">STEP 1 Formulate the Research Question</h2>
<ul>
<li><strong>State your question:</strong> is my question clearly stated? If not, state it.</li>
<li><strong>Relevance:</strong> have I explained its importance? If not, explain.</li>
<li><strong>Ethics</strong> how might this question affect people? How might not investigating this question affect people?</li>
<li><strong>Causality:</strong> Is my question causal? If not, refine your question.</li>
<li><strong>Subgroup analysis:</strong> does my question involve a subgroup (e.g., cultural group)? If not, develop a subgroup analysis question.</li>
<li><strong>Explain the Framework:</strong> can I explain the causal inference framework and convey the gist to non-specialists? If not, review course materials.</li>
</ul>
<section id="determine-data-requirements" class="level4">
<h4 class="anchored" data-anchor-id="determine-data-requirements">Determine Data Requirements</h4>
<ul>
<li><strong>Data types:</strong> are my data experimental? If yes, your project may not fit this course.</li>
<li><strong>Time-series data:</strong> are my data time-series? If not, reconsider your causal question.</li>
<li><strong>Data waves:</strong> do I have at least three waves of data? If not, beware of confounding control issues.</li>
<li><strong>Data source:</strong> are my data from the NZAVS simulated data set? If not, consult with me.</li>
</ul>
</section>
<section id="determine-the-outcome" class="level4">
<h4 class="anchored" data-anchor-id="determine-the-outcome">Determine the Outcome</h4>
<ul>
<li><strong>Outcome variable:</strong> is the outcome variable <em>Y</em> defined? If not, define it.</li>
<li><strong>Multiple outcomes:</strong> are there multiple outcomes? If yes, explain and define them.</li>
<li><strong>Outcome relevance:</strong> can I explain how the outcome variable/s relate to my question? If not, clarify.</li>
<li><strong>Outcome type:</strong> is my outcome binary and rare? If yes, consider logistic regression. If my outcome is continuous, consider z-transforming it or categorising it (consult an expert).</li>
<li><strong>Outcome timing:</strong> does the outcome appear after the exposure? It should.</li>
</ul>
</section>
<section id="determine-the-exposure" class="level4">
<h4 class="anchored" data-anchor-id="determine-the-exposure">Determine the Exposure</h4>
<ul>
<li><strong>Exposure variable:</strong> is the exposure variable <em>A</em> defined? If not, define it.</li>
<li><strong>Multiple exposures:</strong> are there multiple exposures? If yes, reassess; if only one exposure, proceed.</li>
<li><strong>Exposure relevance:</strong> can I explain how the exposure variable relates to my question? If not, clarify.</li>
<li><strong>Positivity:</strong> can we intervene on the exposure at all levels of the covariates? We should be able to.</li>
<li><strong>Consistency:</strong> can I interpret what it means to intervene on the exposure? I should be able to.</li>
<li><strong>Exchangeability:</strong> are different versions of the exposure conditionally exchangeable given measured baseline confounders? They should be.</li>
<li><strong>Exposure type:</strong> is the exposure binary or continuous?</li>
<li><strong>Shift intervention</strong>: Am I contrasting static interventions or modified treatment policies?</li>
<li><strong>Exposure timing:</strong> Does the exposure appear before the outcome? It should.</li>
</ul>
</section>
<section id="account-for-confounders" class="level4">
<h4 class="anchored" data-anchor-id="account-for-confounders">Account for Confounders</h4>
<ul>
<li><strong>Baseline confounders:</strong> Have I defined my baseline confounders <em>L</em>? I should have.</li>
<li><strong>Justification:</strong> Can I explain how the baseline confounders could affect both <em>A</em> and <em>Y</em>? I should be able to.</li>
<li><strong>Timing:</strong> Are the baseline confounders measured before the exposure? They should be.</li>
<li><strong>Inclusion:</strong> Is the baseline measure of the exposure and the baseline outcome included in the set of baseline confounders? They should be.</li>
<li><strong>Sufficiency:</strong> Are the baseline confounders sufficient to ensure balance on the exposure, such that <em>A</em> is independent of <em>Y</em> given <em>L</em>? If not, plan a sensitivity analysis.</li>
<li><strong>Confounder type:</strong> Are the confounders continuous or binary? If so, consider converting them to z-scores. If they are categorical with three or more levels, do not convert them to z-scores.</li>
</ul>
</section>
<section id="draw-a-causal-diagram-with-unmeasured-confounders" class="level4">
<h4 class="anchored" data-anchor-id="draw-a-causal-diagram-with-unmeasured-confounders">Draw a Causal Diagram with Unmeasured Confounders</h4>
<ul>
<li><strong>Unmeasured confounders:</strong> Does previous science suggest the presence of unmeasured confounders? If not, expand your understanding.</li>
<li><strong>Causal diagram:</strong> Have I drawn a causal diagram (DAG) to highlight both measured and unmeasured sources of confounding? I should have.</li>
<li><strong>Measurement error:</strong> Have I described potential biases from measurement errors? If not, we’ll discuss later.</li>
<li><strong>Temporal order:</strong> Does my DAG have time indicators to ensure correct temporal order? It should.</li>
<li><strong>Time consistency:</strong> Is my DAG organized so that time follows in a consistent direction? It should.</li>
</ul>
</section>
<section id="identify-the-estimand" class="level4">
<h4 class="anchored" data-anchor-id="identify-the-estimand">Identify the Estimand</h4>
<ul>
<li><strong>Causal Estimand:</strong> Is my causal estimand one of the following:</li>
</ul>
<p><span class="math display">ATE_{G,(A,A')} = E[Y(1) - Y(0)|G, L]</span></p>
<p><span class="math display">ATE_{G,(A/A')} = \frac{E[Y(1)|G, L]}{E[Y(0)|G, L]}</span></p>
<p>A modified treatment policy, e.g.</p>
<p><span class="math display">
\mathbf{d}^\lambda (a_1) = \begin{cases} 4 &amp; \text{if } a_1 &lt; 4 \\
a_1 &amp; \text{otherwise} \end{cases}
</span> <span class="math display">
\mathbf{d}^\phi (a_1) = \begin{cases} 0 &amp; \text{if } a_1 &gt; 0 \\
a_1 &amp; \text{otherwise} \end{cases}
</span></p>
<p><span class="math display"> g' = \text{Intervention 1 - Intervention 2} = E[Y(\mathbf{d}^\lambda) - Y(\mathbf{d}^\phi)] </span></p>
<p><span class="math display"> g'' = \text{Intervention 1 - Intervention 2} = E[Y(\mathbf{d}^\lambda) - Y(\mathbf{d}^\phi)] </span></p>
<p><span class="math display">
{\gamma}(g) ={g'} - {g''}
</span></p>
<p>If yes, you’re on the right track.</p>
</section>
<section id="understanding-source-and-target-populations" class="level4">
<h4 class="anchored" data-anchor-id="understanding-source-and-target-populations">Understanding Source and Target Populations</h4>
<ul>
<li><strong>Populations identified:</strong> Have I explained how my sample relates to my target populations? I should have.</li>
<li><strong>Generalisability and transportability:</strong> Have I considered whether my results generalise different populations? I should have.</li>
</ul>
</section>
<section id="set-eligibility-criteria" class="level4">
<h4 class="anchored" data-anchor-id="set-eligibility-criteria">Set Eligibility Criteria</h4>
<ul>
<li><strong>Criteria stated:</strong> Have I stated the eligibility criteria for the study? I should have.</li>
</ul>
</section>
<section id="describe-sample-characteristics" class="level4">
<h4 class="anchored" data-anchor-id="describe-sample-characteristics">Describe Sample Characteristics</h4>
<ul>
<li><strong>Descriptive statistics:</strong> have I provided descriptive statistics for demographic information taken at baseline? I should have.</li>
<li><strong>Exposure change:</strong> Have I demonstrated the magnitudes of change in the exposure from baseline to the exposure interval? I should have.</li>
<li><strong>References:</strong> Have I included references for more information about the sample? I should have.</li>
</ul>
</section>
<section id="addressing-missing-data" class="level4">
<h4 class="anchored" data-anchor-id="addressing-missing-data">Addressing Missing Data</h4>
<ul>
<li><strong>Missing data checks:</strong> Have I checked for missing data? I should have.</li>
<li><strong>Missing data plan:</strong> If there is missing data, have I described how I will address it? I should have.</li>
</ul>
</section>
<section id="selecting-the-model-approach-if-not-using-machine-learning-lecture-7" class="level4">
<h4 class="anchored" data-anchor-id="selecting-the-model-approach-if-not-using-machine-learning-lecture-7">Selecting the Model Approach: If Not Using Machine Learning (Lecture 7)</h4>
<ul>
<li><strong>Approach decision:</strong> Have I decided on using G-computation, IPTW, or Doubly-Robust Estimation? I should have.</li>
<li><strong>Interactions:</strong> If not using machine learning, have I included the interaction of the exposure and baseline covariates? I should have.</li>
<li><strong>Big data:</strong> If I have a large data set, should I include the interaction of the exposure, group, and baseline confounders? I should consider it.</li>
<li><strong>Model specification:</strong> have I double-checked the model specification? I should.</li>
<li><strong>Outcome assessment:</strong> If the outcome is rare and binary, have I specified logistic regression? If it’s continuous, have I considered converting it to z-scores?</li>
<li><strong>Sensitivity analysis:</strong> am I planning a sensitivity analysis using simulation? If yes, describe it (e.g.&nbsp;E-values.)</li>
</ul>
</section>
<section id="if-machine-learing" class="level4">
<h4 class="anchored" data-anchor-id="if-machine-learing">If Machine Learing</h4>
<ul>
<li><strong>Machine Learning</strong>: have I explained how semi-parametric ensemble machine learning works? (see example below).</li>
</ul>
</section>
<section id="d.-highlight-unmeasured-pre-treatment-covariates" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="d.-highlight-unmeasured-pre-treatment-covariates">d.&nbsp;Highlight unmeasured pre-treatment covariates</h3>
<p>Let <strong>U</strong> denoted unmeasured pre-treatment covariates that may potentially bias the statistical association between <em>A</em> and <em>Y</em> independently of the measured covariates.</p>
<section id="consider" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="consider">Consider:</h4>
<ul>
<li>To affect <em>Y</em> and <em>A</em>, <em>U</em> must occur before <em>A</em>.</li>
<li>It is useful to draw a causal diagramme to illustrate all potential sources of bias.</li>
<li>Causal diagrammes are qualitative tools that require specialist expertise. We cannot typically obtain a causal graph from the data.</li>
<li>A causal diagramme should include only as much information as is required to assess confounding. See <a href="#fig-dag-outcomewide" class="quarto-xref">Figure&nbsp;7</a> for an example.</li>
<li>Because we cannot ensure the absence of unmeasured confounders in observational settings, it is vital to conduct sensitivity analyses for the results. For sensitivity analyeses, we use E-values.</li>
</ul>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode tex code-with-copy"><code class="sourceCode latex"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{positioning}</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{shapes.geometric}</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{arrows}</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">\usetikzlibrary</span>{decorations}</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">\tikzstyle</span>{Arrow} = [-&gt;, thin, preaction = {decorate}]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">\tikzset</span>{&gt;=latex}</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">\begin</span>{<span class="ex">tikzpicture</span>}[{every node/.append style}=draw]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">\node</span> [rectangle, draw=white] (U) at (0, 0) {U};</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">\node</span> [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L <span class="fu">\\</span>t0/A <span class="fu">\\</span>t0/Y};</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="fu">\node</span> [rectangle, draw=white] (A) at (4, 0) {t1/A};</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="fu">\node</span> [ellipse, draw=white] (Y) at (6, 0) {t2/Y};</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, draw=black] (U) to (L);</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, draw=black] (L) to (A);</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, draw=red, dotted] (A) to (Y);</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, bend left=50, draw =black] (L) to (Y);</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, bend right=50, draw =black, dotted] (U) to (Y);</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="fu">\draw</span> [-latex, bend left=50, draw =black, dotted] (U) to (A);</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="kw">\end</span>{<span class="ex">tikzpicture</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div id="fig-dag-outcomewide" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-dag-outcomewide-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="09-content_files/figure-html/fig-dag-outcomewide-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-dag-outcomewide-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Causal graph: three-wave panel design.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="e.-choose-the-scale-for-a-causal-contrast" class="level3">
<h3 class="anchored" data-anchor-id="e.-choose-the-scale-for-a-causal-contrast">e. Choose the scale for a causal contrast</h3>
<p>Average causal effects can be inferred by contrasting the expected outcome when a population is exposed to an exposure level, <span class="math inline">E[Y(A = a)]</span>, with the expected outcome under a different exposure level, <span class="math inline">E[Y(A=a')]</span>.</p>
<p>For a binary treatment with levels <span class="math inline">A=0</span> and <span class="math inline">A=1</span>, the Average Treatment Effect (ATE), on the difference scale, is expressed:</p>
<p><span class="math display">ATE_{\text{risk difference}} = E[Y(1)|L] - E[Y(0)|L]</span></p>
<p>On the risk ratio scale, the ATE is expressed:</p>
<p><span class="math display">ATE_{\text{risk ratio}} = \frac{E[Y(1)|L]}{E[Y(0)|L]}</span></p>
<p>Other effect scales, such as the incidence rate ratio, incidence rate difference, or hazard ratio, might also be of interest. We can also define the Average Treatment Effect on the Treated (ATT) :</p>
<p><span class="math display">ATT_{\text{risk difference}} = E[Y(1) - Y(0)|A=1,L]</span></p>
<p><span class="math display">ATT_{\text{risk ratio}} = \frac{E[Y(1)|A=1,L]}{E[Y(0)|A=1, L]}</span></p>
<p>Another common estimand is the Population Average Treatment Effect (PATE), which denotes the effect the treatment would have on the entire population if applied universally to that population. This quantity can be expressed:</p>
<p><span class="math display">PATE_{\text{risk difference}} = f(E[Y(1) - Y(0)|L], W)</span></p>
<p><span class="math display">PATE_{\text{risk ratio}} = f\left(\frac{E[Y(1)|L]}{E[Y(0)|L]}, W\right)</span></p>
<p>where <span class="math inline">f</span> is a function that incorporates weights <span class="math inline">W</span> into the estimation of the expected outcomes. These weights are given from census estimates for the wider population. Note: I will show you how to use weights in future seminars.</p>
<p>We might also be interested in identifying effects specific to certain strata, such as risk differences or risk ratios, as they are modified by baseline indicators. Denote a stratum of interest by <span class="math inline">G</span>. We may then compute:</p>
<p><span class="math display">ATE_{G,\text{risk difference}} = E[Y(1) - Y(0)|G, L]</span></p>
<p><span class="math display">ATE_{G,\text{risk ratio}} = \frac{E[Y(1)|G, L]}{E[Y(0)|G, L]}</span></p>
<section id="consider-1" class="level4">
<h4 class="anchored" data-anchor-id="consider-1">Consider:</h4>
<ul>
<li><em>In this course, we are interested in stratum specific comparisons</em></li>
<li>In the causal inference literature, the concept we use to make sense of stratum specific comparisons is called “effect modification.”</li>
<li>By inferring effects within strata, we may evaluate whether the effects of different exposures or treatments on some well-defined outcome (measured in some well-defined time-period after the exposure) differ depending on group measurement.</li>
<li>The logic of effect modification differs slightly from that of interaction.</li>
</ul>
</section>
<section id="aside-extensions" class="level4">
<h4 class="anchored" data-anchor-id="aside-extensions">Aside: extensions</h4>
<p>For continuous exposures, we must stipulate the level of contrast for the exposure (e.g.&nbsp;weekly versus monthly church attendance):</p>
<p><span class="math display">ATE_{A,A'} = E[Y(A) - Y(A')| L]</span></p>
<p>This essentially denotes an average treatment effect comparing the outcome under treatment level <span class="math inline">A</span> to the outcome under treatment level <span class="math inline">A'</span>.</p>
<p>Likewise:</p>
<p><span class="math display">ATE_{A/A'} = \frac{E[Y(A)| L]}{E[Y(A')| L]}</span></p>
<p>This defines the contrast of <span class="math inline">A</span> and <span class="math inline">A'</span> on a ratio scale.</p>
</section>
<section id="f.-describe-the-populations-for-whom-the-intended-study-is-meant-to-generalise-by-distinguishing-between-source-and-target-populations." class="level4">
<h4 class="anchored" data-anchor-id="f.-describe-the-populations-for-whom-the-intended-study-is-meant-to-generalise-by-distinguishing-between-source-and-target-populations.">f.&nbsp;Describe the population(s) for whom the intended study is meant to generalise by distinguishing between source and target populations.</h4>
<p>Consider the following concepts:</p>
<ul>
<li><p><strong>Source population</strong>: a source population is where we gather our data for a study. We pull our specific sample from this group. It needs to mirror the broader group for our conclusions to be valid and widely applicable.</p></li>
<li><p><strong>Target population</strong>: the target population is the larger group we aim to apply our study’s results to. It could be defined by location, demographics, or specific conditions. The closer the source matches the target in ways that are relevant to our causal questions, the stronger our causal inferences about the target population will be.</p>
<ul>
<li><strong>Generalisability</strong> refers to the ability to apply the causal effects estimated from a sample to the population it was drawn from. In simpler terms, it deals with the extrapolation of causal knowledge from a sample to the broader population. This concept is also called “external validity”.</li>
</ul></li>
</ul>
<p><span class="math display">\text{Generalisability} = PATE \approx ATE_{\text{sample}}</span></p>
<ul>
<li><strong>Transportability</strong> refers to the ability to extrapolate causal effects learned from a source population to a target population when certain conditions are met. It deals with the transfer of causal knowledge across different settings or populations.</li>
</ul>
<p><span class="math display">\text{Transportability} = ATE_{\text{target}} \approx f(ATE_{\text{source}}, T)</span></p>
<p>where <span class="math inline">f</span> is a function and <span class="math inline">T</span> is a function that maps the results from our source population to another population. To achieve transportability, we need information about the source and target populations and an understanding of how the relationships between treatment, outcome, and covariates differ between the populations. Assessing transportability requires scientific knowledge.</p>
</section>
</section>
<section id="summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question" class="level3">
<h3 class="anchored" data-anchor-id="summary-step-1-consider-how-much-we-need-to-do-when-asking-a-causal-question">Summary Step 1: Consider how much we need to do when asking a causal question!</h3>
<p>We discover that asking a causal question is a multifaceted task. It demands careful definition of the outcome, including its timing, the exposure, and covariates. It also requires selecting the appropriate scale for causal contrast, controlling for confounding, and potentially adjusting for sample weights or stratification. Finally, when asking a causal question, we must consider for whom the results apply. Only after following these steps can we then ask: “How may we answer this causal question?”</p>
</section>
</section>
<section id="step-2-answer-a-causal-question" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="step-2-answer-a-causal-question">STEP 2: ANSWER A CAUSAL QUESTION</h2>
<section id="obtain-longitudinal-data" class="level4">
<h4 class="anchored" data-anchor-id="obtain-longitudinal-data">Obtain longitudinal data</h4>
<p>Note that causal inference from observational data turns on the appropriate temporal ordering of the key variables involved in the study.</p>
<p>Recall we have defined.</p>
<ul>
<li><p><strong>A</strong>: Our exposure or treatment variable, denoted as <strong>A</strong>. Here we consider the example of ‘Church attendance’.</p></li>
<li><p><strong>Y</strong>: The outcome variable we are interested in, represented by <strong>Y</strong>, is psychological distress. We operationalise this variable through the ‘Kessler-6’ distress scale.</p></li>
<li><p><strong>L</strong>: The confounding variables, collectively referred to as <strong>L</strong>, represent factors that can independently influence both <strong>A</strong> and <strong>Y</strong>. For example, socio-economic status could be a confounder that impacts both the likelihood of church attendance and the levels of psychological distress.</p></li>
</ul>
<p>Given the importance of temporal ordering, we must now define time:</p>
<ul>
<li><strong>t</strong> <span class="math inline">\in</span> T: Let <span class="math inline">t</span> denote within a multiwave panel study with <strong>T</strong> measurement intervals.</li>
</ul>
<p>Where <span class="math inline">t/\text{{exposure}}</span> denotes the measurement interval for the exposure. Longitudinal data collection provides us the ability to establish a causal model such that:</p>
<p><span class="math display">t_{confounders} &lt; t_{exposure}&lt; t_{outcome}</span></p>
<p>To minimise the posibility of time-varying confounding and obtain the clearest effect estimates, we should acquire the most recent values of <span class="math inline">\mathbf{L}</span> preceding <span class="math inline">A</span> and the latest values of <span class="math inline">A</span> before <span class="math inline">Y</span>.</p>
<p>Note in <a href="#fig-dag-outcomewide" class="quarto-xref">Figure&nbsp;7</a>, We use the prefixes “t0, t1, and t2” to denote temporal ordering. We include in the set of baseline confounders the pre-exposure measurement of <em>A</em> and <em>Y</em>. This allows for more substantial confounding control. For unmeasured confounder to affect both the exposure and the outcome, it would need to do so independently of the pre-exposure confounders. Additionally, including the baseline exposure gives us an effect estimate for the incidence exposure, rather than the prevelance of the exposure. This helps us to assess the expected change in the outcome were we to initate a change in the exposure.</p>
</section>
<section id="include-the-measured-exposure-with-baseline-covariates" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="include-the-measured-exposure-with-baseline-covariates">Include the measured exposure with baseline covariates</h3>
<p>Controlling for prior exposure enables the interpretation of the effect estimate as a change in the exposure in a manner akin to a randomised trial. We propose that the effect estimate with prior control for the exposure estimates the “incidence exposure” rather than the “prevalence exposure” <span class="citation" data-cites="danaei2012">(<a href="#ref-danaei2012" role="doc-biblioref">Danaei, Tavakkoli, and Hernán 2012</a>)</span>. It is crucial to estimate the incidence exposure because if the effects of an exposure are harmful in the short term such that these effects are not subsequently measured, a failure to adjust for prior exposure will yield the illusion that the exposure is beneficial. Furthermore, this approach aids in controlling for unmeasured confounding. For such a confounder to explain away the observed exposure-outcome association, it would need to do so independently of the prior level of the exposure and outcome.</p>
<div class="no-row-height column-margin column-container"><div id="ref-danaei2012" class="csl-entry" role="listitem">
Danaei, Goodarz, Mohammad Tavakkoli, and Miguel A. Hernán. 2012. <span>“Bias in observational studies of prevalent users: lessons for comparative effectiveness research from a meta-analysis of statins.”</span> <em>American Journal of Epidemiology</em> 175 (4): 250–62. <a href="https://doi.org/10.1093/aje/kwr301">https://doi.org/10.1093/aje/kwr301</a>.
</div></div></section>
<section id="state-the-eligibility-criteria-for-participation" class="level3">
<h3 class="anchored" data-anchor-id="state-the-eligibility-criteria-for-participation">State the eligibility criteria for participation</h3>
<p>This step is invaluable for assessing whether we are answering the causal question that we have asked.</p>
<section id="consider-2" class="level4">
<h4 class="anchored" data-anchor-id="consider-2">Consider:</h4>
<ul>
<li>Generalisability: we cannot evaluate inferences to a target group from the source population if we do not describe the source population</li>
<li>Eligibility criteria will help us to ensure whether we have correctly evaluated potential measurement bias/error in our instruments.</li>
</ul>
<p>For example, the New Zealand Attitudes and Values Study is a National Probability study of New Zealanders. The details provided in the supplementary materials describe how individuals were randomly selected from the country’s electoral roll. From these invitations there was typically less than 15% response rate. How might this process of recruitment affect generalisability and transportability of our results?</p>
<ul>
<li>Aside: discuss per protocol effects/ intention to treat effects</li>
</ul>
</section>
</section>
<section id="determine-how-missing-data-will-be-handled" class="level3">
<h3 class="anchored" data-anchor-id="determine-how-missing-data-will-be-handled">Determine how missing data will be handled</h3>
<ul>
<li>As we will consider in the upcoming weeks, loss to follow up and non-response opens sources for bias. We must develop a strategy for handling missing data.</li>
</ul>
</section>
<section id="state-a-statistical-model" class="level3">
<h3 class="anchored" data-anchor-id="state-a-statistical-model">State a statistical model</h3>
<p>The models we have considered in this course are G-computation, Inverse Probability of Treatement Weighting, and Doubly-Robust estimation.</p>
</section>
<section id="reporting" class="level3">
<h3 class="anchored" data-anchor-id="reporting">Reporting</h3>
<p>Consider the following ideas about how to report one’s model:</p>
<ul>
<li><strong>Estimator</strong>: Doubly robust where possible.</li>
<li><strong>Propensity Score Reporting:</strong> Detail the process of propensity score derivation, including the model used and any variable transformations.</li>
<li><strong>WeightIt Package:</strong> Explicitly mention the use of the ‘WeightIt’ package in R, including any specific options or parameters used in the propensity score estimation process.</li>
<li><strong>Method Variations:</strong> Report if different methods were used to obtain propensity scores, and the reasons behind the choice of methods such as ‘ebal’, ‘energy’, and ‘ps’.</li>
<li><strong>Continuous Exposures:</strong> Highlight that for continuous exposures, only the ‘energy’ option was used for propensity score estimation.</li>
<li><strong>Subgroup Estimation:</strong> Confirm that the propensity scores for subgroups were estimated separately, and discuss how the weights were subsequently combined with the original data.</li>
<li><strong>Covariate Balance:</strong> Include a Love plot to visually represent covariate balance on the exposure both before and after weighting.</li>
<li><strong>Weighting Algorithm Statistics:</strong> Report the statistics for the weighting algorithms as provided by the WeightIt package, including any measures of balance or fit.</li>
<li><strong>Outcome Regression Model:</strong> Clearly report the type of regression model used to estimate outcome model coefficients (e.g., linear regression, Poisson, binomial), and mention if the exposure was interacted with the baseline covariates. Do not report model coefficients as these have no interpretation.</li>
<li><strong>Subgroup Interaction:</strong> Address whether the subgroup was included separately as an interaction in the outcome model, and if the model successfully converged.</li>
<li><strong>Machine Learning Using <code>lmtp</code></strong> If using the <code>lmtp</code> package, do a stratified analysis. (see today’s lab)</li>
<li><strong>Model coefficients:</strong> note that the model coefficients should not be interpreted, as they are not meaningful in this context.</li>
<li><strong>Confidence intervals and standard errors:</strong> Describe the methods used to derive confidence intervals and standard errors, noting the use of the ‘clarify’ package in R for simulation based inference.</li>
</ul>
</section>
<section id="example-of-how-to-report-a-doubly-robust-method-in-your-report" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="example-of-how-to-report-a-doubly-robust-method-in-your-report">Example of how to report a doubly robust method in your report</h3>
<p>The Doubly Robust Estimation method for Subgroup Analysis Estimator is a sophisticated tool combining features of both IPTW and G-computation methods, providing unbiased estimates if either the propensity score or outcome model is correctly specified. The process involves five main steps:</p>
<p><strong>Step 1</strong> involves the estimation of the propensity score, a measure of the conditional probability of exposure given the covariates and the subgroup indicator. This score is calculated using statistical models such as logistic regression, with the model choice depending on the nature of the data and exposure. Weights for each individual are then calculated using this propensity score. These weights depend on the exposure status and are computed differently for exposed and unexposed individuals. The estimation of propensity scores is performed separately within each subgroup stratum.</p>
<p><strong>Step 2</strong> focuses on fitting a weighted outcome model, making use of the previously calculated weights from the propensity scores. This model estimates the outcome conditional on exposure, covariates, and subgroup, integrating the weights into the estimation process. Unlike in propensity score model estimation, covariates are included as variables in the outcome model. This inclusion makes the method doubly robust - providing a consistent effect estimate if either the propensity score or the outcome model is correctly specified, thereby reducing the assumption of correct model specification.</p>
<p><strong>Step 3</strong> entails the simulation of potential outcomes for each individual in each subgroup. These hypothetical scenarios assume universal exposure to the intervention within each subgroup, regardless of actual exposure levels. The expectation of potential outcomes is calculated for each individual in each subgroup, using individual-specific weights. These scenarios are performed for both the current and alternative interventions.</p>
<p><strong>Step 4</strong> is the estimation of the average causal effect for each subgroup, achieved by comparing the computed expected values of potential outcomes under each intervention level. The difference represents the average causal effect of changing the exposure within each subgroup.</p>
<p><strong>Step 5</strong> involves comparing differences in causal effects across groups by calculating the differences in the estimated causal effects between different subgroups. Confidence intervals and standard errors for these calculations are determined using simulation-based inference methods <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span>. This step allows for a comprehensive comparison of the impact of different interventions across various subgroups, while encorporating uncertainty.</p>
<div class="no-row-height column-margin column-container"></div></section>
<section id="inference" class="level3">
<h3 class="anchored" data-anchor-id="inference">Inference</h3>
<p>Consider the following ideas about what to discuss in one’s findings: Consider the following ideas about what to discuss in one’s findings. The order of exposition might be different.</p>
<ol type="1">
<li><p><strong>Summary of results</strong>: What did you find?</p></li>
<li><p><strong>Interpretation of E-values:</strong> Interpret the E-values used for sensitivity analysis. State what they represent in terms of the robustness of the findings to potential unmeasured confounding.</p></li>
<li><p><strong>Causal Effect Interpretation:</strong> What is the interest of the effect, if any, if an effect was observed? Interpret the average causal effect of changing the exposure level within each subgroup, and discuss its relevance to the research question.</p></li>
<li><p><strong>Comparison of Subgroups:</strong> Discuss how differences in causal effect estimates between different subgroups, if observed, or if not observed, contribute to the overall findings of the study.</p></li>
<li><p><strong>Uncertainty and Confidence Intervals:</strong> Consider the uncertainty around the estimated causal effects, and interpret the confidence intervals to understand the precision of the estimates.</p></li>
<li><p><strong>Generalisability and Transportability:</strong> Reflect on the generalizability of the study results to other contexts or populations. Discuss any factors that might influence the transportability of the causal effects found in the study. (Again see lecture 9.)</p></li>
<li><p><strong>Assumptions and Limitations:</strong> Reflect on the assumptions made during the study and identify any limitations in the methodology that could affect the interpretation of results. State that the implications of different intervention levels on potential outcomes are not analysed.</p></li>
<li><p><strong>Theoretical Relevance</strong>: How are these findings relevant to existing theories.</p></li>
<li><p><strong>Replication and Future Research:</strong> Consider how the study could be replicated or expanded upon in future research, and how the findings contribute to the existing body of knowledge in the field.</p></li>
<li><p><strong>Real-world Implications:</strong> Discuss the real-world implications of the findings, and how they could be applied in policy, practice, or further research.</p></li>
</ol>
</section>
</section>
<section id="appendix-a-details-of-estimation-approaches" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="appendix-a-details-of-estimation-approaches">Appendix A: Details of Estimation Approaches</h2>
<section id="g-computation-for-subgroup-analysis-estimator" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="g-computation-for-subgroup-analysis-estimator">G-computation for Subgroup Analysis Estimator</h3>
<p><strong>Step 1:</strong> Estimate the outcome model. Fit a model for the outcome <span class="math inline">Y</span>, conditional on the exposure <span class="math inline">A</span>, the covariates <span class="math inline">L</span>, and subgroup indicator <span class="math inline">G</span>. This model can be a linear regression, logistic regression, or another statistical model. The goal is to capture the relationship between the outcome, exposure, confounders, and subgroups.</p>
<p><span class="math display"> \hat{E}(Y|A,L,G) = f_Y(A,L,G; \theta_Y) </span></p>
<p>This equation represents the expected value of the outcome <span class="math inline">Y</span> given the exposure <span class="math inline">A</span>, covariates <span class="math inline">L</span>, and subgroup <span class="math inline">G</span>, as modelled by the function <span class="math inline">f_Y</span> with parameters <span class="math inline">\theta_Y</span>. This formulation allows for the prediction of the average outcome <span class="math inline">Y</span> given certain values of <span class="math inline">A</span>, <span class="math inline">L</span>, and <span class="math inline">G</span>.</p>
<p><strong>Step 2:</strong> Simulate potential outcomes. For each individual in each subgroup, predict their potential outcome under the intervention <span class="math inline">A=a</span> using the estimated outcome model:</p>
<p><span class="math display">\hat{E}(Y(a)|G=g) = \hat{E}[Y|A=a,L,G=g; \hat{\theta}_Y]</span></p>
<p>We also predict the potential outcome for everyone in each subgroup under the causal contrast, setting the intervention for everyone in that group to <span class="math inline">A=a'</span>:</p>
<p><span class="math display">\hat{E}(Y(a')|G=g) = \hat{E}[Y|A=a',L,G=g; \hat{\theta}_Y]</span></p>
<p>In these equations, <span class="math inline">Y</span> represents the potential outcome, <span class="math inline">A</span> is the intervention, <span class="math inline">L</span> are the covariates, <span class="math inline">G=g</span> represents the subgroup, and <span class="math inline">\theta_Y</span> are the parameters of the outcome model.</p>
<p><strong>Step 3:</strong> Calculate the estimated difference for each subgroup <span class="math inline">g</span>:</p>
<p><span class="math display">\hat{\delta}_g = \hat{E}[Y(a)|G=g] - \hat{E}[Y(a')|G=g]</span></p>
<p>This difference <span class="math inline">\hat{\delta}_g</span> represents the average causal effect of changing the exposure from level <span class="math inline">a'</span> to level <span class="math inline">a</span> within each subgroup <span class="math inline">g</span>.</p>
<p>We use simulation-based inference methods to compute standard errors and confidence intervals <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span>.</p>
<div class="no-row-height column-margin column-container"></div><p><strong>Step 4:</strong> Compare differences in causal effects by subgroups:</p>
<p><span class="math display">\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}</span></p>
<p>where,</p>
<p><span class="math display">\hat{\gamma} = \overbrace{\big( \hat{E}[Y(a)|G=g] - \hat{E}[Y(a^{\prime})|G=g] \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}[Y(a^{\prime})|G=g^{\prime}]- \hat{E}[Y(a)|G=g^{\prime}]\big)}^{\hat{\delta_{g^{\prime}}}}</span></p>
<p>This difference <span class="math inline">\hat{\gamma}</span> represents the difference in the average causal effects between the subgroups <span class="math inline">g</span> and <span class="math inline">g'</span>. It measures the difference in effect of the exposure <span class="math inline">A</span> within subgroup <span class="math inline">G</span> on the outcome <span class="math inline">Y</span>.</p>
<p><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="no-row-height column-margin column-container"><div id="fn1"><p><sup>1</sup>&nbsp;<span class="math inline">A</span> and <span class="math inline">G</span> on <span class="math inline">Y</span> might not be additive. We assume that the potential confounders <span class="math inline">L</span> are sufficient to control for confounding. See Appendix</p></div></div><p>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span>.</p>
</section>
<section id="inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-estimator" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="inverse-probability-of-treatment-weighting-iptw-for-subgroup-analysis-estimator">Inverse Probability of Treatment Weighting (IPTW) for Subgroup Analysis Estimator</h3>
<p><strong>Step 1:</strong> Estimate the propensity score. The propensity score <span class="math inline">e(L, G)</span> is the conditional probability of the exposure <span class="math inline">A = 1</span>, given the covariates <span class="math inline">L</span> and subgroup indicator <span class="math inline">G</span>. This can be modeled using logistic regression or other suitable methods, depending on the nature of the data and the exposure.</p>
<p><span class="math display">\hat{e} = P(A = 1 | L, G) = f_A(L, G; \theta_A)</span></p>
<p>Here, <span class="math inline">f_A(L, G; \theta_A)</span> is a function (statistical model) that estimates the probability of the exposure <span class="math inline">A = 1</span> given covariates <span class="math inline">L</span> and subgroup <span class="math inline">G</span>. Then, we calculate the weights for each individual, denoted as <span class="math inline">v</span>, using the estimated propensity score:</p>
<p><span class="math display">
v =
\begin{cases}
\frac{1}{\hat{e}} &amp; \text{if } A = 1 \\
\frac{1}{1-\hat{e}} &amp; \text{if } A = 0
\end{cases}
</span></p>
<p><strong>Step 2:</strong> Fit a weighted outcome model. Using the weights calculated from the estimated propensity scores, fit a model for the outcome <span class="math inline">Y</span>, conditional on the exposure <span class="math inline">A</span> and subgroup <span class="math inline">G</span>. This can be represented as:</p>
<p><span class="math display"> \hat{E}(Y|A, G; V) = f_Y(A, G ; \theta_Y, V) </span></p>
<p>In this model, <span class="math inline">f_Y</span> is a function (such as a weighted regression model) with parameters <span class="math inline">θ_Y</span>.</p>
<p><strong>Step 3:</strong> Simulate potential outcomes. For each individual in each subgroup, simulate their potential outcome under the hypothetical scenario where everyone in the subgroup is exposed to the intervention <span class="math inline">A=a</span> regardless of their actual exposure level:</p>
<p><span class="math display">\hat{E}(Y(a)|G=g) = \hat{E}[Y|A=a,G=g; \hat{\theta}_Y, v]</span></p>
<p>And also under the hypothetical scenario where everyone is exposed to intervention <span class="math inline">A=a'</span>:</p>
<p><span class="math display">\hat{E}(Y(a')|G=g) = \hat{E}[Y|A=a',G=g; \hat{\theta}_Y, v]</span></p>
<p><strong>Step 4:</strong> Estimate the average causal effect for each subgroup as the difference in the predicted outcomes:</p>
<p><span class="math display">\hat{\delta}_g = \hat{E}[Y(a)|G=g] - \hat{E}[Y(a')|G=g]</span></p>
<p>The estimated difference <span class="math inline">\hat{\delta}_g</span> represents the average causal effect within group <span class="math inline">g</span>.</p>
<p><strong>Step 5:</strong> Compare differences in causal effects by groups. Compute the differences in the estimated causal effects between different subgroups:</p>
<p><span class="math display">\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}</span></p>
<p>where,</p>
<p><span class="math display">\hat{\gamma} = \overbrace{\big( \hat{E}[Y(a)|G=g] - \hat{E}[Y(a')|G=g] \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}[Y(a')|G=g']- \hat{E}[Y(a)|G=g']\big)}^{\hat{\delta_{g'}}}</span></p>
<p>This <span class="math inline">\hat{\gamma}</span> represents the difference in the average causal effects between the subgroups <span class="math inline">g</span> and <span class="math inline">g'</span>.</p>
<p>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span>.</p>
<div class="no-row-height column-margin column-container"></div></section>
<section id="doubly-robust-estimation-for-subgroup-analysis-estimator" class="level3">
<h3 class="anchored" data-anchor-id="doubly-robust-estimation-for-subgroup-analysis-estimator">Doubly Robust Estimation for Subgroup Analysis Estimator</h3>
<p>It appears that the Doubly Robust Estimation explanation for subgroup analysis is already clear and correct, covering all the necessary steps in the process. Nevertheless, there’s a slight confusion in step 4. The difference <span class="math inline">\delta_g</span> is not defined within the document. I assume that you intended to write <span class="math inline">\hat{\delta}_g</span>. Here’s the corrected version:</p>
</section>
<section id="doubly-robust-estimation-for-subgroup-analysis-estimator-1" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="doubly-robust-estimation-for-subgroup-analysis-estimator-1">Doubly Robust Estimation for Subgroup Analysis Estimator</h3>
<p>Doubly Robust Estimation is a powerful technique that combines the strengths of both the IPTW and G-computation methods. It uses both the propensity score model and the outcome model, which makes it doubly robust: it produces unbiased estimates if either one of the models is correctly specified.</p>
<p><strong>Step 1</strong> Estimate the propensity score. The propensity score <span class="math inline">\hat{e}(L, G)</span> is the conditional probability of the exposure <span class="math inline">A = 1</span>, given the covariates <span class="math inline">L</span> and subgroup indicator <span class="math inline">G</span>. This can be modeled using logistic regression or other suitable methods, depending on the nature of the data and the exposure.</p>
<p><span class="math display">\hat{e} = P(A = 1 | L, G) = f_A(L, G; \theta_A)</span></p>
<p>Here, <span class="math inline">f_A(L, G; \theta_A)</span> is a function (statistical model) that estimates the probability of the exposure <span class="math inline">A = 1</span> given covariates <span class="math inline">L</span> and subgroup <span class="math inline">G</span>. Then, we calculate the weights for each individual, denoted as <span class="math inline">v</span>, using the estimated propensity score:</p>
<p><span class="math display">
v =
\begin{cases}
\frac{1}{\hat{e}} &amp; \text{if } A = 1 \\
\frac{1}{1-\hat{e}} &amp; \text{if } A = 0
\end{cases}
</span></p>
<p><strong>Step 2</strong> Fit a weighted outcome model. Using the weights calculated from the estimated propensity scores, fit a model for the outcome <span class="math inline">Y</span>, conditional on the exposure <span class="math inline">A</span>, covariates <span class="math inline">L</span>, and subgroup <span class="math inline">G</span>.</p>
<p><span class="math display"> \hat{E}(Y|A, L, G; V) = f_Y(A, L, G ; \theta_Y, V) </span></p>
<p><strong>Step 3</strong> For each individual in each subgroup, simulate their potential outcome under the hypothetical scenario where everyone in the subgroup is exposed to the intervention <span class="math inline">A=a</span> regardless of their actual exposure level:</p>
<p><span class="math display">\hat{E}(Y(a)|G=g) = \hat{E}[Y|A=a,G=g; L,\hat{\theta}_Y, v]</span></p>
<p>And also under the hypothetical scenario where everyone in each subgroup is exposed to intervention <span class="math inline">A=a'</span>:</p>
<p><span class="math display">\hat{E}(Y(a')|G=g) = \hat{E}[Y|A=a',G=g; L; \hat{\theta}_Y, v]</span></p>
<p><strong>Step 4</strong> Estimate the average causal effect for each subgroup. Compute the estimated expected value of the potential outcomes under each intervention level for each subgroup:</p>
<p><span class="math display">\hat{\delta}_g = \hat{E}[Y(a)|G=g] - \hat{E}[Y(a')|G=g]</span></p>
<p>The estimated difference <span class="math inline">\hat{\delta}_g</span> represents the average causal effect of changing the exposure from level <span class="math inline">a'</span> to level <span class="math inline">a</span> within each subgroup.</p>
<p><strong>Step 5</strong> Compare differences in causal effects by groups. Compute the differences in the estimated causal effects between different subgroups:</p>
<p><span class="math display">\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}</span></p>
<p>where,</p>
<p><span class="math display">\hat{\gamma} = \overbrace{\big( \hat{E}[Y(a)|G=g] - \hat{E}[Y(a')|G=g] \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}[Y(a')|G=g']- \hat{E}[Y(a)|G=g']\big)}^{\hat{\delta_{g'}}}</span></p>
<p>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span>.</p>
<div class="no-row-height column-margin column-container"></div></section>
</section>
<section id="appendix-b-g-computation-for-subgroup-analysis-estimator-with-non-additive-effects" class="level2">
<h2 class="anchored" data-anchor-id="appendix-b-g-computation-for-subgroup-analysis-estimator-with-non-additive-effects">Appendix B: G-computation for Subgroup Analysis Estimator with Non-Additive Effects</h2>
<p><strong>Step 1:</strong> Estimate the outcome model. Fit a model for the outcome <span class="math inline">Y</span>, conditional on the exposure <span class="math inline">A</span>, the covariates <span class="math inline">L</span>, subgroup indicator <span class="math inline">G</span>, and interactions between <span class="math inline">A</span> and <span class="math inline">G</span>. This model can be a linear regression, logistic regression, or another statistical model. The goal is to capture the relationship between the outcome, exposure, confounders, subgroups, and their interactions.</p>
<p><span class="math display"> \hat{E}(Y|A,L,G,AG) = f_Y(A,L,G,AG; \theta_Y) </span></p>
<p>This equation represents the expected value of the outcome <span class="math inline">Y</span> given the exposure <span class="math inline">A</span>, covariates <span class="math inline">L</span>, subgroup <span class="math inline">G</span>, and interaction term <span class="math inline">AG</span>, as modeled by the function <span class="math inline">f_Y</span> with parameters <span class="math inline">\theta_Y</span>.</p>
<p><strong>Step 2:</strong> Simulate potential outcomes. For each individual in each subgroup, predict their potential outcome under the intervention <span class="math inline">A=a</span> using the estimated outcome model:</p>
<p><span class="math display">\hat{E}(Y(a)|G=g) = \hat{E}[Y|A=a,L,G=g,AG=ag; \hat{\theta}_Y]</span></p>
<p>We also predict the potential outcome for everyone in each subgroup under the causal contrast, setting the intervention for everyone in that group to <span class="math inline">A=a'</span>:</p>
<p><span class="math display">\hat{E}(Y(a')|G=g) = \hat{E}[Y|A=a',L,G=g,AG=a'g; \hat{\theta}_Y]</span></p>
<p><strong>Step 3:</strong> Calculate the estimated difference for each subgroup <span class="math inline">g</span>:</p>
<p><span class="math display">\hat{\delta}_g = \hat{E}[Y(a)|G=g] - \hat{E}[Y(a')|G=g]</span></p>
<p><strong>Step 4:</strong> Compare differences in causal effects by subgroups:</p>
<p><span class="math display">\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}</span></p>
<p>where,</p>
<p><span class="math display">\hat{\gamma} = \overbrace{\big( \hat{E}[Y(a)|G=g] - \hat{E}[Y(a^{\prime})|G=g] \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}[Y(a^{\prime})|G=g^{\prime}]- \hat{E}[Y(a)|G=g^{\prime}]\big)}^{\hat{\delta_{g^{\prime}}}}</span></p>
<p>This difference <span class="math inline">\hat{\gamma}</span> represents the difference in the average causal effects between the subgroups <span class="math inline">g</span> and <span class="math inline">g'</span>, taking into account the interaction effect of the exposure <span class="math inline">A</span> and the subgroup <span class="math inline">G</span> on the outcome <span class="math inline">Y</span>.</p>
<p>Note that the interaction term <span class="math inline">AG</span> (or <span class="math inline">ag</span> and <span class="math inline">a'g</span> in the potential outcomes) stands for the interaction between the exposure level and the subgroup. This term is necessary to accommodate the non-additive effects in the model. As before, we must ensure that potential confounders <span class="math inline">L</span> are sufficient to control for confounding.</p>
</section>
<section id="appendix-c-doubly-robust-estimation-for-subgroup-analysis-estimator-with-interaction" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="appendix-c-doubly-robust-estimation-for-subgroup-analysis-estimator-with-interaction">Appendix C: Doubly Robust Estimation for Subgroup Analysis Estimator with Interaction</h2>
<p>Again, Doubly Robust Estimation combines the strengths of both the IPTW and G-computation methods. It uses both the propensity score model and the outcome model, which makes it doubly robust: it produces unbiased estimates if either one of the models is correctly specified.</p>
<p><strong>Step 1</strong> Estimate the propensity score. The propensity score <span class="math inline">e(L, G)</span> is the conditional probability of the exposure <span class="math inline">A = 1</span>, given the covariates <span class="math inline">L</span> and subgroup indicator <span class="math inline">G</span>. This can be modeled using logistic regression or other suitable methods, depending on the nature of the data and the exposure.</p>
<p><span class="math display">e = P(A = 1 | L, G) = f_A(L, G; \theta_A)</span></p>
<p>Here, <span class="math inline">f_A(L, G; \theta_A)</span> is a function (statistical model) that estimates the probability of the exposure <span class="math inline">A = 1</span> given covariates <span class="math inline">L</span> and subgroup <span class="math inline">G</span>. Then, we calculate the weights for each individual, denoted as <span class="math inline">v</span>, using the estimated propensity score:</p>
<p><span class="math display">
v =
\begin{cases}
\frac{1}{\hat{e}} &amp; \text{if } A = 1 \\
\frac{1}{1-\hat{e}} &amp; \text{if } A = 0
\end{cases}
</span></p>
<p><strong>Step 2</strong> Fit a weighted outcome model. Using the weights calculated from the estimated propensity scores, fit a model for the outcome <span class="math inline">Y</span>, conditional on the exposure <span class="math inline">A</span>, covariates <span class="math inline">L</span>, subgroup <span class="math inline">G</span> and the interaction between <span class="math inline">A</span> and <span class="math inline">G</span>.</p>
<p><span class="math display"> \hat{E}(Y|A, L, G, AG; V) = f_Y(A, L, G, AG ; \theta_Y, V) </span></p>
<p><strong>Step 3</strong> For each individual in each subgroup, simulate their potential outcome under the hypothetical scenario where everyone in the subgroup is exposed to the intervention <span class="math inline">A=a</span> regardless of their actual exposure level:</p>
<p><span class="math display">\hat{E}(Y(a)|G=g) = \hat{E}[Y|A=a,G=g, AG=ag; L,\hat{\theta}_Y, v]</span></p>
<p>And also under the hypothetical scenario where everyone in each subgroup is exposed to intervention <span class="math inline">A=a'</span>:</p>
<p><span class="math display">\hat{E}(Y(a')|G=g) = \hat{E}[Y|A=a',G=g, AG=a'g; L; \hat{\theta}_Y, v]</span></p>
<p><strong>Step 4</strong> Estimate the average causal effect for each subgroup. Compute the estimated expected value of the potential outcomes under each intervention level for each subgroup:</p>
<p><span class="math display">\hat{\delta}_g = \hat{E}[Y(a)|G=g] - \hat{E}[Y(a')|G=g]</span></p>
<p>The estimated difference <span class="math inline">\hat{\delta}_g</span> represents the average causal effect of changing the exposure from level <span class="math inline">a'</span> to level <span class="math inline">a</span> within each subgroup.</p>
<p><strong>Step 5</strong> Compare differences in causal effects by groups. Compute the differences in the estimated causal effects between different subgroups:</p>
<p><span class="math display">\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}</span></p>
<p>where,</p>
<p><span class="math display">\hat{\gamma} = \overbrace{\big( \hat{E}[Y(a)|G=g] - \hat{E}[Y(a')|G=g] \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}[Y(a')|G=g']- \hat{E}[Y(a)|G=g']\big)}^{\hat{\delta_{g'}}}</span></p>
<p>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span>.</p>
<div class="no-row-height column-margin column-container"></div></section>
<section id="appendix-d-marginal-structural-models-for-estimating-population-average-treatment-effect-with-interaction-doubly-robust" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="appendix-d-marginal-structural-models-for-estimating-population-average-treatment-effect-with-interaction-doubly-robust">Appendix D: Marginal Structural Models for Estimating Population Average Treatment Effect with Interaction (Doubly Robust)</h2>
<p>Sometimes we will only wish to estimate a marginal effect. In that case.</p>
<p><strong>Step 1</strong> Estimate the propensity score. The propensity score <span class="math inline">e(L)</span> is the conditional probability of the exposure <span class="math inline">A = 1</span>, given the covariates <span class="math inline">L</span> which contains the subgroup <span class="math inline">G</span>. This can be modelled using logistic regression or other functions as described in <span class="citation" data-cites="greifer2023">Greifer et al. (<a href="#ref-greifer2023" role="doc-biblioref">2023</a>)</span></p>
<div class="no-row-height column-margin column-container"></div><p><span class="math display">\hat{e} = P(A = 1 | L) = f_A(L; \theta_A)</span></p>
<p>Here, <span class="math inline">f_A(L; \theta_A)</span> is a function (a statistical model) that estimates the probability of the exposure <span class="math inline">A = 1</span> given covariates <span class="math inline">L</span>. Then, we calculate the weights for each individual, denoted as <span class="math inline">v</span>, using the estimated propensity score:</p>
<p><span class="math display">
v =
\begin{cases}
\frac{1}{e} &amp; \text{if } A = 1 \\
\frac{1}{1-e} &amp; \text{if } A = 0
\end{cases}
</span></p>
<p><strong>Step 2</strong> Fit a weighted outcome model. Using the weights calculated from the estimated propensity scores, fit a model for the outcome <span class="math inline">Y</span>, conditional on the exposure <span class="math inline">A</span> and covariates <span class="math inline">L</span>.</p>
<p><span class="math display"> \hat{E}(Y|A, L; V) = f_Y(A, L; \theta_Y, V) </span></p>
<p>This model should include terms for both the main effects of <span class="math inline">A</span> and <span class="math inline">L</span> and their interaction <span class="math inline">AL</span>.</p>
<p><strong>Step 3</strong> For the entire population, simulate the potential outcome under the hypothetical scenario where everyone is exposed to the intervention <span class="math inline">A=a</span> regardless of their actual exposure level:</p>
<p><span class="math display">\hat{E}(Y(a)) = \hat{E}[Y|A=a; L,\hat{\theta}_Y, v]</span></p>
<p>And also under the hypothetical scenario where everyone is exposed to intervention <span class="math inline">A=a'</span>:</p>
<p><span class="math display">\hat{E}(Y(a')) = \hat{E}[Y|A=a'; L; \hat{\theta}_Y, v]</span></p>
<p><strong>Step 4</strong> Estimate the average causal effect for the entire population. Compute the estimated expected value of the potential outcomes under each intervention level for the entire population:</p>
<p><span class="math display">\hat{\delta} = \hat{E}[Y(a)] - \hat{E}[Y(a')]</span></p>
<p>The estimated difference <span class="math inline">\hat{\delta}</span> represents the average causal effect of changing the exposure from level <span class="math inline">a'</span> to level <span class="math inline">a</span> in the entire population.</p>
<p>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="citation" data-cites="greifer2023">(<a href="#ref-greifer2023" role="doc-biblioref">Greifer et al. 2023</a>)</span>.</p>
<div class="no-row-height column-margin column-container"><div id="ref-greifer2023" class="csl-entry" role="listitem">
Greifer, Noah, Steven Worthington, Stefano Iacus, and Gary King. 2023. <em>Clarify: Simulation-Based Inference for Regression Models</em>. <a href="https://iqss.github.io/clarify/">https://iqss.github.io/clarify/</a>.
</div></div><section id="machine-learning" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="machine-learning">Machine Learning</h3>
<p>Example from https://osf.io/cnphs</p>
<div class="page-columns page-full"><blockquote class="blockquote">
<p>We perform statistical estimation using semi-parametric Targeted Learning, specifically a Targeted Minimum Loss-based Estimation (TMLE) estimator. TMLE is a robust method that combines machine learning techniques with traditional statistical models to estimate causal effects while providing valid statistical uncertainty measures for these estimates <span class="citation" data-cites="van2012targeted van2014targeted">(<a href="#ref-van2012targeted" role="doc-biblioref">Laan and Gruber 2012</a>; <a href="#ref-van2014targeted" role="doc-biblioref">Van der Laan 2014</a>)</span>.</p>
</blockquote><div class="no-row-height column-margin column-container"><div id="ref-van2012targeted" class="csl-entry" role="listitem">
Laan, Mark J van der, and Susan Gruber. 2012. <span>“Targeted Minimum Loss Based Estimation of Causal Effects of Multiple Time Point Interventions.”</span> <em>The International Journal of Biostatistics</em> 8 (1).
</div><div id="ref-van2014targeted" class="csl-entry" role="listitem">
Van der Laan, Mark J. 2014. <span>“Targeted Estimation of Nuisance Parameters to Obtain Valid Statistical Inference.”</span> <em>The International Journal of Biostatistics</em> 10 (1): 29–57.
</div></div></div>
<div class="page-columns page-full"><blockquote class="blockquote">
<p>TMLE operates through a two-step process that involves modelling both the outcome and treatment (exposure). Initially, TMLE employs machine learning algorithms to flexibly model the relationship between treatments, covariates, and outcomes. This flexibility allows TMLE to account for complex, high-dimensional covariate spaces without imposing restrictive model assumptions; <span class="citation" data-cites="vanderlaan2011 vanderlaan2018">(<a href="#ref-vanderlaan2011" role="doc-biblioref">Van Der Laan and Rose 2011</a>, <a href="#ref-vanderlaan2018" role="doc-biblioref">2018</a>)</span>. The outcome of this step is a set of initial estimates for these relationships.</p>
</blockquote><div class="no-row-height column-margin column-container"><div id="ref-vanderlaan2011" class="csl-entry" role="listitem">
Van Der Laan, Mark J., and Sherri Rose. 2011. <em>Targeted Learning: Causal Inference for Observational and Experimental Data</em>. Springer Series in Statistics. New York, NY: Springer. <a href="https://link.springer.com/10.1007/978-1-4419-9782-1">https://link.springer.com/10.1007/978-1-4419-9782-1</a>.
</div><div id="ref-vanderlaan2018" class="csl-entry" role="listitem">
———. 2018. <em>Targeted Learning in Data Science: Causal Inference for Complex Longitudinal Studies</em>. Springer Series in Statistics. Cham: Springer International Publishing. <a href="http://link.springer.com/10.1007/978-3-319-65304-4">http://link.springer.com/10.1007/978-3-319-65304-4</a>.
</div></div></div>
<div class="page-columns page-full"><blockquote class="blockquote">
<p>The second step of TMLE involves ``targeting’’ these initial estimates by incorporating information about the observed data distribution to improve the accuracy of the causal effect estimate. TMLE achieves this precision through an iterative updating process, which adjusts the initial estimates towards the true causal effect. This updating process is guided by the efficient influence function, ensuring that the final TMLE estimate is as close as possible, given the measures and data, to the targeted causal effect while still being robust to model-misspecification in either the outcome or the treatment model <span class="citation" data-cites="van2014discussion">(<a href="#ref-van2014discussion" role="doc-biblioref">Laan, Luedtke, and Dı́az 2014</a>)</span>.</p>
</blockquote><div class="no-row-height column-margin column-container"><div id="ref-van2014discussion" class="csl-entry" role="listitem">
Laan, Mark J van der, Alexander R Luedtke, and Iván Dı́az. 2014. <span>“Discussion of Identification, Estimation and Approximation of Risk Under Interventions That Depend on the Natural Value of Treatment Using Observational Data, by <span>J</span>essica <span>Y</span>oung, <span>M</span>iguel <span>H</span>ern<span>á</span>n, and <span>J</span>ames <span>R</span>obins.”</span> <em>Epidemiologic Methods</em> 3 (1): 21–31.
</div></div></div>
<div class="page-columns page-full"><blockquote class="blockquote">
<p>Again, a central feature of TMLE is its double-robustness property. If either the treatment model or the outcome model is correctly specified, the TMLE estimator will consistently estimate the causal effect. Additionally, we used cross-validation to avoid over-fitting, following the pre-stated protocols in Bulbulia <span class="citation" data-cites="bulbulia2024PRACTICAL">(<a href="#ref-bulbulia2024PRACTICAL" role="doc-biblioref">J. Bulbulia 2024</a>)</span>. The integration of TMLE and machine learning technologies reduces the dependence on restrictive modelling assumptions and introduces an additional layer of robustness. For further details of the specific targeted learning strategy we favour, see <span class="citation" data-cites="duxedaz2021 hoffman2022">Hoffman et al. (<a href="#ref-hoffman2023" role="doc-biblioref">2023</a>)</span>. We perform estimation using the package <span class="citation" data-cites="williams2021">(<a href="#ref-williams2021" role="doc-biblioref">Williams and Díaz 2021</a>)</span>. We used the library for semi-parametric estimation with the predefined libraries , , and <span class="citation" data-cites="xgboost2023 polley2023 Ranger2017">(<a href="#ref-xgboost2023" role="doc-biblioref">Chen et al. 2023</a>; <a href="#ref-polley2023" role="doc-biblioref">Polley et al. 2023</a>; <a href="#ref-Ranger2017" role="doc-biblioref">Wright and Ziegler 2017</a>)</span>. We created graphs, tables and output reports using the package <span class="citation" data-cites="margot2024">(<a href="#ref-margot2024" role="doc-biblioref">Joseph A. Bulbulia 2024</a>)</span>.</p>
</blockquote><div class="no-row-height column-margin column-container"><div id="ref-bulbulia2024PRACTICAL" class="csl-entry" role="listitem">
Bulbulia, Joseph. 2024. <span>“A Practical Guide to Causal Inference in Three-Wave Panel Studies.”</span> <em>PsyArXiv Preprints</em>, February. <a href="https://doi.org/10.31234/osf.io/uyg3d">https://doi.org/10.31234/osf.io/uyg3d</a>.
</div><div id="ref-hoffman2023" class="csl-entry" role="listitem">
Hoffman, Katherine L., Diego Salazar-Barreto, Kara E. Rudolph, and Iván Díaz. 2023. <span>“Introducing Longitudinal Modified Treatment Policies: A Unified Framework for Studying Complex Exposures,”</span> April. <a href="https://doi.org/10.48550/arXiv.2304.09460">https://doi.org/10.48550/arXiv.2304.09460</a>.
</div><div id="ref-williams2021" class="csl-entry" role="listitem">
Williams, Nicholas T., and Iván Díaz. 2021. <em><span class="nocase">l</span>mtp: Non-Parametric Causal Effects of Feasible Interventions Based on Modified Treatment Policies</em>. <a href="https://doi.org/10.5281/zenodo.3874931">https://doi.org/10.5281/zenodo.3874931</a>.
</div><div id="ref-xgboost2023" class="csl-entry" role="listitem">
Chen, Tianqi, Tong He, Michael Benesty, Vadim Khotilovich, Yuan Tang, Hyunsu Cho, Kailong Chen, et al. 2023. <em>Xgboost: Extreme Gradient Boosting</em>. <a href="https://CRAN.R-project.org/package=xgboost">https://CRAN.R-project.org/package=xgboost</a>.
</div><div id="ref-polley2023" class="csl-entry" role="listitem">
Polley, Eric, Erin LeDell, Chris Kennedy, and Mark van der Laan. 2023. <em>SuperLearner: Super Learner Prediction</em>. <a href="https://CRAN.R-project.org/package=SuperLearner">https://CRAN.R-project.org/package=SuperLearner</a>.
</div><div id="ref-Ranger2017" class="csl-entry" role="listitem">
Wright, Marvin N., and Andreas Ziegler. 2017. <span>“<span class="nocase">ranger</span>: A Fast Implementation of Random Forests for High Dimensional Data in <span>C++</span> and <span>R</span>.”</span> <em>Journal of Statistical Software</em> 77 (1): 1–17. <a href="https://doi.org/10.18637/jss.v077.i01">https://doi.org/10.18637/jss.v077.i01</a>.
</div><div id="ref-margot2024" class="csl-entry" role="listitem">
Bulbulia, Joseph A. 2024. <em>Margot: MARGinal Observational Treatment-Effects</em>. <a href="https://doi.org/10.5281/zenodo.10907724">https://doi.org/10.5281/zenodo.10907724</a>.
</div></div></div>
<section id="sensitivity-analysis-using-the-e-value" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="sensitivity-analysis-using-the-e-value">Sensitivity Analysis Using the E-value</h4>
<div class="page-columns page-full"><blockquote class="blockquote">
<p>To assess the sensitivity of results to unmeasured confounding, we report VanderWeele and Ding’s ``E-value’’ in all analyses <span class="citation" data-cites="vanderweele2017">(<a href="#ref-vanderweele2017" role="doc-biblioref">Tyler J. VanderWeele and Ding 2017</a>)</span>. The E-value quantifies the minimum strength of association (on the risk ratio scale) that an unmeasured confounder would need to have with both the exposure and the outcome (after considering the measured covariates) to explain away the observed exposure-outcome association <span class="citation" data-cites="linden2020EVALUE vanderweele2020">(<a href="#ref-linden2020EVALUE" role="doc-biblioref">Linden, Mathur, and VanderWeele 2020</a>; <a href="#ref-vanderweele2020" role="doc-biblioref">Tyler J. VanderWeele, Mathur, and Chen 2020</a>)</span>. To evaluate the strength of evidence, we use the bound of the E-value 95% confidence interval closest to 1.</p>
</blockquote><div class="no-row-height column-margin column-container"><div id="ref-vanderweele2017" class="csl-entry" role="listitem">
VanderWeele, Tyler J., and Peng Ding. 2017. <span>“Sensitivity Analysis in Observational Research: Introducing the e-Value.”</span> <em>Annals of Internal Medicine</em> 167 (4): 268–74. <a href="https://doi.org/10.7326/M16-2607">https://doi.org/10.7326/M16-2607</a>.
</div><div id="ref-linden2020EVALUE" class="csl-entry" role="listitem">
Linden, Ariel, Maya B Mathur, and Tyler J VanderWeele. 2020. <span>“Conducting Sensitivity Analysis for Unmeasured Confounding in Observational Studies Using e-Values: The Evalue Package.”</span> <em>The Stata Journal</em> 20 (1): 162–75.
</div><div id="ref-vanderweele2020" class="csl-entry" role="listitem">
VanderWeele, Tyler J, Maya B Mathur, and Ying Chen. 2020. <span>“Outcome-Wide Longitudinal Designs for Causal Inference: A New Template for Empirical Studies.”</span> <em>Statistical Science</em> 35 (3): 437–66.
</div></div></div>
</section>
</section>
<section id="packages" class="level3">
<h3 class="anchored" data-anchor-id="packages">Packages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>report<span class="sc">::</span><span class="fu">cite_packages</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  - Barrett M (2021). _ggokabeito: 'Okabe-Ito' Scales for 'ggplot2' and 'ggraph'_. R package version 0.1.0, &lt;https://CRAN.R-project.org/package=ggokabeito&gt;.
  - Bulbulia J (2024). _margot: MARGinal Observational Treatment-effects_. doi:10.5281/zenodo.10907724 &lt;https://doi.org/10.5281/zenodo.10907724&gt;, R package version 0.1.2. License: CC BY 4.0. Functions to obtain MARGinal Observational Treatment-effects from observational data., &lt;https://go-bayes.github.io/margot/&gt;.
  - Chang W (2023). _extrafont: Tools for Using Fonts_. R package version 0.19, &lt;https://CRAN.R-project.org/package=extrafont&gt;.
  - Firke S (2023). _janitor: Simple Tools for Examining and Cleaning Dirty Data_. R package version 2.2.0, &lt;https://CRAN.R-project.org/package=janitor&gt;.
  - Greifer N (2024). _WeightIt: Weighting for Covariate Balance in Observational Studies_. R package version 1.0.0, &lt;https://CRAN.R-project.org/package=WeightIt&gt;.
  - Grolemund G, Wickham H (2011). "Dates and Times Made Easy with lubridate." _Journal of Statistical Software_, *40*(3), 1-25. &lt;https://www.jstatsoft.org/v40/i03/&gt;.
  - Müller K, Wickham H (2023). _tibble: Simple Data Frames_. R package version 3.2.1, &lt;https://CRAN.R-project.org/package=tibble&gt;.
  - Pedersen T (2024). _patchwork: The Composer of Plots_. R package version 1.2.0, &lt;https://CRAN.R-project.org/package=patchwork&gt;.
  - R Core Team (2024). _R: A Language and Environment for Statistical Computing_. R Foundation for Statistical Computing, Vienna, Austria. &lt;https://www.R-project.org/&gt;.
  - VanderWeele TJ, Ding P (2011). "Sensitivity analysis in observational research: introducing the E-value." _Annals of Internal Medicine_, *167*(4), 268-274. Mathur MB, VanderWeele TJ (2019). "Sensitivity analysis for unmeasured confounding in meta-analyses." _Journal of the American Statistical Association&gt;_. Smith LH, VanderWeele TJ (2019). "Bounding bias due to selection." _Epidemiology_.
  - Wickham H (2016). _ggplot2: Elegant Graphics for Data Analysis_. Springer-Verlag New York. ISBN 978-3-319-24277-4, &lt;https://ggplot2.tidyverse.org&gt;.
  - Wickham H (2023). _forcats: Tools for Working with Categorical Variables (Factors)_. R package version 1.0.0, &lt;https://CRAN.R-project.org/package=forcats&gt;.
  - Wickham H (2023). _stringr: Simple, Consistent Wrappers for Common String Operations_. R package version 1.5.1, &lt;https://CRAN.R-project.org/package=stringr&gt;.
  - Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). "Welcome to the tidyverse." _Journal of Open Source Software_, *4*(43), 1686. doi:10.21105/joss.01686 &lt;https://doi.org/10.21105/joss.01686&gt;.
  - Wickham H, François R, Henry L, Müller K, Vaughan D (2023). _dplyr: A Grammar of Data Manipulation_. R package version 1.1.4, &lt;https://CRAN.R-project.org/package=dplyr&gt;.
  - Wickham H, Henry L (2023). _purrr: Functional Programming Tools_. R package version 1.0.2, &lt;https://CRAN.R-project.org/package=purrr&gt;.
  - Wickham H, Hester J, Bryan J (2024). _readr: Read Rectangular Text Data_. R package version 2.1.5, &lt;https://CRAN.R-project.org/package=readr&gt;.
  - Wickham H, Vaughan D, Girlich M (2024). _tidyr: Tidy Messy Data_. R package version 1.3.1, &lt;https://CRAN.R-project.org/package=tidyr&gt;.
  - Xie Y (2023). _knitr: A General-Purpose Package for Dynamic Report Generation in R_. R package version 1.45, &lt;https://yihui.org/knitr/&gt;. Xie Y (2015). _Dynamic Documents with R and knitr_, 2nd edition. Chapman and Hall/CRC, Boca Raton, Florida. ISBN 978-1498716963, &lt;https://yihui.org/knitr/&gt;. Xie Y (2014). "knitr: A Comprehensive Tool for Reproducible Research in R." In Stodden V, Leisch F, Peng RD (eds.), _Implementing Reproducible Computational Research_. Chapman and Hall/CRC. ISBN 978-1466561595.
  - Xie Y (2024). _tinytex: Helper Functions to Install and Maintain TeX Live, and Compile LaTeX Documents_. R package version 0.50, &lt;https://github.com/rstudio/tinytex&gt;. Xie Y (2019). "TinyTeX: A lightweight, cross-platform, and easy-to-maintain LaTeX distribution based on TeX Live." _TUGboat_, *40*(1), 30-32. &lt;https://tug.org/TUGboat/Contents/contents40-1.html&gt;.
  - Zhu H (2024). _kableExtra: Construct Complex Table with 'kable' and Pipe Syntax_. R package version 1.4.0, &lt;https://CRAN.R-project.org/package=kableExtra&gt;.</code></pre>
</div>
</div>


<!-- -->


</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb10" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Causal inference: a step by step guide"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "2024-MAY-6"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> /Users/joseph/GIT/templates/bib/references.bib</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">    warnings: FALSE</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">    error: FALSE</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co">    messages: FALSE</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: scroll</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">    highlight-style: oblivion</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools:</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co">      toggle: FALSE</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="an">html-math-method:</span><span class="co"> katex</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="an">reference-location:</span><span class="co"> margin</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="an">citation-location:</span><span class="co"> margin</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="an">cap-location:</span><span class="co"> margin</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="an">code-block-border-left:</span><span class="co"> true</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#read libraries</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tinytex"</span>)</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(extrafont)</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="fu">loadfonts</span>(<span class="at">device =</span> <span class="st">"all"</span>)</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"margot"</span>)</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">#source("/Users/joseph/GIT/templates/functions/libs2.R")</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co">#source("/Users/joseph/GIT/templates/functions/funs.R")</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/experimental_funs.R"</span>)</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>**Required**</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>nil</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>**Optional**</span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@Bulbulia2024PracticalGuide</span><span class="co">] [link]</span>(https://osf.io/preprints/psyarxiv/uyg3d)</span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@hoffman2023</span><span class="co">] [link]</span>(https://arxiv.org/pdf/2304.09460.pdf)</span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">@vanderweele2020</span><span class="co">] [link]</span>(https://www.dropbox.com/scl/fi/srpynr0dvjcndveplcydn/OutcomeWide_StatisticalScience.pdf?rlkey=h4fv32oyjegdfl3jq9u1fifc3&amp;dl=0)</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key concepts</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>Doing a causal analysis</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span>Download the R script</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span>Download the relevant libraries.</span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span>Will go through this script step-by-step.</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Download the script and store in our R directory: <span class="co">[</span><span class="ot">link to analysis script </span><span class="co">](https://raw.githubusercontent.com/go-bayes/psyc-434-2024/main/scripts/example_analysis.R)</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Make sure you can install all libraries required of the manuscript template.</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Come to the seminar prepared to work through the analysis</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="fu">## LAB</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We start with our lab this week. </span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Here is a link to the workbook:</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">link to template for option 2 assignment 3</span><span class="co">](https://raw.githubusercontent.com/go-bayes/psyc-434-2024/main/scripts/example_analysis.R)</span></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a><span class="fu">## What You Will Learn</span></span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Modified Treatment Policies**</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Setting up your analysis:** </span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Data wrangling (review):** </span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Demographic Tables (review):** </span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Exploratory Tables and Graphs (review)**</span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Computing inverse probability of censoring weights (IPCW) to handle attrition/missingness**</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Sensitivity Analysis: E-values**</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-109"><a href="#cb10-109" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Causal Analysis using machine learning ensembles (Targeted Maximum Likelihood)**</span>
<span id="cb10-110"><a href="#cb10-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-111"><a href="#cb10-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-112"><a href="#cb10-112" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1: New Content </span></span>
<span id="cb10-113"><a href="#cb10-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-114"><a href="#cb10-114" aria-hidden="true" tabindex="-1"></a><span class="fu">### Modified Treatment Policies and E-values</span></span>
<span id="cb10-115"><a href="#cb10-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-116"><a href="#cb10-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-117"><a href="#cb10-117" aria-hidden="true" tabindex="-1"></a>A modified treatment policy is a *flexible* intervention of the following form: </span>
<span id="cb10-118"><a href="#cb10-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-119"><a href="#cb10-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-120"><a href="#cb10-120" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-121"><a href="#cb10-121" aria-hidden="true" tabindex="-1"></a>\mathbf{d}^\lambda (a_1) = \begin{cases} 4 &amp; \text{if } a_1 &lt; 4 <span class="sc">\\</span> </span>
<span id="cb10-122"><a href="#cb10-122" aria-hidden="true" tabindex="-1"></a>a_1 &amp; \text{otherwise} \end{cases}</span>
<span id="cb10-123"><a href="#cb10-123" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-124"><a href="#cb10-124" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-125"><a href="#cb10-125" aria-hidden="true" tabindex="-1"></a>\mathbf{d}^\phi (a_1) = \begin{cases} 0 &amp; \text{if } a_1 &gt; 0 <span class="sc">\\</span> </span>
<span id="cb10-126"><a href="#cb10-126" aria-hidden="true" tabindex="-1"></a>a_1 &amp; \text{otherwise} \end{cases}</span>
<span id="cb10-127"><a href="#cb10-127" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-128"><a href="#cb10-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-129"><a href="#cb10-129" aria-hidden="true" tabindex="-1"></a>$$ g' = \text{Intervention 1 - Intervention 2} = E<span class="co">[</span><span class="ot">Y(\mathbf{d}^\lambda) - Y(\mathbf{d}^\phi)</span><span class="co">]</span> $$</span>
<span id="cb10-130"><a href="#cb10-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-131"><a href="#cb10-131" aria-hidden="true" tabindex="-1"></a>$$ g'' = \text{Intervention 1 - Intervention 2} = E<span class="co">[</span><span class="ot">Y(\mathbf{d}^\lambda) - Y(\mathbf{d}^\phi)</span><span class="co">]</span> $$</span>
<span id="cb10-132"><a href="#cb10-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-133"><a href="#cb10-133" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-134"><a href="#cb10-134" aria-hidden="true" tabindex="-1"></a>{\delta}(g) ={g'} - {g''}</span>
<span id="cb10-135"><a href="#cb10-135" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-136"><a href="#cb10-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-137"><a href="#cb10-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-138"><a href="#cb10-138" aria-hidden="true" tabindex="-1"></a>Rather than shifting an entire population into one of two states, the estimand flexibly shifts a population according to a pre-specified function. </span>
<span id="cb10-139"><a href="#cb10-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-140"><a href="#cb10-140" aria-hidden="true" tabindex="-1"></a>see: @hoffman2023</span>
<span id="cb10-141"><a href="#cb10-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-142"><a href="#cb10-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-143"><a href="#cb10-143" aria-hidden="true" tabindex="-1"></a><span class="fu">### Sensitivity Analysis using E-values</span></span>
<span id="cb10-144"><a href="#cb10-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-145"><a href="#cb10-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-146"><a href="#cb10-146" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The minimum strength of association on the risk ratio scale that an unmeasured confounder would need to have with both the exposure and the outcome, conditional on the measured covariates, to fully explain away a specific exposure-outcome association</span></span>
<span id="cb10-147"><a href="#cb10-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-148"><a href="#cb10-148" aria-hidden="true" tabindex="-1"></a>See: @mathur2018; @linden2020EVALUE; @vanderweele2017.</span>
<span id="cb10-149"><a href="#cb10-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-150"><a href="#cb10-150" aria-hidden="true" tabindex="-1"></a>For example, suppose that the lower bound of the the E-value was 1.3 with the lower bound of the confidence interval = 1.12, we might then write:</span>
<span id="cb10-151"><a href="#cb10-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-152"><a href="#cb10-152" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; With an observed risk ratio of RR=1.3, an unmeasured confounder that was associated with both the outcome and the exposure by a risk ratio of 1.3-fold each (or 30%), above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of 1.12-fold (or 12%) each could do so, but weaker joint confounder associations could not.</span></span>
<span id="cb10-153"><a href="#cb10-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-154"><a href="#cb10-154" aria-hidden="true" tabindex="-1"></a>The equations are as follows (for risk ratios)</span>
<span id="cb10-155"><a href="#cb10-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-156"><a href="#cb10-156" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>E-value_{RR} = RR + \sqrt{RR \times (RR - 1)}</span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>$$ $$</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>E-value_{LCL} = LCL + \sqrt{LCL \times (LCL - 1)}</span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>Here is an R function that will calculate E-values</span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a><span class="co"># evalue for risk ratio</span></span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>calculate_e_value <span class="ot">&lt;-</span> <span class="cf">function</span>(rr, lcl) {</span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>  e_value_rr <span class="ot">=</span> rr <span class="sc">+</span> <span class="fu">sqrt</span>(rr<span class="sc">*</span>(rr <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>  e_value_lcl <span class="ot">=</span> lcl <span class="sc">+</span> <span class="fu">sqrt</span>(lcl<span class="sc">*</span>(lcl <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">e_value_rr =</span> e_value_rr, <span class="at">e_value_lcl =</span> e_value_lcl)</span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a><span class="co"># e.g. smoking causes cancer</span></span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a><span class="co"># finding   RR = 10.73 (95% CI: 8.02, 14.36)</span></span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a>evalue_computed <span class="ot">&lt;-</span> <span class="fu">calculate_e_value</span>(<span class="fl">10.73</span>, <span class="fl">8.02</span>)</span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a><span class="co">#print</span></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a>evalue_computed</span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a>We write:</span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; With an observed risk ratio of RR=10.7, an unmeasured confounder that was associated </span><span class="in">`r evalue_computed$e_value_rr`</span><span class="at">-fold each, above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of </span><span class="in">`e_value_rr$e_value_lcl`</span><span class="at">-fold each could do so, but weaker joint confounder associations could not.</span></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>Note that in this class, most of the outcomes will be (standardised) continuous outcomes. Here's a function and LaTeX code to describe the approximation.</span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a>This function takes a linear regression coefficient estimate (<span class="in">`est`</span>), its standard error (<span class="in">`se`</span>), the standard deviation of the outcome (<span class="in">`sd`</span>), a contrast of interest in the exposure (<span class="in">`delta`</span>, which defaults to 1), and a "true" standardized mean difference (true, which defaults to 0). It calculates the odds ratio using the formula from Chinn (2000) and VanderWeele (2017), and then uses this to calculate the E-value.</span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: evalue_ols</span></span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a><span class="co">#evalue for ols</span></span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a>compute_evalue_ols <span class="ot">&lt;-</span> <span class="cf">function</span>(est, se, <span class="at">delta =</span> <span class="dv">1</span>, <span class="at">true =</span> <span class="dv">0</span>) {</span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rescale estimate and SE to get a contrast of size delta</span></span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>  est <span class="ot">&lt;-</span> est <span class="sc">/</span> delta</span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>  se <span class="ot">&lt;-</span> se <span class="sc">/</span> delta</span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute transformed odds ratio and ci's</span></span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a>  odds_ratio <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">0.91</span> <span class="sc">*</span> est)</span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>  lo <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">0.91</span> <span class="sc">*</span> est <span class="sc">-</span> <span class="fl">1.78</span> <span class="sc">*</span> se)</span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>  hi <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">0.91</span> <span class="sc">*</span> est <span class="sc">+</span> <span class="fl">1.78</span> <span class="sc">*</span> se)</span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute E-Values based on the RR values</span></span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>  evalue_point_estimate <span class="ot">&lt;-</span> odds_ratio <span class="sc">*</span> <span class="fu">sqrt</span>(odds_ratio <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>  evalue_lower_ci <span class="ot">&lt;-</span> lo <span class="sc">*</span> <span class="fu">sqrt</span>(lo <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the e-values</span></span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">EValue_PointEstimate =</span> evalue_point_estimate,</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>              <span class="at">EValue_LowerCI =</span> evalue_lower_ci))</span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a><span class="co"># example:</span></span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a><span class="co"># suppose we have an estimate of 0.5, a standard error of 0.1, and a standard deviation of 1.</span></span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a><span class="co"># this would correspond to a half a standard deviation increase in the outcome per unit increase in the exposure.</span></span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">compute_evalue_ols</span>(<span class="at">est =</span> <span class="fl">0.5</span>, <span class="at">se =</span> <span class="fl">0.1</span>, <span class="at">delta =</span> <span class="dv">1</span>)</span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>point_round <span class="ot">&lt;-</span> <span class="fu">round</span>(results<span class="sc">$</span>EValue_PointEstimate, <span class="dv">3</span>)</span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>ci_round <span class="ot">&lt;-</span> <span class="fu">round</span>(results<span class="sc">$</span>EValue_LowerCI, <span class="dv">3</span>)</span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(point_round)</span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ci_round)</span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>We write:</span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; With an observed risk ratio of </span><span class="in">`r point_round`</span><span class="at">, an unmeasured confounder that was associated with both the outcome and the exposure by a risk ratio of </span><span class="in">`r point_round`</span><span class="at">-fold each, above and beyond the measured confounders, could explain away the estimate, but weaker joint confounder associations could not; to move the confidence interval to include the null, an unmeasured confounder that was associated with the outcome and the exposure by a risk ratio of </span><span class="in">`r ci_round`</span><span class="at">-fold each could do so, but weaker joint confounder associations could not.</span></span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>Note the E-values package will do the computational work for us and this is what we use in the <span class="in">`margot`</span> package to obtain E-values for sensitivity analysis.</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2 Guide For Preparing Your Study</span></span>
<span id="cb10-242"><a href="#cb10-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-243"><a href="#cb10-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-244"><a href="#cb10-244" aria-hidden="true" tabindex="-1"></a>Recall that psychology begins with two questions. </span>
<span id="cb10-245"><a href="#cb10-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-246"><a href="#cb10-246" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; What do I want to know about thought and behaviour? </span></span>
<span id="cb10-247"><a href="#cb10-247" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; What is the target population? </span></span>
<span id="cb10-248"><a href="#cb10-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-249"><a href="#cb10-249" aria-hidden="true" tabindex="-1"></a>In cross-cultural psychology, these questions relate to differences, and similarities, between groups.</span>
<span id="cb10-250"><a href="#cb10-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-251"><a href="#cb10-251" aria-hidden="true" tabindex="-1"></a>Suppose we have asked a question. How can we address it using observational data?</span>
<span id="cb10-252"><a href="#cb10-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-253"><a href="#cb10-253" aria-hidden="true" tabindex="-1"></a>Too fast.</span>
<span id="cb10-254"><a href="#cb10-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-255"><a href="#cb10-255" aria-hidden="true" tabindex="-1"></a>Our question must be made precise. </span>
<span id="cb10-256"><a href="#cb10-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-257"><a href="#cb10-257" aria-hidden="true" tabindex="-1"></a>Today we will consider how to make psychological questions precise, and how to answer them, using 3-wave panel designs <span class="co">[</span><span class="ot">@vanderweele2020</span><span class="co">]</span>.</span>
<span id="cb10-258"><a href="#cb10-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-259"><a href="#cb10-259" aria-hidden="true" tabindex="-1"></a>The order is as follows:</span>
<span id="cb10-260"><a href="#cb10-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-261"><a href="#cb10-261" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Motivate Three Wave Longitudinal Designs Using Causal Graphs**</span>
<span id="cb10-262"><a href="#cb10-262" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Checklist For Causal Estimation in Three Wave Longitudinal Designs**</span>
<span id="cb10-263"><a href="#cb10-263" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Explanation of the the Checklist**</span>
<span id="cb10-264"><a href="#cb10-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-265"><a href="#cb10-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-266"><a href="#cb10-266" aria-hidden="true" tabindex="-1"></a><span class="fu">## Motivations for a Three-Wave Longitudinal Design for Observational Causal Inference. </span></span>
<span id="cb10-267"><a href="#cb10-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-268"><a href="#cb10-268" aria-hidden="true" tabindex="-1"></a>REVIEW: </span>
<span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a>Causal Diagrammes (DAGS) are a remarkably powerful and simple tool for understanding confounding <span class="co">[</span><span class="ot">See here</span><span class="co">](https://osf.io/b23k7)</span> </span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a><span class="fu">### Common cause of exposure and outcome.</span></span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a>Our question: does visiting a clinical psychologist reduce the 10 year incidence of heart attacks?</span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-275"><a href="#cb10-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb10-279"><a href="#cb10-279" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-1</span></span>
<span id="cb10-280"><a href="#cb10-280" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Common cause of exposure and outcome: example"</span></span>
<span id="cb10-281"><a href="#cb10-281" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb10-282"><a href="#cb10-282" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb10-283"><a href="#cb10-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-284"><a href="#cb10-284" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb10-285"><a href="#cb10-285" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb10-286"><a href="#cb10-286" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb10-287"><a href="#cb10-287" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb10-288"><a href="#cb10-288" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb10-289"><a href="#cb10-289" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb10-290"><a href="#cb10-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-291"><a href="#cb10-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-292"><a href="#cb10-292" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb10-293"><a href="#cb10-293" aria-hidden="true" tabindex="-1"></a><span class="in">\node [ellipse, draw=white] (L) at (0, 0) {t0/Male};</span></span>
<span id="cb10-294"><a href="#cb10-294" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (4, 0) {t1/DoctorVisit};</span></span>
<span id="cb10-295"><a href="#cb10-295" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};</span></span>
<span id="cb10-296"><a href="#cb10-296" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red, dashed] (A) to (Y);</span></span>
<span id="cb10-297"><a href="#cb10-297" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left, draw =black] (L) to (Y);</span></span>
<span id="cb10-298"><a href="#cb10-298" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, black] (L) to (A);</span></span>
<span id="cb10-299"><a href="#cb10-299" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb10-300"><a href="#cb10-300" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-301"><a href="#cb10-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-302"><a href="#cb10-302" aria-hidden="true" tabindex="-1"></a><span class="fu">### Solution: Adjust for Confounder</span></span>
<span id="cb10-303"><a href="#cb10-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-306"><a href="#cb10-306" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb10-307"><a href="#cb10-307" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-2</span></span>
<span id="cb10-308"><a href="#cb10-308" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Solution to this problem."</span></span>
<span id="cb10-309"><a href="#cb10-309" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb10-310"><a href="#cb10-310" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb10-311"><a href="#cb10-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-312"><a href="#cb10-312" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb10-313"><a href="#cb10-313" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb10-314"><a href="#cb10-314" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb10-315"><a href="#cb10-315" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb10-316"><a href="#cb10-316" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb10-317"><a href="#cb10-317" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb10-318"><a href="#cb10-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-319"><a href="#cb10-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-320"><a href="#cb10-320" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb10-321"><a href="#cb10-321" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=black] (L) at (0, 0) {t0/Male};</span></span>
<span id="cb10-322"><a href="#cb10-322" aria-hidden="true" tabindex="-1"></a><span class="in">\node [ellipse, draw=white] (A) at (4, 0) {t1/DoctorVisit};</span></span>
<span id="cb10-323"><a href="#cb10-323" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};</span></span>
<span id="cb10-324"><a href="#cb10-324" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=white] (A) to (Y);</span></span>
<span id="cb10-325"><a href="#cb10-325" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left, draw =black] (L) to (Y);</span></span>
<span id="cb10-326"><a href="#cb10-326" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, black] (L) to (A);</span></span>
<span id="cb10-327"><a href="#cb10-327" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb10-328"><a href="#cb10-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-329"><a href="#cb10-329" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-330"><a href="#cb10-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-331"><a href="#cb10-331" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bias: exposure at baseline is a common cause of the exposure at t1 and outcome at t2</span></span>
<span id="cb10-332"><a href="#cb10-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-335"><a href="#cb10-335" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb10-336"><a href="#cb10-336" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-3</span></span>
<span id="cb10-337"><a href="#cb10-337" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Causal graph reveals bias from pre-exosure indicator"</span></span>
<span id="cb10-338"><a href="#cb10-338" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb10-339"><a href="#cb10-339" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb10-340"><a href="#cb10-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-341"><a href="#cb10-341" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb10-342"><a href="#cb10-342" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb10-343"><a href="#cb10-343" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb10-344"><a href="#cb10-344" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb10-345"><a href="#cb10-345" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb10-346"><a href="#cb10-346" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb10-347"><a href="#cb10-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-348"><a href="#cb10-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-349"><a href="#cb10-349" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb10-350"><a href="#cb10-350" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (L) at (0, 0) {t0/Doctor Visit};</span></span>
<span id="cb10-351"><a href="#cb10-351" aria-hidden="true" tabindex="-1"></a><span class="in">\node [ellipse, draw=white] (A) at (4, 0) {t1/Doctor Visit};</span></span>
<span id="cb10-352"><a href="#cb10-352" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};</span></span>
<span id="cb10-353"><a href="#cb10-353" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red, dashed] (A) to (Y);</span></span>
<span id="cb10-354"><a href="#cb10-354" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left, draw =black] (L) to (Y);</span></span>
<span id="cb10-355"><a href="#cb10-355" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, black] (L) to (A);</span></span>
<span id="cb10-356"><a href="#cb10-356" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb10-357"><a href="#cb10-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-358"><a href="#cb10-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-359"><a href="#cb10-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-360"><a href="#cb10-360" aria-hidden="true" tabindex="-1"></a><span class="fu">### Solution: adjust for confounder at baseline</span></span>
<span id="cb10-361"><a href="#cb10-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-364"><a href="#cb10-364" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb10-365"><a href="#cb10-365" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-4</span></span>
<span id="cb10-366"><a href="#cb10-366" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Solution to this problem"</span></span>
<span id="cb10-367"><a href="#cb10-367" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb10-368"><a href="#cb10-368" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb10-369"><a href="#cb10-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-370"><a href="#cb10-370" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb10-371"><a href="#cb10-371" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb10-372"><a href="#cb10-372" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb10-373"><a href="#cb10-373" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb10-374"><a href="#cb10-374" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb10-375"><a href="#cb10-375" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb10-376"><a href="#cb10-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-377"><a href="#cb10-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-378"><a href="#cb10-378" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb10-379"><a href="#cb10-379" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white, align=left] (L) at (0, 0) {t0/Heart Attack};</span></span>
<span id="cb10-380"><a href="#cb10-380" aria-hidden="true" tabindex="-1"></a><span class="in">\node [ellipse, draw=white] (A) at (4, 0) {t1/Doctor Visit};</span></span>
<span id="cb10-381"><a href="#cb10-381" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};</span></span>
<span id="cb10-382"><a href="#cb10-382" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red, dashed] (A) to (Y);</span></span>
<span id="cb10-383"><a href="#cb10-383" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left, draw =black] (L) to (Y);</span></span>
<span id="cb10-384"><a href="#cb10-384" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, black] (L) to (A);</span></span>
<span id="cb10-385"><a href="#cb10-385" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb10-386"><a href="#cb10-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-387"><a href="#cb10-387" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-388"><a href="#cb10-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-389"><a href="#cb10-389" aria-hidden="true" tabindex="-1"></a><span class="fu">### A more thorough confounding control</span></span>
<span id="cb10-390"><a href="#cb10-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-393"><a href="#cb10-393" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb10-394"><a href="#cb10-394" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-5</span></span>
<span id="cb10-395"><a href="#cb10-395" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Causal graph:more general panel design"</span></span>
<span id="cb10-396"><a href="#cb10-396" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb10-397"><a href="#cb10-397" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb10-398"><a href="#cb10-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-399"><a href="#cb10-399" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb10-400"><a href="#cb10-400" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb10-401"><a href="#cb10-401" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb10-402"><a href="#cb10-402" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb10-403"><a href="#cb10-403" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb10-404"><a href="#cb10-404" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb10-405"><a href="#cb10-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-406"><a href="#cb10-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-407"><a href="#cb10-407" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb10-408"><a href="#cb10-408" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white, align=left] (L) at (0, 0) {t0/Male \\t0/Doctor Visit \\t0/Heart Attack};</span></span>
<span id="cb10-409"><a href="#cb10-409" aria-hidden="true" tabindex="-1"></a><span class="in">\node [ellipse, draw=white] (A) at (4, 0) {t1/Doctor Visit};</span></span>
<span id="cb10-410"><a href="#cb10-410" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (Y) at (8, 0) {t2/Heart Attack};</span></span>
<span id="cb10-411"><a href="#cb10-411" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red, dashed] (A) to (Y);</span></span>
<span id="cb10-412"><a href="#cb10-412" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left, draw =black] (L) to (Y);</span></span>
<span id="cb10-413"><a href="#cb10-413" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, black] (L) to (A);</span></span>
<span id="cb10-414"><a href="#cb10-414" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb10-415"><a href="#cb10-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-416"><a href="#cb10-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-417"><a href="#cb10-417" aria-hidden="true" tabindex="-1"></a><span class="fu">### Generic 3-wave panel design (VanderWeeele 2020)</span></span>
<span id="cb10-418"><a href="#cb10-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-421"><a href="#cb10-421" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb10-422"><a href="#cb10-422" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-6</span></span>
<span id="cb10-423"><a href="#cb10-423" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Causal graph: three-wave panel design"</span></span>
<span id="cb10-424"><a href="#cb10-424" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb10-425"><a href="#cb10-425" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb10-426"><a href="#cb10-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-427"><a href="#cb10-427" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb10-428"><a href="#cb10-428" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb10-429"><a href="#cb10-429" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb10-430"><a href="#cb10-430" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb10-431"><a href="#cb10-431" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb10-432"><a href="#cb10-432" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb10-433"><a href="#cb10-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-434"><a href="#cb10-434" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb10-435"><a href="#cb10-435" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (U) at (0, 0) {U};</span></span>
<span id="cb10-436"><a href="#cb10-436" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y};</span></span>
<span id="cb10-437"><a href="#cb10-437" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (4, 0) {t1/A};</span></span>
<span id="cb10-438"><a href="#cb10-438" aria-hidden="true" tabindex="-1"></a><span class="in">\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};</span></span>
<span id="cb10-439"><a href="#cb10-439" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (U) to (L);</span></span>
<span id="cb10-440"><a href="#cb10-440" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (L) to (A);</span></span>
<span id="cb10-441"><a href="#cb10-441" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red, dotted] (A) to (Y);</span></span>
<span id="cb10-442"><a href="#cb10-442" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left=50, draw =black] (L) to (Y);</span></span>
<span id="cb10-443"><a href="#cb10-443" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend right=50, draw =black, dotted] (U) to (Y);</span></span>
<span id="cb10-444"><a href="#cb10-444" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left=50, draw =black, dotted] (U) to (A);</span></span>
<span id="cb10-445"><a href="#cb10-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-446"><a href="#cb10-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-447"><a href="#cb10-447" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb10-448"><a href="#cb10-448" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-449"><a href="#cb10-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-450"><a href="#cb10-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-451"><a href="#cb10-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-452"><a href="#cb10-452" aria-hidden="true" tabindex="-1"></a><span class="fu">## Sensitivity analysis</span></span>
<span id="cb10-453"><a href="#cb10-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-454"><a href="#cb10-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-455"><a href="#cb10-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-456"><a href="#cb10-456" aria-hidden="true" tabindex="-1"></a><span class="fu">## Comprehensive Checklist for Detailed Reporting of a Causal Inferenctial Study.</span></span>
<span id="cb10-457"><a href="#cb10-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-458"><a href="#cb10-458" aria-hidden="true" tabindex="-1"></a><span class="fu">## STEP 1 Formulate the Research Question</span></span>
<span id="cb10-459"><a href="#cb10-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-460"><a href="#cb10-460" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**State your question:** is my question clearly stated? If not, state it.</span>
<span id="cb10-461"><a href="#cb10-461" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Relevance:** have I explained its importance? If not, explain.</span>
<span id="cb10-462"><a href="#cb10-462" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Ethics** how might this question affect people? How might not investigating this question affect people? </span>
<span id="cb10-463"><a href="#cb10-463" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Causality:** Is my question causal? If not, refine your question.</span>
<span id="cb10-464"><a href="#cb10-464" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Subgroup analysis:** does my question involve a subgroup (e.g., cultural group)? If not, develop a subgroup analysis question.</span>
<span id="cb10-465"><a href="#cb10-465" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Explain the Framework:** can I explain the causal inference framework and convey the gist to non-specialists? If not, review course materials.</span>
<span id="cb10-466"><a href="#cb10-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-467"><a href="#cb10-467" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Determine Data Requirements</span></span>
<span id="cb10-468"><a href="#cb10-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-469"><a href="#cb10-469" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Data types:** are my data experimental? If yes, your project may not fit this course.</span>
<span id="cb10-470"><a href="#cb10-470" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Time-series data:** are my data time-series? If not, reconsider your causal question.</span>
<span id="cb10-471"><a href="#cb10-471" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Data waves:** do I have at least three waves of data? If not, beware of confounding control issues.</span>
<span id="cb10-472"><a href="#cb10-472" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Data source:** are my data from the NZAVS simulated data set? If not, consult with me.</span>
<span id="cb10-473"><a href="#cb10-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-474"><a href="#cb10-474" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Determine the Outcome</span></span>
<span id="cb10-475"><a href="#cb10-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-476"><a href="#cb10-476" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Outcome variable:** is the outcome variable *Y* defined? If not, define it.</span>
<span id="cb10-477"><a href="#cb10-477" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Multiple outcomes:** are there multiple outcomes? If yes, explain and define them.</span>
<span id="cb10-478"><a href="#cb10-478" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Outcome relevance:** can I explain how the outcome variable/s relate to my question? If not, clarify.</span>
<span id="cb10-479"><a href="#cb10-479" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Outcome type:** is my outcome binary and rare? If yes, consider logistic regression. If my outcome is continuous, consider z-transforming it or categorising it (consult an expert).</span>
<span id="cb10-480"><a href="#cb10-480" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Outcome timing:** does the outcome appear after the exposure? It should.</span>
<span id="cb10-481"><a href="#cb10-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-482"><a href="#cb10-482" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Determine the Exposure</span></span>
<span id="cb10-483"><a href="#cb10-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-484"><a href="#cb10-484" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Exposure variable:** is the exposure variable *A* defined? If not, define it.</span>
<span id="cb10-485"><a href="#cb10-485" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Multiple exposures:** are there multiple exposures? If yes, reassess; if only one exposure, proceed.</span>
<span id="cb10-486"><a href="#cb10-486" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Exposure relevance:** can I explain how the exposure variable relates to my question? If not, clarify.</span>
<span id="cb10-487"><a href="#cb10-487" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Positivity:** can we intervene on the exposure at all levels of the covariates? We should be able to.</span>
<span id="cb10-488"><a href="#cb10-488" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Consistency:** can I interpret what it means to intervene on the exposure? I should be able to.</span>
<span id="cb10-489"><a href="#cb10-489" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Exchangeability:** are different versions of the exposure conditionally exchangeable given measured baseline confounders? They should be.</span>
<span id="cb10-490"><a href="#cb10-490" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Exposure type:** is the exposure binary or continuous?</span>
<span id="cb10-491"><a href="#cb10-491" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Shift intervention**: Am I contrasting static interventions or modified treatment policies? </span>
<span id="cb10-492"><a href="#cb10-492" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Exposure timing:** Does the exposure appear before the outcome? It should.</span>
<span id="cb10-493"><a href="#cb10-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-494"><a href="#cb10-494" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Account for Confounders</span></span>
<span id="cb10-495"><a href="#cb10-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-496"><a href="#cb10-496" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Baseline confounders:** Have I defined my baseline confounders *L*? I should have.</span>
<span id="cb10-497"><a href="#cb10-497" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Justification:** Can I explain how the baseline confounders could affect both *A* and *Y*? I should be able to.</span>
<span id="cb10-498"><a href="#cb10-498" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Timing:** Are the baseline confounders measured before the exposure? They should be.</span>
<span id="cb10-499"><a href="#cb10-499" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Inclusion:** Is the baseline measure of the exposure and the baseline outcome included in the set of baseline confounders? They should be.</span>
<span id="cb10-500"><a href="#cb10-500" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Sufficiency:** Are the baseline confounders sufficient to ensure balance on the exposure, such that *A* is independent of *Y* given *L*? If not, plan a sensitivity analysis.</span>
<span id="cb10-501"><a href="#cb10-501" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Confounder type:** Are the confounders continuous or binary? If so, consider converting them to z-scores. If they are categorical with three or more levels, do not convert them to z-scores.</span>
<span id="cb10-502"><a href="#cb10-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-503"><a href="#cb10-503" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Draw a Causal Diagram with Unmeasured Confounders</span></span>
<span id="cb10-504"><a href="#cb10-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-505"><a href="#cb10-505" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Unmeasured confounders:** Does previous science suggest the presence of unmeasured confounders? If not, expand your understanding.</span>
<span id="cb10-506"><a href="#cb10-506" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Causal diagram:** Have I drawn a causal diagram (DAG) to highlight both measured and unmeasured sources of confounding? I should have.</span>
<span id="cb10-507"><a href="#cb10-507" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Measurement error:** Have I described potential biases from measurement errors? If not, we'll discuss later.</span>
<span id="cb10-508"><a href="#cb10-508" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Temporal order:** Does my DAG have time indicators to ensure correct temporal order? It should.</span>
<span id="cb10-509"><a href="#cb10-509" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Time consistency:** Is my DAG organized so that time follows in a consistent direction? It should.</span>
<span id="cb10-510"><a href="#cb10-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-511"><a href="#cb10-511" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Identify the Estimand</span></span>
<span id="cb10-512"><a href="#cb10-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-513"><a href="#cb10-513" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Causal Estimand:** Is my causal estimand one of the following:</span>
<span id="cb10-514"><a href="#cb10-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-515"><a href="#cb10-515" aria-hidden="true" tabindex="-1"></a>$$ATE_{G,(A,A')} = E<span class="co">[</span><span class="ot">Y(1) - Y(0)|G, L</span><span class="co">]</span>$$</span>
<span id="cb10-516"><a href="#cb10-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-517"><a href="#cb10-517" aria-hidden="true" tabindex="-1"></a>$$ATE_{G,(A/A')} = \frac{E<span class="co">[</span><span class="ot">Y(1)|G, L</span><span class="co">]</span>}{E<span class="co">[</span><span class="ot">Y(0)|G, L</span><span class="co">]</span>}$$</span>
<span id="cb10-518"><a href="#cb10-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-519"><a href="#cb10-519" aria-hidden="true" tabindex="-1"></a>A modified treatment policy, e.g.</span>
<span id="cb10-520"><a href="#cb10-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-521"><a href="#cb10-521" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-522"><a href="#cb10-522" aria-hidden="true" tabindex="-1"></a>\mathbf{d}^\lambda (a_1) = \begin{cases} 4 &amp; \text{if } a_1 &lt; 4 <span class="sc">\\</span> </span>
<span id="cb10-523"><a href="#cb10-523" aria-hidden="true" tabindex="-1"></a>a_1 &amp; \text{otherwise} \end{cases}</span>
<span id="cb10-524"><a href="#cb10-524" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-525"><a href="#cb10-525" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-526"><a href="#cb10-526" aria-hidden="true" tabindex="-1"></a>\mathbf{d}^\phi (a_1) = \begin{cases} 0 &amp; \text{if } a_1 &gt; 0 <span class="sc">\\</span> </span>
<span id="cb10-527"><a href="#cb10-527" aria-hidden="true" tabindex="-1"></a>a_1 &amp; \text{otherwise} \end{cases}</span>
<span id="cb10-528"><a href="#cb10-528" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-529"><a href="#cb10-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-530"><a href="#cb10-530" aria-hidden="true" tabindex="-1"></a>$$ g' = \text{Intervention 1 - Intervention 2} = E<span class="co">[</span><span class="ot">Y(\mathbf{d}^\lambda) - Y(\mathbf{d}^\phi)</span><span class="co">]</span> $$</span>
<span id="cb10-531"><a href="#cb10-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-532"><a href="#cb10-532" aria-hidden="true" tabindex="-1"></a>$$ g'' = \text{Intervention 1 - Intervention 2} = E<span class="co">[</span><span class="ot">Y(\mathbf{d}^\lambda) - Y(\mathbf{d}^\phi)</span><span class="co">]</span> $$</span>
<span id="cb10-533"><a href="#cb10-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-534"><a href="#cb10-534" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-535"><a href="#cb10-535" aria-hidden="true" tabindex="-1"></a>{\gamma}(g) ={g'} - {g''}</span>
<span id="cb10-536"><a href="#cb10-536" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-537"><a href="#cb10-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-538"><a href="#cb10-538" aria-hidden="true" tabindex="-1"></a>If yes, you're on the right track.</span>
<span id="cb10-539"><a href="#cb10-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-540"><a href="#cb10-540" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Understanding Source and Target Populations</span></span>
<span id="cb10-541"><a href="#cb10-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-542"><a href="#cb10-542" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Populations identified:** Have I explained how my sample relates to my target populations? I should have.</span>
<span id="cb10-543"><a href="#cb10-543" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Generalisability and transportability:** Have I considered whether my results generalise different populations?  I should have.</span>
<span id="cb10-544"><a href="#cb10-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-545"><a href="#cb10-545" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Set Eligibility Criteria</span></span>
<span id="cb10-546"><a href="#cb10-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-547"><a href="#cb10-547" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Criteria stated:** Have I stated the eligibility criteria for the study? I should have.</span>
<span id="cb10-548"><a href="#cb10-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-549"><a href="#cb10-549" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Describe Sample Characteristics</span></span>
<span id="cb10-550"><a href="#cb10-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-551"><a href="#cb10-551" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Descriptive statistics:** have I provided descriptive statistics for demographic information taken at baseline? I should have.</span>
<span id="cb10-552"><a href="#cb10-552" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Exposure change:** Have I demonstrated the magnitudes of change in the exposure from baseline to the exposure interval? I should have.</span>
<span id="cb10-553"><a href="#cb10-553" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**References:** Have I included references for more information about the sample? I should have.</span>
<span id="cb10-554"><a href="#cb10-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-555"><a href="#cb10-555" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Addressing Missing Data</span></span>
<span id="cb10-556"><a href="#cb10-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-557"><a href="#cb10-557" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Missing data checks:** Have I checked for missing data? I should have.</span>
<span id="cb10-558"><a href="#cb10-558" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Missing data plan:** If there is missing data, have I described how I will address it? I should have.</span>
<span id="cb10-559"><a href="#cb10-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-560"><a href="#cb10-560" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Selecting the Model Approach: If Not Using Machine Learning (Lecture 7)</span></span>
<span id="cb10-561"><a href="#cb10-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-562"><a href="#cb10-562" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Approach decision:** Have I decided on using G-computation, IPTW, or Doubly-Robust Estimation? I should have.</span>
<span id="cb10-563"><a href="#cb10-563" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Interactions:** If not using machine learning, have I included the interaction of the exposure and baseline covariates? I should have.</span>
<span id="cb10-564"><a href="#cb10-564" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Big data:** If I have a large data set, should I include the interaction of the exposure, group, and baseline confounders? I should consider it.</span>
<span id="cb10-565"><a href="#cb10-565" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model specification:** have I double-checked the model specification? I should.</span>
<span id="cb10-566"><a href="#cb10-566" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Outcome assessment:** If the outcome is rare and binary, have I specified logistic regression? If it's continuous, have I considered converting it to z-scores?</span>
<span id="cb10-567"><a href="#cb10-567" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Sensitivity analysis:** am I planning a sensitivity analysis using simulation? If yes, describe it (e.g. E-values.)</span>
<span id="cb10-568"><a href="#cb10-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-569"><a href="#cb10-569" aria-hidden="true" tabindex="-1"></a><span class="fu">#### If Machine Learing</span></span>
<span id="cb10-570"><a href="#cb10-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-571"><a href="#cb10-571" aria-hidden="true" tabindex="-1"></a><span class="ss">-  </span>**Machine Learning**: have I explained how semi-parametric ensemble machine learning works? (see example below).</span>
<span id="cb10-572"><a href="#cb10-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-573"><a href="#cb10-573" aria-hidden="true" tabindex="-1"></a><span class="fu">### d. Highlight unmeasured pre-treatment covariates</span></span>
<span id="cb10-574"><a href="#cb10-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-575"><a href="#cb10-575" aria-hidden="true" tabindex="-1"></a>Let **U** denoted unmeasured pre-treatment covariates that may potentially bias the statistical association between *A* and *Y* independently of the measured covariates.</span>
<span id="cb10-576"><a href="#cb10-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-577"><a href="#cb10-577" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Consider:</span></span>
<span id="cb10-578"><a href="#cb10-578" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-579"><a href="#cb10-579" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>To affect *Y* and *A*, *U* must occur before *A*.</span>
<span id="cb10-580"><a href="#cb10-580" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>It is useful to draw a causal diagramme to illustrate all potential sources of bias.</span>
<span id="cb10-581"><a href="#cb10-581" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Causal diagrammes are qualitative tools that require specialist expertise. We cannot typically obtain a causal graph from the data.</span>
<span id="cb10-582"><a href="#cb10-582" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A causal diagramme should include only as much information as is required to assess confounding. See @fig-dag-outcomewide for an example.</span>
<span id="cb10-583"><a href="#cb10-583" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Because we cannot ensure the absence of unmeasured confounders in observational settings, it is vital to conduct sensitivity analyses for the results. For sensitivity analyeses, we use E-values.</span>
<span id="cb10-584"><a href="#cb10-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-587"><a href="#cb10-587" aria-hidden="true" tabindex="-1"></a><span class="in">```{tikz}</span></span>
<span id="cb10-588"><a href="#cb10-588" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-dag-outcomewide</span></span>
<span id="cb10-589"><a href="#cb10-589" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Causal graph: three-wave panel design." </span></span>
<span id="cb10-590"><a href="#cb10-590" aria-hidden="true" tabindex="-1"></a><span class="in">#| out-width: 100%</span></span>
<span id="cb10-591"><a href="#cb10-591" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: true</span></span>
<span id="cb10-592"><a href="#cb10-592" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb10-593"><a href="#cb10-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-594"><a href="#cb10-594" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{positioning}</span></span>
<span id="cb10-595"><a href="#cb10-595" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{shapes.geometric}</span></span>
<span id="cb10-596"><a href="#cb10-596" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{arrows}</span></span>
<span id="cb10-597"><a href="#cb10-597" aria-hidden="true" tabindex="-1"></a><span class="in">\usetikzlibrary{decorations}</span></span>
<span id="cb10-598"><a href="#cb10-598" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzstyle{Arrow} = [-&gt;, thin, preaction = {decorate}]</span></span>
<span id="cb10-599"><a href="#cb10-599" aria-hidden="true" tabindex="-1"></a><span class="in">\tikzset{&gt;=latex}</span></span>
<span id="cb10-600"><a href="#cb10-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-601"><a href="#cb10-601" aria-hidden="true" tabindex="-1"></a><span class="in">\begin{tikzpicture}[{every node/.append style}=draw]</span></span>
<span id="cb10-602"><a href="#cb10-602" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (U) at (0, 0) {U};</span></span>
<span id="cb10-603"><a href="#cb10-603" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=black, align=left] (L) at (2, 0) {t0/L \\t0/A \\t0/Y};</span></span>
<span id="cb10-604"><a href="#cb10-604" aria-hidden="true" tabindex="-1"></a><span class="in">\node [rectangle, draw=white] (A) at (4, 0) {t1/A};</span></span>
<span id="cb10-605"><a href="#cb10-605" aria-hidden="true" tabindex="-1"></a><span class="in">\node [ellipse, draw=white] (Y) at (6, 0) {t2/Y};</span></span>
<span id="cb10-606"><a href="#cb10-606" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (U) to (L);</span></span>
<span id="cb10-607"><a href="#cb10-607" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=black] (L) to (A);</span></span>
<span id="cb10-608"><a href="#cb10-608" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, draw=red, dotted] (A) to (Y);</span></span>
<span id="cb10-609"><a href="#cb10-609" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left=50, draw =black] (L) to (Y);</span></span>
<span id="cb10-610"><a href="#cb10-610" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend right=50, draw =black, dotted] (U) to (Y);</span></span>
<span id="cb10-611"><a href="#cb10-611" aria-hidden="true" tabindex="-1"></a><span class="in">\draw [-latex, bend left=50, draw =black, dotted] (U) to (A);</span></span>
<span id="cb10-612"><a href="#cb10-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-613"><a href="#cb10-613" aria-hidden="true" tabindex="-1"></a><span class="in">\end{tikzpicture}</span></span>
<span id="cb10-614"><a href="#cb10-614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb10-615"><a href="#cb10-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-616"><a href="#cb10-616" aria-hidden="true" tabindex="-1"></a><span class="fu">### e. Choose the scale for a causal contrast</span></span>
<span id="cb10-617"><a href="#cb10-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-618"><a href="#cb10-618" aria-hidden="true" tabindex="-1"></a>Average causal effects can be inferred by contrasting the expected outcome when a population is exposed to an exposure level, $E<span class="co">[</span><span class="ot">Y(A = a)</span><span class="co">]</span>$, with the expected outcome under a different exposure level, $E<span class="co">[</span><span class="ot">Y(A=a')</span><span class="co">]</span>$.</span>
<span id="cb10-619"><a href="#cb10-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-620"><a href="#cb10-620" aria-hidden="true" tabindex="-1"></a>For a binary treatment with levels $A=0$ and $A=1$, the Average Treatment Effect (ATE), on the difference scale, is expressed:</span>
<span id="cb10-621"><a href="#cb10-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-622"><a href="#cb10-622" aria-hidden="true" tabindex="-1"></a>$$ATE_{\text{risk difference}} = E<span class="co">[</span><span class="ot">Y(1)|L</span><span class="co">]</span> - E<span class="co">[</span><span class="ot">Y(0)|L</span><span class="co">]</span>$$</span>
<span id="cb10-623"><a href="#cb10-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-624"><a href="#cb10-624" aria-hidden="true" tabindex="-1"></a>On the risk ratio scale, the ATE is expressed:</span>
<span id="cb10-625"><a href="#cb10-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-626"><a href="#cb10-626" aria-hidden="true" tabindex="-1"></a>$$ATE_{\text{risk ratio}} = \frac{E<span class="co">[</span><span class="ot">Y(1)|L</span><span class="co">]</span>}{E<span class="co">[</span><span class="ot">Y(0)|L</span><span class="co">]</span>}$$</span>
<span id="cb10-627"><a href="#cb10-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-628"><a href="#cb10-628" aria-hidden="true" tabindex="-1"></a>Other effect scales, such as the incidence rate ratio, incidence rate difference, or hazard ratio, might also be of interest. We can also define the Average Treatment Effect on the Treated (ATT) :</span>
<span id="cb10-629"><a href="#cb10-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-630"><a href="#cb10-630" aria-hidden="true" tabindex="-1"></a>$$ATT_{\text{risk difference}} = E<span class="co">[</span><span class="ot">Y(1) - Y(0)|A=1,L</span><span class="co">]</span>$$</span>
<span id="cb10-631"><a href="#cb10-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-632"><a href="#cb10-632" aria-hidden="true" tabindex="-1"></a>$$ATT_{\text{risk ratio}} = \frac{E<span class="co">[</span><span class="ot">Y(1)|A=1,L</span><span class="co">]</span>}{E<span class="co">[</span><span class="ot">Y(0)|A=1, L</span><span class="co">]</span>}$$</span>
<span id="cb10-633"><a href="#cb10-633" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-634"><a href="#cb10-634" aria-hidden="true" tabindex="-1"></a>Another common estimand is the Population Average Treatment Effect (PATE), which denotes the effect the treatment would have on the entire population if applied universally to that population. This quantity can be expressed:</span>
<span id="cb10-635"><a href="#cb10-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-636"><a href="#cb10-636" aria-hidden="true" tabindex="-1"></a>$$PATE_{\text{risk difference}} = f(E<span class="co">[</span><span class="ot">Y(1) - Y(0)|L</span><span class="co">]</span>, W)$$</span>
<span id="cb10-637"><a href="#cb10-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-638"><a href="#cb10-638" aria-hidden="true" tabindex="-1"></a>$$PATE_{\text{risk ratio}} = f\left(\frac{E<span class="co">[</span><span class="ot">Y(1)|L</span><span class="co">]</span>}{E<span class="co">[</span><span class="ot">Y(0)|L</span><span class="co">]</span>}, W\right)$$</span>
<span id="cb10-639"><a href="#cb10-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-640"><a href="#cb10-640" aria-hidden="true" tabindex="-1"></a>where $f$ is a function that incorporates weights $W$ into the estimation of the expected outcomes. These weights are given from census estimates for the wider population. Note: I will show you how to use weights in future seminars.</span>
<span id="cb10-641"><a href="#cb10-641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-642"><a href="#cb10-642" aria-hidden="true" tabindex="-1"></a>We might also be interested in identifying effects specific to certain strata, such as risk differences or risk ratios, as they are modified by baseline indicators. Denote a stratum of interest by $G$. We may then compute:</span>
<span id="cb10-643"><a href="#cb10-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-644"><a href="#cb10-644" aria-hidden="true" tabindex="-1"></a>$$ATE_{G,\text{risk difference}} = E<span class="co">[</span><span class="ot">Y(1) - Y(0)|G, L</span><span class="co">]</span>$$</span>
<span id="cb10-645"><a href="#cb10-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-646"><a href="#cb10-646" aria-hidden="true" tabindex="-1"></a>$$ATE_{G,\text{risk ratio}} = \frac{E<span class="co">[</span><span class="ot">Y(1)|G, L</span><span class="co">]</span>}{E<span class="co">[</span><span class="ot">Y(0)|G, L</span><span class="co">]</span>}$$</span>
<span id="cb10-647"><a href="#cb10-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-648"><a href="#cb10-648" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Consider:</span></span>
<span id="cb10-649"><a href="#cb10-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-650"><a href="#cb10-650" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>*In this course, we are interested in stratum specific comparisons*</span>
<span id="cb10-651"><a href="#cb10-651" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>In the causal inference literature, the concept we use to make sense of stratum specific comparisons is called "effect modification."</span>
<span id="cb10-652"><a href="#cb10-652" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>By inferring effects within strata, we may evaluate whether the effects of different exposures or treatments on some well-defined outcome (measured in some well-defined time-period after the exposure) differ depending on group measurement.</span>
<span id="cb10-653"><a href="#cb10-653" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The logic of effect modification differs slightly from that of interaction.</span>
<span id="cb10-654"><a href="#cb10-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-655"><a href="#cb10-655" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Aside: extensions</span></span>
<span id="cb10-656"><a href="#cb10-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-657"><a href="#cb10-657" aria-hidden="true" tabindex="-1"></a>For continuous exposures, we must stipulate the level of contrast for the exposure (e.g. weekly versus monthly church attendance):</span>
<span id="cb10-658"><a href="#cb10-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-659"><a href="#cb10-659" aria-hidden="true" tabindex="-1"></a>$$ATE_{A,A'} = E<span class="co">[</span><span class="ot">Y(A) - Y(A')| L</span><span class="co">]</span>$$</span>
<span id="cb10-660"><a href="#cb10-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-661"><a href="#cb10-661" aria-hidden="true" tabindex="-1"></a>This essentially denotes an average treatment effect comparing the outcome under treatment level $A$ to the outcome under treatment level $A'$.</span>
<span id="cb10-662"><a href="#cb10-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-663"><a href="#cb10-663" aria-hidden="true" tabindex="-1"></a>Likewise:</span>
<span id="cb10-664"><a href="#cb10-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-665"><a href="#cb10-665" aria-hidden="true" tabindex="-1"></a>$$ATE_{A/A'} = \frac{E<span class="co">[</span><span class="ot">Y(A)| L</span><span class="co">]</span>}{E<span class="co">[</span><span class="ot">Y(A')| L</span><span class="co">]</span>}$$</span>
<span id="cb10-666"><a href="#cb10-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-667"><a href="#cb10-667" aria-hidden="true" tabindex="-1"></a>This defines the contrast of $A$ and $A'$ on a ratio scale.</span>
<span id="cb10-668"><a href="#cb10-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-669"><a href="#cb10-669" aria-hidden="true" tabindex="-1"></a><span class="fu">#### f. Describe the population(s) for whom the intended study is meant to generalise by distinguishing between source and target populations.</span></span>
<span id="cb10-670"><a href="#cb10-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-671"><a href="#cb10-671" aria-hidden="true" tabindex="-1"></a>Consider the following concepts:</span>
<span id="cb10-672"><a href="#cb10-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-673"><a href="#cb10-673" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Source population**: a source population is where we gather our data for a study. We pull our specific sample from this group. It needs to mirror the broader group for our conclusions to be valid and widely applicable.</span>
<span id="cb10-674"><a href="#cb10-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-675"><a href="#cb10-675" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Target population**: the target population is the larger group we aim to apply our study's results to. It could be defined by location, demographics, or specific conditions. The closer the source matches the target in ways that are relevant to our causal questions, the stronger our causal inferences about the target population will be.</span>
<span id="cb10-676"><a href="#cb10-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-677"><a href="#cb10-677" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**Generalisability** refers to the ability to apply the causal effects estimated from a sample to the population it was drawn from. In simpler terms, it deals with the extrapolation of causal knowledge from a sample to the broader population. This concept is also called "external validity".</span>
<span id="cb10-678"><a href="#cb10-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-679"><a href="#cb10-679" aria-hidden="true" tabindex="-1"></a>$$\text{Generalisability} = PATE \approx ATE_{\text{sample}}$$</span>
<span id="cb10-680"><a href="#cb10-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-681"><a href="#cb10-681" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Transportability** refers to the ability to extrapolate causal effects learned from a source population to a target population when certain conditions are met. It deals with the transfer of causal knowledge across different settings or populations.</span>
<span id="cb10-682"><a href="#cb10-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-683"><a href="#cb10-683" aria-hidden="true" tabindex="-1"></a>$$\text{Transportability} = ATE_{\text{target}} \approx f(ATE_{\text{source}}, T)$$</span>
<span id="cb10-684"><a href="#cb10-684" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-685"><a href="#cb10-685" aria-hidden="true" tabindex="-1"></a>where $f$ is a function and $T$ is a function that maps the results from our source population to another population. To achieve transportability, we need information about the source and target populations and an understanding of how the relationships between treatment, outcome, and covariates differ between the populations. Assessing transportability requires scientific knowledge.</span>
<span id="cb10-686"><a href="#cb10-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-687"><a href="#cb10-687" aria-hidden="true" tabindex="-1"></a><span class="fu">### Summary Step 1: Consider how much we need to do when asking a causal question!</span></span>
<span id="cb10-688"><a href="#cb10-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-689"><a href="#cb10-689" aria-hidden="true" tabindex="-1"></a>We discover that asking a causal question is a multifaceted task. It demands careful definition of the outcome, including its timing, the exposure, and covariates. It also requires selecting the appropriate scale for causal contrast, controlling for confounding, and potentially adjusting for sample weights or stratification. Finally, when asking a causal question, we must consider for whom the results apply. Only after following these steps can we then ask: "How may we answer this causal question?"</span>
<span id="cb10-690"><a href="#cb10-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-691"><a href="#cb10-691" aria-hidden="true" tabindex="-1"></a><span class="fu">## STEP 2: ANSWER A CAUSAL QUESTION</span></span>
<span id="cb10-692"><a href="#cb10-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-693"><a href="#cb10-693" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Obtain longitudinal data</span></span>
<span id="cb10-694"><a href="#cb10-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-695"><a href="#cb10-695" aria-hidden="true" tabindex="-1"></a>Note that causal inference from observational data turns on the appropriate temporal ordering of the key variables involved in the study.</span>
<span id="cb10-696"><a href="#cb10-696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-697"><a href="#cb10-697" aria-hidden="true" tabindex="-1"></a>Recall we have defined.</span>
<span id="cb10-698"><a href="#cb10-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-699"><a href="#cb10-699" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**A**: Our exposure or treatment variable, denoted as **A**. Here we consider the example of 'Church attendance'.</span>
<span id="cb10-700"><a href="#cb10-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-701"><a href="#cb10-701" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Y**: The outcome variable we are interested in, represented by **Y**, is psychological distress. We operationalise this variable through the 'Kessler-6' distress scale.</span>
<span id="cb10-702"><a href="#cb10-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-703"><a href="#cb10-703" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**L**: The confounding variables, collectively referred to as **L**, represent factors that can independently influence both **A** and **Y**. For example, socio-economic status could be a confounder that impacts both the likelihood of church attendance and the levels of psychological distress.</span>
<span id="cb10-704"><a href="#cb10-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-705"><a href="#cb10-705" aria-hidden="true" tabindex="-1"></a>Given the importance of temporal ordering, we must now define time:</span>
<span id="cb10-706"><a href="#cb10-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-707"><a href="#cb10-707" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**t** $\in$ T: Let $t$ denote within a multiwave panel study with **T** measurement intervals.</span>
<span id="cb10-708"><a href="#cb10-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-709"><a href="#cb10-709" aria-hidden="true" tabindex="-1"></a>Where $t/\text{{exposure}}$ denotes the measurement interval for the exposure. Longitudinal data collection provides us the ability to establish a causal model such that:</span>
<span id="cb10-710"><a href="#cb10-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-711"><a href="#cb10-711" aria-hidden="true" tabindex="-1"></a>$$t_{confounders} &lt; t_{exposure}&lt; t_{outcome}$$</span>
<span id="cb10-712"><a href="#cb10-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-713"><a href="#cb10-713" aria-hidden="true" tabindex="-1"></a>To minimise the posibility of time-varying confounding and obtain the clearest effect estimates, we should acquire the most recent values of $\mathbf{L}$ preceding $A$ and the latest values of $A$ before $Y$.</span>
<span id="cb10-714"><a href="#cb10-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-715"><a href="#cb10-715" aria-hidden="true" tabindex="-1"></a>Note in @fig-dag-outcomewide, We use the prefixes "t0, t1, and t2" to denote temporal ordering. We include in the set of baseline confounders the pre-exposure measurement of *A* and *Y*. This allows for more substantial confounding control. For unmeasured confounder to affect both the exposure and the outcome, it would need to do so independently of the pre-exposure confounders. Additionally, including the baseline exposure gives us an effect estimate for the incidence exposure, rather than the prevelance of the exposure. This helps us to assess the expected change in the outcome were we to initate a change in the exposure.</span>
<span id="cb10-716"><a href="#cb10-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-717"><a href="#cb10-717" aria-hidden="true" tabindex="-1"></a><span class="fu">### Include the measured exposure with baseline covariates</span></span>
<span id="cb10-718"><a href="#cb10-718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-719"><a href="#cb10-719" aria-hidden="true" tabindex="-1"></a>Controlling for prior exposure enables the interpretation of the effect estimate as a change in the exposure in a manner akin to a randomised trial. We propose that the effect estimate with prior control for the exposure estimates the "incidence exposure" rather than the "prevalence exposure" <span class="co">[</span><span class="ot">@danaei2012</span><span class="co">]</span>. It is crucial to estimate the incidence exposure because if the effects of an exposure are harmful in the short term such that these effects are not subsequently measured, a failure to adjust for prior exposure will yield the illusion that the exposure is beneficial. Furthermore, this approach aids in controlling for unmeasured confounding. For such a confounder to explain away the observed exposure-outcome association, it would need to do so independently of the prior level of the exposure and outcome.</span>
<span id="cb10-720"><a href="#cb10-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-721"><a href="#cb10-721" aria-hidden="true" tabindex="-1"></a><span class="fu">### State the eligibility criteria for participation</span></span>
<span id="cb10-722"><a href="#cb10-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-723"><a href="#cb10-723" aria-hidden="true" tabindex="-1"></a>This step is invaluable for assessing whether we are answering the causal question that we have asked.</span>
<span id="cb10-724"><a href="#cb10-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-725"><a href="#cb10-725" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Consider:</span></span>
<span id="cb10-726"><a href="#cb10-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-727"><a href="#cb10-727" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Generalisability: we cannot evaluate inferences to a target group from the source population if we do not describe the source population</span>
<span id="cb10-728"><a href="#cb10-728" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Eligibility criteria will help us to ensure whether we have correctly evaluated potential measurement bias/error in our instruments.</span>
<span id="cb10-729"><a href="#cb10-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-730"><a href="#cb10-730" aria-hidden="true" tabindex="-1"></a>For example, the New Zealand Attitudes and Values Study is a National Probability study of New Zealanders. The details provided in the supplementary materials describe how individuals were randomly selected from the country's electoral roll. From these invitations there was typically less than 15% response rate. How might this process of recruitment affect generalisability and transportability of our results?</span>
<span id="cb10-731"><a href="#cb10-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-732"><a href="#cb10-732" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Aside: discuss per protocol effects/ intention to treat effects</span>
<span id="cb10-733"><a href="#cb10-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-734"><a href="#cb10-734" aria-hidden="true" tabindex="-1"></a><span class="fu">### Determine how missing data will be handled</span></span>
<span id="cb10-735"><a href="#cb10-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-736"><a href="#cb10-736" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>As we will consider in the upcoming weeks, loss to follow up and non-response opens sources for bias. We must develop a strategy for handling missing data.</span>
<span id="cb10-737"><a href="#cb10-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-738"><a href="#cb10-738" aria-hidden="true" tabindex="-1"></a><span class="fu">### State a statistical model</span></span>
<span id="cb10-739"><a href="#cb10-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-740"><a href="#cb10-740" aria-hidden="true" tabindex="-1"></a>The models we have considered in this course are G-computation, Inverse Probability of Treatement Weighting, and Doubly-Robust estimation.</span>
<span id="cb10-741"><a href="#cb10-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-742"><a href="#cb10-742" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reporting</span></span>
<span id="cb10-743"><a href="#cb10-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-744"><a href="#cb10-744" aria-hidden="true" tabindex="-1"></a>Consider the following ideas about how to report one's model:</span>
<span id="cb10-745"><a href="#cb10-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-746"><a href="#cb10-746" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Estimator**: Doubly robust where possible.</span>
<span id="cb10-747"><a href="#cb10-747" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Propensity Score Reporting:** Detail the process of propensity score derivation, including the model used and any variable transformations.</span>
<span id="cb10-748"><a href="#cb10-748" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**WeightIt Package:** Explicitly mention the use of the 'WeightIt' package in R, including any specific options or parameters used in the propensity score estimation process.</span>
<span id="cb10-749"><a href="#cb10-749" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Method Variations:** Report if different methods were used to obtain propensity scores, and the reasons behind the choice of methods such as 'ebal', 'energy', and 'ps'.</span>
<span id="cb10-750"><a href="#cb10-750" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Continuous Exposures:** Highlight that for continuous exposures, only the 'energy' option was used for propensity score estimation.</span>
<span id="cb10-751"><a href="#cb10-751" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Subgroup Estimation:** Confirm that the propensity scores for subgroups were estimated separately, and discuss how the weights were subsequently combined with the original data.</span>
<span id="cb10-752"><a href="#cb10-752" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Covariate Balance:** Include a Love plot to visually represent covariate balance on the exposure both before and after weighting.</span>
<span id="cb10-753"><a href="#cb10-753" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Weighting Algorithm Statistics:** Report the statistics for the weighting algorithms as provided by the WeightIt package, including any measures of balance or fit.</span>
<span id="cb10-754"><a href="#cb10-754" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Outcome Regression Model:** Clearly report the type of regression model used to estimate outcome model coefficients (e.g., linear regression, Poisson, binomial), and mention if the exposure was interacted with the baseline covariates. Do not report model coefficients as these have no interpretation.</span>
<span id="cb10-755"><a href="#cb10-755" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Subgroup Interaction:** Address whether the subgroup was included separately as an interaction in the outcome model, and if the model successfully converged.</span>
<span id="cb10-756"><a href="#cb10-756" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Machine Learning Using `lmtp`** If using the <span class="in">`lmtp`</span> package, do a stratified analysis. (see today's lab)</span>
<span id="cb10-757"><a href="#cb10-757" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Model coefficients:** note that the model coefficients should not be interpreted, as they are not meaningful in this context.</span>
<span id="cb10-758"><a href="#cb10-758" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Confidence intervals and standard errors:** Describe the methods used to derive confidence intervals and standard errors, noting the use of the 'clarify' package in R for simulation based inference.</span>
<span id="cb10-759"><a href="#cb10-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-760"><a href="#cb10-760" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example of how to report a doubly robust method in your report</span></span>
<span id="cb10-761"><a href="#cb10-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-762"><a href="#cb10-762" aria-hidden="true" tabindex="-1"></a>The Doubly Robust Estimation method for Subgroup Analysis Estimator is a sophisticated tool combining features of both IPTW and G-computation methods, providing unbiased estimates if either the propensity score or outcome model is correctly specified. The process involves five main steps:</span>
<span id="cb10-763"><a href="#cb10-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-764"><a href="#cb10-764" aria-hidden="true" tabindex="-1"></a>**Step 1** involves the estimation of the propensity score, a measure of the conditional probability of exposure given the covariates and the subgroup indicator. This score is calculated using statistical models such as logistic regression, with the model choice depending on the nature of the data and exposure. Weights for each individual are then calculated using this propensity score. These weights depend on the exposure status and are computed differently for exposed and unexposed individuals. The estimation of propensity scores is performed separately within each subgroup stratum.</span>
<span id="cb10-765"><a href="#cb10-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-766"><a href="#cb10-766" aria-hidden="true" tabindex="-1"></a>**Step 2** focuses on fitting a weighted outcome model, making use of the previously calculated weights from the propensity scores. This model estimates the outcome conditional on exposure, covariates, and subgroup, integrating the weights into the estimation process. Unlike in propensity score model estimation, covariates are included as variables in the outcome model. This inclusion makes the method doubly robust - providing a consistent effect estimate if either the propensity score or the outcome model is correctly specified, thereby reducing the assumption of correct model specification.</span>
<span id="cb10-767"><a href="#cb10-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-768"><a href="#cb10-768" aria-hidden="true" tabindex="-1"></a>**Step 3** entails the simulation of potential outcomes for each individual in each subgroup. These hypothetical scenarios assume universal exposure to the intervention within each subgroup, regardless of actual exposure levels. The expectation of potential outcomes is calculated for each individual in each subgroup, using individual-specific weights. These scenarios are performed for both the current and alternative interventions.</span>
<span id="cb10-769"><a href="#cb10-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-770"><a href="#cb10-770" aria-hidden="true" tabindex="-1"></a>**Step 4** is the estimation of the average causal effect for each subgroup, achieved by comparing the computed expected values of potential outcomes under each intervention level. The difference represents the average causal effect of changing the exposure within each subgroup. </span>
<span id="cb10-771"><a href="#cb10-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-772"><a href="#cb10-772" aria-hidden="true" tabindex="-1"></a>**Step 5** involves comparing differences in causal effects across groups by calculating the differences in the estimated causal effects between different subgroups. Confidence intervals and standard errors for these calculations are determined using simulation-based inference methods <span class="co">[</span><span class="ot">@greifer2023</span><span class="co">]</span>. This step allows for a comprehensive comparison of the impact of different interventions across various subgroups, while encorporating uncertainty.</span>
<span id="cb10-773"><a href="#cb10-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-774"><a href="#cb10-774" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inference</span></span>
<span id="cb10-775"><a href="#cb10-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-776"><a href="#cb10-776" aria-hidden="true" tabindex="-1"></a>Consider the following ideas about what to discuss in one's findings:</span>
<span id="cb10-777"><a href="#cb10-777" aria-hidden="true" tabindex="-1"></a>Consider the following ideas about what to discuss in one's findings. The order of exposition might be different.</span>
<span id="cb10-778"><a href="#cb10-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-779"><a href="#cb10-779" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>**Summary of results**:  What did you find?</span>
<span id="cb10-780"><a href="#cb10-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-781"><a href="#cb10-781" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Interpretation of E-values:** Interpret the E-values used for sensitivity analysis. State what they represent in terms of the robustness of the findings to potential unmeasured confounding.</span>
<span id="cb10-782"><a href="#cb10-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-783"><a href="#cb10-783" aria-hidden="true" tabindex="-1"></a><span class="ss">3.  </span>**Causal Effect Interpretation:** What is the interest of the effect, if any, if an effect was observed? Interpret the average causal effect of changing the exposure level within each subgroup, and discuss its relevance to the research question. </span>
<span id="cb10-784"><a href="#cb10-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-785"><a href="#cb10-785" aria-hidden="true" tabindex="-1"></a><span class="ss">4.  </span>**Comparison of Subgroups:** Discuss how differences in causal effect estimates between different subgroups, if observed, or if not observed, contribute to the overall findings of the study.</span>
<span id="cb10-786"><a href="#cb10-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-787"><a href="#cb10-787" aria-hidden="true" tabindex="-1"></a><span class="ss">5.  </span>**Uncertainty and Confidence Intervals:** Consider the uncertainty around the estimated causal effects, and interpret the confidence intervals to understand the precision of the estimates.</span>
<span id="cb10-788"><a href="#cb10-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-789"><a href="#cb10-789" aria-hidden="true" tabindex="-1"></a><span class="ss">6.  </span>**Generalisability and Transportability:** Reflect on the generalizability of the study results to other contexts or populations. Discuss any factors that might influence the transportability of the causal effects found in the study. (Again see lecture 9.)</span>
<span id="cb10-790"><a href="#cb10-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-791"><a href="#cb10-791" aria-hidden="true" tabindex="-1"></a><span class="ss">7.  </span>**Assumptions and Limitations:** Reflect on the assumptions made during the study and identify any limitations in the methodology that could affect the interpretation of results. State that the implications of different intervention levels on potential outcomes are not analysed. </span>
<span id="cb10-792"><a href="#cb10-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-793"><a href="#cb10-793" aria-hidden="true" tabindex="-1"></a><span class="ss">8.  </span>**Theoretical Relevance**: How are these findings relevant to existing theories. </span>
<span id="cb10-794"><a href="#cb10-794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-795"><a href="#cb10-795" aria-hidden="true" tabindex="-1"></a><span class="ss">9.  </span>**Replication and Future Research:** Consider how the study could be replicated or expanded upon in future research, and how the findings contribute to the existing body of knowledge in the field.</span>
<span id="cb10-796"><a href="#cb10-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-797"><a href="#cb10-797" aria-hidden="true" tabindex="-1"></a><span class="ss">10. </span>**Real-world Implications:** Discuss the real-world implications of the findings, and how they could be applied in policy, practice, or further research.</span>
<span id="cb10-798"><a href="#cb10-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-799"><a href="#cb10-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-800"><a href="#cb10-800" aria-hidden="true" tabindex="-1"></a><span class="fu">## Appendix A: Details of Estimation Approaches</span></span>
<span id="cb10-801"><a href="#cb10-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-802"><a href="#cb10-802" aria-hidden="true" tabindex="-1"></a><span class="fu">### G-computation for Subgroup Analysis Estimator</span></span>
<span id="cb10-803"><a href="#cb10-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-804"><a href="#cb10-804" aria-hidden="true" tabindex="-1"></a>**Step 1:** Estimate the outcome model. Fit a model for the outcome $Y$, conditional on the exposure $A$, the covariates $L$, and subgroup indicator $G$. This model can be a linear regression, logistic regression, or another statistical model. The goal is to capture the relationship between the outcome, exposure, confounders, and subgroups.</span>
<span id="cb10-805"><a href="#cb10-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-806"><a href="#cb10-806" aria-hidden="true" tabindex="-1"></a>$$ \hat{E}(Y|A,L,G) = f_Y(A,L,G; \theta_Y) $$</span>
<span id="cb10-807"><a href="#cb10-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-808"><a href="#cb10-808" aria-hidden="true" tabindex="-1"></a>This equation represents the expected value of the outcome $Y$ given the exposure $A$, covariates $L$, and subgroup $G$, as modelled by the function $f_Y$ with parameters $\theta_Y$. This formulation allows for the prediction of the average outcome $Y$ given certain values of $A$, $L$, and $G$.</span>
<span id="cb10-809"><a href="#cb10-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-810"><a href="#cb10-810" aria-hidden="true" tabindex="-1"></a>**Step 2:** Simulate potential outcomes. For each individual in each subgroup, predict their potential outcome under the intervention $A=a$ using the estimated outcome model:</span>
<span id="cb10-811"><a href="#cb10-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-812"><a href="#cb10-812" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a)|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a,L,G=g; \hat{\theta}_Y</span><span class="co">]</span>$$</span>
<span id="cb10-813"><a href="#cb10-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-814"><a href="#cb10-814" aria-hidden="true" tabindex="-1"></a>We also predict the potential outcome for everyone in each subgroup under the causal contrast, setting the intervention for everyone in that group to $A=a'$:</span>
<span id="cb10-815"><a href="#cb10-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-816"><a href="#cb10-816" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a')|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a',L,G=g; \hat{\theta}_Y</span><span class="co">]</span>$$</span>
<span id="cb10-817"><a href="#cb10-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-818"><a href="#cb10-818" aria-hidden="true" tabindex="-1"></a>In these equations, $Y$ represents the potential outcome, $A$ is the intervention, $L$ are the covariates, $G=g$ represents the subgroup, and $\theta_Y$ are the parameters of the outcome model.</span>
<span id="cb10-819"><a href="#cb10-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-820"><a href="#cb10-820" aria-hidden="true" tabindex="-1"></a>**Step 3:** Calculate the estimated difference for each subgroup $g$:</span>
<span id="cb10-821"><a href="#cb10-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-822"><a href="#cb10-822" aria-hidden="true" tabindex="-1"></a>$$\hat{\delta}_g = \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g</span><span class="co">]</span>$$</span>
<span id="cb10-823"><a href="#cb10-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-824"><a href="#cb10-824" aria-hidden="true" tabindex="-1"></a>This difference $\hat{\delta}_g$ represents the average causal effect of changing the exposure from level $a'$ to level $a$ within each subgroup $g$.</span>
<span id="cb10-825"><a href="#cb10-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-826"><a href="#cb10-826" aria-hidden="true" tabindex="-1"></a>We use simulation-based inference methods to compute standard errors and confidence intervals <span class="co">[</span><span class="ot">@greifer2023</span><span class="co">]</span>.</span>
<span id="cb10-827"><a href="#cb10-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-828"><a href="#cb10-828" aria-hidden="true" tabindex="-1"></a>**Step 4:** Compare differences in causal effects by subgroups:</span>
<span id="cb10-829"><a href="#cb10-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-830"><a href="#cb10-830" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}$$</span>
<span id="cb10-831"><a href="#cb10-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-832"><a href="#cb10-832" aria-hidden="true" tabindex="-1"></a>where,</span>
<span id="cb10-833"><a href="#cb10-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-834"><a href="#cb10-834" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \overbrace{\big( \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a^{\prime})|G=g</span><span class="co">]</span> \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}<span class="co">[</span><span class="ot">Y(a^{\prime})|G=g^{\prime}</span><span class="co">]</span>- \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g^{\prime}</span><span class="co">]</span>\big)}^{\hat{\delta_{g^{\prime}}}}$$</span>
<span id="cb10-835"><a href="#cb10-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-836"><a href="#cb10-836" aria-hidden="true" tabindex="-1"></a>This difference $\hat{\gamma}$ represents the difference in the average causal effects between the subgroups $g$ and $g'$. It measures the difference in effect of the exposure $A$ within subgroup $G$ on the outcome $Y$.</span>
<span id="cb10-837"><a href="#cb10-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-838"><a href="#cb10-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-839"><a href="#cb10-839" aria-hidden="true" tabindex="-1"></a><span class="ot">[^note_care]</span> </span>
<span id="cb10-840"><a href="#cb10-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-841"><a href="#cb10-841" aria-hidden="true" tabindex="-1"></a><span class="ot">[^note_care]: </span>$A$ and $G$ on $Y$ might not be additive. We assume that the potential confounders $L$ are sufficient to control for confounding. See Appendix</span>
<span id="cb10-842"><a href="#cb10-842" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-843"><a href="#cb10-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-844"><a href="#cb10-844" aria-hidden="true" tabindex="-1"></a>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="co">[</span><span class="ot">@greifer2023</span><span class="co">]</span>.</span>
<span id="cb10-845"><a href="#cb10-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-846"><a href="#cb10-846" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-847"><a href="#cb10-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-848"><a href="#cb10-848" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-849"><a href="#cb10-849" aria-hidden="true" tabindex="-1"></a><span class="fu">### Inverse Probability of Treatment Weighting (IPTW) for Subgroup Analysis Estimator</span></span>
<span id="cb10-850"><a href="#cb10-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-851"><a href="#cb10-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-852"><a href="#cb10-852" aria-hidden="true" tabindex="-1"></a>**Step 1:** Estimate the propensity score. The propensity score $e(L, G)$ is the conditional probability of the exposure $A = 1$, given the covariates $L$ and subgroup indicator $G$. This can be modeled using logistic regression or other suitable methods, depending on the nature of the data and the exposure.</span>
<span id="cb10-853"><a href="#cb10-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-854"><a href="#cb10-854" aria-hidden="true" tabindex="-1"></a>$$\hat{e} = P(A = 1 | L, G) = f_A(L, G; \theta_A)$$</span>
<span id="cb10-855"><a href="#cb10-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-856"><a href="#cb10-856" aria-hidden="true" tabindex="-1"></a>Here, $f_A(L, G; \theta_A)$ is a function (statistical model) that estimates the probability of the exposure $A = 1$ given covariates $L$ and subgroup $G$. Then, we calculate the weights for each individual, denoted as $v$, using the estimated propensity score:</span>
<span id="cb10-857"><a href="#cb10-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-858"><a href="#cb10-858" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-859"><a href="#cb10-859" aria-hidden="true" tabindex="-1"></a>v = </span>
<span id="cb10-860"><a href="#cb10-860" aria-hidden="true" tabindex="-1"></a>\begin{cases} </span>
<span id="cb10-861"><a href="#cb10-861" aria-hidden="true" tabindex="-1"></a>\frac{1}{\hat{e}} &amp; \text{if } A = 1 <span class="sc">\\</span></span>
<span id="cb10-862"><a href="#cb10-862" aria-hidden="true" tabindex="-1"></a>\frac{1}{1-\hat{e}} &amp; \text{if } A = 0 </span>
<span id="cb10-863"><a href="#cb10-863" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb10-864"><a href="#cb10-864" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-865"><a href="#cb10-865" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-866"><a href="#cb10-866" aria-hidden="true" tabindex="-1"></a>**Step 2:** Fit a weighted outcome model. Using the weights calculated from the estimated propensity scores, fit a model for the outcome $Y$, conditional on the exposure $A$ and subgroup $G$. This can be represented as:</span>
<span id="cb10-867"><a href="#cb10-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-868"><a href="#cb10-868" aria-hidden="true" tabindex="-1"></a>$$ \hat{E}(Y|A, G; V) = f_Y(A, G ; \theta_Y, V) $$</span>
<span id="cb10-869"><a href="#cb10-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-870"><a href="#cb10-870" aria-hidden="true" tabindex="-1"></a>In this model, $f_Y$ is a function (such as a weighted regression model) with parameters $θ_Y$.</span>
<span id="cb10-871"><a href="#cb10-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-872"><a href="#cb10-872" aria-hidden="true" tabindex="-1"></a>**Step 3:** Simulate potential outcomes. For each individual in each subgroup, simulate their potential outcome under the hypothetical scenario where everyone in the subgroup is exposed to the intervention $A=a$ regardless of their actual exposure level:</span>
<span id="cb10-873"><a href="#cb10-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-874"><a href="#cb10-874" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a)|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a,G=g; \hat{\theta}_Y, v</span><span class="co">]</span>$$</span>
<span id="cb10-875"><a href="#cb10-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-876"><a href="#cb10-876" aria-hidden="true" tabindex="-1"></a>And also under the hypothetical scenario where everyone is exposed to intervention $A=a'$:</span>
<span id="cb10-877"><a href="#cb10-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-878"><a href="#cb10-878" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a')|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a',G=g; \hat{\theta}_Y, v</span><span class="co">]</span>$$</span>
<span id="cb10-879"><a href="#cb10-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-880"><a href="#cb10-880" aria-hidden="true" tabindex="-1"></a>**Step 4:** Estimate the average causal effect for each subgroup as the difference in the predicted outcomes:</span>
<span id="cb10-881"><a href="#cb10-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-882"><a href="#cb10-882" aria-hidden="true" tabindex="-1"></a>$$\hat{\delta}_g = \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g</span><span class="co">]</span>$$</span>
<span id="cb10-883"><a href="#cb10-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-884"><a href="#cb10-884" aria-hidden="true" tabindex="-1"></a>The estimated difference $\hat{\delta}_g$ represents the average causal effect within group $g$.</span>
<span id="cb10-885"><a href="#cb10-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-886"><a href="#cb10-886" aria-hidden="true" tabindex="-1"></a>**Step 5:** Compare differences in causal effects by groups. Compute the differences in the estimated causal effects between different subgroups:</span>
<span id="cb10-887"><a href="#cb10-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-888"><a href="#cb10-888" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}$$</span>
<span id="cb10-889"><a href="#cb10-889" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-890"><a href="#cb10-890" aria-hidden="true" tabindex="-1"></a>where,</span>
<span id="cb10-891"><a href="#cb10-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-892"><a href="#cb10-892" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \overbrace{\big( \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g</span><span class="co">]</span> \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g'</span><span class="co">]</span>- \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g'</span><span class="co">]</span>\big)}^{\hat{\delta_{g'}}}$$</span>
<span id="cb10-893"><a href="#cb10-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-894"><a href="#cb10-894" aria-hidden="true" tabindex="-1"></a>This $\hat{\gamma}$ represents the difference in the average causal effects between the subgroups $g$ and $g'$.</span>
<span id="cb10-895"><a href="#cb10-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-896"><a href="#cb10-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-897"><a href="#cb10-897" aria-hidden="true" tabindex="-1"></a>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="co">[</span><span class="ot">@greifer2023</span><span class="co">]</span>.</span>
<span id="cb10-898"><a href="#cb10-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-899"><a href="#cb10-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-900"><a href="#cb10-900" aria-hidden="true" tabindex="-1"></a><span class="fu">### Doubly Robust Estimation for Subgroup Analysis Estimator</span></span>
<span id="cb10-901"><a href="#cb10-901" aria-hidden="true" tabindex="-1"></a>It appears that the Doubly Robust Estimation explanation for subgroup analysis is already clear and correct, covering all the necessary steps in the process. Nevertheless, there's a slight confusion in step 4. The difference $\delta_g$ is not defined within the document. I assume that you intended to write $\hat{\delta}_g$. Here's the corrected version:</span>
<span id="cb10-902"><a href="#cb10-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-903"><a href="#cb10-903" aria-hidden="true" tabindex="-1"></a><span class="fu">### Doubly Robust Estimation for Subgroup Analysis Estimator</span></span>
<span id="cb10-904"><a href="#cb10-904" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-905"><a href="#cb10-905" aria-hidden="true" tabindex="-1"></a>Doubly Robust Estimation is a powerful technique that combines the strengths of both the IPTW and G-computation methods. It uses both the propensity score model and the outcome model, which makes it doubly robust: it produces unbiased estimates if either one of the models is correctly specified.</span>
<span id="cb10-906"><a href="#cb10-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-907"><a href="#cb10-907" aria-hidden="true" tabindex="-1"></a>**Step 1** Estimate the propensity score. The propensity score $\hat{e}(L, G)$ is the conditional probability of the exposure $A = 1$, given the covariates $L$ and subgroup indicator $G$. This can be modeled using logistic regression or other suitable methods, depending on the nature of the data and the exposure.</span>
<span id="cb10-908"><a href="#cb10-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-909"><a href="#cb10-909" aria-hidden="true" tabindex="-1"></a>$$\hat{e} = P(A = 1 | L, G) = f_A(L, G; \theta_A)$$</span>
<span id="cb10-910"><a href="#cb10-910" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-911"><a href="#cb10-911" aria-hidden="true" tabindex="-1"></a>Here, $f_A(L, G; \theta_A)$ is a function (statistical model) that estimates the probability of the exposure $A = 1$ given covariates $L$ and subgroup $G$. Then, we calculate the weights for each individual, denoted as $v$, using the estimated propensity score:</span>
<span id="cb10-912"><a href="#cb10-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-913"><a href="#cb10-913" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-914"><a href="#cb10-914" aria-hidden="true" tabindex="-1"></a>v = </span>
<span id="cb10-915"><a href="#cb10-915" aria-hidden="true" tabindex="-1"></a>\begin{cases} </span>
<span id="cb10-916"><a href="#cb10-916" aria-hidden="true" tabindex="-1"></a>\frac{1}{\hat{e}} &amp; \text{if } A = 1 <span class="sc">\\</span></span>
<span id="cb10-917"><a href="#cb10-917" aria-hidden="true" tabindex="-1"></a>\frac{1}{1-\hat{e}} &amp; \text{if } A = 0 </span>
<span id="cb10-918"><a href="#cb10-918" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb10-919"><a href="#cb10-919" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-920"><a href="#cb10-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-921"><a href="#cb10-921" aria-hidden="true" tabindex="-1"></a>**Step 2** Fit a weighted outcome model. Using the weights calculated from the estimated propensity scores, fit a model for the outcome $Y$, conditional on the exposure $A$, covariates $L$, and subgroup $G$.</span>
<span id="cb10-922"><a href="#cb10-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-923"><a href="#cb10-923" aria-hidden="true" tabindex="-1"></a>$$ \hat{E}(Y|A, L, G; V) = f_Y(A, L, G ; \theta_Y, V) $$</span>
<span id="cb10-924"><a href="#cb10-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-925"><a href="#cb10-925" aria-hidden="true" tabindex="-1"></a>**Step 3** For each individual in each subgroup, simulate their potential outcome under the hypothetical scenario where everyone in the subgroup is exposed to the intervention $A=a$ regardless of their actual exposure level:</span>
<span id="cb10-926"><a href="#cb10-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-927"><a href="#cb10-927" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a)|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a,G=g; L,\hat{\theta}_Y, v</span><span class="co">]</span>$$</span>
<span id="cb10-928"><a href="#cb10-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-929"><a href="#cb10-929" aria-hidden="true" tabindex="-1"></a>And also under the hypothetical scenario where everyone in each subgroup is exposed to intervention $A=a'$:</span>
<span id="cb10-930"><a href="#cb10-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-931"><a href="#cb10-931" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a')|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a',G=g; L; \hat{\theta}_Y, v</span><span class="co">]</span>$$</span>
<span id="cb10-932"><a href="#cb10-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-933"><a href="#cb10-933" aria-hidden="true" tabindex="-1"></a>**Step 4** Estimate the average causal effect for each subgroup. Compute the estimated expected value of the potential outcomes under each intervention level for each subgroup:</span>
<span id="cb10-934"><a href="#cb10-934" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-935"><a href="#cb10-935" aria-hidden="true" tabindex="-1"></a>$$\hat{\delta}_g = \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g</span><span class="co">]</span>$$</span>
<span id="cb10-936"><a href="#cb10-936" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-937"><a href="#cb10-937" aria-hidden="true" tabindex="-1"></a>The estimated difference $\hat{\delta}_g$ represents the average causal effect of changing the exposure from level $a'$ to level $a$ within each subgroup.</span>
<span id="cb10-938"><a href="#cb10-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-939"><a href="#cb10-939" aria-hidden="true" tabindex="-1"></a>**Step 5** Compare differences in causal effects by groups. Compute the differences in the estimated causal effects between different subgroups:</span>
<span id="cb10-940"><a href="#cb10-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-941"><a href="#cb10-941" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}$$</span>
<span id="cb10-942"><a href="#cb10-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-943"><a href="#cb10-943" aria-hidden="true" tabindex="-1"></a>where,</span>
<span id="cb10-944"><a href="#cb10-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-945"><a href="#cb10-945" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \overbrace{\big( \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g</span><span class="co">]</span> \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g'</span><span class="co">]</span>- \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g'</span><span class="co">]</span>\big)}^{\hat{\delta_{g'}}}$$</span>
<span id="cb10-946"><a href="#cb10-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-947"><a href="#cb10-947" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-948"><a href="#cb10-948" aria-hidden="true" tabindex="-1"></a>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="co">[</span><span class="ot">@greifer2023</span><span class="co">]</span>.</span>
<span id="cb10-949"><a href="#cb10-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-950"><a href="#cb10-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-951"><a href="#cb10-951" aria-hidden="true" tabindex="-1"></a><span class="fu">## Appendix B: G-computation for Subgroup Analysis Estimator with Non-Additive Effects</span></span>
<span id="cb10-952"><a href="#cb10-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-953"><a href="#cb10-953" aria-hidden="true" tabindex="-1"></a>**Step 1:** Estimate the outcome model. Fit a model for the outcome $Y$, conditional on the exposure $A$, the covariates $L$, subgroup indicator $G$, and interactions between $A$ and $G$. This model can be a linear regression, logistic regression, or another statistical model. The goal is to capture the relationship between the outcome, exposure, confounders, subgroups, and their interactions.</span>
<span id="cb10-954"><a href="#cb10-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-955"><a href="#cb10-955" aria-hidden="true" tabindex="-1"></a>$$ \hat{E}(Y|A,L,G,AG) = f_Y(A,L,G,AG; \theta_Y) $$</span>
<span id="cb10-956"><a href="#cb10-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-957"><a href="#cb10-957" aria-hidden="true" tabindex="-1"></a>This equation represents the expected value of the outcome $Y$ given the exposure $A$, covariates $L$, subgroup $G$, and interaction term $AG$, as modeled by the function $f_Y$ with parameters $\theta_Y$. </span>
<span id="cb10-958"><a href="#cb10-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-959"><a href="#cb10-959" aria-hidden="true" tabindex="-1"></a>**Step 2:** Simulate potential outcomes. For each individual in each subgroup, predict their potential outcome under the intervention $A=a$ using the estimated outcome model:</span>
<span id="cb10-960"><a href="#cb10-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-961"><a href="#cb10-961" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a)|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a,L,G=g,AG=ag; \hat{\theta}_Y</span><span class="co">]</span>$$</span>
<span id="cb10-962"><a href="#cb10-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-963"><a href="#cb10-963" aria-hidden="true" tabindex="-1"></a>We also predict the potential outcome for everyone in each subgroup under the causal contrast, setting the intervention for everyone in that group to $A=a'$:</span>
<span id="cb10-964"><a href="#cb10-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-965"><a href="#cb10-965" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a')|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a',L,G=g,AG=a'g; \hat{\theta}_Y</span><span class="co">]</span>$$</span>
<span id="cb10-966"><a href="#cb10-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-967"><a href="#cb10-967" aria-hidden="true" tabindex="-1"></a>**Step 3:** Calculate the estimated difference for each subgroup $g$:</span>
<span id="cb10-968"><a href="#cb10-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-969"><a href="#cb10-969" aria-hidden="true" tabindex="-1"></a>$$\hat{\delta}_g = \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g</span><span class="co">]</span>$$</span>
<span id="cb10-970"><a href="#cb10-970" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-971"><a href="#cb10-971" aria-hidden="true" tabindex="-1"></a>**Step 4:** Compare differences in causal effects by subgroups:</span>
<span id="cb10-972"><a href="#cb10-972" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-973"><a href="#cb10-973" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}$$</span>
<span id="cb10-974"><a href="#cb10-974" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-975"><a href="#cb10-975" aria-hidden="true" tabindex="-1"></a>where,</span>
<span id="cb10-976"><a href="#cb10-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-977"><a href="#cb10-977" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \overbrace{\big( \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a^{\prime})|G=g</span><span class="co">]</span> \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}<span class="co">[</span><span class="ot">Y(a^{\prime})|G=g^{\prime}</span><span class="co">]</span>- \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g^{\prime}</span><span class="co">]</span>\big)}^{\hat{\delta_{g^{\prime}}}}$$</span>
<span id="cb10-978"><a href="#cb10-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-979"><a href="#cb10-979" aria-hidden="true" tabindex="-1"></a>This difference $\hat{\gamma}$ represents the difference in the average causal effects between the subgroups $g$ and $g'$, taking into account the interaction effect of the exposure $A$ and the subgroup $G$ on the outcome $Y$.</span>
<span id="cb10-980"><a href="#cb10-980" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-981"><a href="#cb10-981" aria-hidden="true" tabindex="-1"></a>Note that the interaction term $AG$ (or $ag$ and $a'g$ in the potential outcomes) stands for the interaction between the exposure level and the subgroup. This term is necessary to accommodate the non-additive effects in the model. As before, we must ensure that potential confounders $L$ are sufficient to control for confounding. </span>
<span id="cb10-982"><a href="#cb10-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-983"><a href="#cb10-983" aria-hidden="true" tabindex="-1"></a><span class="fu">## Appendix C: Doubly Robust Estimation for Subgroup Analysis Estimator with Interaction</span></span>
<span id="cb10-984"><a href="#cb10-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-985"><a href="#cb10-985" aria-hidden="true" tabindex="-1"></a>Again, Doubly Robust Estimation combines the strengths of both the IPTW and G-computation methods. It uses both the propensity score model and the outcome model, which makes it doubly robust: it produces unbiased estimates if either one of the models is correctly specified.</span>
<span id="cb10-986"><a href="#cb10-986" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-987"><a href="#cb10-987" aria-hidden="true" tabindex="-1"></a>**Step 1** Estimate the propensity score. The propensity score $e(L, G)$ is the conditional probability of the exposure $A = 1$, given the covariates $L$ and subgroup indicator $G$. This can be modeled using logistic regression or other suitable methods, depending on the nature of the data and the exposure.</span>
<span id="cb10-988"><a href="#cb10-988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-989"><a href="#cb10-989" aria-hidden="true" tabindex="-1"></a>$$e = P(A = 1 | L, G) = f_A(L, G; \theta_A)$$</span>
<span id="cb10-990"><a href="#cb10-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-991"><a href="#cb10-991" aria-hidden="true" tabindex="-1"></a>Here, $f_A(L, G; \theta_A)$ is a function (statistical model) that estimates the probability of the exposure $A = 1$ given covariates $L$ and subgroup $G$. Then, we calculate the weights for each individual, denoted as $v$, using the estimated propensity score:</span>
<span id="cb10-992"><a href="#cb10-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-993"><a href="#cb10-993" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-994"><a href="#cb10-994" aria-hidden="true" tabindex="-1"></a>v = </span>
<span id="cb10-995"><a href="#cb10-995" aria-hidden="true" tabindex="-1"></a>\begin{cases} </span>
<span id="cb10-996"><a href="#cb10-996" aria-hidden="true" tabindex="-1"></a>\frac{1}{\hat{e}} &amp; \text{if } A = 1 <span class="sc">\\</span></span>
<span id="cb10-997"><a href="#cb10-997" aria-hidden="true" tabindex="-1"></a>\frac{1}{1-\hat{e}} &amp; \text{if } A = 0 </span>
<span id="cb10-998"><a href="#cb10-998" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb10-999"><a href="#cb10-999" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1000"><a href="#cb10-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1001"><a href="#cb10-1001" aria-hidden="true" tabindex="-1"></a>**Step 2** Fit a weighted outcome model. Using the weights calculated from the estimated propensity scores, fit a model for the outcome $Y$, conditional on the exposure $A$, covariates $L$, subgroup $G$ and the interaction between $A$ and $G$.</span>
<span id="cb10-1002"><a href="#cb10-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1003"><a href="#cb10-1003" aria-hidden="true" tabindex="-1"></a>$$ \hat{E}(Y|A, L, G, AG; V) = f_Y(A, L, G, AG ; \theta_Y, V) $$</span>
<span id="cb10-1004"><a href="#cb10-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1005"><a href="#cb10-1005" aria-hidden="true" tabindex="-1"></a>**Step 3** For each individual in each subgroup, simulate their potential outcome under the hypothetical scenario where everyone in the subgroup is exposed to the intervention $A=a$ regardless of their actual exposure level:</span>
<span id="cb10-1006"><a href="#cb10-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1007"><a href="#cb10-1007" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a)|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a,G=g, AG=ag; L,\hat{\theta}_Y, v</span><span class="co">]</span>$$</span>
<span id="cb10-1008"><a href="#cb10-1008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1009"><a href="#cb10-1009" aria-hidden="true" tabindex="-1"></a>And also under the hypothetical scenario where everyone in each subgroup is exposed to intervention $A=a'$:</span>
<span id="cb10-1010"><a href="#cb10-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1011"><a href="#cb10-1011" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a')|G=g) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a',G=g, AG=a'g; L; \hat{\theta}_Y, v</span><span class="co">]</span>$$</span>
<span id="cb10-1012"><a href="#cb10-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1013"><a href="#cb10-1013" aria-hidden="true" tabindex="-1"></a>**Step 4** Estimate the average causal effect for each subgroup. Compute the estimated expected value of the potential outcomes under each intervention level for each subgroup:</span>
<span id="cb10-1014"><a href="#cb10-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1015"><a href="#cb10-1015" aria-hidden="true" tabindex="-1"></a>$$\hat{\delta}_g = \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g</span><span class="co">]</span>$$</span>
<span id="cb10-1016"><a href="#cb10-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1017"><a href="#cb10-1017" aria-hidden="true" tabindex="-1"></a>The estimated difference $\hat{\delta}_g$ represents the average causal effect of changing the exposure from level $a'$ to level $a$ within each subgroup.</span>
<span id="cb10-1018"><a href="#cb10-1018" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1019"><a href="#cb10-1019" aria-hidden="true" tabindex="-1"></a>**Step 5** Compare differences in causal effects by groups. Compute the differences in the estimated causal effects between different subgroups:</span>
<span id="cb10-1020"><a href="#cb10-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1021"><a href="#cb10-1021" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \hat{\delta}_g - \hat{\delta}_{g'}$$</span>
<span id="cb10-1022"><a href="#cb10-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1023"><a href="#cb10-1023" aria-hidden="true" tabindex="-1"></a>where,</span>
<span id="cb10-1024"><a href="#cb10-1024" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1025"><a href="#cb10-1025" aria-hidden="true" tabindex="-1"></a>$$\hat{\gamma} = \overbrace{\big( \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g</span><span class="co">]</span> \big)}^{\hat{\delta_g}} - \overbrace{\big(\hat{E}<span class="co">[</span><span class="ot">Y(a')|G=g'</span><span class="co">]</span>- \hat{E}<span class="co">[</span><span class="ot">Y(a)|G=g'</span><span class="co">]</span>\big)}^{\hat{\delta_{g'}}}$$</span>
<span id="cb10-1026"><a href="#cb10-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1027"><a href="#cb10-1027" aria-hidden="true" tabindex="-1"></a>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="co">[</span><span class="ot">@greifer2023</span><span class="co">]</span>.</span>
<span id="cb10-1028"><a href="#cb10-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1029"><a href="#cb10-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1030"><a href="#cb10-1030" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1031"><a href="#cb10-1031" aria-hidden="true" tabindex="-1"></a><span class="fu">## Appendix D: Marginal Structural Models for Estimating Population Average Treatment Effect with Interaction (Doubly Robust)</span></span>
<span id="cb10-1032"><a href="#cb10-1032" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1033"><a href="#cb10-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1034"><a href="#cb10-1034" aria-hidden="true" tabindex="-1"></a>Sometimes we will only wish to estimate a marginal effect. In that case.</span>
<span id="cb10-1035"><a href="#cb10-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1036"><a href="#cb10-1036" aria-hidden="true" tabindex="-1"></a>**Step 1** Estimate the propensity score. The propensity score $e(L)$ is the conditional probability of the exposure $A = 1$, given the covariates $L$ which contains the subgroup $G$. This can be modelled using logistic regression or other functions as described in @greifer2023</span>
<span id="cb10-1037"><a href="#cb10-1037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1038"><a href="#cb10-1038" aria-hidden="true" tabindex="-1"></a>$$\hat{e} = P(A = 1 | L) = f_A(L; \theta_A)$$</span>
<span id="cb10-1039"><a href="#cb10-1039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1040"><a href="#cb10-1040" aria-hidden="true" tabindex="-1"></a>Here, $f_A(L; \theta_A)$ is a function (a statistical model) that estimates the probability of the exposure $A = 1$ given covariates $L$. Then, we calculate the weights for each individual, denoted as $v$, using the estimated propensity score:</span>
<span id="cb10-1041"><a href="#cb10-1041" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1042"><a href="#cb10-1042" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1043"><a href="#cb10-1043" aria-hidden="true" tabindex="-1"></a>v = </span>
<span id="cb10-1044"><a href="#cb10-1044" aria-hidden="true" tabindex="-1"></a>\begin{cases} </span>
<span id="cb10-1045"><a href="#cb10-1045" aria-hidden="true" tabindex="-1"></a>\frac{1}{e} &amp; \text{if } A = 1 <span class="sc">\\</span></span>
<span id="cb10-1046"><a href="#cb10-1046" aria-hidden="true" tabindex="-1"></a>\frac{1}{1-e} &amp; \text{if } A = 0 </span>
<span id="cb10-1047"><a href="#cb10-1047" aria-hidden="true" tabindex="-1"></a>\end{cases}</span>
<span id="cb10-1048"><a href="#cb10-1048" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb10-1049"><a href="#cb10-1049" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1050"><a href="#cb10-1050" aria-hidden="true" tabindex="-1"></a>**Step 2** Fit a weighted outcome model. Using the weights calculated from the estimated propensity scores, fit a model for the outcome $Y$, conditional on the exposure $A$ and covariates $L$.</span>
<span id="cb10-1051"><a href="#cb10-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1052"><a href="#cb10-1052" aria-hidden="true" tabindex="-1"></a>$$ \hat{E}(Y|A, L; V) = f_Y(A, L; \theta_Y, V) $$</span>
<span id="cb10-1053"><a href="#cb10-1053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1054"><a href="#cb10-1054" aria-hidden="true" tabindex="-1"></a>This model should include terms for both the main effects of $A$ and $L$ and their interaction $AL$.</span>
<span id="cb10-1055"><a href="#cb10-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1056"><a href="#cb10-1056" aria-hidden="true" tabindex="-1"></a>**Step 3** For the entire population, simulate the potential outcome under the hypothetical scenario where everyone is exposed to the intervention $A=a$ regardless of their actual exposure level:</span>
<span id="cb10-1057"><a href="#cb10-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1058"><a href="#cb10-1058" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a)) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a; L,\hat{\theta}_Y, v</span><span class="co">]</span>$$</span>
<span id="cb10-1059"><a href="#cb10-1059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1060"><a href="#cb10-1060" aria-hidden="true" tabindex="-1"></a>And also under the hypothetical scenario where everyone is exposed to intervention $A=a'$:</span>
<span id="cb10-1061"><a href="#cb10-1061" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1062"><a href="#cb10-1062" aria-hidden="true" tabindex="-1"></a>$$\hat{E}(Y(a')) = \hat{E}<span class="co">[</span><span class="ot">Y|A=a'; L; \hat{\theta}_Y, v</span><span class="co">]</span>$$</span>
<span id="cb10-1063"><a href="#cb10-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1064"><a href="#cb10-1064" aria-hidden="true" tabindex="-1"></a>**Step 4** Estimate the average causal effect for the entire population. Compute the estimated expected value of the potential outcomes under each intervention level for the entire population:</span>
<span id="cb10-1065"><a href="#cb10-1065" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1066"><a href="#cb10-1066" aria-hidden="true" tabindex="-1"></a>$$\hat{\delta} = \hat{E}<span class="co">[</span><span class="ot">Y(a)</span><span class="co">]</span> - \hat{E}<span class="co">[</span><span class="ot">Y(a')</span><span class="co">]</span>$$</span>
<span id="cb10-1067"><a href="#cb10-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1068"><a href="#cb10-1068" aria-hidden="true" tabindex="-1"></a>The estimated difference $\hat{\delta}$ represents the average causal effect of changing the exposure from level $a'$ to level $a$ in the entire population.</span>
<span id="cb10-1069"><a href="#cb10-1069" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1070"><a href="#cb10-1070" aria-hidden="true" tabindex="-1"></a>We again use simulation-based inference methods to compute standard errors and confidence intervals <span class="co">[</span><span class="ot">@greifer2023</span><span class="co">]</span>.</span>
<span id="cb10-1071"><a href="#cb10-1071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1072"><a href="#cb10-1072" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1073"><a href="#cb10-1073" aria-hidden="true" tabindex="-1"></a><span class="fu">### Machine Learning</span></span>
<span id="cb10-1074"><a href="#cb10-1074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1075"><a href="#cb10-1075" aria-hidden="true" tabindex="-1"></a>Example from https://osf.io/cnphs</span>
<span id="cb10-1076"><a href="#cb10-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1077"><a href="#cb10-1077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1078"><a href="#cb10-1078" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; We perform statistical estimation using semi-parametric Targeted</span></span>
<span id="cb10-1079"><a href="#cb10-1079" aria-hidden="true" tabindex="-1"></a><span class="at">Learning, specifically a Targeted Minimum Loss-based Estimation (TMLE)</span></span>
<span id="cb10-1080"><a href="#cb10-1080" aria-hidden="true" tabindex="-1"></a><span class="at">estimator. TMLE is a robust method that combines machine learning</span></span>
<span id="cb10-1081"><a href="#cb10-1081" aria-hidden="true" tabindex="-1"></a><span class="at">techniques with traditional statistical models to estimate causal</span></span>
<span id="cb10-1082"><a href="#cb10-1082" aria-hidden="true" tabindex="-1"></a><span class="at">effects while providing valid statistical uncertainty measures for these</span></span>
<span id="cb10-1083"><a href="#cb10-1083" aria-hidden="true" tabindex="-1"></a><span class="at">estimates </span><span class="co">[</span><span class="ot">@van2012targeted; @van2014targeted</span><span class="co">]</span><span class="at">.</span></span>
<span id="cb10-1084"><a href="#cb10-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1085"><a href="#cb10-1085" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; TMLE operates through a two-step process that involves modelling both</span></span>
<span id="cb10-1086"><a href="#cb10-1086" aria-hidden="true" tabindex="-1"></a><span class="at">the outcome and treatment (exposure). Initially, TMLE employs machine</span></span>
<span id="cb10-1087"><a href="#cb10-1087" aria-hidden="true" tabindex="-1"></a><span class="at">learning algorithms to flexibly model the relationship between</span></span>
<span id="cb10-1088"><a href="#cb10-1088" aria-hidden="true" tabindex="-1"></a><span class="at">treatments, covariates, and outcomes. This flexibility allows TMLE to</span></span>
<span id="cb10-1089"><a href="#cb10-1089" aria-hidden="true" tabindex="-1"></a><span class="at">account for complex, high-dimensional covariate spaces</span></span>
<span id="cb10-1090"><a href="#cb10-1090" aria-hidden="true" tabindex="-1"></a><span class="at">\emph{efficiently} without imposing restrictive model assumptions;</span></span>
<span id="cb10-1091"><a href="#cb10-1091" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@vanderlaan2011; @vanderlaan2018</span><span class="co">]</span><span class="at">. The outcome of this step is a set</span></span>
<span id="cb10-1092"><a href="#cb10-1092" aria-hidden="true" tabindex="-1"></a><span class="at">of initial estimates for these relationships.</span></span>
<span id="cb10-1093"><a href="#cb10-1093" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1094"><a href="#cb10-1094" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; The second step of TMLE involves ``targeting'' these initial estimates</span></span>
<span id="cb10-1095"><a href="#cb10-1095" aria-hidden="true" tabindex="-1"></a><span class="at">by incorporating information about the observed data distribution to</span></span>
<span id="cb10-1096"><a href="#cb10-1096" aria-hidden="true" tabindex="-1"></a><span class="at">improve the accuracy of the causal effect estimate. TMLE achieves this</span></span>
<span id="cb10-1097"><a href="#cb10-1097" aria-hidden="true" tabindex="-1"></a><span class="at">precision through an iterative updating process, which adjusts the</span></span>
<span id="cb10-1098"><a href="#cb10-1098" aria-hidden="true" tabindex="-1"></a><span class="at">initial estimates towards the true causal effect. This updating process</span></span>
<span id="cb10-1099"><a href="#cb10-1099" aria-hidden="true" tabindex="-1"></a><span class="at">is guided by the efficient influence function, ensuring that the final</span></span>
<span id="cb10-1100"><a href="#cb10-1100" aria-hidden="true" tabindex="-1"></a><span class="at">TMLE estimate is as close as possible, given the measures and data, to</span></span>
<span id="cb10-1101"><a href="#cb10-1101" aria-hidden="true" tabindex="-1"></a><span class="at">the targeted causal effect while still being robust to</span></span>
<span id="cb10-1102"><a href="#cb10-1102" aria-hidden="true" tabindex="-1"></a><span class="at">model-misspecification in either the outcome or the treatment model</span></span>
<span id="cb10-1103"><a href="#cb10-1103" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@van2014discussion</span><span class="co">]</span><span class="at">.</span></span>
<span id="cb10-1104"><a href="#cb10-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1105"><a href="#cb10-1105" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Again, a central feature of TMLE is its double-robustness property. If</span></span>
<span id="cb10-1106"><a href="#cb10-1106" aria-hidden="true" tabindex="-1"></a><span class="at">either the treatment model or the outcome model is correctly specified,</span></span>
<span id="cb10-1107"><a href="#cb10-1107" aria-hidden="true" tabindex="-1"></a><span class="at">the TMLE estimator will consistently estimate the causal effect.</span></span>
<span id="cb10-1108"><a href="#cb10-1108" aria-hidden="true" tabindex="-1"></a><span class="at">Additionally, we used cross-validation to avoid over-fitting, following</span></span>
<span id="cb10-1109"><a href="#cb10-1109" aria-hidden="true" tabindex="-1"></a><span class="at">the pre-stated protocols in Bulbulia </span><span class="co">[</span><span class="ot">@bulbulia2024PRACTICAL</span><span class="co">]</span><span class="at">. The integration of TMLE</span></span>
<span id="cb10-1110"><a href="#cb10-1110" aria-hidden="true" tabindex="-1"></a><span class="at">and machine learning technologies reduces the dependence on restrictive</span></span>
<span id="cb10-1111"><a href="#cb10-1111" aria-hidden="true" tabindex="-1"></a><span class="at">modelling assumptions and introduces an additional layer of robustness.</span></span>
<span id="cb10-1112"><a href="#cb10-1112" aria-hidden="true" tabindex="-1"></a><span class="at">For further details of the specific targeted learning strategy we</span></span>
<span id="cb10-1113"><a href="#cb10-1113" aria-hidden="true" tabindex="-1"></a><span class="at">favour, see </span><span class="co">[</span><span class="ot">@duxedaz2021; @hoffman2022, @hoffman2023</span><span class="co">]</span><span class="at">. We perform estimation using the</span></span>
<span id="cb10-1114"><a href="#cb10-1114" aria-hidden="true" tabindex="-1"></a><span class="at">\texttt{lmtp} package </span><span class="co">[</span><span class="ot">@williams2021</span><span class="co">]</span><span class="at">. We used the \texttt{superlearner} library for semi-parametric estimation with the predefined libraries \texttt{SL.ranger},</span></span>
<span id="cb10-1115"><a href="#cb10-1115" aria-hidden="true" tabindex="-1"></a><span class="at">\texttt{SL.glmnet}, and \texttt{SL.xgboost} </span><span class="co">[</span><span class="ot">@xgboost2023; @polley2023; @Ranger2017</span><span class="co">]</span><span class="at">. We created graphs, tables and output reports using the \texttt{margot} package</span></span>
<span id="cb10-1116"><a href="#cb10-1116" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@margot2024</span><span class="co">]</span><span class="at">.</span></span>
<span id="cb10-1117"><a href="#cb10-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1118"><a href="#cb10-1118" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Sensitivity Analysis Using the E-value</span></span>
<span id="cb10-1119"><a href="#cb10-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1120"><a href="#cb10-1120" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; To assess the sensitivity of results to unmeasured confounding, we</span></span>
<span id="cb10-1121"><a href="#cb10-1121" aria-hidden="true" tabindex="-1"></a><span class="at">report VanderWeele and Ding's ``E-value'' in all analyses</span></span>
<span id="cb10-1122"><a href="#cb10-1122" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@vanderweele2017</span><span class="co">]</span><span class="at">. The E-value quantifies the minimum strength of association (on the risk ratio scale) that an unmeasured confounder would need to have with both the exposure</span></span>
<span id="cb10-1123"><a href="#cb10-1123" aria-hidden="true" tabindex="-1"></a><span class="at">and the outcome (after considering the measured covariates) to explain</span></span>
<span id="cb10-1124"><a href="#cb10-1124" aria-hidden="true" tabindex="-1"></a><span class="at">away the observed exposure-outcome association</span></span>
<span id="cb10-1125"><a href="#cb10-1125" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@linden2020EVALUE; @vanderweele2020</span><span class="co">]</span><span class="at">. To</span></span>
<span id="cb10-1126"><a href="#cb10-1126" aria-hidden="true" tabindex="-1"></a><span class="at">evaluate the strength of evidence, we use the bound of the E-value 95\%</span></span>
<span id="cb10-1127"><a href="#cb10-1127" aria-hidden="true" tabindex="-1"></a><span class="at">confidence interval closest to 1.</span></span>
<span id="cb10-1128"><a href="#cb10-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1129"><a href="#cb10-1129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1130"><a href="#cb10-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1131"><a href="#cb10-1131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1132"><a href="#cb10-1132" aria-hidden="true" tabindex="-1"></a><span class="fu">### Packages</span></span>
<span id="cb10-1133"><a href="#cb10-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-1136"><a href="#cb10-1136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb10-1137"><a href="#cb10-1137" aria-hidden="true" tabindex="-1"></a>report<span class="sc">::</span><span class="fu">cite_packages</span>()</span>
<span id="cb10-1138"><a href="#cb10-1138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>