<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.523">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Bulbulia">
<meta name="dcterms.date" content="2023-05-30">

<title>PSYC 434 Conducting Research Across Cultures: Trimester 1, 2023 - Measurement from a Causal Perspective</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PSYC 434 Conducting Research Across Cultures: Trimester 1, 2023</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../content/common_graphs.html">
 <span class="dropdown-text">Background: Causal Graphs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/measurement_error.qmd">
 <span class="dropdown-text">Background: Causal Graphs: Measurement Error</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/index.html">
 <span class="dropdown-text">Preliminaries</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/01-content.html">
 <span class="dropdown-text">1: Asking questions in cross-cultural psychology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/02-content.html">
 <span class="dropdown-text">2: Getting started with R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/03-content.html">
 <span class="dropdown-text">3: Lost in Translation? Measurement and Language</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/04-content.html">
 <span class="dropdown-text">4: Dealing with Data (Factor Analysis)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/05-content.html">
 <span class="dropdown-text">5: Dealing with Data (Multi-Group CFA)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/06-content.html">
 <span class="dropdown-text">6: Dealing with Data (Partial Invariance)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/07-content.html">
 <span class="dropdown-text">7: Causal Inference: Causal Graphs</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/08-content.html">
 <span class="dropdown-text">8: Causal Inference: Causal Effects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/09-content.html">
 <span class="dropdown-text">9: Causal inference: Causal Estimation I</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/10-content.html">
 <span class="dropdown-text">10: Causal Inference: Causal Estimation II</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/11-content.html">
 <span class="dropdown-text">11: Reconsidering Measurement from a Causal Perspective</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/12-content.html">
 <span class="dropdown-text">12: Template for Report</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Measurement from a Causal Perspective</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Joseph Bulbulia <a href="mailto:joseph.bulbulia@vuw.ac.nz" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-5861-2056" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Victoria University of Wellington, New Zealand
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 30, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#two-ways-of-thinking-about-measurement-in-psychometric-research." id="toc-two-ways-of-thinking-about-measurement-in-psychometric-research." class="nav-link" data-scroll-target="#two-ways-of-thinking-about-measurement-in-psychometric-research.">Two ways of thinking about measurement in psychometric research.</a>
  <ul class="collapse">
  <li><a href="#reflective-model-factor-analysis" id="toc-reflective-model-factor-analysis" class="nav-link" data-scroll-target="#reflective-model-factor-analysis">Reflective Model (Factor Analysis)</a></li>
  <li><a href="#the-formative-model-factor-analysis" id="toc-the-formative-model-factor-analysis" class="nav-link" data-scroll-target="#the-formative-model-factor-analysis">The Formative Model (Factor Analysis)</a></li>
  </ul></li>
  <li><a href="#structural-interpretation-of-the-formative-model-and-reflective-models-factor-analysis" id="toc-structural-interpretation-of-the-formative-model-and-reflective-models-factor-analysis" class="nav-link" data-scroll-target="#structural-interpretation-of-the-formative-model-and-reflective-models-factor-analysis">Structural Interpretation of the formative model and reflective models (Factor Analysis)</a></li>
  <li><a href="#problems-with-the-structural-interpretations-of-the-reflective-and-formative-factor-models." id="toc-problems-with-the-structural-interpretations-of-the-reflective-and-formative-factor-models." class="nav-link" data-scroll-target="#problems-with-the-structural-interpretations-of-the-reflective-and-formative-factor-models.">Problems with the structural interpretations of the reflective and formative factor models.</a></li>
  <li><a href="#review-of-the-theory-of-multiple-versions-of-treatment" id="toc-review-of-the-theory-of-multiple-versions-of-treatment" class="nav-link" data-scroll-target="#review-of-the-theory-of-multiple-versions-of-treatment">Review of the theory of multiple versions of treatment</a>
  <ul class="collapse">
  <li><a href="#reflective-and-formative-measurement-models-may-be-approached-as-multiple-versions-of-treatment" id="toc-reflective-and-formative-measurement-models-may-be-approached-as-multiple-versions-of-treatment" class="nav-link" data-scroll-target="#reflective-and-formative-measurement-models-may-be-approached-as-multiple-versions-of-treatment">Reflective and formative measurement models may be approached as multiple versions of treatment</a></li>
  </ul></li>
  <li><a href="#vanderweeles-model-of-reality" id="toc-vanderweeles-model-of-reality" class="nav-link" data-scroll-target="#vanderweeles-model-of-reality">VanderWeele’s model of reality</a></li>
  <li><a href="#how-theory-of-dependent-and-directed-measurement-error-might-be-usefully-employed-to-develop-a-pragmatic-responses-to-construct-measurement" id="toc-how-theory-of-dependent-and-directed-measurement-error-might-be-usefully-employed-to-develop-a-pragmatic-responses-to-construct-measurement" class="nav-link" data-scroll-target="#how-theory-of-dependent-and-directed-measurement-error-might-be-usefully-employed-to-develop-a-pragmatic-responses-to-construct-measurement">How theory of dependent and directed measurement error might be usefully employed to develop a pragmatic responses to construct measurement</a>
  <ul class="collapse">
  <li><a href="#confounding-control-by-baseline-measures-of-exposure-and-outcome-dependent-directed-measurement-error-in-three-wave-panels" id="toc-confounding-control-by-baseline-measures-of-exposure-and-outcome-dependent-directed-measurement-error-in-three-wave-panels" class="nav-link" data-scroll-target="#confounding-control-by-baseline-measures-of-exposure-and-outcome-dependent-directed-measurement-error-in-three-wave-panels">Confounding control by baseline measures of exposure and outcome: Dependent Directed Measurement Error in Three-Wave Panels</a></li>
  <li><a href="#comment-on-slow-changes" id="toc-comment-on-slow-changes" class="nav-link" data-scroll-target="#comment-on-slow-changes">Comment on slow changes</a></li>
  </ul></li>
  <li><a href="#slides" id="toc-slides" class="nav-link" data-scroll-target="#slides">Slides</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>By the end of this lecture you will:</p>
<ol type="1">
<li><p>Understand the causal assumptions implied by the factor analytic interpretation of the formative and reflective models.</p></li>
<li><p>Be able to distinguish between statistical and structural interpretations of these models.</p></li>
<li><p>Understand why Vanderweele thinks consistent causal estimation is possible using the theory of multiple versions of treatments for constructs with multiple indicators</p></li>
</ol>
</section>
<section id="two-ways-of-thinking-about-measurement-in-psychometric-research." class="level2">
<h2 class="anchored" data-anchor-id="two-ways-of-thinking-about-measurement-in-psychometric-research.">Two ways of thinking about measurement in psychometric research.</h2>
<p>In psychometric research, formative and reflective models describe the relationship between latent variables and their respective indicators. VanderWeele discusses this in the assigned reading for this week <span class="citation" data-cites="vanderweele2022">(<a href="#ref-vanderweele2022" role="doc-biblioref">Tyler J. VanderWeele 2022</a>)</span>.</p>
<section id="reflective-model-factor-analysis" class="level3">
<h3 class="anchored" data-anchor-id="reflective-model-factor-analysis">Reflective Model (Factor Analysis)</h3>
<p>In a reflective measurement model, also known as an effect indicator model, the latent variable is understood to cause the observed variables. In this model, changes in the latent variable cause changes in the observed variables. Each indicator (observed variable) is a ‘reflection’ of the latent variable. In other words, they are effects or manifestations of the latent variable. These relations are presented in <a href="#fig-dag-latent-1" class="quarto-xref">Figure&nbsp;1</a>.</p>
<p>The reflective model may be expressed:</p>
<p><span class="math display">X_i = \lambda_i \eta + \varepsilon_i</span></p>
<p>Here, <span class="math inline">X_i</span> is an observed variable (indicator), <span class="math inline">\lambda_i</span> is the factor loading for <span class="math inline">X_i</span>, <span class="math inline">\eta</span> is the latent variable, and <span class="math inline">\varepsilon_i</span> is the error term associated with <span class="math inline">X_i</span>. It is assumed that all the indicators are interchangeable and have a common cause, which is the latent variable <span class="math inline">\eta</span>.</p>
<p>In the conventional approach of factor analysis, the assumption is that a common latent variable is responsible for the correlation seen among the indicators. Thus, any fluctuation in the latent variable should immediately lead to similar changes in the indicators.These assumptions are presented in <a href="#fig-dag-latent-1" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-latent-1" class="quarto-figure quarto-figure-center anchored" width="80%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-latent-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-latent-1-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-latent-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Reflective model: assume univariate latent variable η giving rise to indicators X1…X3. Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="the-formative-model-factor-analysis" class="level3">
<h3 class="anchored" data-anchor-id="the-formative-model-factor-analysis">The Formative Model (Factor Analysis)</h3>
<p>In a formative measurement model, the observed variables are seen as causing or determining the latent variable. Here again, there is a single latent variable. However this latent variable is taken to be an effect of the underlying indicators. These relations are presented in <a href="#fig-dag-latent-formative_0" class="quarto-xref">Figure&nbsp;2</a>.</p>
<p>The formative model may be expressed:</p>
<p><span class="math display">\eta = \sum_i\lambda_i X_i + \varepsilon</span></p>
<p>In this equation, <span class="math inline">\eta</span> is the latent variable, <span class="math inline">\lambda_i</span> is the weight for <span class="math inline">X_i</span> (the observed variable), and <span class="math inline">\varepsilon</span> is the error term. The latent variable <span class="math inline">\eta</span> is a composite of the observed variables <span class="math inline">X_i</span>.</p>
<p>In the context of a formative model, correlation or interchangeability between indicators is not required. Each indicator contributes distinctively to the latent variable. As such, a modification in one indicator doesn’t automatically imply a corresponding change in the other indicators.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-latent-formative_0" class="quarto-figure quarto-figure-center anchored" width="80%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-latent-formative_0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-latent-formative_0-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-latent-formative_0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Formative model:: assume univariate latent variable from which the indicators X1…X3 give rise. Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="structural-interpretation-of-the-formative-model-and-reflective-models-factor-analysis" class="level2">
<h2 class="anchored" data-anchor-id="structural-interpretation-of-the-formative-model-and-reflective-models-factor-analysis">Structural Interpretation of the formative model and reflective models (Factor Analysis)</h2>
<blockquote class="blockquote">
<p>However, this analysis of reflective and formative models assumed that the latent η was causally efficacious. This may not be the case (VanderWeele 2022)</p>
</blockquote>
<p>VanderWeele distinguishes between statistical and structural interpretations of the equations preesented above.</p>
<ol type="1">
<li><p><strong>Statistical Model:</strong> a mathematical construct that shows how observable variables, also known as indicators, are related to latent or unseen variables. These are presented in the equations above</p></li>
<li><p><strong>Structural Model:</strong> A structural model refers to the causal assumptions or hypotheses about the relationships among variables in a statistical model. The assumptions of the factor analytic tradition are presented in <a href="#fig-dag-latent-formative_0" class="quarto-xref">Figure&nbsp;2</a> and <a href="#fig-dag-latent-1" class="quarto-xref">Figure&nbsp;1</a> are structural models.</p></li>
</ol>
<p>We have seen that the <strong>reflective model</strong> statistically implies that the observed variables (indicators) are reflections or manifestations of the latent variable, expressed as <span class="math inline">X_i = \lambda_i \eta + \varepsilon_i</span>. However, the factor analytic tradition makes the additional structural assumption that a univariate latent variable is causally efficacious and influences the observed variables, as in: <a href="#fig-structural-assumptions-reflective-model" class="quarto-xref">Figure&nbsp;3 (a)</a>.</p>
<p>We have also seen that the <strong>formative model</strong> statistically implies that the latent variable is formed or influenced by the observed variables, expressed as <span class="math inline">\eta = \sum_i\lambda_i X_i + \varepsilon</span>. However, the factor analytic tradition makes the additional assumption that the observed variables give rise to a univariate latent variable, as in <a href="#fig-dag-reflective-assumptions_note" class="quarto-xref">Figure&nbsp;3 (b)</a>.</p>
<div id="fig-latent" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-latent-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-latent" style="flex-basis: 100.0%;justify-content: center;">
<div class="cell-output-display quarto-layout-cell-subref" data-ref-parent="fig-latent">
<div id="fig-structural-assumptions-reflective-model" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-structural-assumptions-reflective-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-structural-assumptions-reflective-model-1.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-latent">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-structural-assumptions-reflective-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Reflective Model: causal assumptions. Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-latent" style="flex-basis: 100.0%;justify-content: center;">
<div class="cell-output-display quarto-layout-cell-subref" data-ref-parent="fig-latent">
<div id="fig-dag-reflective-assumptions_note" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-dag-reflective-assumptions_note-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-reflective-assumptions_note-1.png" class="img-fluid figure-img" style="width:100.0%" data-ref-parent="fig-latent">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-dag-reflective-assumptions_note-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Formative model: causal assumptions. Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p>The reflective model implies <span class="math inline">X_i = \lambda_i \eta + \varepsilon_i</span>, which factor analysts take to imply <a href="#fig-structural-assumptions-reflective-model" class="quarto-xref">Figure&nbsp;3 (a)</a>.</p>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-latent-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: The formative model implies <span class="math inline">\eta = \sum_i\lambda_i X_i + \varepsilon</span>, which factor analysts take to imply <a href="#fig-dag-reflective-assumptions_note" class="quarto-xref">Figure&nbsp;3 (b)</a>.
</figcaption>
</figure>
</div>
</section>
<section id="problems-with-the-structural-interpretations-of-the-reflective-and-formative-factor-models." class="level2">
<h2 class="anchored" data-anchor-id="problems-with-the-structural-interpretations-of-the-reflective-and-formative-factor-models.">Problems with the structural interpretations of the reflective and formative factor models.</h2>
<p>While the statistical model <span class="math inline">X_i = \lambda_i \eta + \varepsilon_i</span> aligns with <a href="#fig-structural-assumptions-reflective-model" class="quarto-xref">Figure&nbsp;3 (a)</a>, it also alings with <a href="#fig-dag-formative-assumptions-compatible" class="quarto-xref">Figure&nbsp;4</a>. Cross-sectional data, unfortunately, do not provide enough information to discern between these different structural interpretations.</p>
<p>Similarly, the statistical model <span class="math inline">\eta = \sum_i\lambda_i X_i + \varepsilon</span> agrees with <a href="#fig-dag-reflective-assumptions_note" class="quarto-xref">Figure&nbsp;3 (b)</a> but it also agrees with@fig-dag-reflectiveassumptions-compatible_again. Here too, cross-sectional data cannot decide between these two potential structural interpretations.</p>
<p>There are other, compatible structural interprestations as well. The formative and reflective conceptions of factor analysis are compatible with indicators having causal effects as shown in <span class="citation" data-cites="fig_dag_multivariate_reality_again">(<a href="#ref-fig_dag_multivariate_reality_again" role="doc-biblioref"><strong>fig_dag_multivariate_reality_again?</strong></a>)</span>. They are also compatible with a multivariate reality giving rise to multiple indicators as shown in <a href="#fig-dag-multivariate-reality-bulbulia" class="quarto-xref">Figure&nbsp;6</a>.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="1">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="cell-output-display">
<div id="fig-dag-formative-assumptions-compatible" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-formative-assumptions-compatible-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-formative-assumptions-compatible-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-formative-assumptions-compatible-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Formative model is compatible with indicators causing outcome.Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="cell-output-display">
<div id="fig-dag-reflectiveassumptions-compatible_again" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-reflectiveassumptions-compatible_again-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-reflectiveassumptions-compatible_again-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-reflectiveassumptions-compatible_again-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Reflective model is compatible with indicators causing the outcome. Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="11-content_files/figure-html/fig_dag_multivariate_reality_again-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Multivariate reality gives rise to the indicators, from which we draw our measures. Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<div class="cell-output-display">
<div id="fig-dag-multivariate-reality-bulbulia" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-multivariate-reality-bulbulia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-multivariate-reality-bulbulia-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-multivariate-reality-bulbulia-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Although we take our constructs, A, to be functions of indicators, X, such that, perhaps only one or several of the indicators are efficacious.Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p>VanderWeele’s key observation is this:</p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><strong>While cross-sectional data can provide insights into the relationships between variables, they cannot conclusively determine the causal direction of these relationships.</strong></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p>This results is worrying. The structural assumptions of factor analysis underpin nearly all psychological research. If the cross-sectional data used to derive factor structures cannot decide whether the structural interpretations of factor models are accurate, where does that leave us?</p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p>More worrying still, VanderWeele discusses several longitudinal tests for structural interpretations of univariate latent variables that do not pass.</p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p>Where does that leave us? In psychology we have heard about a replication crisis. We might describe the reliance on factor models as an aspect of a much larger, and more worrying “causal crisis” <span class="citation" data-cites="bulbulia2022">(<a href="#ref-bulbulia2022" role="doc-biblioref">Bulbulia 2022</a>)</span></p>
</div>
</div>
</div>
</section>
<section id="review-of-the-theory-of-multiple-versions-of-treatment" class="level2">
<h2 class="anchored" data-anchor-id="review-of-the-theory-of-multiple-versions-of-treatment">Review of the theory of multiple versions of treatment</h2>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="11-content_files/figure-html/fig_dag_multiple_version_treatment_dag-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Multiple Versions of treatment. Heae, A is regarded to bbe a coarseneed version of K</figcaption>
</figure>
</div>
</div>
</div>
<p>Perhaps not all is lost. VanderWeele looks to the theory of multiple versions of treatment for solace.</p>
<p>Recall, a causal effect is defined as the difference in the expected potential outcome when everyone is exposed (perhaps contrary to fact) to one level of a treatment, conditional on their levels of a confounder, with the expected potential outcome when everyone is exposed to a a different level of a treatement (perhaps contrary to fact), conditional on their levels of a counfounder.</p>
<p><span class="math display"> \delta = \sum_l \left( \mathbb{E}[Y|A=a,l] - \mathbb{E}[Y|A=a^*,l] \right) P(l)</span></p>
<p>where <span class="math inline">\delta</span> is the causal estimand on the difference scale <span class="math inline">(\mathbb{E}[Y^0 - Y^0])</span>.</p>
<p>In causal inference, the multiple versions of treatment theory allows us to handle situations where the treatment isn’t uniform, but instead has several variations. Each variation of the treatment, or “version”, can have a different impact on the outcome. Consistency is not violated because it is redefined: for each version of the treatment, the outcome under that version is equal to the observed outcome when that version is received. Put differently we may think of the indicator <span class="math inline">A</span> as corresponding to many version of the true treament <span class="math inline">K</span>. Where conditional independence holds such that there is a absence of confounding for the effect of <span class="math inline">K</span> on <span class="math inline">Y</span> given <span class="math inline">L</span>, we have: <span class="math inline">Y_k \coprod A|K,L</span>. This states conditional on <span class="math inline">L</span>, <span class="math inline">A</span> gives no information about <span class="math inline">Y</span> once <span class="math inline">K</span> and <span class="math inline">L</span> are accounted for. When <span class="math inline">Y = Y_k</span> if <span class="math inline">K = k</span> and Y<span class="math inline">_k</span> is independent of <span class="math inline">K</span>, condition on <span class="math inline">L</span>, then <span class="math inline">A</span> may be thought of as a coarsened indicator of <span class="math inline">K</span>, as shown in <span class="citation" data-cites="fig_dag_multiple_version_treatment_dag">(<a href="#ref-fig_dag_multiple_version_treatment_dag" role="doc-biblioref"><strong>fig_dag_multiple_version_treatment_dag?</strong></a>)</span>. We may estimate consistent causal effects where:</p>
<p><span class="math display"> \delta = \sum_{k,l} \mathbb{E}[Y_k|l] P(k|a,l) P(l) - \sum_{k,l} \mathbb{E}[Y_k|l] P(k|a^*,l) P(l)</span></p>
<p>The scenario represents a hypothetical randomised trial where within strata of covariates <span class="math inline">L</span>, individuals in one group receive a treatment <span class="math inline">K</span> version randomly assigned from the distribution of <span class="math inline">K</span> distribution <span class="math inline">(A = 1, L = l)</span> sub-population. Meanwhile, individuals in the other group receive a randomly assigned <span class="math inline">K</span> version from <span class="math inline">(A = 0, L = l)</span></p>
<p>This theory finds its utility in practical scenarios where treatments seldom resemble each other – we discussed the example of obesity last week (see: <span class="citation" data-cites="vanderweele2013">(<a href="#ref-vanderweele2013" role="doc-biblioref">Tyler J. VanderWeele and Hernan 2013</a>)</span>).</p>
<section id="reflective-and-formative-measurement-models-may-be-approached-as-multiple-versions-of-treatment" class="level3">
<h3 class="anchored" data-anchor-id="reflective-and-formative-measurement-models-may-be-approached-as-multiple-versions-of-treatment">Reflective and formative measurement models may be approached as multiple versions of treatment</h3>
<p>Vanderweele applies the following substitution:</p>
<p><span class="math display">\delta = \sum_{\eta,l} \mathbb{E}[Y_\eta|l] P(\eta|A=a+1,l) P(l) - \sum_{\eta,l} \mathbb{E}[Y_\eta|l] P(\eta|A=a,l) P(l)</span></p>
<p>Specifically, we substitue <span class="math inline">K</span> with <span class="math inline">\eta</span> from the previous section, and compare the measurement response <span class="math inline">A = a + 1</span> with <span class="math inline">A = a</span>. We discover that if the influence of <span class="math inline">\eta</span> on <span class="math inline">Y</span> is not confounded given <span class="math inline">L</span>, then the multiple versions of reality consistent with the reflective and formative statistical models of reality will not lead to biased estimation. <span class="math inline">\delta</span> retains its interpretability as a comparison in a hypothetical randomised trial in which the distribution of coarsened measures of <span class="math inline">\eta_A</span> are balanced within levels of the treatment, conditional on <span class="math inline">\eta_L</span>.</p>
<p>This connection between measurement and the multiple versions of treatment framework provides a hope for consistent causal inference varying reliabilities of measurement.</p>
<p>However, as with the theory of multiple treatments, we might not known how to interpret our results because we don’t know the true relationships between our measured indicators and underlying reality.</p>
<p>How can we do better?</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-multiple-version-treatment-applied-measurement" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-multiple-version-treatment-applied-measurement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-multiple-version-treatment-applied-measurement-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-multiple-version-treatment-applied-measurement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Multiple Versions of treatment applied to measuremen.Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="vanderweeles-model-of-reality" class="level2">
<h2 class="anchored" data-anchor-id="vanderweeles-model-of-reality">VanderWeele’s model of reality</h2>
<p>VanderWeele’s article concludes as follows:</p>
<blockquote class="blockquote">
<p>A preliminary outline of a more adequate approach to the construction and use of psychosocial measures might thus be summarized by the following propositions, that I have argued for in this article: (1) Traditional univariate reflective and formative models do not adequately capture the relations between the underlying causally relevant phenomena and our indicators and measures. (2) The causally relevant constituents of reality related to our constructs are almost always multidimensional, giving rise both to our indicators from which we construct measures, and also to our language and concepts, from which we can more precisely define constructs. (3) In measure construction, we ought to always specify a definition of the underlying construct, from which items are derived, and by which analytic relations of the items to the definition are made clear. (4) The presumption of a structural univariate reflective model impairs measure construction, evaluation, and use. (5) If a structural interpretation of a univariate reflective factor model is being proposed this should be formally tested, not presumed; factor analysis is not sufficient for assessing the relevant evidence. (6) Even when the causally relevant constituents of reality are multidimensional, and a univariate measure is used, we can still interpret associations with outcomes using theory for multiple versions of treatment, though the interpretation is obscured when we do not have a clear sense of what the causally relevant constituents are. (7) When data permit, examining associations item-by-item, or with conceptually related item sets, may give insight into the various facets of the construct.</p>
</blockquote>
<blockquote class="blockquote">
<p>A new integrated theory of measurement for psychosocial constructs is needed in light of these points – one that better respects the relations between our constructs, items, indicators, measures, and the underlying causally relevant phenomena. (VanderWeele 2022)</p>
</blockquote>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-multivariate-reality-complete" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-multivariate-reality-complete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-multivariate-reality-complete-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-multivariate-reality-complete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Multivariate reality gives rise to the latent variables.Figure adapted from VanderWeele: doi: 10.1097/EDE.0000000000001434
</figcaption>
</figure>
</div>
</div>
</div>
<p>This seems to me sensible. However, <a href="#fig-dag-multivariate-reality-complete" class="quarto-xref">Figure&nbsp;8</a> this is not a causal graph. The arrows to not clearly represent causal relations. It leaves me unclear about what to practically do.</p>
<p>Let’s return to the three wave many-outcomes model described in previous weeks. How should we revise this model in light of measurement theory?</p>
</section>
<section id="how-theory-of-dependent-and-directed-measurement-error-might-be-usefully-employed-to-develop-a-pragmatic-responses-to-construct-measurement" class="level2">
<h2 class="anchored" data-anchor-id="how-theory-of-dependent-and-directed-measurement-error-might-be-usefully-employed-to-develop-a-pragmatic-responses-to-construct-measurement">How theory of dependent and directed measurement error might be usefully employed to develop a pragmatic responses to construct measurement</h2>
<p>By now you are all familiar with The New Zealand Attitudes and Values Study (NZAVS),which is a national probability survey collects a wide range of information, including data on distress, exercise habits, and cultural backgrounds.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-uu-null" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-uu-null-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-uu-null-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-uu-null-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Uncorrelated non-differential measurement error does not bias estimates under the null. Note, however, we assume that L is measured with sufficient precision to block the path from A_eta –&gt; L_eta –&gt; Y_eta, which, otherwise, we would assume to be open.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Consider a study that seeks to use this dataset to investigate the effect of regular exercise on psychological distress. In contrast to previous graphs, let us allow for latent reality to affect our measurements, as well as the discrepencies between our measurements and true underlying reality. We shall use <a href="#fig-dag-uu-null" class="quarto-xref">Figure&nbsp;9</a> as our initial guide.</p>
<p>We represent the true exercise by <span class="math inline">\eta_A</span>. We represent true psychological distress by <span class="math inline">\eta_Y</span>. Let <span class="math inline">\eta_L</span> denote a persons true workload, and assume that this state of work affects both levels of excercise and psychological distress.</p>
<p>To bring the model into contact with measurement theory, Let us describe measurements of these latent true underlying realities as functions of multiple indicators: <span class="math inline">L_{f(X_1\dots X_n)}</span>, <span class="math inline">A_{f(X_1\dots X_n)}</span>, and <span class="math inline">A_{f(X_1\dots X_n)}</span>. These constructs are measured realisations of the underlying true states. We assume that the true states of these variables affect their corresponding measured states, and so draw arrows from <span class="math inline">\eta_L\rightarrow{L_{f(X_1\dots X_n)}}</span>, <span class="math inline">\eta_A\rightarrow{A_{f(X_1\dots X_n)}}</span>, <span class="math inline">\eta_Y\rightarrow{Y_{f(X_1\dots X_n)}}</span>.</p>
<p>We also assume unmeasured sources of error that affect the measurements: <span class="math inline">U_{L} \rightarrow</span> <span class="math inline">L_{f(X_1\dots X_n)}</span>, <span class="math inline">U_{A} \rightarrow</span> <span class="math inline">A_{f(X_1\dots X_n)}</span>, and <span class="math inline">U_{Y} \rightarrow</span> <span class="math inline">Y_{f(X_1\dots X_n)}</span>. That is, we allow that our measured indicators may “see as through a mirror, in darkness,” the underlying true reality they hope to capture (Corinthians 13:12). We use <span class="math inline">U_{L}</span>, <span class="math inline">U_{A}</span> and <span class="math inline">U_{Y}</span> to denote the unmeasured sources of error in the measured indicators. These are the unknown, and perhaps unknowable, darkness and mirror.</p>
<p>Allow that the true underlying reality represented by the <span class="math inline">\eta_{var}</span> may be multivariate. Similarly, allow the true underlying reality represented by <span class="math inline">\U_{var}</span> is multivariate.</p>
<p>We now have a causal diagramme that more precisely captures VanderWeele’s thinking as presented in <a href="#fig-dag-multivariate-reality-complete" class="quarto-xref">Figure&nbsp;8</a>. In our <a href="#fig-dag-uu-null" class="quarto-xref">Figure&nbsp;9</a>, we have fleshed out <span class="math inline">\mathcal{R}</span> in a way that may include natural language concepts and scientific language, or constructs, as latent realities and latent unmeasured sources of error in our constructs.</p>
<p>The utility of describing the measurement dynamics using causal graphs is apparrent. We can understand that the measured states, once conditioned upon create <em>collider biases</em> which opens path between the unmeasured sources of error and the true underlying state that gives rise to our measurements. This is depicted by a the arrows <span class="math inline">U_{var}</span> and from <span class="math inline">\eta_{var}</span> into each <span class="math inline">var_{f(X1, X2,\dots X_n)}</span></p>
<p>Notice: <strong>where true unmeasured (multivariate) psycho-physical states are related to true unmeasured (multivariate) sources of error in the measurement of those states, the very act of measurement opens pathways to confounding.</strong></p>
<p>If for each measured construct <span class="math inline">var_{f(X1, X2,\dots X_n)}</span>, the sources of error <span class="math inline">U_{var}</span> and the unmeasured consituents of reality that give rise to our measures <span class="math inline">\eta_{var}</span> are uncorrelated with other variables <span class="math inline">U\prime_{var}</span> and from <span class="math inline">\eta\prime_{var}</span> and <span class="math inline">var\prime_{f(X1, X2,\dots X_n)}</span>, our estimates may be downwardly biased toward the null. However, d-separation is preserved. Where errors are uncorrelated with true latent realities, there is no new pathway that opens information between our exposure and outcome. Consider the relations presented in <a href="#fig-dag-dep-udir-effect-confounders-3wave" class="quarto-xref">Figure&nbsp;10</a></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-dep-udir-effect-confounders-3wave" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-dep-udir-effect-confounders-3wave-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-dep-udir-effect-confounders-3wave-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-dep-udir-effect-confounders-3wave-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Measurement error opens an additional pathway to confounding if either there are correlated errors, or a directed effect of the exposure on the errors of measured outcome.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Here,</p>
<p><span class="math inline">\eta_L \rightarrow L</span>: We assume that the true workload state affects its measurement. This measurement, however, may be affected by an unmeasured error source, <span class="math inline">U_{L}</span>. Personal perceptions of workload can introduce this error. For instance, a person may perceive their workload differently based on recent personal experiences or cultural backgrounds. Additionally, unmeasured cultural influences like societal expectations of productivity could shape their responses independently of the true workload state. There may be cultural differences - Americans may verstate; the British may present effortless superiority.</p>
<p><span class="math inline">\eta_A \rightarrow A</span>: When it comes to exercise, the true state may affect the measured frequency (questions about exercise are not totally uninformative). However, this measurement is also affected by an unmeasured source of error, which we denote by <span class="math inline">U_{A}</span>. For example, a cultural shift towards valuing physical health might prompt participants toreport higher activity levels, introducing an error, <span class="math inline">U_{A}</span>.</p>
<p><span class="math inline">\eta_Y \rightarrow Y</span>: We assume questions about distress are not totally uninformative: actual distress affects the measured distress. However this measurement is subject to unmeasured error: <span class="math inline">U_{Y}</span>. For instance, an increased societal acceptance of mental health might change how distress is reported creating an error, <span class="math inline">U_{Y}</span>, in the measurement of distress. Such norms, moreover, may change over time.</p>
<p><span class="math inline">U_{L} \rightarrow L</span>, <span class="math inline">U_{A} \rightarrow A</span>, and <span class="math inline">U_{Y} \rightarrow Y</span>: These edges between the nodes indicate how each unmeasured error source can influence its corresponding measurement, leading to a discrepancy between the true state and the measured state.</p>
<p><span class="math inline">U_{L} \rightarrow U_{A}</span> and <span class="math inline">U_{L} \rightarrow U_{Y}</span>: These relationships indicate that the error in the stress measurement can correlate with those in the exercise and mood measurements. This could stem from a common cultural bias affecting how a participant self-reports across these areas.</p>
<p><span class="math inline">\eta_A \rightarrow U_{Y}</span> and <span class="math inline">\eta_L \rightarrow U_{A}</span>: These relationships indicate that the actual state of one variable can affect the error in another variable’s measurement. For example, a cultural emphasis on physical health leading to increased exercise might, in turn, affect the reporting of distress levels, causing an error, <span class="math inline">U_{Y}</span>, in the distress measurement. Similarly, if a cultural trend pushes people to work more, it might cause them to over or underestimate their exercise frequency, introducing an error, <span class="math inline">U_{A}</span>, in the exercise measurement.</p>
<section id="confounding-control-by-baseline-measures-of-exposure-and-outcome-dependent-directed-measurement-error-in-three-wave-panels" class="level3">
<h3 class="anchored" data-anchor-id="confounding-control-by-baseline-measures-of-exposure-and-outcome-dependent-directed-measurement-error-in-three-wave-panels">Confounding control by baseline measures of exposure and outcome: Dependent Directed Measurement Error in Three-Wave Panels</h3>
<ol type="1">
<li><p>We propose a three-wave panel design to control confounding. This design adjusts for baseline measurements of both exposure and the outcome.</p></li>
<li><p>Understanding this approach in the context of potential directed and correlated measurement errors gives us a clearer picture of its strengths and limitations.</p></li>
<li><p>This three-wave panel design incorporates baseline measurements of both exposure and confounders. As a result, any bias that could come from unmeasured sources of measurement errors should be uncorrelated with their baseline effects.</p></li>
<li><p>For instance, if individuals have a social desirability bias at the baseline, they would have to develop a different bias unrelated to the initial one for new bias to occur due to correlated unmeasured sources of measurement errors.</p></li>
<li><p>However, we cannot completely eliminate the possibility of such new bias development. There could also be potential new sources of bias from directed effects of the exposure on the error term of the outcome, which can often occur due to panel attrition.</p></li>
<li><p>To mitigate this risk, we adjust for panel attrition/non-response using methods like multiple imputation. We also consistently perform sensitivity analyses to detect any unanticipated bias.</p></li>
<li><p>Despite these potential challenges, it is worth noting that by including measures of both exposure and outcome at baseline, the chances of new confounding are significantly reduced.</p></li>
<li><p>Therefore, adopting this practice should be a standard procedure in multi-wave studies as it substantially minimizes the likelihood of introducing novel confounding factors.</p></li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div id="fig-dag-dep-udir-effect-confounders-3wave-new" class="quarto-figure quarto-figure-center anchored" width="100%">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dag-dep-udir-effect-confounders-3wave-new-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="11-content_files/figure-html/fig-dag-dep-udir-effect-confounders-3wave-new-1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dag-dep-udir-effect-confounders-3wave-new-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: TBA
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="comment-on-slow-changes" class="level3">
<h3 class="anchored" data-anchor-id="comment-on-slow-changes">Comment on slow changes</h3>
<p>Over long periods of time we can expect additional sources of confounding. Changes in cultural norms and attitudes can occur over the duration of a longitudinal study like the NZAVS, leading to residual confounding. For example, if there is a cultural shift towards increased acceptance of mental health issues, this might change how psychological distress is reported over time, irrespective of baseline responses.</p>
<!-- It's also important to consider that cultural influences might not be entirely captured by the survey. Factors such as societal expectations, shared beliefs, and norms within a culture could influence both exercise behaviour and distress states. These could change over time due to sociocultural shifts, and if these changes aren't accounted for, could lead to residual confounding. For example, a societal shift towards valuing physical health might encourage more exercise independently of baseline responses -->
<!-- 1.  **Baseline Measures and Cultural Differences:** The NZAVS contains data from diverse cultural backgrounds. Therefore, controlling for baseline measures of exercise and distress would also help account for cultural differences that might influence these variables at the outset. For instance, certain cultural groups might have different baseline physical activity or baseline distress states due to various socio-cultural factors. -->
<!-- 2.  **Residual Confounding and Exercise:** Let's consider the construct $\eta_{A}$, representing the true state of exercise behaviour. If we control for baseline exercise, we're adjusting for the initial state of this behaviour. However, there could still be cultural factors that impact how exercise changes over time. For instance, a cultural event or festival that significantly increases physical activity for a certain period might occur. This change might be independent of the baseline state of exercise, thus leading to residual confounding. -->
<!-- 3.  **Residual Confounding and Depression:** Similarly for $\eta_{Y}$, the true state of Depression/Anxiety. Controlling for baseline states adjusts for the initial emotional state. However, cultural factors such as societal norms or expectations about emotional expression could change over time independently of the baseline distress. These changes could result in residual confounding. For example, a significant cultural event might induce communal feelings of joy or sadness, influencing the distress state irrespective of the baseline level. -->
<!-- 4.  **Unmeasured Cultural Factors**: It's also important to consider that cultural influences might not be entirely captured by the survey. Factors such as societal expectations, shared beliefs, and norms within a culture could influence both exercise behaviour and distress states. These could change over time due to sociocultural shifts, and if these changes aren't accounted for, could lead to residual confounding. For example, a societal shift towards valuing physical health might encourage more exercise independently of baseline responses -->
<!-- 5.  **Change over time**: Finally, time itself can be a factor. Changes in cultural norms and attitudes can occur over the duration of a longitudinal study like the NZAVS. If the timing of these changes isn't aligned with the measurement times, this can also lead to residual confounding. For example, if there is a cultural shift towards increased acceptance of mental health issues, this might change how mood is reported over time, irrespective of baseline responses. -->
<!-- 6.  **Directed Measurement Error:** Consider a situation where individuals from certain cultural backgrounds might systematically under-report their physical activity due to societal norms or expectations, introducing a directed measurement error. Similarly, reporting of mood states might also be influenced by cultural perspectives on expressing emotions. These culturally influenced errors in measurement can introduce bias, even after controlling for baseline measures. -->
<!-- 7.  **Undirected Measurement Error:** Undirected errors could also occur due to random variations in understanding or interpreting survey questions across different cultures, introducing variability in the data. If these random errors correlate with the error in measuring other variables (for instance, if misunderstanding of exercise questions correlates with misunderstanding of mood questions), this can introduce bias. -->
<!-- 8.  **Correlated Errors and Cultural Differences:** The culturally influenced measurement errors ($U_{A}$, $U_{Y}$) could be correlated, as the cultural factors influencing the reporting of exercise might also influence the reporting of mood. This correlation between errors introduces further complexity and potential bias. -->
<!-- 9.  **Residual Confounding:** Despite controlling for baseline measures, there can still be residual confounding due to unmeasured cultural factors. For instance, even if we control for baseline exercise and mood, there might still be cultural factors that impact the changes in these variables over time independently of the baseline measures. -->
<!-- In short, controlling for baseline measures in the NZAVS helps to reduce some bias and account for cultural differences that influence the exposure and outcome. However, potential bias due to unmeasured confounding and measurement error, for example, if these are influenced by cultural factors, still remain. -->
<ol start="10" type="1">
<li><strong>Need for Sensitivity Analysis</strong> The Key takehome message is that we must always perform sensitivity analyses because we can never be certain that our confounding control strategy has worked.</li>
</ol>
<!-- ```{tikz} -->
<!-- #| label: fig-dag-multivariate-reality-complete-bulbulia -->
<!-- #| fig-cap: "Multivariate reality gives rise to the latent variables,if reality continues to strongly effect η at t0 ...tn, there is an open backdoor path to Y through our concepts and constructs." -->
<!-- #| out-width: 100% -->
<!-- #| echo: false -->
<!-- \usetikzlibrary{positioning} -->
<!-- \usetikzlibrary{shapes.geometric} -->
<!-- \usetikzlibrary{arrows} -->
<!-- \usetikzlibrary{decorations} -->
<!-- \tikzstyle{Arrow} = [->, thin, preaction = {decorate}] -->
<!-- \tikzset{>=latex} -->
<!-- \begin{tikzpicture}[{every node/.append style}=draw] -->
<!-- \node [rectangle, draw=white, align=left] (R) at (0, 0 ) {$\mathcal{R}$\\ -->
<!--   concepts$^{~}$\\constructs$^{~}$}; -->
<!-- \node [rectangle, draw=white] (eta0) at (3, 0 ) {$\eta^{t0}$}; -->
<!-- \node [rectangle, draw=black] (X0) at (6, 0 ) {$(X_1 \dots X_n)^{t0}$}; -->
<!-- \node [rectangle, draw=white] (eta1) at (10, 0 ) {$\eta^{t1}$}; -->
<!-- \node [rectangle, draw=black] (X1) at (12, 0 ) {$(X_1 \dots X_n)^{t1}$}; -->
<!-- \node [rectangle, draw=white] (Y) at (14, 0 ) {Y$^{t2}$}; -->
<!-- \draw [-latex, draw=red, bend left=80] (R) to (Y); -->
<!-- \draw [-latex, draw=black] (R) to (eta0); -->
<!-- \draw [-latex, draw=black, bend left, red] (R) to (eta1); -->
<!-- \draw [-latex, draw=black] (eta0) to (X0); -->
<!-- \draw [-latex, draw=black, bend right=40] (eta0) to (X1); -->
<!-- \draw [-latex, draw=black] (eta1) to (X1); -->
<!-- \draw [-latex, draw=red,dotted, bend left=40] (eta1) to (Y); -->
<!-- \end{tikzpicture} -->
<!-- ``` -->
</section>
</section>
<section id="slides" class="level2">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Slides</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-bulbulia2022" class="csl-entry" role="listitem">
Bulbulia, Joseph A. 2022. <span>“A Workflow for Causal Inference in Cross-Cultural Psychology.”</span> <em>Religion, Brain &amp; Behavior</em> 0 (0): 1–16. <a href="https://doi.org/10.1080/2153599X.2022.2070245">https://doi.org/10.1080/2153599X.2022.2070245</a>.
</div>
<div id="ref-vanderweele2022" class="csl-entry" role="listitem">
VanderWeele, Tyler J. 2022. <span>“Constructed Measures and Causal Inference: Towards a New Model of Measurement for Psychosocial Constructs.”</span> <em>Epidemiology</em> 33 (1): 141. <a href="https://doi.org/10.1097/EDE.0000000000001434">https://doi.org/10.1097/EDE.0000000000001434</a>.
</div>
<div id="ref-vanderweele2013" class="csl-entry" role="listitem">
VanderWeele, Tyler J, and Miguel A Hernan. 2013. <span>“Causal Inference Under Multiple Versions of Treatment.”</span> <em>Journal of Causal Inference</em> 1 (1): 120.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>MIT</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>