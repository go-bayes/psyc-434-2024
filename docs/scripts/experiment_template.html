<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.23">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joseph Bulbulia">

<title>PSYC 434 Conducting Research Across Cultures: Trimester 1, 2024 – experiment_template.qmd</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../site_libs/table1-1.0/table1_defaults.css" rel="stylesheet">
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">PSYC 434 Conducting Research Across Cultures: Trimester 1, 2024</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../content/course-outline.html"> 
<span class="menu-text">Course Outline</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="../content/glossary.pdf">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/course-outline.html">
 <span class="dropdown-text">Course Outline</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/01-content.html">
 <span class="dropdown-text">Week 1: Course Introduction - R (installing packages)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../content/02-content.html">
 <span class="dropdown-text">Week 2: Causal Diagrams - Elementary Structures and Rules - R (using the interface)</span></a>
  </li>  
        <li class="dropdown-header">Week 3: Causal Diagrams - Confounding Bias - R (regression/simulation)</li>
        <li class="dropdown-header">Week 4: Causal Diagrams - Interaction, Measurement Bias, Selection Bias - R (regression/simulation)</li>
        <li class="dropdown-header">Week 5: Quiz - R (regression/simulation/reporting)</li>
        <li class="dropdown-header">Week 6: Causal Inference - Key Concepts ATE - R (regression/simulation: ATE)</li>
        <li class="dropdown-header">Week 7: Causal Inference - Key Concept CATE - R (regression/simulation: ATE)</li>
        <li class="dropdown-header">Week 8: Causal Inference - Estimation of ATE and CATE - R and LaTeX</li>
        <li class="dropdown-header">Week 9: Quiz - R</li>
        <li class="dropdown-header">Week 10: Measurement Matters - Factor Analysis, CFA, MultiGroup CFA, Partial Invariance - R</li>
        <li class="dropdown-header">Week 11: Measurement + External Validity in Causal Inference - R (writing introduction/method section)</li>
        <li class="dropdown-header">Week 12: Missing Data Workflows - Quarto Documents Seminar - Workflows</li>
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">experiment_template.qmd</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Joseph Bulbulia <a href="mailto:joseph.bulbulia@vuw.ac.nz" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0000-0002-5861-2056" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Victoria University of Wellington, New Zealand
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#questions" id="toc-questions" class="nav-link active" data-scroll-target="#questions">Questions</a></li>
  <li><a href="#preliminaries-source-functions-import-data." id="toc-preliminaries-source-functions-import-data." class="nav-link" data-scroll-target="#preliminaries-source-functions-import-data.">Preliminaries: source functions, import data.</a>
  <ul class="collapse">
  <li><a href="#data-wrangling." id="toc-data-wrangling." class="nav-link" data-scroll-target="#data-wrangling.">Data Wrangling.</a></li>
  <li><a href="#cfa-for-kessler-6" id="toc-cfa-for-kessler-6" class="nav-link" data-scroll-target="#cfa-for-kessler-6">CFA for Kessler 6</a></li>
  <li><a href="#try-with-multiple-groups" id="toc-try-with-multiple-groups" class="nav-link" data-scroll-target="#try-with-multiple-groups">Try with multiple groups</a></li>
  <li><a href="#configural-invariance" id="toc-configural-invariance" class="nav-link" data-scroll-target="#configural-invariance">Configural invariance:</a></li>
  <li><a href="#metric-equivalence" id="toc-metric-equivalence" class="nav-link" data-scroll-target="#metric-equivalence">Metric Equivalence</a></li>
  <li><a href="#scalar-equivalence" id="toc-scalar-equivalence" class="nav-link" data-scroll-target="#scalar-equivalence">Scalar Equivalence</a></li>
  <li><a href="#assess-change-in-the-exposure" id="toc-assess-change-in-the-exposure" class="nav-link" data-scroll-target="#assess-change-in-the-exposure">Assess change in the exposure</a></li>
  <li><a href="#create-wide-data-frame-for-analysis" id="toc-create-wide-data-frame-for-analysis" class="nav-link" data-scroll-target="#create-wide-data-frame-for-analysis">Create wide data frame for analysis</a></li>
  </ul></li>
  <li><a href="#descriptive-table" id="toc-descriptive-table" class="nav-link" data-scroll-target="#descriptive-table">Descriptive table</a></li>
  <li><a href="#propensity-scores" id="toc-propensity-scores" class="nav-link" data-scroll-target="#propensity-scores">Propensity scores</a></li>
  <li><a href="#differences-by-subgroups" id="toc-differences-by-subgroups" class="nav-link" data-scroll-target="#differences-by-subgroups">Differences by subgroups</a></li>
  <li><a href="#depression" id="toc-depression" class="nav-link" data-scroll-target="#depression">Depression</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>Today we will do an analysis, proceeding in a step-by-step way.</p>
<p>Recall our checklist:</p>
<ol type="1">
<li>Stating the Question: Is my question clearly stated? If not, state it.</li>
<li>Relevance of the Question: Have I explained its importance? If not, explain.</li>
<li>Causality of the Question: Is my question causal? If not, refine your question.</li>
<li>Subgroup Analysis: Does my question involve a subgroup (e.g., cultural group)? If not, develop a subgroup analysis question.</li>
</ol>
<section id="questions" class="level2">
<h2 class="anchored" data-anchor-id="questions">Questions</h2>
<p>Question 1. Does exercise affect anxiety/depression?</p>
<p>Question 2: Do these effects vary among NZ Europeans and Māori?</p>
<p>Are these questions clearly stated? No, they are vague:</p>
<ul>
<li>How much exercise?</li>
<li>By which measures of depression?</li>
<li>When should the effects be observed?</li>
</ul>
<p>Recall we can help to clarify these questions by attempting to emulate an experiment.</p>
<p>We shall use the measure of exercise in the NZAVS: hours of activity per week (we shall see, the question remains vague).</p>
<p>We will assess the 1-year effect on Kessler-6 depression after initiating a change in exercise (intention-to-treat).</p>
<p>We will investigate effect-modification by NZ European and Māori ethnic identification.</p>
</section>
<section id="preliminaries-source-functions-import-data." class="level2">
<h2 class="anchored" data-anchor-id="preliminaries-source-functions-import-data.">Preliminaries: source functions, import data.</h2>
<p>We source our functions, load libraries, and important our (synthetic) data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PSYCH 434: Example script for assessment 3 and 5.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Before running this source code, make sure to update to the current version of R, and to update all existing packages.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/libs2.R"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/funs.R"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">WARNING</span><span class="co">:  COMMENT THIS OUT. JB DOES THIS FOR WORKING WITHOUT WIFI</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"/Users/joseph/GIT/templates/functions/experimental_funs.R"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="do">############## ############## ############## ############## ############## ############## ############## ########</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="do">#########  ############## ############## IMPORT DATA ##############  ############## ############## ##############</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">############## ############## ############## ############## ############## ############## ############## ########</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#  If you haven't already, you should have created a folder called "data", in your Rstudio project. If not, download this file, add it to your the folder called "data" in your Rstudio project. # "https://www.dropbox.com/s/vwqijg4ha17hbs1/nzavs_dat_synth_t10_t12?dl=0"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># A function we will use for our tables. </span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>tab_ate_subgroup_rd <span class="ot">&lt;-</span> <span class="cf">function</span>(x,</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                                new_name,</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">delta =</span> <span class="dv">1</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                                <span class="at">sd =</span> <span class="dv">1</span>) {</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if required packages are installed</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"EValue"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  new_packages <span class="ot">&lt;-</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    required_packages[<span class="sc">!</span>(required_packages <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[, <span class="st">"Package"</span>])]</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(new_packages))</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Missing packages: "</span>, <span class="fu">paste</span>(new_packages, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(EValue)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(dplyr)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check if input data is a dataframe</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.data.frame</span>(x))</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Input x must be a dataframe"</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if required columns are in the dataframe</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"lower_ci"</span>, <span class="st">"upper_ci"</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  missing_cols <span class="ot">&lt;-</span> required_cols[<span class="sc">!</span>(required_cols <span class="sc">%in%</span> <span class="fu">colnames</span>(x))]</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing_cols) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Missing columns in dataframe: "</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste</span>(missing_cols, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if lower_ci and upper_ci do not contain NA values</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(x<span class="sc">$</span>lower_ci), <span class="fu">is.na</span>(x<span class="sc">$</span>upper_ci)))</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Columns 'lower_ci' and 'upper_ci' should not contain NA values"</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">"E[Y(1)]-E[Y(0)]"</span> <span class="ot">=</span> estimate)</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>standard_error <span class="ot">&lt;-</span> <span class="fu">abs</span>(x<span class="sc">$</span>lower_ci <span class="sc">-</span> x<span class="sc">$</span>upper_ci) <span class="sc">/</span> <span class="fl">3.92</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  evalues_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(x)), <span class="cf">function</span>(i) {</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    row_evalue <span class="ot">&lt;-</span> EValue<span class="sc">::</span><span class="fu">evalues.OLS</span>(</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>      x[i, <span class="st">"E[Y(1)]-E[Y(0)]"</span>],</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">se =</span> x[i, <span class="st">"standard_error"</span>],</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd =</span> sd,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta =</span> delta,</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>      <span class="at">true =</span> <span class="dv">0</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If E_value is NA, set it to 1</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(row_evalue[<span class="dv">2</span>, <span class="st">"lower"</span>])) {</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>      row_evalue[<span class="dv">2</span>, <span class="st">"lower"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(row_evalue[<span class="dv">2</span>, <span class="st">"upper"</span>])) {</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>      row_evalue[<span class="dv">2</span>, <span class="st">"upper"</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="fu">round</span>(<span class="fu">as.data.frame</span>(row_evalue)[<span class="dv">2</span>,], <span class="dv">3</span>)) <span class="co"># exclude the NA column</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>  evalues_df <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, evalues_list)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(evalues_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"E_Value"</span>, <span class="st">"E_Val_bound"</span>)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>  tab_p <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x, evalues_df)</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  tab <span class="ot">&lt;-</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    tab_p <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">c</span>(</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>      <span class="st">"E[Y(1)]-E[Y(0)]"</span>,</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>      <span class="st">"lower_ci"</span>,</span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>      <span class="st">"upper_ci"</span>,</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>      <span class="st">"E_Value"</span>,</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>      <span class="st">"E_Val_bound"</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(tab)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This will read the synthetic data into Rstudio.  Note that the arrow package allows us to have lower memory demands in the storage and retrieval of data.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>nzavs_synth <span class="ot">&lt;-</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  arrow<span class="sc">::</span><span class="fu">read_parquet</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"nzavs_dat_synth_t10_t12"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we will inspect column names.</p>
<p>Make sure to familiarise your self with the variable names <a href="https://github.com/go-bayes/psych-434-2023/blob/main/data/readme.qmd">here</a></p>
<p>It’s a good idea to plot the data</p>
<section id="data-wrangling." class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling.">Data Wrangling.</h3>
<p>Next, we’ll get the data into shape.</p>
<p>Consider the following causal questions: “Does exercise affect well-being?” “Do such effects, if they exist, differ by ethnicity?”</p>
<p>These questions are not precise. What type of excercise? How regularly must one exercise? For how long must one exercise? Which ethnicities shall we compare? Why?</p>
<p>It helpst to think like an experimentalist… (say more)</p>
<p>In this exampe, we’ll do the following:</p>
<ol type="1">
<li>Create a Kessler 6 average score</li>
<li>Create a Kessler 6 sum score</li>
<li>Create a Kessler 6 binary score (Not Depressed vs.&nbsp;Moderately or Severely Depressed)</li>
<li>Create a log Exercise score</li>
<li>Create a coarsened Exercise score.</li>
</ol>
<p>Consider: the NZAVS asks participants the following question. During the past week, list “Hours spent exercising/physical activity.” The question is inherently unclear about what sort of physical activity someone is doing. When participants respond to this question, what do they mean? John considers anything that is not sleep to be physical activity. He returns a high number. Jane only counts aerobic exercise. For Jane, walking an hour to work and back doesn’t count.</p>
<p>Recall that an assumption of causal inference is consistency. (Say more … then leave to the side.)</p>
<p>For now, let’s create the indicators.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create sum score of kessler 6</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dt_start <span class="ot">&lt;-</span> nzavs_synth <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kessler_6  =</span> <span class="fu">mean</span>(</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Specify the Kessler scale items</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      kessler_depressed,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="co"># During the last 30 days, how often did you feel so depressed that nothing could cheer you up?</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>      kessler_hopeless,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># During the last 30 days, how often did you feel hopeless?</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>      kessler_nervous,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>      <span class="co"># During the last 30 days, how often did you feel nervous?</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      kessler_effort,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># During the last 30 days, how often did you feel that everything was an effort?</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      kessler_restless,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># During the last 30 days, how often did you feel restless or fidgety ?</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>      kessler_worthless  <span class="co"># During the last 30 days, how often did you feel worthless?</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    )))) <span class="sc">|&gt;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kessler_6_sum =</span> <span class="fu">round</span>(</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">c</span> (kessler_depressed,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>                   kessler_hopeless,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                   kessler_nervous,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>                   kessler_effort,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                   kessler_restless,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>                   kessler_worthless)),</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">0</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a categorical variable 'kessler_6_coarsen' based on the sum of Kessler scale items</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">kessler_6_coarsen =</span> <span class="fu">cut</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>      kessler_6_sum,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">24</span>),</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">"not_depressed"</span>,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">"mildly_to_severely_depressed"</span>),</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">include.lowest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">include.highest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">right =</span> <span class="cn">FALSE</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform 'hours_exercise' by applying the log function to compress its scale</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hours_exercise_log =</span> <span class="fu">log</span>(hours_exercise <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">|&gt;</span> <span class="co"># Add 1 to avoid undefined log(0). Hours spent exercising/physical activity</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Coarsen 'hours_exercise' into categories</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">hours_exercise_coarsen =</span> <span class="fu">cut</span>(</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>      hours_exercise,</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Hours spent exercising/ physical activity</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">200</span>),</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>        <span class="st">"inactive"</span>,</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>        <span class="st">"active"</span>,</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>        <span class="st">"very_active"</span>      ),</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Define thresholds for categories</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"(-1,2]"</span>, <span class="st">"(2,8]"</span>, <span class="st">"(8,200]"</span>),</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>      <span class="at">ordered =</span> <span class="cn">TRUE</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a binary 'urban' variable based on the 'rural_gch2018' variable</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">urban =</span> <span class="fu">factor</span>(</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>      rural_gch2018 <span class="sc">==</span> <span class="st">"medium_urban_accessibility"</span> <span class="sc">|</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Define urban condition</span></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>        rural_gch2018 <span class="sc">==</span> <span class="st">"high_urban_accessibility"</span>,</span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>      <span class="st">"urban"</span>,</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Label 'urban' if condition is met</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>      <span class="st">"rural"</span>  <span class="co"># Label 'rural' if condition is not met</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We next do some data checks. I will leave you to do these in your own time.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># do some checks</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>( dt_start<span class="sc">$</span>hours_exercise)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">min</span>( dt_start<span class="sc">$</span>hours_exercise)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># checks</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">is.na</span>(dt_start<span class="sc">$</span>kessler_6_coarsen))</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="fu">is.na</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># justification for transforming exercise" has a very long tail</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt_start<span class="sc">$</span>hours_exercise, <span class="at">breaks =</span> <span class="dv">1000</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># consider only those cases below &lt; or = to 20</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">subset</span>(dt_start, hours_exercise <span class="sc">&lt;=</span> <span class="dv">20</span>)<span class="sc">$</span>hours_exercise)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect kessler 6</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt_start<span class="sc">$</span>kessler_6_coarsen)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>( <span class="fu">as.numeric</span>(dt_start<span class="sc">$</span>kessler_6_coarsen) )</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>( <span class="fu">as.numeric</span>(dt_start<span class="sc">$</span>hours_exercise_coarsen))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="cfa-for-kessler-6" class="level3">
<h3 class="anchored" data-anchor-id="cfa-for-kessler-6">CFA for Kessler 6</h3>
<p>We have learned how to do confirmatory factor analysis. Let’s put this knowledge to use, and consider whether Kessler 6 is one variable.</p>
<p>The code below will:</p>
<ul>
<li>Load required packages.</li>
<li>Select the Kessler 6 items</li>
<li>Check whether there is sufficient correlation among the variables to support factor analysis.</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppose we have reason to think Kessler 6 isn't one thing.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's put our factor analysis skills to work</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we will use the paramters and see packages for R (part of the Easystats suite)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for efa/cfa</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(psych)) {</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"psych"</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"psych"</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: psych</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for reporting</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(parameters)) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"parameters"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"parameters"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for graphing</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(see)) {</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"see"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"see"</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: see</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for graphing</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(lavaan)) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"lavaan"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"lavaan"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lavaan</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is lavaan 0.6-16
lavaan is FREE software! Please report any bugs.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for graphing</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(datawizard)) {</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"datawizard"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(<span class="st">"datawizard"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: datawizard</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select the columns we need. </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>dt_only_k6 <span class="ot">&lt;-</span> dt_start <span class="sc">|&gt;</span> <span class="fu">select</span>(kessler_depressed, kessler_effort,kessler_hopeless,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                 kessler_worthless, kessler_nervous,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                 kessler_restless)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># check factor structure</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>performance<span class="sc">::</span><span class="fu">check_factorstructure</span>(dt_only_k6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Is the data suitable for Factor Analysis?


  - Sphericity: Bartlett's test of sphericity suggests that there is sufficient significant correlation in the data for factor analysis (Chisq(15) = 70564.23, p &lt; .001).
  - KMO: The Kaiser, Meyer, Olkin (KMO) overall measure of sampling adequacy suggests that data seems appropriate for factor analysis (KMO = 0.86). The individual KMO scores are: kessler_depressed (0.83), kessler_effort (0.89), kessler_hopeless (0.85), kessler_worthless (0.85), kessler_nervous (0.88), kessler_restless (0.85).</code></pre>
</div>
</div>
<p>The code below will allow us to explore the factor structure, on the assumption of n = 3 factors.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># exploratory factor analysis</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># explore a factor structure made of 3 latent variables</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>efa <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">fa</span>(dt_only_k6, <span class="at">nfactors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">model_parameters</span>(<span class="at">sort =</span> <span class="cn">TRUE</span>, <span class="at">threshold =</span> <span class="st">"max"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: GPArotation</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>efa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Rotated loadings from Factor Analysis (oblimin-rotation)

Variable          | MR1  | MR2  | MR3  | Complexity | Uniqueness
----------------------------------------------------------------
kessler_depressed | 0.85 |      |      |    1.01    |    0.33   
kessler_worthless | 0.79 |      |      |    1.00    |    0.35   
kessler_hopeless  | 0.75 |      |      |    1.02    |    0.33   
kessler_nervous   |      | 1.00 |      |    1.00    |  5.00e-03 
kessler_restless  |      |      | 0.69 |    1.02    |    0.52   
kessler_effort    |      |      | 0.48 |    1.66    |    0.50   

The 3 latent factors (oblimin rotation) accounted for 66.05% of the total variance of the original data (MR1 = 35.14%, MR2 = 17.17%, MR3 = 13.73%).</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This output presents the results of an exploratory factor analysis (EFA), a statistical method used to discover the underlying structure of a relatively large set of variables. It's often used when you don't have a specific hypothesis about what latent factors (unobservable variables) might be influencing the observed variables in your dataset.</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># In this analysis, we've requested three factors (latent variables), and the table presents the loadings of each observed variable on each of these factors. The loadings can be interpreted as the correlations between the observed variables and the latent factors.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Here's how to interpret the output:</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   The variables kessler_depressed, kessler_worthless, and kessler_hopeless load strongly on the first latent factor (MR1), and do not significantly load on the other two. This suggests that these three variables share some common underlying factor.</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The variable kessler_nervous loads exclusively on the second latent factor (MR2), suggesting it might represent a different latent construct.</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># The variables kessler_restless and kessler_effort load on the third latent factor (MR3), which could represent yet another underlying construct.</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># The "Complexity" column indicates the complexity of each item. Complexity 1 indicates that the item is influenced mostly by a single factor.</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="co"># The "Uniqueness" column represents the proportion of variance in each variable that is not explained by the factors. For example, the uniqueness of kessler_depressed is 0.33, which means that 33% of the variance in this variable is not accounted for by the three factors.</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastly, the total variance explained by the three latent factors is 66.05%, with MR1 explaining 35.14%, MR2 explaining 17.17%, and MR3 explaining 13.73%. This indicates that about two-thirds of the variance in the six observed variables can be explained by the three latent factors extracted in the analysis.</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># fa -- there is no agreed method!</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="co"># method of agreement:</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">n_factors</span>(dt_only_k6)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # summary</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># as.data.frame(n)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot of smmary</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(n) <span class="sc">+</span> <span class="fu">theme_modern</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="experiment_template_files/figure-html/plot_factors-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## CFA</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next try a CFA</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first partition the data </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>part_data <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">data_partition</span>(dt_only_k6, <span class="at">traing_proportion =</span> .<span class="dv">07</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> part_data<span class="sc">$</span>p_0<span class="fl">.7</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> part_data<span class="sc">$</span>test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|label: cfa_all</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># one factor</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>structure_k6_one <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">fa</span>(training, <span class="at">nfactors =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">efa_to_cfa</span>()</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># two factor model</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>structure_k6_two <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">fa</span>(training, <span class="at">nfactors =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">efa_to_cfa</span>()</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># three structure model</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>structure_k6_three <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">fa</span>(training, <span class="at">nfactors =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">efa_to_cfa</span>()</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect models</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>structure_k6_one</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Latent variables
MR1 =~ kessler_depressed + kessler_effort + kessler_hopeless + kessler_worthless + kessler_nervous + kessler_restless + .row_id</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>structure_k6_two</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Latent variables
MR1 =~ kessler_depressed + kessler_hopeless + kessler_worthless
MR2 =~ kessler_effort + kessler_nervous + kessler_restless + .row_id</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>structure_k6_three</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Latent variables
MR1 =~ kessler_depressed + kessler_effort + kessler_hopeless + kessler_worthless
MR2 =~ kessler_restless
MR3 =~ kessler_nervous + .row_id</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit and compare models</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>one_latent <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_one, <span class="at">data =</span> test))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>two_latents <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_two, <span class="at">data =</span> test))</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>three_latents <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_three, <span class="at">data =</span> test))</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>compare <span class="ot">&lt;-</span> performance<span class="sc">::</span><span class="fu">compare_performance</span>(one_latent, two_latents, three_latents, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># view as html table</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(compare)<span class="sc">|&gt;</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Chi2</th>
<th style="text-align: right;">Chi2_df</th>
<th style="text-align: right;">p_Chi2</th>
<th style="text-align: right;">Baseline</th>
<th style="text-align: right;">Baseline_df</th>
<th style="text-align: right;">p_Baseline</th>
<th style="text-align: right;">GFI</th>
<th style="text-align: right;">AGFI</th>
<th style="text-align: right;">NFI</th>
<th style="text-align: right;">NNFI</th>
<th style="text-align: right;">CFI</th>
<th style="text-align: right;">RMSEA</th>
<th style="text-align: right;">RMSEA_CI_low</th>
<th style="text-align: right;">RMSEA_CI_high</th>
<th style="text-align: right;">p_RMSEA</th>
<th style="text-align: right;">RMR</th>
<th style="text-align: right;">SRMR</th>
<th style="text-align: right;">RFI</th>
<th style="text-align: right;">PNFI</th>
<th style="text-align: right;">IFI</th>
<th style="text-align: right;">RNI</th>
<th style="text-align: right;">Loglikelihood</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">AIC_wt</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">BIC_wt</th>
<th style="text-align: right;">BIC_adjusted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">one_latent</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">1359.7168</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">159746.19</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9533955</td>
<td style="text-align: right;">0.9067909</td>
<td style="text-align: right;">0.9914883</td>
<td style="text-align: right;">0.9873622</td>
<td style="text-align: right;">0.9915748</td>
<td style="text-align: right;">0.1033455</td>
<td style="text-align: right;">0.0987385</td>
<td style="text-align: right;">0.1080285</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">36.00334</td>
<td style="text-align: right;">0.0493327</td>
<td style="text-align: right;">0.9872324</td>
<td style="text-align: right;">0.6609922</td>
<td style="text-align: right;">0.9915752</td>
<td style="text-align: right;">0.9915748</td>
<td style="text-align: right;">-151483.7</td>
<td style="text-align: right;">302995.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">303094.8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">303050.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">two_latents</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">317.9709</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">30915.75</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9900793</td>
<td style="text-align: right;">0.9786322</td>
<td style="text-align: right;">0.9897149</td>
<td style="text-align: right;">0.9840541</td>
<td style="text-align: right;">0.9901287</td>
<td style="text-align: right;">0.0510548</td>
<td style="text-align: right;">0.0462789</td>
<td style="text-align: right;">0.0559908</td>
<td style="text-align: right;">0.3499758</td>
<td style="text-align: right;">36.31236</td>
<td style="text-align: right;">0.0226983</td>
<td style="text-align: right;">0.9833856</td>
<td style="text-align: right;">0.6126807</td>
<td style="text-align: right;">0.9901313</td>
<td style="text-align: right;">0.9901287</td>
<td style="text-align: right;">-150962.8</td>
<td style="text-align: right;">301955.6</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">302062.2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">302014.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">three_latents</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">747.8723</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20903.30</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9763317</td>
<td style="text-align: right;">0.9447739</td>
<td style="text-align: right;">0.9642223</td>
<td style="text-align: right;">0.9383317</td>
<td style="text-align: right;">0.9647609</td>
<td style="text-align: right;">0.0825447</td>
<td style="text-align: right;">0.0775761</td>
<td style="text-align: right;">0.0876237</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">37.13824</td>
<td style="text-align: right;">0.0377955</td>
<td style="text-align: right;">0.9373890</td>
<td style="text-align: right;">0.5509842</td>
<td style="text-align: right;">0.9647761</td>
<td style="text-align: right;">0.9647609</td>
<td style="text-align: right;">-151177.7</td>
<td style="text-align: right;">302387.5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">302501.2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">302450.3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This table provides the results of three different Confirmatory Factor Analysis (CFA) models: one that specifies a single latent factor, one that specifies two latent factors, and one that specifies three latent factors. The results include a number of goodness-of-fit statistics, which can be used to assess how well each model fits the data.</p>
<section id="one_latent-model-this-model-assumes-that-there-is-only-one-underlying-latent-factor-contributing-to-all-variables.-this-model-has-a-chi-square-statistic-of-1359.7-with-14-degrees-of-freedom-which-is-highly-significant-p0.001-indicating-a-poor-fit-of-the-model-to-the-data.-other-goodness-of-fit-indices-like-gfi-agfi-nfi-nnfi-and-cfi-are-all-high-above-0.9-generally-indicating-good-fit-but-these-indices-can-be-misleading-in-the-presence-of-large-sample-sizes.-rmsea-is-above-0.1-which-indicates-a-poor-fit.-the-srmr-is-less-than-0.08-which-suggests-a-good-fit-but-given-the-high-chi-square-and-rmsea-values-we-cant-solely-rely-on-this-index.-the-akaike-information-criterion-aic-bayesian-information-criterion-bic-and-adjusted-bic-are-used-for-comparing-models-with-lower-values-indicating-better-fit." class="level4">
<h4 class="anchored" data-anchor-id="one_latent-model-this-model-assumes-that-there-is-only-one-underlying-latent-factor-contributing-to-all-variables.-this-model-has-a-chi-square-statistic-of-1359.7-with-14-degrees-of-freedom-which-is-highly-significant-p0.001-indicating-a-poor-fit-of-the-model-to-the-data.-other-goodness-of-fit-indices-like-gfi-agfi-nfi-nnfi-and-cfi-are-all-high-above-0.9-generally-indicating-good-fit-but-these-indices-can-be-misleading-in-the-presence-of-large-sample-sizes.-rmsea-is-above-0.1-which-indicates-a-poor-fit.-the-srmr-is-less-than-0.08-which-suggests-a-good-fit-but-given-the-high-chi-square-and-rmsea-values-we-cant-solely-rely-on-this-index.-the-akaike-information-criterion-aic-bayesian-information-criterion-bic-and-adjusted-bic-are-used-for-comparing-models-with-lower-values-indicating-better-fit.">One_latent Model: This model assumes that there is only one underlying latent factor contributing to all variables. This model has a chi-square statistic of 1359.7 with 14 degrees of freedom, which is highly significant (p&lt;0.001), indicating a poor fit of the model to the data. Other goodness-of-fit indices like GFI, AGFI, NFI, NNFI, and CFI are all high (above 0.9), generally indicating good fit, but these indices can be misleading in the presence of large sample sizes. RMSEA is above 0.1 which indicates a poor fit. The SRMR is less than 0.08 which suggests a good fit, but given the high Chi-square and RMSEA values, we can’t solely rely on this index. The Akaike information criterion (AIC), Bayesian information criterion (BIC) and adjusted BIC are used for comparing models, with lower values indicating better fit.</h4>
</section>
<section id="two_latents-model-this-model-assumes-that-there-are-two-underlying-latent-factors.-the-chi-square-statistic-is-lower-than-the-one-factor-model-317.97-with-13-df-suggesting-a-better-fit.-the-p-value-is-still-less-than-0.05-indicating-a-statistically-significant-chi-square-which-typically-suggests-a-poor-fit.-however-all-other-fit-indices-gfi-agfi-nfi-nnfi-and-cfi-are-above-0.9-and-the-rmsea-is-0.051-which-generally-indicate-good-fit.-the-srmr-is-also-less-than-0.08-which-suggests-a-good-fit.-this-model-has-the-lowest-aic-and-bic-values-among-the-three-models-indicating-the-best-fit-according-to-these-criteria." class="level4">
<h4 class="anchored" data-anchor-id="two_latents-model-this-model-assumes-that-there-are-two-underlying-latent-factors.-the-chi-square-statistic-is-lower-than-the-one-factor-model-317.97-with-13-df-suggesting-a-better-fit.-the-p-value-is-still-less-than-0.05-indicating-a-statistically-significant-chi-square-which-typically-suggests-a-poor-fit.-however-all-other-fit-indices-gfi-agfi-nfi-nnfi-and-cfi-are-above-0.9-and-the-rmsea-is-0.051-which-generally-indicate-good-fit.-the-srmr-is-also-less-than-0.08-which-suggests-a-good-fit.-this-model-has-the-lowest-aic-and-bic-values-among-the-three-models-indicating-the-best-fit-according-to-these-criteria.">Two_latents Model: This model assumes that there are two underlying latent factors. The chi-square statistic is lower than the one-factor model (317.97 with 13 df), suggesting a better fit. The p-value is still less than 0.05, indicating a statistically significant chi-square, which typically suggests a poor fit. However, all other fit indices (GFI, AGFI, NFI, NNFI, and CFI) are above 0.9 and the RMSEA is 0.051, which generally indicate good fit. The SRMR is also less than 0.08 which suggests a good fit. This model has the lowest AIC and BIC values among the three models, indicating the best fit according to these criteria.</h4>
</section>
<section id="three_latents-model-this-model-assumes-three-underlying-latent-factors.-the-chi-square-statistic-is-747.87-with-12-df-higher-than-the-two-factor-model-suggesting-a-worse-fit-to-the-data.-other-fit-indices-such-as-gfi-agfi-nfi-nnfi-and-cfi-are-below-0.97-and-the-rmsea-is-0.083-which-generally-indicate-acceptable-but-not-excellent-fit.-the-srmr-is-less-than-0.08-which-suggests-a-good-fit.-the-aic-and-bic-values-are-higher-than-the-two-factor-model-but-lower-than-the-one-factor-model-indicating-a-fit-that-is-better-than-the-one-factor-model-but-worse-than-the-two-factor-model." class="level4">
<h4 class="anchored" data-anchor-id="three_latents-model-this-model-assumes-three-underlying-latent-factors.-the-chi-square-statistic-is-747.87-with-12-df-higher-than-the-two-factor-model-suggesting-a-worse-fit-to-the-data.-other-fit-indices-such-as-gfi-agfi-nfi-nnfi-and-cfi-are-below-0.97-and-the-rmsea-is-0.083-which-generally-indicate-acceptable-but-not-excellent-fit.-the-srmr-is-less-than-0.08-which-suggests-a-good-fit.-the-aic-and-bic-values-are-higher-than-the-two-factor-model-but-lower-than-the-one-factor-model-indicating-a-fit-that-is-better-than-the-one-factor-model-but-worse-than-the-two-factor-model.">Three_latents Model: This model assumes three underlying latent factors. The chi-square statistic is 747.87 with 12 df, higher than the two-factor model, suggesting a worse fit to the data. Other fit indices such as GFI, AGFI, NFI, NNFI, and CFI are below 0.97 and the RMSEA is 0.083, which generally indicate acceptable but not excellent fit. The SRMR is less than 0.08 which suggests a good fit. The AIC and BIC values are higher than the two-factor model but lower than the one-factor model, indicating a fit that is better than the one-factor model but worse than the two-factor model.</h4>
<p>Based on these results, the two-latents model seems to provide the best fit to the data among the three models, according to most of the fit indices and the AIC and BIC. Note, all models have significant chi-square statistics, which suggests some degree of misfit. It’s also important to consider the substantive interpretation of the factors, to make sure the model makes sense theoretically.</p>
</section>
</section>
<section id="try-with-multiple-groups" class="level3">
<h3 class="anchored" data-anchor-id="try-with-multiple-groups">Try with multiple groups</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select the columns we need + ethnicity</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dt_eth_k6_eth <span class="ot">&lt;-</span> dt_start <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(eth_cat <span class="sc">==</span> <span class="st">"euro"</span> <span class="sc">|</span> eth_cat <span class="sc">==</span> <span class="st">"maori"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(kessler_depressed, kessler_effort,kessler_hopeless,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                                 kessler_worthless, kessler_nervous,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                                 kessler_restless, eth_cat)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># remove ethnicity for traning data </span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># first partition the data </span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>part_data_eth <span class="ot">&lt;-</span> datawizard<span class="sc">::</span><span class="fu">data_partition</span>(dt_eth_k6_eth, <span class="at">traing_proportion =</span> .<span class="dv">07</span>, <span class="at">seed =</span> <span class="dv">123</span>, <span class="at">group =</span> <span class="st">"eth_cat"</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>training_eth <span class="ot">&lt;-</span> part_data_eth<span class="sc">$</span>p_0<span class="fl">.7</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>test_eth <span class="ot">&lt;-</span> part_data_eth<span class="sc">$</span>test</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="co"># fit and compare models for configural equivalence</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>one_latent_eth_configural <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_one, <span class="at">group =</span> <span class="st">"eth_cat"</span>, <span class="at">data =</span> test_eth))</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>two_latents_eth_configural <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_two, <span class="at">group =</span> <span class="st">"eth_cat"</span>, <span class="at">data =</span> test_eth))</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>three_latents_eth_configural <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_three, <span class="at">group =</span> <span class="st">"eth_cat"</span>, <span class="at">data =</span> test_eth))</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>compare_eth_configural <span class="ot">&lt;-</span> performance<span class="sc">::</span><span class="fu">compare_performance</span>(one_latent_eth_configural, two_latents_eth_configural, three_latents_eth_configural, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a><span class="co"># fit and compare models for metric equivalence</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>one_latent_eth_metric <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_one, <span class="at">group =</span> <span class="st">"eth_cat"</span>, <span class="at">group.equal =</span> <span class="st">"loadings"</span>, <span class="at">data =</span> test_eth))</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>two_latents_eth_metric  <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_two, <span class="at">group =</span> <span class="st">"eth_cat"</span>, <span class="at">group.equal =</span> <span class="st">"loadings"</span>, <span class="at">data =</span> test_eth))</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>three_latents_eth_metric  <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_three, <span class="at">group =</span> <span class="st">"eth_cat"</span>,<span class="at">group.equal =</span> <span class="st">"loadings"</span>, <span class="at">data =</span> test_eth))</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>compare_eth_metric  <span class="ot">&lt;-</span> performance<span class="sc">::</span><span class="fu">compare_performance</span>(one_latent_eth_metric, </span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>                                                        two_latents_eth_metric, </span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>                                                        three_latents_eth_metric, </span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a><span class="co"># fit and compare models for scalar equivalence</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>one_latent_eth_scalar <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_one, <span class="at">group =</span> <span class="st">"eth_cat"</span>, <span class="at">group.equal =</span> <span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span>), <span class="at">data =</span> test_eth))</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>two_latents_eth_scalar  <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_two, <span class="at">group =</span> <span class="st">"eth_cat"</span>, <span class="at">group.equal =</span>  <span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span>), <span class="at">data =</span> test_eth))</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>three_latents_eth_scalar  <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(lavaan<span class="sc">::</span><span class="fu">cfa</span>(structure_k6_three, <span class="at">group =</span> <span class="st">"eth_cat"</span>,<span class="at">group.equal =</span>  <span class="fu">c</span>(<span class="st">"loadings"</span>,<span class="st">"intercepts"</span>), <span class="at">data =</span> test_eth))</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>compare_eth_scalar  <span class="ot">&lt;-</span> performance<span class="sc">::</span><span class="fu">compare_performance</span>(one_latent_eth_scalar, </span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>                                                        two_latents_eth_scalar, </span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>                                                        three_latents_eth_scalar, </span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>                                                        <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Recall, in the context of measurement and factor analysis, the concepts of <em>configural</em>, <em>metric</em>, and <em>scalar invariance</em> relate to the comparability of a measurement instrument, such as a survey or test, across different groups.</p>
<p>We saw in part 1 of this course that these invariance concepts are frequently tested in the context of cross-cultural, multi-group, or longitudinal studies.</p>
<p>Let’s first define these concepts, and then apply them to the context of the Kessler 6 (K6) Distress Scale used among Maori and New Zealand Europeans.</p>
<ol type="1">
<li><strong>Configural invariance</strong> refers to the most basic level of measurement invariance, and it is established when the same pattern of factor loadings and structure is observed across groups. This means that the underlying constructs (factors) are defined the same way for different groups. This doesn’t mean the strength of relationship between items and factors (loadings) or the item means (intercepts) are the same, just that the items relate to the same factors in all groups.</li>
</ol>
<p>In the context of the K6 Distress Scale, configural invariance would suggest that the same six items are measuring the construct of psychological distress in the same way for both Māori and New Zealand Europeans, even though the strength of the relationship between the items and the construct (distress), or the average scores, might differ.</p>
<ol start="2" type="1">
<li><strong>Metric invariance</strong> (also known as “weak invariance”) refers to the assumption that factor loadings are equivalent across groups, meaning that the relationship or association between the measured items and their underlying factor is the same in all groups. This is important when comparing the strength of relationships with other variables across groups.</li>
</ol>
<p>If metric invariance holds for the K6 Distress Scale, this would mean that a unit change in the latent distress factor would correspond to the same change in each item score (e.g., feeling nervous, hopeless, restless, etc.) for both Māori and New Zealand Europeans.</p>
<ol start="3" type="1">
<li><strong>Scalar invariance</strong> (also known as “strong invariance”) involves equivalence of both factor loadings and intercepts (item means) across groups. This means that not only are the relationships between the items and the factors the same across groups (as with metric invariance), but also the zero-points or origins of the scales are the same. Scalar invariance is necessary when one wants to compare latent mean scores across groups.</li>
</ol>
<p>In the context of the K6 Distress Scale, if scalar invariance holds, it would mean that a specific score on the scale would correspond to the same level of the underlying distress factor for both Māori and New Zealand Europeans. It would mean that the groups do not differ systematically in how they interpret and respond to the items. If this holds, one can make meaningful comparisons of distress level between Maori and New Zealand Europeans based on the scale scores.</p>
<p>Note: each of these levels of invariance is a progressively stricter test of the equivalence of the measurement instrument across groups. Demonstrating scalar invariance, for example, also demonstrates configural and metric invariance. On the other hand, failure to demonstrate metric invariance means that scalar invariance also does not hold. These tests are therefore usually conducted in sequence. The results of these tests should be considered when comparing group means or examining the relationship between a scale and other variables across groups.</p>
</section>
<section id="configural-invariance" class="level3">
<h3 class="anchored" data-anchor-id="configural-invariance">Configural invariance:</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(compare_eth_configural)<span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 9%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Chi2</th>
<th style="text-align: right;">Chi2_df</th>
<th style="text-align: right;">p_Chi2</th>
<th style="text-align: right;">Baseline</th>
<th style="text-align: right;">Baseline_df</th>
<th style="text-align: right;">p_Baseline</th>
<th style="text-align: right;">GFI</th>
<th style="text-align: right;">AGFI</th>
<th style="text-align: right;">NFI</th>
<th style="text-align: right;">NNFI</th>
<th style="text-align: right;">CFI</th>
<th style="text-align: right;">RMSEA</th>
<th style="text-align: right;">RMSEA_CI_low</th>
<th style="text-align: right;">RMSEA_CI_high</th>
<th style="text-align: right;">p_RMSEA</th>
<th style="text-align: right;">RMR</th>
<th style="text-align: right;">SRMR</th>
<th style="text-align: right;">RFI</th>
<th style="text-align: right;">PNFI</th>
<th style="text-align: right;">IFI</th>
<th style="text-align: right;">RNI</th>
<th style="text-align: right;">Loglikelihood</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">AIC_wt</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">BIC_wt</th>
<th style="text-align: right;">BIC_adjusted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">one_latent_eth_configural</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">1162.4746</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">341229.17</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9831752</td>
<td style="text-align: right;">0.9579381</td>
<td style="text-align: right;">0.9965933</td>
<td style="text-align: right;">0.9949511</td>
<td style="text-align: right;">0.9966341</td>
<td style="text-align: right;">0.1027048</td>
<td style="text-align: right;">0.0977499</td>
<td style="text-align: right;">0.1077479</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">38.29915</td>
<td style="text-align: right;">0.0439380</td>
<td style="text-align: right;">0.9948899</td>
<td style="text-align: right;">0.6643955</td>
<td style="text-align: right;">0.9966342</td>
<td style="text-align: right;">0.9966341</td>
<td style="text-align: right;">-129452.1</td>
<td style="text-align: right;">258946.1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">259092.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">259025.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">two_latents_eth_configural</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">276.7703</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">42034.04</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9961916</td>
<td style="text-align: right;">0.9897467</td>
<td style="text-align: right;">0.9934156</td>
<td style="text-align: right;">0.9898581</td>
<td style="text-align: right;">0.9937217</td>
<td style="text-align: right;">0.0510782</td>
<td style="text-align: right;">0.0459383</td>
<td style="text-align: right;">0.0564019</td>
<td style="text-align: right;">0.3560216</td>
<td style="text-align: right;">34.17489</td>
<td style="text-align: right;">0.0201464</td>
<td style="text-align: right;">0.9893636</td>
<td style="text-align: right;">0.6149715</td>
<td style="text-align: right;">0.9937229</td>
<td style="text-align: right;">0.9937217</td>
<td style="text-align: right;">-129009.2</td>
<td style="text-align: right;">258062.4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">258215.5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">258145.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">three_latents_eth_configural</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">701.6287</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27397.50</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9906044</td>
<td style="text-align: right;">0.9725962</td>
<td style="text-align: right;">0.9743908</td>
<td style="text-align: right;">0.9559166</td>
<td style="text-align: right;">0.9748095</td>
<td style="text-align: right;">0.0859629</td>
<td style="text-align: right;">0.0806184</td>
<td style="text-align: right;">0.0914299</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">76.26852</td>
<td style="text-align: right;">0.0358868</td>
<td style="text-align: right;">0.9551839</td>
<td style="text-align: right;">0.5567947</td>
<td style="text-align: right;">0.9748177</td>
<td style="text-align: right;">0.9748095</td>
<td style="text-align: right;">-129221.6</td>
<td style="text-align: right;">258489.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">258649.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">258576.2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The table represents the comparison of three multi-group confirmatory factor analysis (CFA) models conducted to test for configural invariance across different ethnic categories (eth_cat). Configural invariance refers to whether the pattern of factor loadings is the same across groups. It’s the most basic form of measurement invariance.</p>
<p>Looking at the results, we can draw the following conclusions:</p>
<ol type="1">
<li><p><strong>Chi2 (Chi-square)</strong>: A lower value suggests a better model fit. In this case, the two_latents_eth_configural model exhibits the lowest Chi2 value, suggesting it has the best fit according to this metric.</p></li>
<li><p><strong>GFI (Goodness of Fit Index) and AGFI (Adjusted Goodness of Fit Index)</strong>: These values range from 0 to 1, with values closer to 1 suggesting a better fit. The two_latents_eth_configural model has the highest GFI and AGFI values, indicating it is the best fit according to these indices.</p></li>
<li><p><strong>NFI (Normed Fit Index), NNFI (Non-Normed Fit Index, also called TLI), CFI (Comparative Fit Index)</strong>: These range from 0 to 1, with values closer to 1 suggesting a better fit. The one_latent_eth_configural model has the highest values, suggesting it is the best fit according to these metrics.</p></li>
<li><p><strong>RMSEA (Root Mean Square Error of Approximation)</strong>: Lower values are better, with values below 0.05 considered good and up to 0.08 considered acceptable. In this table, the two_latents_eth_configural model has an RMSEA of 0.05, which falls within the acceptable range.</p></li>
<li><p><strong>RMR (Root Mean Square Residual) and SRMR (Standardized Root Mean Square Residual)</strong>: Lower values are better, typically less than 0.08 is considered a good fit. All models exhibit acceptable RMR and SRMR values, with the two_latents_eth_configural model having the lowest.</p></li>
<li><p><strong>RFI (Relative Fit Index), PNFI (Parsimonious Normed Fit Index), IFI (Incremental Fit Index), RNI (Relative Noncentrality Index)</strong>: These range from 0 to 1, with values closer to 1 suggesting a better fit. The one_latent_eth_configural model has the highest values, suggesting the best fit according to these measures.</p></li>
<li><p><strong>AIC (Akaike Information Criterion) and BIC (Bayesian Information Criterion)</strong>: Lower values indicate a better fit when comparing models. The two_latents_eth_configural model has the lowest AIC and BIC, suggesting it is the best fit according to these criteria.</p></li>
<li><p><strong>p_Chi2 and p_RMSEA</strong>: These are the significance levels for the Chi-square test and the RMSEA, respectively. Non-significant values (p &gt; 0.05) suggest a good fit. Only the RMSEA for the two_latents_eth_configural model is non-significant, suggesting a good fit.</p></li>
</ol>
<p>Overall, the two_latents_eth_configural model appears to provide the best fit across multiple indices, suggesting configural invariance (i.e., the same general factor structure) across ethnic categories with a two-factor solution. As with the previous assessment, theoretical soundness and other substantive considerations should also be taken into account when deciding on the final model.</p>
</section>
<section id="metric-equivalence" class="level3">
<h3 class="anchored" data-anchor-id="metric-equivalence">Metric Equivalence</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(compare_eth_metric)<span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Chi2</th>
<th style="text-align: right;">Chi2_df</th>
<th style="text-align: right;">p_Chi2</th>
<th style="text-align: right;">Baseline</th>
<th style="text-align: right;">Baseline_df</th>
<th style="text-align: right;">p_Baseline</th>
<th style="text-align: right;">GFI</th>
<th style="text-align: right;">AGFI</th>
<th style="text-align: right;">NFI</th>
<th style="text-align: right;">NNFI</th>
<th style="text-align: right;">CFI</th>
<th style="text-align: right;">RMSEA</th>
<th style="text-align: right;">RMSEA_CI_low</th>
<th style="text-align: right;">RMSEA_CI_high</th>
<th style="text-align: right;">p_RMSEA</th>
<th style="text-align: right;">RMR</th>
<th style="text-align: right;">SRMR</th>
<th style="text-align: right;">RFI</th>
<th style="text-align: right;">PNFI</th>
<th style="text-align: right;">IFI</th>
<th style="text-align: right;">RNI</th>
<th style="text-align: right;">Loglikelihood</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">AIC_wt</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">BIC_wt</th>
<th style="text-align: right;">BIC_adjusted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">one_latent_eth_metric</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">1162.4746</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">341229.17</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9831752</td>
<td style="text-align: right;">0.9579381</td>
<td style="text-align: right;">0.9965933</td>
<td style="text-align: right;">0.9949511</td>
<td style="text-align: right;">0.9966341</td>
<td style="text-align: right;">0.1027048</td>
<td style="text-align: right;">0.0977499</td>
<td style="text-align: right;">0.1077479</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">38.29915</td>
<td style="text-align: right;">0.0439380</td>
<td style="text-align: right;">0.9948899</td>
<td style="text-align: right;">0.6643955</td>
<td style="text-align: right;">0.9966342</td>
<td style="text-align: right;">0.9966341</td>
<td style="text-align: right;">-129452.1</td>
<td style="text-align: right;">258946.1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">259092.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">259025.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">two_latents_eth_metric</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">276.7703</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">42034.04</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9961916</td>
<td style="text-align: right;">0.9897467</td>
<td style="text-align: right;">0.9934156</td>
<td style="text-align: right;">0.9898581</td>
<td style="text-align: right;">0.9937217</td>
<td style="text-align: right;">0.0510782</td>
<td style="text-align: right;">0.0459383</td>
<td style="text-align: right;">0.0564019</td>
<td style="text-align: right;">0.3560216</td>
<td style="text-align: right;">34.17489</td>
<td style="text-align: right;">0.0201464</td>
<td style="text-align: right;">0.9893636</td>
<td style="text-align: right;">0.6149715</td>
<td style="text-align: right;">0.9937229</td>
<td style="text-align: right;">0.9937217</td>
<td style="text-align: right;">-129009.2</td>
<td style="text-align: right;">258062.4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">258215.5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">258145.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">three_latents_eth_metric</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">701.6287</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27397.50</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9906044</td>
<td style="text-align: right;">0.9725962</td>
<td style="text-align: right;">0.9743908</td>
<td style="text-align: right;">0.9559166</td>
<td style="text-align: right;">0.9748095</td>
<td style="text-align: right;">0.0859629</td>
<td style="text-align: right;">0.0806184</td>
<td style="text-align: right;">0.0914299</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">76.26852</td>
<td style="text-align: right;">0.0358868</td>
<td style="text-align: right;">0.9551839</td>
<td style="text-align: right;">0.5567947</td>
<td style="text-align: right;">0.9748177</td>
<td style="text-align: right;">0.9748095</td>
<td style="text-align: right;">-129221.6</td>
<td style="text-align: right;">258489.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">258649.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">258576.2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>This table presents the results of a multi-group confirmatory factor analysis (CFA) conducted to test metric equivalence (also known as measurement invariance) across different ethnic categories (eth_cat). The models (one_latent_eth_metric, two_latents_eth_metric, three_latents_eth_metric) were run with a constraint of equal factor loadings across groups, which is a requirement for metric invariance.</p>
<p>Here’s the interpretation of the fit indices:</p>
<ol type="1">
<li><p><strong>Chi2 (Chi-square)</strong>: Lower values indicate better model fit. The two_latents_eth_metric model has the lowest Chi2 value, suggesting the best fit according to this measure.</p></li>
<li><p><strong>GFI (Goodness of Fit Index), AGFI (Adjusted Goodness of Fit Index)</strong>: These range from 0 to 1, with values closer to 1 indicating a better fit. The two_latents_eth_metric model has the highest GFI and AGFI values, suggesting the best fit according to these indices.</p></li>
<li><p><strong>NFI (Normed Fit Index), NNFI (Non-Normed Fit Index, or TLI), CFI (Comparative Fit Index)</strong>: These range from 0 to 1, with values closer to 1 indicating a better fit. For these indices, the one_latent_eth_metric model has the highest values, suggesting the best fit according to these measures.</p></li>
<li><p><strong>RMSEA (Root Mean Square Error of Approximation)</strong>: Lower values are better, with values below 0.05 generally considered good, and values up to 0.08 considered acceptable. Only the two_latents_eth_metric model has an RMSEA within the acceptable range (0.051).</p></li>
<li><p><strong>RMR (Root Mean Square Residual) and SRMR (Standardized Root Mean Square Residual)</strong>: Lower values are better, typically less than 0.08 is considered a good fit. All models have acceptable RMR and SRMR values, with the two_latents_eth_metric model having the lowest, indicating the best fit.</p></li>
<li><p><strong>RFI (Relative Fit Index), PNFI (Parsimonious Normed Fit Index), IFI (Incremental Fit Index), RNI (Relative Noncentrality Index)</strong>: These range from 0 to 1, with values closer to 1 indicating better fit. The one_latent_eth_metric model has the highest values, suggesting the best fit according to these indices.</p></li>
<li><p><strong>AIC (Akaike Information Criterion) and BIC (Bayesian Information Criterion)</strong>: Lower values indicate a better fit when comparing models. The two_latents_eth_metric model has the lowest AIC and BIC, indicating the best fit according to these criteria.</p></li>
<li><p><strong>p_Chi2 and p_RMSEA</strong>: These are the significance levels for the Chi-square test and the RMSEA, respectively. Non-significant values (p &gt; 0.05) suggest a good fit. Only the RMSEA for the two_latents_eth_metric model is non-significant, suggesting a good fit.</p></li>
</ol>
<p>In summary, the two_latents_eth_metric model appears to provide the best fit overall, indicating that a two-factor solution might be appropriate and that the metric equivalence (equal factor loadings) assumption is supported across ethnic categories. However, one must also take into consideration the theoretical soundness of the model and other substantive considerations when deciding on the final model.</p>
</section>
<section id="scalar-equivalence" class="level3">
<h3 class="anchored" data-anchor-id="scalar-equivalence">Scalar Equivalence</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># view as html table</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(compare_eth_scalar)<span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Chi2</th>
<th style="text-align: right;">Chi2_df</th>
<th style="text-align: right;">p_Chi2</th>
<th style="text-align: right;">Baseline</th>
<th style="text-align: right;">Baseline_df</th>
<th style="text-align: right;">p_Baseline</th>
<th style="text-align: right;">GFI</th>
<th style="text-align: right;">AGFI</th>
<th style="text-align: right;">NFI</th>
<th style="text-align: right;">NNFI</th>
<th style="text-align: right;">CFI</th>
<th style="text-align: right;">RMSEA</th>
<th style="text-align: right;">RMSEA_CI_low</th>
<th style="text-align: right;">RMSEA_CI_high</th>
<th style="text-align: right;">p_RMSEA</th>
<th style="text-align: right;">RMR</th>
<th style="text-align: right;">SRMR</th>
<th style="text-align: right;">RFI</th>
<th style="text-align: right;">PNFI</th>
<th style="text-align: right;">IFI</th>
<th style="text-align: right;">RNI</th>
<th style="text-align: right;">Loglikelihood</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">AIC_wt</th>
<th style="text-align: right;">BIC</th>
<th style="text-align: right;">BIC_wt</th>
<th style="text-align: right;">BIC_adjusted</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">one_latent_eth_scalar</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">1162.4746</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">341229.17</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9831752</td>
<td style="text-align: right;">0.9579381</td>
<td style="text-align: right;">0.9965933</td>
<td style="text-align: right;">0.9949511</td>
<td style="text-align: right;">0.9966341</td>
<td style="text-align: right;">0.1027048</td>
<td style="text-align: right;">0.0977499</td>
<td style="text-align: right;">0.1077479</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">38.29915</td>
<td style="text-align: right;">0.0439380</td>
<td style="text-align: right;">0.9948899</td>
<td style="text-align: right;">0.6643955</td>
<td style="text-align: right;">0.9966342</td>
<td style="text-align: right;">0.9966341</td>
<td style="text-align: right;">-129452.1</td>
<td style="text-align: right;">258946.1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">259092.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">259025.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">two_latents_eth_scalar</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">276.7703</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">42034.04</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9961916</td>
<td style="text-align: right;">0.9897467</td>
<td style="text-align: right;">0.9934156</td>
<td style="text-align: right;">0.9898581</td>
<td style="text-align: right;">0.9937217</td>
<td style="text-align: right;">0.0510782</td>
<td style="text-align: right;">0.0459383</td>
<td style="text-align: right;">0.0564019</td>
<td style="text-align: right;">0.3560216</td>
<td style="text-align: right;">34.17489</td>
<td style="text-align: right;">0.0201464</td>
<td style="text-align: right;">0.9893636</td>
<td style="text-align: right;">0.6149715</td>
<td style="text-align: right;">0.9937229</td>
<td style="text-align: right;">0.9937217</td>
<td style="text-align: right;">-129009.2</td>
<td style="text-align: right;">258062.4</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">258215.5</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">258145.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">three_latents_eth_scalar</td>
<td style="text-align: left;">lavaan</td>
<td style="text-align: right;">701.6287</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27397.50</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.9906044</td>
<td style="text-align: right;">0.9725962</td>
<td style="text-align: right;">0.9743908</td>
<td style="text-align: right;">0.9559166</td>
<td style="text-align: right;">0.9748095</td>
<td style="text-align: right;">0.0859629</td>
<td style="text-align: right;">0.0806184</td>
<td style="text-align: right;">0.0914299</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">76.26852</td>
<td style="text-align: right;">0.0358868</td>
<td style="text-align: right;">0.9551839</td>
<td style="text-align: right;">0.5567947</td>
<td style="text-align: right;">0.9748177</td>
<td style="text-align: right;">0.9748095</td>
<td style="text-align: right;">-129221.6</td>
<td style="text-align: right;">258489.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">258649.3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">258576.2</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The table presents the results of a multi-group confirmatory factor analysis (CFA) conducted to test scalar equivalence (also known as measurement invariance) across different ethnic categories (eth_cat). The models (one_latent_eth_scalar, two_latents_eth_scalar, three_latents_eth_scalar) were run with constraints on both factor loadings and intercepts to be equal across groups, a requirement for scalar invariance.</p>
<p>Here’s the interpretation of the fit indices:</p>
<ol type="1">
<li><p><strong>Chi2 (Chi-square)</strong>: Lower values indicate better model fit. The two_latents_eth_scalar model has the lowest Chi2 value, suggesting the best fit according to this measure.</p></li>
<li><p><strong>GFI (Goodness of Fit Index), AGFI (Adjusted Goodness of Fit Index)</strong>: These range from 0 to 1, with values closer to 1 indicating a better fit. The two_latents_eth_scalar model has the highest GFI and AGFI values, suggesting the best fit according to these indices.</p></li>
<li><p><strong>NFI (Normed Fit Index), NNFI (Non-Normed Fit Index, or TLI), CFI (Comparative Fit Index)</strong>: These range from 0 to 1, with values closer to 1 indicating a better fit. The one_latent_eth_scalar model has the highest values, suggesting the best fit according to these measures.</p></li>
<li><p><strong>RMSEA (Root Mean Square Error of Approximation)</strong>: Lower values are better, with values below 0.05 generally considered good, and values up to 0.08 considered acceptable. Only the two_latents_eth_scalar model has an RMSEA within the acceptable range (0.05).</p></li>
<li><p><strong>RMR (Root Mean Square Residual) and SRMR (Standardized Root Mean Square Residual)</strong>: Lower values are better, typically less than 0.08 is considered a good fit. All models have acceptable RMR and SRMR values, with the two_latents_eth_scalar model having the lowest, indicating the best fit.</p></li>
<li><p><strong>RFI (Relative Fit Index), PNFI (Parsimonious Normed Fit Index), IFI (Incremental Fit Index), RNI (Relative Noncentrality Index)</strong>: These range from 0 to 1, with values closer to 1 indicating better fit. The one_latent_eth_scalar model has the highest values, suggesting the best fit according to these indices.</p></li>
<li><p><strong>AIC (Akaike Information Criterion) and BIC (Bayesian Information Criterion)</strong>: Lower values indicate a better fit when comparing models. The two_latents_eth_scalar model has the lowest AIC and BIC, indicating the best fit according to these criteria.</p></li>
<li><p><strong>p_Chi2 and p_RMSEA</strong>: These are the significance levels for the Chi-square test and the RMSEA, respectively. Non-significant values (p &gt; 0.05) suggest a good fit. Only the RMSEA for the two_latents_eth_scalar model is non-significant, suggesting a good fit.</p></li>
</ol>
<p>In summary, the two_latents_eth_scalar model appears to provide the best fit overall, indicating that a two-factor solution might be appropriate and that the scalar equivalence (equal factor loadings and intercepts) assumption is supported across ethnic categories. However, one must also consider the theoretical soundness of the model and other substantive considerations when deciding on the final model.</p>
<p>Overall it seems that we have good evidence for the two-factor model of Kessler-6.</p>
<p>Let’s next get the data into shape for analysis. Here we create a variable for the two factors:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get two factors from data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>dt_start2 <span class="ot">&lt;-</span> dt_start <span class="sc">|&gt;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id, wave) <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">kessler_latent_depression =</span> <span class="fu">mean</span>(<span class="fu">c</span>(kessler_depressed, kessler_hopeless, kessler_effort), <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">kessler_latent_anxiety  =</span> <span class="fu">mean</span>(<span class="fu">c</span>(kessler_effort, kessler_nervous, kessler_restless), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It is useful toinspect histograms</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt_start2<span class="sc">$</span>kessler_latent_anxiety)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="experiment_template_files/figure-html/histogram_kessler_anxiety-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt_start2<span class="sc">$</span>kessler_latent_depression)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="experiment_template_files/figure-html/histogram_kessler_depression-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="assess-change-in-the-exposure" class="level3">
<h3 class="anchored" data-anchor-id="assess-change-in-the-exposure">Assess change in the exposure</h3>
<p>Not this is just a description of the the summary scores. We do not assess change within indivuals</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  select only the baseline year and the exposure year.  That will give us change in the exposure. ()</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>dt_exposure <span class="ot">&lt;-</span> dt_start2 <span class="sc">|&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select baseline year and exposure year</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(wave <span class="sc">==</span> <span class="st">"2018"</span> <span class="sc">|</span> wave <span class="sc">==</span> <span class="st">"2019"</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select variables of interest</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, wave, hours_exercise_coarsen,  eth_cat) <span class="sc">|&gt;</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the categorical variable needs to be numeric for us to use msm package to investigate change</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hours_exercise_coarsen_n =</span> <span class="fu">as.numeric</span>(hours_exercise_coarsen)) <span class="sc">|&gt;</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co"># check</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>dt_exposure <span class="sc">|&gt;</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(hours_exercise_coarsen_n, eth_cat,  wave )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$`2018`
 hours_exercise_coarsen_n euro māori pacific asian
                        1 3238   319      78   170
                        2 3790   341      81   130
                        3 1613   161      31    48

$`2019`
 hours_exercise_coarsen_n euro māori pacific asian
                        1 2880   307      79   143
                        2 3927   354      82   141
                        3 1834   160      29    64</code></pre>
</div>
</div>
<p>I’ve written a function called <code>transition_table</code> that will help us assess change in the exposure at the individual level.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">#   consider people going from active to vary active</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> msm<span class="sc">::</span><span class="fu">statetable.msm</span>(<span class="fu">round</span>(hours_exercise_coarsen_n, <span class="dv">0</span>), id, <span class="at">data =</span> dt_exposure)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># for a function I wrote to create state tables</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>state_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Inactive"</span>, <span class="st">"Somewhat Active"</span>, <span class="st">"Active"</span>, <span class="st">"Extremely Active"</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># transition table</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="fu">transition_table</span>(out, state_names)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$explanation
[1] "This transition matrix describes the shifts from one state to another between the baseline wave and the following wave. The numbers in the cells represent the number of individuals who transitioned from one state (rows) to another (columns). For example, the cell in the first row and second column shows the number of individuals who transitioned from the first state (indicated by the left-most cell in the row) to the second state. The top left cell shows the number of individuals who remained in the first state."

$table


|      From       | Inactive | Somewhat Active | Active |
|:---------------:|:--------:|:---------------:|:------:|
|    Inactive     |   2186   |      1324       |  295   |
| Somewhat Active |   1019   |      2512       |  811   |
|     Active      |   204    |       668       |  981   |</code></pre>
</div>
</div>
<p>Next consider Māori only</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maori only</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>dt_exposure_maori <span class="ot">&lt;-</span> dt_exposure <span class="sc">|&gt;</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(eth_cat <span class="sc">==</span> <span class="st">"māori"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>out_m <span class="ot">&lt;-</span> msm<span class="sc">::</span><span class="fu">statetable.msm</span>(<span class="fu">round</span>(hours_exercise_coarsen_n, <span class="dv">0</span>), id, <span class="at">data =</span> dt_exposure_maori)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># with this little support we might consider parametric models</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>t_tab_m<span class="ot">&lt;-</span> <span class="fu">transition_table</span>( out_m, state_names)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#interpretation</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(t_tab_m<span class="sc">$</span>explanation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>This transition matrix describes the shifts from one state to another between the baseline wave and the following wave. The numbers in the cells represent the number of individuals who transitioned from one state (rows) to another (columns). For example, the cell in the first row and second column shows the number of individuals who transitioned from the first state (indicated by the left-most cell in the row) to the second state. The top left cell shows the number of individuals who remained in the first state.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t_tab_m<span class="sc">$</span>table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

|      From       | Inactive | Somewhat Active | Active |
|:---------------:|:--------:|:---------------:|:------:|
|    Inactive     |   187    |       108       |   24   |
| Somewhat Active |    92    |       188       |   61   |
|     Active      |    28    |       58        |   75   |</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter euro</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>dt_exposure_euro <span class="ot">&lt;-</span> dt_exposure <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(eth_cat <span class="sc">==</span> <span class="st">"euro"</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co"># model change</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>out_e <span class="ot">&lt;-</span> msm<span class="sc">::</span><span class="fu">statetable.msm</span>(<span class="fu">round</span>(hours_exercise_coarsen_n, <span class="dv">0</span>), id, <span class="at">data =</span> dt_exposure_euro)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># creat transition table.</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>t_tab_e <span class="ot">&lt;-</span> <span class="fu">transition_table</span>( out_e, state_names)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="co">#interpretation</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(t_tab_e<span class="sc">$</span>explanation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>This transition matrix describes the shifts from one state to another between the baseline wave and the following wave. The numbers in the cells represent the number of individuals who transitioned from one state (rows) to another (columns). For example, the cell in the first row and second column shows the number of individuals who transitioned from the first state (indicated by the left-most cell in the row) to the second state. The top left cell shows the number of individuals who remained in the first state.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># table</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(t_tab_e<span class="sc">$</span>table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

|      From       | Inactive | Somewhat Active | Active |
|:---------------:|:--------:|:---------------:|:------:|
|    Inactive     |   1843   |      1136       |  259   |
| Somewhat Active |   870    |      2208       |  712   |
|     Active      |   167    |       583       |  863   |</code></pre>
</div>
</div>
<p>Overall we find evidence for change in the exposure variable. This suggest that we are ready to proceed with the next step of causal estimation.</p>
</section>
<section id="create-wide-data-frame-for-analysis" class="level3">
<h3 class="anchored" data-anchor-id="create-wide-data-frame-for-analysis">Create wide data frame for analysis</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="do">############## ############## ############## ############## ############## ############## ############## ########</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="do">####  ####  ####  CREATE DATA FRAME FOR ANALYSIS ####  ####  ################## ############## ######## #########</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="do">############## ############## ############## ############## ############## ############## ############# #########</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># To find out more about our dataset go here:</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/go-bayes/psych-434-2023/blob/main/data/readme.qmd</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co"># I have created a function that will put the data into the correct shape. Here are the steps.</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: choose baseline variables (confounders).  here we select standard demographic variablees plus personality variables.</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="co"># note that the function will automatically include the baseline exposure and basline outcome in the baseline variable confounder set so you don't need to include these. </span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co"># here are some plausible baseline confounders</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"edu"</span>,</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"male"</span>,</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"eth_cat"</span>,</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"employed"</span>,</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"gen_cohort"</span>,</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nz_dep2018"</span>, <span class="co"># nz dep</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"nzsei13"</span>, <span class="co"># occupational prestige</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"partner"</span>,</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"parent"</span>,</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"pol_orient"</span>,</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a> <span class="co"># "rural_gch2018",</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>   <span class="st">"urban"</span>, <span class="co"># use the two level urban varaible. </span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"agreeableness"</span>,</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"conscientiousness"</span>,</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"extraversion"</span>,</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"honesty_humility"</span>,</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"openness"</span>,</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"neuroticism"</span>,</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"modesty"</span>,</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"religion_identification_level"</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Step 2, select the exposure variable.  This is the "cause"</span></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>exposure_var <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"hours_exercise_coarsen"</span>)</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a><span class="do">## step 3. select the outcome variable.  These are the outcomes.</span></span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>outcome_vars_reflective <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"kessler_latent_anxiety"</span>,</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"kessler_latent_depression"</span>)</span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a><span class="co"># the function "create_wide_data" should be in your environment.</span></span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a><span class="co"># If not, make sure to run the first line of code in this script once more.  You may ignore the warnings. or uncomment and run the code below</span></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a><span class="co"># source("https://raw.githubusercontent.com/go-bayes/templates/main/functions/funs.R")</span></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>dt_prepare <span class="ot">&lt;-</span></span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_wide_data</span>(</span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">dat_long =</span> dt_start2,</span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseline_vars =</span> baseline_vars,</span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">exposure_var =</span> exposure_var,</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">outcome_vars =</span> outcome_vars_reflective</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(exclude_vars)

  # Now:
  data %&gt;% select(all_of(exclude_vars))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using an external vector in selections was deprecated in tidyselect 1.1.0.
ℹ Please use `all_of()` or `any_of()` instead.
  # Was:
  data %&gt;% select(t0_column_order)

  # Now:
  data %&gt;% select(all_of(t0_column_order))

See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</code></pre>
</div>
</div>
</section>
</section>
<section id="descriptive-table" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-table">Descriptive table</h2>
<p>I created a simple function</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I have created a function that will allow you to take a data frame and</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create a table</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># REDO</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>However, if would like like a nicer table, try this:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get data into shape</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dt_new <span class="ot">&lt;-</span> dt_prepare <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"t0"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_all</span>(<span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_replace</span>(., <span class="st">"^t0_"</span>, <span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wave =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="st">"baseline"</span>, <span class="fu">nrow</span>(dt_prepare)))) <span class="sc">|&gt;</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>(<span class="at">case =</span> <span class="st">"screaming_snake"</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create a formula string</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>baseline_vars_names <span class="ot">&lt;-</span> dt_new <span class="sc">%&gt;%</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>WAVE) <span class="sc">%&gt;%</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>()</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>table_baseline_vars <span class="ot">&lt;-</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(baseline_vars_names, <span class="at">collapse =</span> <span class="st">"+"</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>formula_string_table_baseline <span class="ot">&lt;-</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="st">"~"</span>, table_baseline_vars, <span class="st">"|WAVE"</span>)</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>table1<span class="sc">::</span><span class="fu">table1</span>(<span class="fu">as.formula</span>(formula_string_table_baseline),</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dt_new,</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">overall =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<div class="Rtable1">
<table class="Rtable1 table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th class="rowlabel firstrow lastrow" data-quarto-table-cell-role="th"></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">baseline<br>
<span class="stratn">(N=10000)</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowlabel firstrow">EDU</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>5.85 (2.59)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">6.96 [-0.128, 10.1]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">MALE</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Male</td>
<td>3905 (39.1%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Not_male</td>
<td class="lastrow">6095 (61.0%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">ETH_CAT</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">euro</td>
<td>8641 (86.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">māori</td>
<td>821 (8.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel">pacific</td>
<td>190 (1.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">asian</td>
<td class="lastrow">348 (3.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">EMPLOYED</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>0.836 (0.370)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.00 [0, 1.00]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">GEN_COHORT</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Gen_Silent: born&lt; 1946</td>
<td>166 (1.7%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965</td>
<td>4257 (42.6%)</td>
</tr>
<tr class="even">
<td class="rowlabel">GenX: born &gt;=1961 &amp; b.&lt; 1981</td>
<td>3493 (34.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">GenY: born &gt;=1981 &amp; b.&lt; 1996</td>
<td>1883 (18.8%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">GenZ: born &gt;= 1996</td>
<td class="lastrow">201 (2.0%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">NZ_DEP2018</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>4.46 (2.65)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">4.01 [0.835, 10.1]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">NZSEI13</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>57.0 (16.1)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">61.0 [9.91, 90.1]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">PARTNER</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>0.795 (0.404)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.00 [0, 1.00]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">PARENT</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>0.706 (0.456)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.00 [0, 1.00]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">POL_ORIENT</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>3.47 (1.40)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">3.09 [0.862, 7.14]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">URBAN</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">rural</td>
<td>1738 (17.4%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">urban</td>
<td class="lastrow">8262 (82.6%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">AGREEABLENESS</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>5.36 (0.986)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">5.48 [0.977, 7.13]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">CONSCIENTIOUSNESS</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>5.19 (1.03)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">5.28 [0.938, 7.16]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">EXTRAVERSION</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>3.85 (1.21)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">3.80 [0.861, 7.07]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">HONESTY_HUMILITY</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>5.52 (1.12)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">5.71 [1.14, 7.15]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">OPENNESS</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>5.06 (1.10)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">5.12 [0.899, 7.15]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">NEUROTICISM</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>3.41 (1.17)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">3.31 [0.860, 7.08]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">MODESTY</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>6.07 (0.860)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">6.24 [2.17, 7.17]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">RELIGION_IDENTIFICATION_LEVEL</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>2.19 (2.07)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.00 [1.00, 7.00]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">HOURS_EXERCISE_COARSEN</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">inactive</td>
<td>3805 (38.1%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">active</td>
<td>4342 (43.4%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">very_active</td>
<td class="lastrow">1853 (18.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">KESSLER_LATENT_ANXIETY</td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Mean (SD)</td>
<td>1.16 (0.719)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">1.03 [-0.0800, 4.03]</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">KESSLER_LATENT_DEPRESSION</td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>0.744 (0.686)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">0.646 [-0.0871, 4.02]</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># another method for making a table</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="co"># x &lt;- table1::table1(as.formula(formula_string_table_baseline),</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                     data = dt_new,</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                     overall = FALSE)</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co"># # some options, see: https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># table1::t1kable(x, format = "html", booktabs = TRUE) |&gt;</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   kable_material(c("striped", "hover"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Some more data wrangling.</p>
<ol type="1">
<li><p><code>mutate(id = factor(1:nrow(dt_prepare)))</code>: This creates a new column called <code>id</code> that has unique identification factors for each row in the dataset. It ranges from 1 to the number of rows in the dataset.</p></li>
<li><p>The next <code>mutate</code> operation is used to convert the <code>t0_eth_cat</code>, <code>t0_urban</code>, and <code>t0_gen_cohort</code> variables to factor type, if they are not already.</p></li>
<li><p>The <code>filter</code> command is used to subset the dataset to only include rows where the <code>t0_eth_cat</code> is either “euro” or “māori”. The original dataset includes data with four different ethnic categories. This command filters out any row not related to these two groups.</p></li>
<li><p><code>ungroup()</code> ensures that there’s no grouping in the dataframe.</p></li>
<li><p>The <code>mutate(across(where(is.numeric), ~ scale(.x), .names = "{col}_z"))</code> step standardizes all numeric columns in the dataset by subtracting the mean and dividing by the standard deviation (a z-score transformation). The resulting columns are renamed to include “_z” at the end of their original names.</p></li>
<li><p>The <code>select</code> function is used to keep only specific columns: the <code>id</code> column, any columns that are factors, and any columns that end in “_z”.</p></li>
<li><p>The <code>relocate</code> functions re-order columns. The first <code>relocate</code> places the <code>id</code> column at the beginning. The next three <code>relocate</code> functions order the rest of the columns based on their names: those starting with “t0_” are placed before “t1_” columns, and those starting with “t2_” are placed after “t1_” columns.</p></li>
<li><p><code>droplevels()</code> removes unused factor levels in the dataframe.</p></li>
<li><p>Finally, <code>skimr::skim(dt)</code> will print out a summary of the data in the <code>dt</code> object using the skimr package. This provides a useful overview of the data, including data types and summary statistics.</p></li>
</ol>
<p>This function seems to be part of a data preparation pipeline in a longitudinal or panel analysis, where observations are ordered over time (indicated by t0_, t1_, t2_, etc.).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="do">### </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> SUBGROUP DATA ANALYSIS: DATA WRANGLING  </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span><span class="do"> </span><span class="al">###</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt_prepare<span class="sc">|&gt;</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dt_prepare))) <span class="sc">|&gt;</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_eth_cat =</span> <span class="fu">as.factor</span>(t0_eth_cat),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_urban =</span> <span class="fu">as.factor</span>(t0_urban),</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">t0_gen_cohort =</span> <span class="fu">as.factor</span>(t0_gen_cohort)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span> <span class="sc">|</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>) <span class="sc">|&gt;</span> <span class="co"># Too few asian and pacific</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform numeric variables into z scores (improves estimation)</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">scale</span>(.x), <span class="at">.names =</span> <span class="st">"{col}_z"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># select only factors and numeric values that are z-scores</span></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, <span class="co"># category is too sparse</span></span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>         <span class="fu">where</span>(is.factor),</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>         <span class="fu">ends_with</span>(<span class="st">"_z"</span>), ) <span class="sc">|&gt;</span></span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tidy data frame so that the columns are ordered by time (useful for more complex models)</span></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(id, <span class="at">.before =</span> <span class="fu">starts_with</span>(<span class="st">"t1_"</span>))   <span class="sc">|&gt;</span></span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">"t0_"</span>), <span class="at">.before =</span> <span class="fu">starts_with</span>(<span class="st">"t1_"</span>))  <span class="sc">|&gt;</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">"t2_"</span>), <span class="at">.after =</span> <span class="fu">starts_with</span>(<span class="st">"t1_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">droplevels</span>()</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a><span class="co"># view object</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
dt
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
9462
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
26
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
19
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:left;">
ordered
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:left;">
top_counts
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
id
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
9462
</td>
<td style="text-align:left;">
1: 1, 2: 1, 3: 1, 4: 1
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_male
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Not: 5767, Mal: 3695
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_eth_cat
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
eur: 8641, māo: 821
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_gen_cohort
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
Gen: 4107, Gen: 3311, Gen: 1716, Gen: 164
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_urban
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
urb: 7762, rur: 1700
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_hours_exercise_coarsen
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
act: 4131, ina: 3557, ver: 1774
</td>
</tr>
<tr>
<td style="text-align:left;">
t1_hours_exercise_coarsen
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
act: 4281, ina: 3187, ver: 1994
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
t0_edu_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.29
</td>
<td style="text-align:right;">
-1.05
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
1.66
</td>
<td style="text-align:left;">
▂▃▃▇▂
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_employed_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.26
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:left;">
▂▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_nz_dep2018_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.36
</td>
<td style="text-align:right;">
-0.92
</td>
<td style="text-align:right;">
-0.16
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
2.17
</td>
<td style="text-align:left;">
▇▆▆▅▂
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_nzsei13_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.94
</td>
<td style="text-align:right;">
-0.75
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
2.07
</td>
<td style="text-align:left;">
▁▃▅▇▁
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_partner_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.99
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:left;">
▂▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_parent_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.58
</td>
<td style="text-align:right;">
-1.58
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:left;">
▃▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_pol_orient_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.87
</td>
<td style="text-align:right;">
-1.02
</td>
<td style="text-align:right;">
-0.28
</td>
<td style="text-align:right;">
0.44
</td>
<td style="text-align:right;">
2.62
</td>
<td style="text-align:left;">
▇▆▇▅▂
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_agreeableness_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-4.46
</td>
<td style="text-align:right;">
-0.62
</td>
<td style="text-align:right;">
0.12
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
1.79
</td>
<td style="text-align:left;">
▁▁▃▇▆
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_conscientiousness_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-4.13
</td>
<td style="text-align:right;">
-0.65
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;">
1.91
</td>
<td style="text-align:left;">
▁▁▅▇▅
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_extraversion_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.48
</td>
<td style="text-align:right;">
-0.71
</td>
<td style="text-align:right;">
-0.04
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:right;">
2.67
</td>
<td style="text-align:left;">
▂▆▇▅▁
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_honesty_humility_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-3.95
</td>
<td style="text-align:right;">
-0.69
</td>
<td style="text-align:right;">
0.17
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;">
1.45
</td>
<td style="text-align:left;">
▁▁▃▆▇
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_openness_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-3.76
</td>
<td style="text-align:right;">
-0.71
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;">
1.90
</td>
<td style="text-align:left;">
▁▂▆▇▅
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_neuroticism_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-2.18
</td>
<td style="text-align:right;">
-0.76
</td>
<td style="text-align:right;">
-0.09
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;">
3.14
</td>
<td style="text-align:left;">
▃▇▇▃▁
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_modesty_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-4.67
</td>
<td style="text-align:right;">
-0.66
</td>
<td style="text-align:right;">
0.19
</td>
<td style="text-align:right;">
0.83
</td>
<td style="text-align:right;">
1.26
</td>
<td style="text-align:left;">
▁▁▂▅▇
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_religion_identification_level_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.56
</td>
<td style="text-align:right;">
-0.56
</td>
<td style="text-align:right;">
-0.56
</td>
<td style="text-align:right;">
-0.08
</td>
<td style="text-align:right;">
2.37
</td>
<td style="text-align:left;">
▇▁▁▁▂
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_kessler_latent_anxiety_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.72
</td>
<td style="text-align:right;">
-0.69
</td>
<td style="text-align:right;">
-0.19
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;">
4.01
</td>
<td style="text-align:left;">
▇▇▆▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
t0_kessler_latent_depression_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.21
</td>
<td style="text-align:right;">
-0.63
</td>
<td style="text-align:right;">
-0.13
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
4.83
</td>
<td style="text-align:left;">
▇▂▂▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
t2_kessler_latent_depression_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.23
</td>
<td style="text-align:right;">
-0.65
</td>
<td style="text-align:right;">
-0.16
</td>
<td style="text-align:right;">
0.39
</td>
<td style="text-align:right;">
4.75
</td>
<td style="text-align:left;">
▇▃▂▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
t2_kessler_latent_anxiety_z
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-1.74
</td>
<td style="text-align:right;">
-0.70
</td>
<td style="text-align:right;">
-0.20
</td>
<td style="text-align:right;">
0.68
</td>
<td style="text-align:right;">
3.97
</td>
<td style="text-align:left;">
▇▇▆▁▁
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quick cross table</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">#table( dt$t1_hours_exercise_coarsen, dt$t0_eth_cat )</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># checks</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt<span class="sc">$</span>t2_kessler_latent_depression_z)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(dt<span class="sc">$</span>t2_kessler_latent_anxiety_z)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">|&gt;</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tabyl</span>(t0_eth_cat, t1_hours_exercise_coarsen ) <span class="sc">|&gt;</span></span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise missingness</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>naniar<span class="sc">::</span><span class="fu">vis_miss</span>(dt)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co"># save your dataframe for future use</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co"># make dataframe</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">=</span> <span class="fu">as.data.frame</span>(dt)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co"># save data</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="propensity-scores" class="level2">
<h2 class="anchored" data-anchor-id="propensity-scores">Propensity scores</h2>
<p>Next we generate propensity scores. Instead of modelling the outcome (t2_y) we will model the exposure (t1_x) as predicted by baseline indicators (t0_c) that we assume may be associated with the outcome and the exposure.</p>
<p>The first step is to obtain the baseline variables. note that we must remove “t0_eth_cat” because we are performing separate weighting for each stratum within this variable.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read -- you may start here if you need to repeat the analysis</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt"</span>))</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get column names</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>baseline_vars_reflective_propensity <span class="ot">&lt;-</span> dt<span class="sc">|&gt;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"t0"</span>), <span class="sc">-</span>t0_eth_cat) <span class="sc">|&gt;</span> <span class="fu">colnames</span>()</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co"># define our exposure</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="st">"t1_hours_exercise_coarsen"</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="co"># define subclasses</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="st">"t0_eth_cat"</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure data is in a data frame format</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(dt)</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="co"># next we use our trick for creating a formula string, which will reduce our work</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>formula_str_prop <span class="ot">&lt;-</span></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(X,</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"~"</span>,</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(baseline_vars_reflective_propensity, <span class="at">collapse =</span> <span class="st">"+"</span>))</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a><span class="co"># this shows the exposure variable as predicted by the baseline confounders.</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>formula_str_prop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "t1_hours_exercise_coarsen ~ t0_male+t0_gen_cohort+t0_urban+t0_hours_exercise_coarsen+t0_edu_z+t0_employed_z+t0_nz_dep2018_z+t0_nzsei13_z+t0_partner_z+t0_parent_z+t0_pol_orient_z+t0_agreeableness_z+t0_conscientiousness_z+t0_extraversion_z+t0_honesty_humility_z+t0_openness_z+t0_neuroticism_z+t0_modesty_z+t0_religion_identification_level_z+t0_kessler_latent_anxiety_z+t0_kessler_latent_depression_z"</code></pre>
</div>
</div>
<p>For propensity score analysis, we will try several different approaches. We will want to select the method that produces the best balance.</p>
<p>I typically use “ps” (classical propensity scores), <code>ebal</code> and <code>energy</code>. The latter two in my experience yeild good balance. Also <code>energy</code> will work with <em>continuous</em> exposures.</p>
<p>For more information, see <a href="https://ngreifer.github.io/WeightIt/">https://ngreifer.github.io/WeightIt/</a></p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># traditional propensity scores-- note we select the ATT and we have a subgroup </span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>dt_match_ps <span class="ot">&lt;-</span> <span class="fu">match_mi_general</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dt,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_vars =</span> baseline_vars_reflective_propensity,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroup =</span> <span class="st">"t0_eth_cat"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span>,</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ps"</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_match_ps, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ps"</span>))</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ebalance</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>dt_match_ebal <span class="ot">&lt;-</span> <span class="fu">match_mi_general</span>(</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dt,</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> X,</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_vars =</span> baseline_vars_reflective_propensity,</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">subgroup =</span> <span class="st">"t0_eth_cat"</span>,</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">estimand =</span> <span class="st">"ATE"</span>,</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"ebal"</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a><span class="co"># save output</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(dt_match_ebal, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ebal"</span>))</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="do">## energy balance method</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="co"># dt_match_energy &lt;- match_mi_general(</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   data = dt,</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   X = X,</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   baseline_vars = baseline_vars_reflective_propensity,</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   subgroup = "t0_eth_cat",</span></span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   estimand = "ATE",</span></span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   #focal = "high", # for use with ATT</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   method = "energy"</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(dt_match_energy, here::here("data", "dt_match_energy"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Results, first for Europeans</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dt_match_energy <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_energy"</span>))</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>dt_match_ebal <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ebal"</span>))</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>dt_match_ps <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"dt_match_ps"</span>))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># next we inspect balance. "Max.Diff.Adj" should ideally be less than .05, but less than .1 is ok. This is the standardised mean difference. The variance ratio should be less than 2. </span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># note that if the variables are unlikely to influence the outcome we can be less strict. </span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">#See: Hainmueller, J. 2012. “Entropy Balancing for Causal Effects: A Multivariate Reweighting Method to Produce Balanced Samples in Observational Studies.” Political Analysis 20 (1): 25–46. https://doi.org/10.1093/pan/mpr025.</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Cole SR, Hernan MA. Constructing inverse probability weights for marginal structural models. American Journal of</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Epidemiology 2008; 168(6):656–664.</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Moving towards best practice when using inverse probability of treatment weighting (IPTW) using the propensity score to estimate causal treatment effects in observational studies</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Peter C. Austin, Elizabeth A. Stuart</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="co"># https://onlinelibrary.wiley.com/doi/10.1002/sim.6607</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_energy<span class="sc">$</span>euro)   <span class="co">#  good</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Balance summary across all treatment pairs
                                                      Type Max.Diff.Adj
t0_male_Not_male                                    Binary       0.0008
t0_gen_cohort_Gen_Silent: born&lt; 1946                Binary       0.0001
t0_gen_cohort_Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965  Binary       0.0007
t0_gen_cohort_GenX: born &gt;=1961 &amp; b.&lt; 1981          Binary       0.0006
t0_gen_cohort_GenY: born &gt;=1981 &amp; b.&lt; 1996          Binary       0.0012
t0_gen_cohort_GenZ: born &gt;= 1996                    Binary       0.0001
t0_urban_urban                                      Binary       0.0002
t0_hours_exercise_coarsen_inactive                  Binary       0.0049
t0_hours_exercise_coarsen_active                    Binary       0.0005
t0_hours_exercise_coarsen_very_active               Binary       0.0045
t0_edu_z                                           Contin.       0.0021
t0_employed_z                                      Contin.       0.0016
t0_nz_dep2018_z                                    Contin.       0.0039
t0_nzsei13_z                                       Contin.       0.0024
t0_partner_z                                       Contin.       0.0003
t0_parent_z                                        Contin.       0.0010
t0_pol_orient_z                                    Contin.       0.0033
t0_agreeableness_z                                 Contin.       0.0019
t0_conscientiousness_z                             Contin.       0.0015
t0_extraversion_z                                  Contin.       0.0026
t0_honesty_humility_z                              Contin.       0.0015
t0_openness_z                                      Contin.       0.0003
t0_neuroticism_z                                   Contin.       0.0031
t0_modesty_z                                       Contin.       0.0011
t0_religion_identification_level_z                 Contin.       0.0029
t0_kessler_latent_anxiety_z                        Contin.       0.0009
t0_kessler_latent_depression_z                     Contin.       0.0010

Effective sample sizes
           inactive  active very_active
Unadjusted  2880.   3927.       1834.  
Adjusted    1646.63 3164.13      946.78</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_ebal<span class="sc">$</span>euro)   <span class="co">#  best</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Balance summary across all treatment pairs
                                                      Type Max.Diff.Adj
t0_male_Not_male                                    Binary       0.0001
t0_gen_cohort_Gen_Silent: born&lt; 1946                Binary       0.0001
t0_gen_cohort_Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965  Binary       0.0001
t0_gen_cohort_GenX: born &gt;=1961 &amp; b.&lt; 1981          Binary       0.0001
t0_gen_cohort_GenY: born &gt;=1981 &amp; b.&lt; 1996          Binary       0.0001
t0_gen_cohort_GenZ: born &gt;= 1996                    Binary       0.0000
t0_urban_urban                                      Binary       0.0001
t0_hours_exercise_coarsen_inactive                  Binary       0.0000
t0_hours_exercise_coarsen_active                    Binary       0.0000
t0_hours_exercise_coarsen_very_active               Binary       0.0000
t0_edu_z                                           Contin.       0.0000
t0_employed_z                                      Contin.       0.0003
t0_nz_dep2018_z                                    Contin.       0.0000
t0_nzsei13_z                                       Contin.       0.0000
t0_partner_z                                       Contin.       0.0001
t0_parent_z                                        Contin.       0.0001
t0_pol_orient_z                                    Contin.       0.0000
t0_agreeableness_z                                 Contin.       0.0000
t0_conscientiousness_z                             Contin.       0.0000
t0_extraversion_z                                  Contin.       0.0000
t0_honesty_humility_z                              Contin.       0.0001
t0_openness_z                                      Contin.       0.0000
t0_neuroticism_z                                   Contin.       0.0001
t0_modesty_z                                       Contin.       0.0001
t0_religion_identification_level_z                 Contin.       0.0001
t0_kessler_latent_anxiety_z                        Contin.       0.0001
t0_kessler_latent_depression_z                     Contin.       0.0000

Effective sample sizes
           inactive  active very_active
Unadjusted  2880.   3927.       1834.  
Adjusted    1855.89 3659.59     1052.01</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_ps<span class="sc">$</span>euro)   <span class="co">#  not as good</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Balance summary across all treatment pairs
                                                      Type Max.Diff.Adj
t0_male_Not_male                                    Binary       0.0664
t0_gen_cohort_Gen_Silent: born&lt; 1946                Binary       0.0038
t0_gen_cohort_Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965  Binary       0.0305
t0_gen_cohort_GenX: born &gt;=1961 &amp; b.&lt; 1981          Binary       0.0236
t0_gen_cohort_GenY: born &gt;=1981 &amp; b.&lt; 1996          Binary       0.0107
t0_gen_cohort_GenZ: born &gt;= 1996                    Binary       0.0025
t0_urban_urban                                      Binary       0.0447
t0_hours_exercise_coarsen_inactive                  Binary       0.0832
t0_hours_exercise_coarsen_active                    Binary       0.1000
t0_hours_exercise_coarsen_very_active               Binary       0.0728
t0_edu_z                                           Contin.       0.1782
t0_employed_z                                      Contin.       0.0636
t0_nz_dep2018_z                                    Contin.       0.1321
t0_nzsei13_z                                       Contin.       0.1387
t0_partner_z                                       Contin.       0.0698
t0_parent_z                                        Contin.       0.0186
t0_pol_orient_z                                    Contin.       0.0644
t0_agreeableness_z                                 Contin.       0.1456
t0_conscientiousness_z                             Contin.       0.0769
t0_extraversion_z                                  Contin.       0.0607
t0_honesty_humility_z                              Contin.       0.0181
t0_openness_z                                      Contin.       0.0488
t0_neuroticism_z                                   Contin.       0.0338
t0_modesty_z                                       Contin.       0.0137
t0_religion_identification_level_z                 Contin.       0.0757
t0_kessler_latent_anxiety_z                        Contin.       0.0327
t0_kessler_latent_depression_z                     Contin.       0.0768

Effective sample sizes
           inactive  active very_active
Unadjusted  2880.   3927.       1834.  
Adjusted    1585.48 3760.58      949.56</code></pre>
</div>
</div>
<p>Results for Maori</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_energy<span class="sc">$</span>māori)   <span class="co">#  good</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Balance summary across all treatment pairs
                                                      Type Max.Diff.Adj
t0_male_Not_male                                    Binary       0.0090
t0_gen_cohort_Gen_Silent: born&lt; 1946                Binary       0.0020
t0_gen_cohort_Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965  Binary       0.0161
t0_gen_cohort_GenX: born &gt;=1961 &amp; b.&lt; 1981          Binary       0.0038
t0_gen_cohort_GenY: born &gt;=1981 &amp; b.&lt; 1996          Binary       0.0077
t0_gen_cohort_GenZ: born &gt;= 1996                    Binary       0.0067
t0_urban_urban                                      Binary       0.0058
t0_hours_exercise_coarsen_inactive                  Binary       0.0408
t0_hours_exercise_coarsen_active                    Binary       0.0152
t0_hours_exercise_coarsen_very_active               Binary       0.0256
t0_edu_z                                           Contin.       0.0205
t0_employed_z                                      Contin.       0.0432
t0_nz_dep2018_z                                    Contin.       0.0387
t0_nzsei13_z                                       Contin.       0.0147
t0_partner_z                                       Contin.       0.0179
t0_parent_z                                        Contin.       0.0182
t0_pol_orient_z                                    Contin.       0.0262
t0_agreeableness_z                                 Contin.       0.0057
t0_conscientiousness_z                             Contin.       0.0447
t0_extraversion_z                                  Contin.       0.0117
t0_honesty_humility_z                              Contin.       0.0073
t0_openness_z                                      Contin.       0.0159
t0_neuroticism_z                                   Contin.       0.0134
t0_modesty_z                                       Contin.       0.0053
t0_religion_identification_level_z                 Contin.       0.0167
t0_kessler_latent_anxiety_z                        Contin.       0.0202
t0_kessler_latent_depression_z                     Contin.       0.0125

Effective sample sizes
           inactive active very_active
Unadjusted    307.  354.        160.  
Adjusted      212.2 289.68       97.34</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_ebal<span class="sc">$</span>māori)   <span class="co">#  best</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Balance summary across all treatment pairs
                                                      Type Max.Diff.Adj
t0_male_Not_male                                    Binary       0.0000
t0_gen_cohort_Gen_Silent: born&lt; 1946                Binary       0.0000
t0_gen_cohort_Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965  Binary       0.0000
t0_gen_cohort_GenX: born &gt;=1961 &amp; b.&lt; 1981          Binary       0.0000
t0_gen_cohort_GenY: born &gt;=1981 &amp; b.&lt; 1996          Binary       0.0000
t0_gen_cohort_GenZ: born &gt;= 1996                    Binary       0.0000
t0_urban_urban                                      Binary       0.0000
t0_hours_exercise_coarsen_inactive                  Binary       0.0000
t0_hours_exercise_coarsen_active                    Binary       0.0000
t0_hours_exercise_coarsen_very_active               Binary       0.0000
t0_edu_z                                           Contin.       0.0000
t0_employed_z                                      Contin.       0.0001
t0_nz_dep2018_z                                    Contin.       0.0000
t0_nzsei13_z                                       Contin.       0.0000
t0_partner_z                                       Contin.       0.0002
t0_parent_z                                        Contin.       0.0001
t0_pol_orient_z                                    Contin.       0.0000
t0_agreeableness_z                                 Contin.       0.0001
t0_conscientiousness_z                             Contin.       0.0000
t0_extraversion_z                                  Contin.       0.0000
t0_honesty_humility_z                              Contin.       0.0000
t0_openness_z                                      Contin.       0.0000
t0_neuroticism_z                                   Contin.       0.0000
t0_modesty_z                                       Contin.       0.0000
t0_religion_identification_level_z                 Contin.       0.0001
t0_kessler_latent_anxiety_z                        Contin.       0.0000
t0_kessler_latent_depression_z                     Contin.       0.0001

Effective sample sizes
           inactive active very_active
Unadjusted   307.   354.        160.  
Adjusted     220.54 321.09       76.39</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bal.tab</span>(dt_match_ps<span class="sc">$</span>māori)   <span class="co">#  not good</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Balance summary across all treatment pairs
                                                      Type Max.Diff.Adj
t0_male_Not_male                                    Binary       0.0839
t0_gen_cohort_Gen_Silent: born&lt; 1946                Binary       0.0048
t0_gen_cohort_Gen Boomers: born &gt;= 1946 &amp; b.&lt; 1965  Binary       0.0692
t0_gen_cohort_GenX: born &gt;=1961 &amp; b.&lt; 1981          Binary       0.0203
t0_gen_cohort_GenY: born &gt;=1981 &amp; b.&lt; 1996          Binary       0.0548
t0_gen_cohort_GenZ: born &gt;= 1996                    Binary       0.0131
t0_urban_urban                                      Binary       0.0790
t0_hours_exercise_coarsen_inactive                  Binary       0.0810
t0_hours_exercise_coarsen_active                    Binary       0.1137
t0_hours_exercise_coarsen_very_active               Binary       0.1082
t0_edu_z                                           Contin.       0.1130
t0_employed_z                                      Contin.       0.0998
t0_nz_dep2018_z                                    Contin.       0.1613
t0_nzsei13_z                                       Contin.       0.1672
t0_partner_z                                       Contin.       0.1720
t0_parent_z                                        Contin.       0.1720
t0_pol_orient_z                                    Contin.       0.1194
t0_agreeableness_z                                 Contin.       0.1196
t0_conscientiousness_z                             Contin.       0.0692
t0_extraversion_z                                  Contin.       0.1158
t0_honesty_humility_z                              Contin.       0.0994
t0_openness_z                                      Contin.       0.2098
t0_neuroticism_z                                   Contin.       0.0706
t0_modesty_z                                       Contin.       0.1336
t0_religion_identification_level_z                 Contin.       0.1557
t0_kessler_latent_anxiety_z                        Contin.       0.1641
t0_kessler_latent_depression_z                     Contin.       0.1164

Effective sample sizes
           inactive active very_active
Unadjusted   307.   354.        160.  
Adjusted     181.71 334.58       79.73</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># code for summar</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>sum_e <span class="ot">&lt;-</span> <span class="fu">summary</span>(dt_match_ebal<span class="sc">$</span>euro)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>sum_m <span class="ot">&lt;-</span> <span class="fu">summary</span>(dt_match_ebal<span class="sc">$</span>māori)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>love_plot_e <span class="ot">&lt;-</span> <span class="fu">love.plot</span>(dt_match_ebal<span class="sc">$</span>euro,</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>))<span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NZ Euro PS: ebalance"</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>love_plot_m <span class="ot">&lt;-</span> <span class="fu">love.plot</span>(dt_match_ebal<span class="sc">$</span>māori,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">binary =</span> <span class="st">"std"</span>,</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>          <span class="at">thresholds =</span> <span class="fu">c</span>(<span class="at">m =</span> .<span class="dv">1</span>)) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Māori PS: ebalance"</span>)</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>love_plot_e <span class="sc">/</span> love_plot_m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="experiment_template_files/figure-html/love_plots-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>More data wrangling</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data post-weighting ---------------------------------------------</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>dt_ref_e <span class="ot">&lt;-</span> <span class="fu">subset</span>(dt, t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span>) <span class="co"># original data subset only nz europeans</span></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>dt_ref_e<span class="sc">$</span>weights <span class="ot">&lt;-</span> dt_match_ebal<span class="sc">$</span>euro<span class="sc">$</span>weights <span class="co"># get weights from the ps matching model,add to data</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare data</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>dt_ref_m <span class="ot">&lt;-</span> <span class="fu">subset</span>(dt, t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>)<span class="co"># original data subset only maori</span></span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>dt_ref_m<span class="sc">$</span>weights <span class="ot">&lt;-</span> dt_match_ebal<span class="sc">$</span>māori<span class="sc">$</span>weights <span class="co"># get weights from the ps matching model, add to data</span></span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a><span class="co"># combine data into one data frame</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>dt_ref_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dt_ref_e, dt_ref_m) <span class="co"># combine the data into one dataframe. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s consider a pseudo experiment where someome moves from inactive to active.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we do not evaluate to save time</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="do">### SUBGROUP analysis</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span>  dt_ref_all</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span>  <span class="st">"t2_kessler_latent_anxiety_z"</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="st">"t1_hours_exercise_coarsen"</span> <span class="co"># already defined above</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> baseline_vars_reflective_propensity</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>treat_0 <span class="ot">=</span> <span class="st">"inactive"</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>treat_1 <span class="ot">=</span> <span class="st">"very_active"</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>estimand <span class="ot">=</span> <span class="st">"ATE"</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">=</span> <span class="st">"RD"</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>family <span class="ot">=</span> <span class="st">"gaussian"</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>continuous_X <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>splines <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb75-15"><a href="#cb75-15" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb75-16"><a href="#cb75-16" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="st">"t0_eth_cat"</span></span>
<span id="cb75-17"><a href="#cb75-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-18"><a href="#cb75-18" aria-hidden="true" tabindex="-1"></a><span class="co"># not we interact the subclass X treatment X covariates</span></span>
<span id="cb75-19"><a href="#cb75-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-20"><a href="#cb75-20" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span></span>
<span id="cb75-21"><a href="#cb75-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(</span>
<span id="cb75-22"><a href="#cb75-22" aria-hidden="true" tabindex="-1"></a>    Y,</span>
<span id="cb75-23"><a href="#cb75-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"~"</span>,</span>
<span id="cb75-24"><a href="#cb75-24" aria-hidden="true" tabindex="-1"></a>    S,</span>
<span id="cb75-25"><a href="#cb75-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb75-26"><a href="#cb75-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb75-27"><a href="#cb75-27" aria-hidden="true" tabindex="-1"></a>    X ,</span>
<span id="cb75-28"><a href="#cb75-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb75-29"><a href="#cb75-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb75-30"><a href="#cb75-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(baseline_vars_reflective_propensity, <span class="at">collapse =</span> <span class="st">"+"</span>),</span>
<span id="cb75-31"><a href="#cb75-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span>,</span>
<span id="cb75-32"><a href="#cb75-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span></span>
<span id="cb75-33"><a href="#cb75-33" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb75-34"><a href="#cb75-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-35"><a href="#cb75-35" aria-hidden="true" tabindex="-1"></a><span class="co"># formula_str. # inspect on our own time </span></span>
<span id="cb75-36"><a href="#cb75-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-37"><a href="#cb75-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-38"><a href="#cb75-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-39"><a href="#cb75-39" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb75-40"><a href="#cb75-40" aria-hidden="true" tabindex="-1"></a>fit_all_all  <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb75-41"><a href="#cb75-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(formula_str),</span>
<span id="cb75-42"><a href="#cb75-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights,</span>
<span id="cb75-43"><a href="#cb75-43" aria-hidden="true" tabindex="-1"></a>  <span class="co"># weights = if (!is.null(weight_var)) weight_var else NULL,</span></span>
<span id="cb75-44"><a href="#cb75-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> family,</span>
<span id="cb75-45"><a href="#cb75-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df</span>
<span id="cb75-46"><a href="#cb75-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-47"><a href="#cb75-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-48"><a href="#cb75-48" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate coefficients</span></span>
<span id="cb75-49"><a href="#cb75-49" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(clarify<span class="sc">::</span>sim)</span>
<span id="cb75-50"><a href="#cb75-50" aria-hidden="true" tabindex="-1"></a>sim_model_all <span class="ot">&lt;-</span> <span class="fu">sim</span>(fit_all_all, <span class="at">n =</span> nsims, <span class="at">vcov =</span> <span class="st">"HC0"</span>)</span>
<span id="cb75-51"><a href="#cb75-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-52"><a href="#cb75-52" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in europeans</span></span>
<span id="cb75-53"><a href="#cb75-53" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb75-54"><a href="#cb75-54" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb75-55"><a href="#cb75-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb75-56"><a href="#cb75-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb75-57"><a href="#cb75-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span>,</span>
<span id="cb75-58"><a href="#cb75-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb75-59"><a href="#cb75-59" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-60"><a href="#cb75-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-61"><a href="#cb75-61" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(sim_estimand_all_e)</span></span>
<span id="cb75-62"><a href="#cb75-62" aria-hidden="true" tabindex="-1"></a><span class="co"># note contrast of interest</span></span>
<span id="cb75-63"><a href="#cb75-63" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e <span class="ot">&lt;-</span></span>
<span id="cb75-64"><a href="#cb75-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_e, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span>)</span>
<span id="cb75-65"><a href="#cb75-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-66"><a href="#cb75-66" aria-hidden="true" tabindex="-1"></a><span class="co">#rm(sim_estimand_all_m)</span></span>
<span id="cb75-67"><a href="#cb75-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-68"><a href="#cb75-68" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in māori</span></span>
<span id="cb75-69"><a href="#cb75-69" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb75-70"><a href="#cb75-70" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb75-71"><a href="#cb75-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb75-72"><a href="#cb75-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb75-73"><a href="#cb75-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>,</span>
<span id="cb75-74"><a href="#cb75-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb75-75"><a href="#cb75-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb75-76"><a href="#cb75-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-77"><a href="#cb75-77" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb75-78"><a href="#cb75-78" aria-hidden="true" tabindex="-1"></a><span class="co">#m(sim_estimand_all_m)</span></span>
<span id="cb75-79"><a href="#cb75-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-80"><a href="#cb75-80" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m <span class="ot">&lt;-</span></span>
<span id="cb75-81"><a href="#cb75-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_m, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span>)</span>
<span id="cb75-82"><a href="#cb75-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-83"><a href="#cb75-83" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange</span></span>
<span id="cb75-84"><a href="#cb75-84" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_e) <span class="ot">&lt;-</span></span>
<span id="cb75-85"><a href="#cb75-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_e), <span class="st">"e"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb75-86"><a href="#cb75-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-87"><a href="#cb75-87" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_m) <span class="ot">&lt;-</span></span>
<span id="cb75-88"><a href="#cb75-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_m), <span class="st">"m"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb75-89"><a href="#cb75-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-90"><a href="#cb75-90" aria-hidden="true" tabindex="-1"></a>est_all_anxiety <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sim_estimand_all_m, sim_estimand_all_e)</span>
<span id="cb75-91"><a href="#cb75-91" aria-hidden="true" tabindex="-1"></a>est_all_anxiety <span class="ot">&lt;-</span> <span class="fu">transform</span>(est_all_anxiety, <span class="st">`</span><span class="at">RD_m - RD_e</span><span class="st">`</span> <span class="ot">=</span> RD_m <span class="sc">-</span> RD_e)</span>
<span id="cb75-92"><a href="#cb75-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-93"><a href="#cb75-93" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(est_all_anxiety, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"est_all_anxiety"</span>))</span>
<span id="cb75-94"><a href="#cb75-94" aria-hidden="true" tabindex="-1"></a><span class="co"># view summary</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Calculate E-values</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read data</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>est_all_anxiety <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"est_all_anxiety"</span>))</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make dataframe</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>df_anxiety_all <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">summary</span>(est_all_anxiety) )</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>table_estimates_anxiety <span class="ot">&lt;-</span> df_anxiety_all <span class="sc">|&gt;</span> </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">row.names</span>(df_anxiety_all) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"RD_m"</span>, <span class="st">"RD_e"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">lower_ci =</span> <span class="st">`</span><span class="at">X2.5..</span><span class="st">`</span>,</span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_ci =</span> <span class="st">`</span><span class="at">X97.5..</span><span class="st">`</span>,</span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> Estimate) <span class="sc">|&gt;</span> </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># dplyr::mutate(standard_error = abs(`2.5 %` - `97.5 %`) / 3.92) |&gt; </span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `dplyr::mutate()`.
ℹ In argument: `across(where(is.numeric), round, digits = 3)`.
Caused by warning:
! The `...` argument of `across()` is deprecated as of dplyr 1.1.0.
Supply arguments directly to `.fns` through an anonymous function instead.

  # Previously
  across(a:b, mean, na.rm = TRUE)

  # Now
  across(a:b, \(x) mean(x, na.rm = TRUE))</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># note that I made a function to calculate the Evalue, load this with "experimental functions"</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>test_tab <span class="ot">&lt;-</span> <span class="fu">tab_ate_subgroup_rd</span>(table_estimates_anxiety, <span class="at">delta =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Confidence interval crosses the true value, so its E-value is 1.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>test_tab <span class="sc">|&gt;</span> <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">E[Y(1)]-E[Y(0)]</th>
<th style="text-align: right;">lower_ci</th>
<th style="text-align: right;">upper_ci</th>
<th style="text-align: right;">E_Value</th>
<th style="text-align: right;">E_Val_bound</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RD_m</td>
<td style="text-align: right;">0.027</td>
<td style="text-align: right;">-0.114</td>
<td style="text-align: right;">0.188</td>
<td style="text-align: right;">1.185</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">RD_e</td>
<td style="text-align: right;">-0.077</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: right;">-0.022</td>
<td style="text-align: right;">1.352</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="differences-by-subgroups" class="level2">
<h2 class="anchored" data-anchor-id="differences-by-subgroups">Differences by subgroups</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df_anxiety_all_plot <span class="ot">&lt;-</span> df_anxiety_all <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># filter(row.names(df_anxiety_all) %in% c("RD_m - RD_e")) |&gt; </span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">lower_ci =</span> <span class="st">`</span><span class="at">X2.5..</span><span class="st">`</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_ci =</span> <span class="st">`</span><span class="at">X97.5..</span><span class="st">`</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> Estimate) <span class="sc">|&gt;</span> </span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a> <span class="co"># dplyr::mutate(standard_error = abs(`2.5 %` - `97.5 %`) / 3.92) |&gt; </span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">3</span>)) </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>df_anxiety_all_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                    estimate lower_ci upper_ci
E[Y(inactive)]_m       0.108    0.010    0.201
E[Y(active)]_m         0.138    0.056    0.214
E[Y(very_active)]_m    0.134    0.014    0.264
RD_m                   0.027   -0.114    0.188
E[Y(inactive)]_e       0.034    0.002    0.066
E[Y(active)]_e        -0.021   -0.046    0.002
E[Y(very_active)]_e   -0.043   -0.085    0.004
RD_e                  -0.077   -0.131   -0.022
RD_m - RD_e            0.104   -0.042    0.279</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sub_forest</span>(df_anxiety_all_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="experiment_template_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df_anxiety_all_plot<span class="sc">|&gt;</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lower_ci</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">upper_ci</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">E[Y(inactive)]_m</td>
<td style="text-align: right;">0.108</td>
<td style="text-align: right;">0.010</td>
<td style="text-align: right;">0.201</td>
</tr>
<tr class="even">
<td style="text-align: left;">E[Y(active)]_m</td>
<td style="text-align: right;">0.138</td>
<td style="text-align: right;">0.056</td>
<td style="text-align: right;">0.214</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E[Y(very_active)]_m</td>
<td style="text-align: right;">0.134</td>
<td style="text-align: right;">0.014</td>
<td style="text-align: right;">0.264</td>
</tr>
<tr class="even">
<td style="text-align: left;">RD_m</td>
<td style="text-align: right;">0.027</td>
<td style="text-align: right;">-0.114</td>
<td style="text-align: right;">0.188</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E[Y(inactive)]_e</td>
<td style="text-align: right;">0.034</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">0.066</td>
</tr>
<tr class="even">
<td style="text-align: left;">E[Y(active)]_e</td>
<td style="text-align: right;">-0.021</td>
<td style="text-align: right;">-0.046</td>
<td style="text-align: right;">0.002</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E[Y(very_active)]_e</td>
<td style="text-align: right;">-0.043</td>
<td style="text-align: right;">-0.085</td>
<td style="text-align: right;">0.004</td>
</tr>
<tr class="even">
<td style="text-align: left;">RD_e</td>
<td style="text-align: right;">-0.077</td>
<td style="text-align: right;">-0.131</td>
<td style="text-align: right;">-0.022</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RD_m - RD_e</td>
<td style="text-align: right;">0.104</td>
<td style="text-align: right;">-0.042</td>
<td style="text-align: right;">0.279</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</section>
<section id="depression" class="level2">
<h2 class="anchored" data-anchor-id="depression">Depression</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="do">### SUBGROUP analysis</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span>  dt_ref_all</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span>  <span class="st">"t2_kessler_latent_depression_z"</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="st">"t1_hours_exercise_coarsen"</span> <span class="co"># already defined above</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>baseline_vars <span class="ot">=</span> baseline_vars_reflective_propensity</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>treat_0 <span class="ot">=</span> <span class="st">"inactive"</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>treat_1 <span class="ot">=</span> <span class="st">"very_active"</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>estimand <span class="ot">=</span> <span class="st">"ATE"</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">=</span> <span class="st">"RD"</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">=</span> <span class="dv">1000</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>family <span class="ot">=</span> <span class="st">"gaussian"</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>continuous_X <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>splines <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>S <span class="ot">=</span> <span class="st">"t0_eth_cat"</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a><span class="co"># not we interact the subclass X treatment X covariates</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>formula_str <span class="ot">&lt;-</span></span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a>    Y,</span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"~"</span>,</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a>    S,</span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>    X ,</span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"*"</span>,</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"("</span>,</span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(baseline_vars_reflective_propensity, <span class="at">collapse =</span> <span class="st">"+"</span>),</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span>,</span>
<span id="cb85-31"><a href="#cb85-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span></span>
<span id="cb85-32"><a href="#cb85-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb85-33"><a href="#cb85-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-34"><a href="#cb85-34" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb85-35"><a href="#cb85-35" aria-hidden="true" tabindex="-1"></a>fit_all_dep  <span class="ot">&lt;-</span> <span class="fu">glm</span>(</span>
<span id="cb85-36"><a href="#cb85-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.formula</span>(formula_str),</span>
<span id="cb85-37"><a href="#cb85-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">weights =</span> weights,</span>
<span id="cb85-38"><a href="#cb85-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># weights = if (!is.null(weight_var)) weight_var else NULL,</span></span>
<span id="cb85-39"><a href="#cb85-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> family,</span>
<span id="cb85-40"><a href="#cb85-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df</span>
<span id="cb85-41"><a href="#cb85-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-42"><a href="#cb85-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-43"><a href="#cb85-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-44"><a href="#cb85-44" aria-hidden="true" tabindex="-1"></a><span class="co"># coefs &lt;- coef(fit_all_dep)</span></span>
<span id="cb85-45"><a href="#cb85-45" aria-hidden="true" tabindex="-1"></a><span class="co"># table(is.na(coefs))#   </span></span>
<span id="cb85-46"><a href="#cb85-46" aria-hidden="true" tabindex="-1"></a><span class="co"># insight::get_varcov(fit_all_all)</span></span>
<span id="cb85-47"><a href="#cb85-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-48"><a href="#cb85-48" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate coefficients</span></span>
<span id="cb85-49"><a href="#cb85-49" aria-hidden="true" tabindex="-1"></a><span class="fu">conflicts_prefer</span>(clarify<span class="sc">::</span>sim)</span>
<span id="cb85-50"><a href="#cb85-50" aria-hidden="true" tabindex="-1"></a>sim_model_all <span class="ot">&lt;-</span> <span class="fu">sim</span>(fit_all_dep, <span class="at">n =</span> nsims, <span class="at">vcov =</span> <span class="st">"HC1"</span>)</span>
<span id="cb85-51"><a href="#cb85-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-52"><a href="#cb85-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-53"><a href="#cb85-53" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in europeans</span></span>
<span id="cb85-54"><a href="#cb85-54" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e_d <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb85-55"><a href="#cb85-55" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb85-56"><a href="#cb85-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb85-57"><a href="#cb85-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb85-58"><a href="#cb85-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"euro"</span>,</span>
<span id="cb85-59"><a href="#cb85-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb85-60"><a href="#cb85-60" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-61"><a href="#cb85-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-62"><a href="#cb85-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-63"><a href="#cb85-63" aria-hidden="true" tabindex="-1"></a><span class="co"># note contrast of interest</span></span>
<span id="cb85-64"><a href="#cb85-64" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_e_d <span class="ot">&lt;-</span></span>
<span id="cb85-65"><a href="#cb85-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_e_d, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span>)</span>
<span id="cb85-66"><a href="#cb85-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-67"><a href="#cb85-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-68"><a href="#cb85-68" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate effect as modified in māori</span></span>
<span id="cb85-69"><a href="#cb85-69" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m_d <span class="ot">&lt;-</span> <span class="fu">sim_ame</span>(</span>
<span id="cb85-70"><a href="#cb85-70" aria-hidden="true" tabindex="-1"></a>  sim_model_all,</span>
<span id="cb85-71"><a href="#cb85-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> X,</span>
<span id="cb85-72"><a href="#cb85-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">cl =</span> cores,</span>
<span id="cb85-73"><a href="#cb85-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">subset =</span> t0_eth_cat <span class="sc">==</span> <span class="st">"māori"</span>,</span>
<span id="cb85-74"><a href="#cb85-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb85-75"><a href="#cb85-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb85-76"><a href="#cb85-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-77"><a href="#cb85-77" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb85-78"><a href="#cb85-78" aria-hidden="true" tabindex="-1"></a>sim_estimand_all_m_d <span class="ot">&lt;-</span></span>
<span id="cb85-79"><a href="#cb85-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transform</span>(sim_estimand_all_m_d, <span class="at">RD =</span> <span class="st">`</span><span class="at">E[Y(inactive)]</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">E[Y(very_active)]</span><span class="st">`</span>)</span>
<span id="cb85-80"><a href="#cb85-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-81"><a href="#cb85-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-82"><a href="#cb85-82" aria-hidden="true" tabindex="-1"></a><span class="co"># summary</span></span>
<span id="cb85-83"><a href="#cb85-83" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(sim_estimand_all_e_d)</span></span>
<span id="cb85-84"><a href="#cb85-84" aria-hidden="true" tabindex="-1"></a><span class="co">#summary(sim_estimand_all_m_d)</span></span>
<span id="cb85-85"><a href="#cb85-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-86"><a href="#cb85-86" aria-hidden="true" tabindex="-1"></a><span class="co"># rearrange</span></span>
<span id="cb85-87"><a href="#cb85-87" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_e_d) <span class="ot">&lt;-</span></span>
<span id="cb85-88"><a href="#cb85-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_e_d), <span class="st">"e"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb85-89"><a href="#cb85-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-90"><a href="#cb85-90" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sim_estimand_all_m_d) <span class="ot">&lt;-</span></span>
<span id="cb85-91"><a href="#cb85-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">names</span>(sim_estimand_all_m_d), <span class="st">"m"</span>, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb85-92"><a href="#cb85-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-93"><a href="#cb85-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-94"><a href="#cb85-94" aria-hidden="true" tabindex="-1"></a>est_all_d <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sim_estimand_all_m_d, sim_estimand_all_e_d)</span>
<span id="cb85-95"><a href="#cb85-95" aria-hidden="true" tabindex="-1"></a>est_all_d <span class="ot">&lt;-</span> <span class="fu">transform</span>(est_all_d, <span class="st">`</span><span class="at">RD_m - RD_e</span><span class="st">`</span> <span class="ot">=</span> RD_m <span class="sc">-</span> RD_e)</span>
<span id="cb85-96"><a href="#cb85-96" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(est_all_d, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"est_all_d"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>est_all_d <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"est_all_d"</span>))</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make dataframe</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>df_dep <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="fu">summary</span>(est_all_d) )</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>table_estimates_depression <span class="ot">&lt;-</span> df_dep <span class="sc">|&gt;</span> </span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">row.names</span>(df_dep) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"RD_m"</span>, <span class="st">"RD_e"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">lower_ci =</span> <span class="st">`</span><span class="at">X2.5..</span><span class="st">`</span>,</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_ci =</span> <span class="st">`</span><span class="at">X97.5..</span><span class="st">`</span>,</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> Estimate) <span class="sc">|&gt;</span> </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a> <span class="co"># dplyr::mutate(standard_error = abs(`2.5 %` - `97.5 %`) / 3.92) |&gt; </span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="co"># note that I made a function to calculate the Evalue, load this with "experimental functions"</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>table_depression <span class="ot">&lt;-</span> <span class="fu">tab_ate_subgroup_rd</span>(table_estimates_depression, <span class="at">delta =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Confidence interval crosses the true value, so its E-value is 1.
Confidence interval crosses the true value, so its E-value is 1.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>table_depression <span class="sc">|&gt;</span> <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"markdown"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">E[Y(1)]-E[Y(0)]</th>
<th style="text-align: right;">lower_ci</th>
<th style="text-align: right;">upper_ci</th>
<th style="text-align: right;">E_Value</th>
<th style="text-align: right;">E_Val_bound</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">RD_m</td>
<td style="text-align: right;">0.028</td>
<td style="text-align: right;">-0.120</td>
<td style="text-align: right;">0.185</td>
<td style="text-align: right;">1.189</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">RD_e</td>
<td style="text-align: right;">-0.039</td>
<td style="text-align: right;">-0.103</td>
<td style="text-align: right;">0.021</td>
<td style="text-align: right;">1.230</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Summary</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># view summary</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>df_dep <span class="sc">|&gt;</span> </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">X2.5..</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">X97.5..</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">E[Y(inactive)]_m</td>
<td style="text-align: right;">0.1510358</td>
<td style="text-align: right;">0.0537454</td>
<td style="text-align: right;">0.2442848</td>
</tr>
<tr class="even">
<td style="text-align: left;">E[Y(active)]_m</td>
<td style="text-align: right;">0.1877594</td>
<td style="text-align: right;">0.1031401</td>
<td style="text-align: right;">0.2866124</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E[Y(very_active)]_m</td>
<td style="text-align: right;">0.1793980</td>
<td style="text-align: right;">0.0718405</td>
<td style="text-align: right;">0.2990333</td>
</tr>
<tr class="even">
<td style="text-align: left;">RD_m</td>
<td style="text-align: right;">0.0283622</td>
<td style="text-align: right;">-0.1197312</td>
<td style="text-align: right;">0.1854479</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E[Y(inactive)]_e</td>
<td style="text-align: right;">0.0035095</td>
<td style="text-align: right;">-0.0324475</td>
<td style="text-align: right;">0.0411906</td>
</tr>
<tr class="even">
<td style="text-align: left;">E[Y(active)]_e</td>
<td style="text-align: right;">-0.0168208</td>
<td style="text-align: right;">-0.0404293</td>
<td style="text-align: right;">0.0071173</td>
</tr>
<tr class="odd">
<td style="text-align: left;">E[Y(very_active)]_e</td>
<td style="text-align: right;">-0.0358775</td>
<td style="text-align: right;">-0.0825212</td>
<td style="text-align: right;">0.0120629</td>
</tr>
<tr class="even">
<td style="text-align: left;">RD_e</td>
<td style="text-align: right;">-0.0393869</td>
<td style="text-align: right;">-0.1027416</td>
<td style="text-align: right;">0.0212851</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RD_m - RD_e</td>
<td style="text-align: right;">0.0677491</td>
<td style="text-align: right;">-0.0902557</td>
<td style="text-align: right;">0.2292381</td>
</tr>
</tbody>
</table>


</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This table provides estimated levels of depression, in standard deviation units, for different levels of activity for two groups: Māori (indicated by "_m") and NZ Europeans (indicated by "_e").</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The expectations are named as `E[Y(&lt;level of activity&gt;)]_group`, where the level of activity can be `inactive`, `active`, or `very_active`.</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Here is a breakdown of the results.</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   1. For the Māori group (`_m`):</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   - `E[Y(inactive)]_m`: When inactive, the expected level of depression is 0.23 standard deviations, with a 95% confidence interval from 0.116 to 0.356.</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a><span class="co"># - `E[Y(active)]_m`: When active, the expected level of depression decreases to 0.193 standard deviations, with a 95% confidence interval from 0.108 to 0.282.</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a><span class="co"># - `E[Y(very_active)]_m`: When very active, the expected level of depression further decreases to 0.133 standard deviations, with a 95% confidence interval from 0.009 to 0.262.</span></span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - `RD_m`: The risk difference (RD) between inactive and very active Māori individuals is 0.097 standard deviations, with a 95% confidence interval from -0.068 to 0.274. This indicates a decrease in depression when individuals move from an inactive to a very active lifestyle.</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. For the NZ European group (`_e`):</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb90-16"><a href="#cb90-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   - `E[Y(inactive)]_e`: When inactive, the expected level of depression is 0.034 standard deviations, with a 95% confidence interval from -0.012 to 0.078.</span></span>
<span id="cb90-17"><a href="#cb90-17" aria-hidden="true" tabindex="-1"></a><span class="co"># - `E[Y(active)]_e`: When active, the expected level of depression slightly decreases to -0.006 standard deviations, with a 95% confidence interval from -0.03 to 0.016.</span></span>
<span id="cb90-18"><a href="#cb90-18" aria-hidden="true" tabindex="-1"></a><span class="co"># - `E[Y(very_active)]_e`: When very active, the expected level of depression further decreases to -0.046 standard deviations, with a 95% confidence interval from -0.086 to -0.007.</span></span>
<span id="cb90-19"><a href="#cb90-19" aria-hidden="true" tabindex="-1"></a><span class="co"># - `RD_e`: The risk difference (RD) between inactive and very active NZ European individuals is 0.081 standard deviations, with a 95% confidence interval from 0.02 to 0.138. Similar to the Māori group, this indicates a decrease in depression when individuals move from an inactive to a very active lifestyle.</span></span>
<span id="cb90-20"><a href="#cb90-20" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb90-21"><a href="#cb90-21" aria-hidden="true" tabindex="-1"></a><span class="co"># The last row, `RD_m - RD_e`, represents the difference in risk differences between Māori and NZ Europeans. It's 0.017 standard deviations with a 95% confidence interval from -0.152 to 0.204. This is not statistically significant (the confidence interval contains 0), suggesting that the difference in depression reduction from being inactive to very active is not significantly different between the two groups.</span></span>
<span id="cb90-22"><a href="#cb90-22" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb90-23"><a href="#cb90-23" aria-hidden="true" tabindex="-1"></a><span class="co"># These are estimates and subject to statistical uncertainty. While they suggest a trend, the wide confidence intervals indicate that these estimates come with a degree of uncertainty.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>df_dep_plot_data <span class="ot">&lt;-</span> df_dep <span class="sc">|&gt;</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">rename</span>( <span class="at">lower_ci =</span> <span class="st">`</span><span class="at">X2.5..</span><span class="st">`</span>,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_ci =</span> <span class="st">`</span><span class="at">X97.5..</span><span class="st">`</span>,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate =</span> Estimate) </span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>df_dep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                        Estimate      X2.5..     X97.5..
E[Y(inactive)]_m     0.151035788  0.05374538 0.244284755
E[Y(active)]_m       0.187759424  0.10314013 0.286612442
E[Y(very_active)]_m  0.179397991  0.07184045 0.299033259
RD_m                 0.028362203 -0.11973124 0.185447917
E[Y(inactive)]_e     0.003509459 -0.03244753 0.041190620
E[Y(active)]_e      -0.016820762 -0.04042933 0.007117345
E[Y(very_active)]_e -0.035877479 -0.08252119 0.012062852
RD_e                -0.039386939 -0.10274163 0.021285115
RD_m - RD_e          0.067749141 -0.09025568 0.229238107</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>plot_sub_forest <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">require</span>(ggplot2)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if required packages are installed</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  required_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  new_packages <span class="ot">&lt;-</span> required_packages[<span class="sc">!</span>(required_packages <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[, <span class="st">"Package"</span>])]</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(new_packages))</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Missing packages: "</span>, <span class="fu">paste</span>(new_packages, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if required columns are in the dataframe</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  required_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"lower_ci"</span>, <span class="st">"upper_ci"</span>)</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>  missing_cols <span class="ot">&lt;-</span> required_cols[<span class="sc">!</span>(required_cols <span class="sc">%in%</span> <span class="fu">colnames</span>(df))]</span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing_cols) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Missing columns in dataframe: "</span>, <span class="fu">paste</span>(missing_cols, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order the factor levels by the estimate column in decreasing order</span></span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>estimate, <span class="at">y=</span><span class="fu">factor</span>(<span class="fu">row.names</span>(df)))) <span class="sc">+</span></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbarh</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower_ci, <span class="at">xmax =</span> upper_ci), <span class="at">height=</span><span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Estimate"</span>) <span class="sc">+</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">""</span>)</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_sub_forest</span>(df_dep_plot_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="experiment_template_files/figure-html/my_graph-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>