---
title: "Your Title Here"
abstract: |
   Your abstract herr. 
   
   **KEYWORDS**: *Causal Inference*; *Cross-validation*; *Longitudinal*; *Machine Learning*;  *Semi-parametric*; *Targeted Learning*; *TMLE*; **OTHERS**; **FEWER**.
author: 
  - name: YOUR NAME HERE
    affiliation: Victoria University of Wellington, New Zealand
    orcid: 0000-0000-0000-0000
    email: your.name@vuw.ac.nz
    corresponding: yes
  - name: YOUR CO-AUTHOR HERE
    affiliation: Georgia State University, Matheny Center for the Study of Stress, Trauma, and Resilience
    orcid: 0000-0000-0000-0000
    email: your.coauthor@gsu.edu
editor_options: 
  chunk_output_type: console
format:
  pdf:
    sanitise: true
    keep-tex: true
    link-citations: true
    colorlinks: true
    documentclass: article
    classoption: [single column]
    lof: false
    lot: false
    geometry:
      - top=30mm
      - left=25mm
      - heightrounded
      - headsep=22pt
      - headheight=11pt
      - footskip=33pt
      - ignorehead
      - ignorefoot
    header-includes:
      - \input{/Users/joseph/GIT/latex/latex-for-quarto.tex}
    template-partials: 
      - /Users/joseph/GIT/templates/quarto/title.tex
date: last-modified
execute:
  echo: false
  warning: false
  include: true
  eval: true
fontfamily: libertinus
bibliography: /Users/joseph/GIT/templates/bib/references.bib
csl: /Users/joseph/GIT/templates/csl/camb-a.csl
---

```{r}
#| label: load-libraries
#| echo: false
#| include: false
#| eval: true


# copy this template and add a path to it to your machine
# https://github.com/go-bayes/templates/blob/main/quarto/title.tex
# set the path using `    template-partials: ` above

## install latest version of quarto
#  https://quarto.org/docs/download/

# create a fixed path to your bibliography mine is here: 
# https://github.com/go-bayes/templates/blob/main/bib/references.bib

# add and remove items by going to google scholar and copying the syntax from the citation, using 
# bibtex format

# if you want to add a csl file add it above in the yaml. mine is here:
# https://github.com/go-bayes/templates/tree/main/csl

# Install tiny text by running this in your terminal (not the console)
# quarto install tinytex --update-path


#optional headers, e.g. I use this for my DAGS to save time 
    # header-includes:
    #   - \input{/Users/joseph/GIT/latex/latex-for-quarto.tex}


# SET THE CORRECT PATH TO WHERE YOU SAVED YOUR MODELS 
# example
push_mods <- here::here('/Users/joseph/Library/CloudStorage/Dropbox-v-project/data/saved')


# load libraries 

# make sure you install tiny tex
library("tinytex")

# if you want nice fonts (optional)
library("extrafont")

# data wrangling
library("tidyverse")

# tables 
library("kableExtra")

# utility functions, interpreations & etc. 
library("margot")

# tables
library("gtsummary")

# multiple graphs
library("patchwork")

# results in-line
library("glue")




# set divice
loadfonts(device = "all")

## Read in data from analysis -- this will be read from your analysis script

# n total in the study 
n_total <-  margot::here_read("n_total")

# n participants in your study 
n_participants <- margot::here_read("n_participants")

# n (un)censored sample
n_censored_sample <- here_read("n_censored_sample")



# n by groups
n_participants_born_overseas <- margot::here_read("n_participants_born_overseas")
n_participants_born_nz <- margot::here_read("n_participants_born_nz")

# mean exposure (if needed)
mean_exposure <- here_read("mean_exposure")

# sd exposure (if needed)
sd_exposure <- here_read("sd_exposure")

# baseline table
table_baseline <- here_read("table_baseline")

# exposure table
table_exposures <- here_read("table_exposures")

# outcome table
table_outcomes <- margot::here_read("table_outcomes")

# graph densisity shift function
graph_density_shift_function <- margot::here_read("graph_density_shift_function")

# transition table
transition_table <- margot::here_read("transition_table")


# iptw score graph: marginal
love_plot_marginal <- margot::here_read("love_plot_marginal")

# summary of iptw model
summary_iptw_marginal <- margot::here_read("summary_iptw_marginal")


# transition table
transition_table <- margot::here_read("transition_table")


# if using binary gains and losses
# transition_table_binary_gain <- margot::here_read("transition_table_binary_gain")
# transition_table_binary_loss <- margot::here_read("transition_table_binary_loss")

# import missing values at baseline
viss_miss_baseline <-  margot::here_read("viss_miss_baseline")



# # ordinary regressions
fit_kessler_latent_anxiety<- margot::here_read('fit_kessler_latent_anxiety')
fit_kessler_latent_depression<-margot::here_read('fit_kessler_latent_depression')

# full models
lm_fit_kessler_latent_anxiety <-  margot::here_read("lm_fit_kessler_latent_anxiety")
lm_fit_kessler_latent_depression <-  margot::here_read("lm_fit_kessler_latent_depression")

# betas from models
b_lm_fit_kessler_latent_anxiety <-  margot::here_read("b_lm_fit_kessler_latent_anxiety")
b_lm_fit_kessler_latent_depression <-  margot::here_read("b_lm_fit_kessler_latent_depression")




# practical effect sizes -------------------------------------------------------
# compute magnitudes 
contrast_t2_kessler_latent_anxiety_z <- margot::here_read("contrast_t2_kessler_latent_anxiety_z")
contrast_t2_kessler_latent_depression_z <- margot::here_read("contrast_t2_kessler_latent_depression_z")

# get effect sizes 
marginal_eff_anxiety <- round( contrast_t2_kessler_latent_anxiety_z$vals$theta, 3)
marginal_eff_depression <-  round( contrast_t2_kessler_latent_depression_z$vals$theta, 3) 

# marginal effects
#marginal_eff_anxiety
#marginal_eff_depression


regression_regular_anxiety  <- round( (fit_kessler_latent_anxiety$coefficients[2] ), 3) #  1 x sd change
regression_regular_depression  <- round( (fit_kessler_latent_depression$coefficients[2] ), 3) #  1 x sd change

# cross-sectional regressions
#regression_regular_anxiety
#regression_regular_depression


percent_greater_regression_anxiety <- 
  round( (regression_regular_anxiety/marginal_eff_anxiety), 2) 

# percentage greater cross-sectional inference
#percent_greater_regression_anxiety


percent_greater_regression_depression<- 
  round( (regression_regular_depression/marginal_eff_depression), 2) 

# percentage greater cross-sectional inference
#percent_greater_regression_depression

# comarative results -------------------------------------------------------

difference_in_group_means_anxiety <- margot::here_read("difference_in_group_means_anxiety")

difference_in_group_means_depression <- margot::here_read("difference_in_group_means_depression")


# import tables to manuscript -------------------------------------------------------

# marginal results: table for manuscript
tab_marginal_outcomes <- margot::here_read("tab_marginal_outcomes")

# table for graph 
group_tab_marginal_outcomes <- margot::here_read("group_tab_marginal_outcomes")


# Compute for manuscript
diff_data_scale_anxiety <- round( ( sd_exposure *  tab_marginal_outcomes[1,1]), 2)
# diff_anxiety_data_scale makes a .16 difference on the data scale 1-7

diff_data_scale_depression <- round( ( sd_exposure *  tab_marginal_outcomes[2,1]), 2)
# diff_data_scale_depression  makes a .16 difference on the data scale 1-7

# compute more if/as needed...


# marginal results: table for manuscript
tab_marginal_outcomes <- margot::here_read("tab_marginal_outcomes")

# table for graph 
group_tab_marginal_outcomes <- margot::here_read("group_tab_marginal_outcomes")

# read table for overseas
tab_born_overseas_outcomes <- margot::here_read("tab_born_overseas_outcomes")
group_tab_born_overseas_outcomes <- margot::here_read("group_tab_born_overseas_outcomes")

# read table for born in NZ
tab_born_nz_outcomes <- margot::here_read("tab_born_nz_outcomes")
group_tab_born_nz_outcomes <- margot::here_read("group_tab_born_nz_outcomes")



# graphs ------------------------------------------------------------------
title = "Causal Effect of + 1 Perfactionism vs. Status Quo"

# remind self of number n_participants
marginal_sub_title = "Marginal Effects N = 19,997"


# remind self n_participants_born_nz
conditional_born_nz_sub_title = "Born in NZ Effects N = 11,381"

# remind self n_participants_born_overseas
conditional_born_overseas_sub_title = "Born Overseas Effects N = 2,949"

# play aroud with size
plot_group_tab_marginal_outcomes <- margot::margot_plot(
  group_tab_marginal_outcomes,
  type = "RD",
  title = title,
  subtitle = marginal_sub_title,
  #"Self-Reported Prosociality",
  estimate_scale = 3,
  base_size = 14,
  text_size = 4,
  point_size = 2,
  title_size = 12,
  subtitle_size = 12,
  legend_text_size = 10,
  legend_title_size = 10,
  x_offset = -.15,
  x_lim_lo = -.5,
  x_lim_hi =  .5
)+ xlab("")

#plot_group_tab_marginal_outcomes

plot_group_tab_born_nz_outcomes<- margot::margot_plot(
  group_tab_born_nz_outcomes,
  type = "RD",
  title = title,
  subtitle = conditional_born_nz_sub_title,
  #"Self-Reported Prosociality",
  estimate_scale = 3,
  base_size = 14,
  text_size = 4,
  point_size = 2,
  title_size = 12,
  subtitle_size = 12,
  legend_text_size = 10,
  legend_title_size = 10,
  x_offset = -.15,
  x_lim_lo = -.5,
  x_lim_hi =  .5
)+ xlab("")

#plot_group_tab_born_nz_outcomes

# plot born overseas
plot_group_tab_born_overseas_outcomes<- margot::margot_plot(
  group_tab_born_overseas_outcomes,
  type = "RD",
  title = title,
  subtitle = conditional_born_overseas_sub_title,
  #"Self-Reported Prosociality",
  estimate_scale = 3,
  base_size = 14,
  text_size = 4,
  point_size = 2,
  title_size = 12,
  subtitle_size = 12,
  legend_text_size = 10,
  legend_title_size = 10,
  x_offset = -.15,
  x_lim_lo = -.5,
  x_lim_hi =  .5
)+ xlab("")

#plot_group_tab_born_overseas_outcomes


# pathwork

plot_combo_conditional <- plot_group_tab_born_nz_outcomes /
plot_group_tab_born_overseas_outcomes + 
  plot_annotation(title = "Group Comparisons: Perfectionism on Distress", tag_levels = 'A',
             theme = theme(plot.title = element_text(size = 16, face = "bold")))

```


## Introduction

A central question in the scientific study of XXXX is whether YYYY fosters ZZZZZ [@johnson2005; @norenzayan2016; @watts2016; @watts2015; @sosis2003cooperation; @whitehouse2023; @schloss2011evolutionary; @swanson1967; @decoulanges1903; @wheatley1971]. However, quantifying causal effects for YYYY, and many other social behaviours presents significant challenges. 

Investigators have limited scope to randomise YYYY on ZZZZZ. On the other hand, valid causal inferences from non-experimental or observational data must combine high-resolution repeated-measures time-series data with robust methods for causal inference. Few studies meet this standard... 

An encouraging recent attempt to obtain valid causal inference is PPPP's thoughtful investigation of the relationships between religious attendance, beliefs, and affiliation on blood donations among pregnant women and their partners who were residents of Bristol, United Kingdom, in the early 1990s and participated in the Avon Longitudinal Study of Parents and Children, $N=13,477$ mothers and $N=13,424$ partners [@major2023exploring]. PPPP's study begins with a careful overview of the threats to causal inference from confounding and selection bias....

Although we may sometimes use cross-sectional associations to obtain credible suggestions about causality, we cannot typically attach causal interpretations, at least not without strong assumptions about the relative order and timing of events [@vanderweele2021can]. Indeed, below we report an analysis restricted to baseline New Zealand Attitudes and Values Study data that observes a `r percent_greater_regression_anxiety` times overstatement for the effect of perfectionism on anxiety and a `r percent_greater_regression_depression` times overstatement for perfectionism's effect on depression...


Here, to obtain causal inferences from time-series data, we leverage comprehensive panel data from a **SYNTHETIC DATASET** for `r n_participants` participants in the New Zealand Attitudes and Values Study from 2018-2021 to quantify the effects of clearly defined interventions in religious attendance across the population of New Zealanders on two features of mental health: "Depression" and "Anxiety" These outcomes are called “counterfactual” or “potential” outcomes, terms we use interchangeably [@rubin2005; @neyman1923; @robins1986; @pearl2009; @vanderlaan2018].[^theory] 

A fundamental challenge in observational studies is to ensure *balance* between the variables in interventions or “treatments” to be compared that might affect both treatment and the potential outcomes under treatment [@shiba2021using]. We call the state of imbalance *confounding*, and the strategy for ensuring balance, *confounding control.* In this study, we express the interventions on religious service as "modified treatment policies" [@haneuse2013estimation; @diaz2023lmtp; @díaz2021; @hoffman2023]. We obtain causal inferences by contrasting inferred population averages under different modified treatment policies.

[^theory]: Philosophical disagreements about the meanings assigned to "potential" and "counterfactual" outcomes do not affect our use.

Our initial causal contrast investigates: "What would be the average difference across the New Zealand population if everyone were to become one unit greater on a 1-7 ordinal scale in Perfectionism versus the status quo" This contrast addresses the practically interesting question ... 

A second analysis investigates whether there are differences in the causal effects of perfectionism among those born in New Zealand and those born oveseas.  A considerable body of acculturation research suggestions...  yadda yadda

Note that our approach does not focus on testing specific hypotheses; instead, we aim to compute our pre-specified causal contrasts with high accuracy by combining appropriate time-series data and robust methods for causal inference [@hernan2024stating].


## Method

### Sample

Data were *SIMULATED* from responses to the New Zealand Attitudes and Values Study (NZAVS), an annual longitudinal national probability panel study of social attitudes, personality, ideology, and health outcomes in New Zealand. Chris G. Sibley started the New Zealand Attitudes and Values Study in 2009, which has grown to include a community of over fifty researchers. In this simulated dataset there were `r n_total` New Zealand residents. The New Zealand Attitudes and Values Study operates independently of political or corporate funding and is based in a university setting. Data summaries for our study sample on all measures used in this study are found in **Appendices B-D**.  For more details about the New Zealand Attitudes and Values Study see: [OSF.IO/75SNB](https://doi.org/10.17605/OSF.IO/75SNB).

### Treatment Indicator

Perfectionism was assessed using a three item "almost perfect scale":

- *Yadda*
- *Yadda*
- *Dadda*


### Measures of Well-Being


Kessler-6. Yadda... 

- Anxiety:
  *"Yadda*
  
- Depression:
  *Yadda*


**Subgroup Analysis** 

We assessed group differences in these effects ....


We provide comprehensive details of all measures in **Appendix A**.


### Causal Interventions

We define three targeted causal contrasts (*causal estimands*) as interventions on prespecified modified treatment policies (refer to @haneuse2013estimation; @diaz2021nonparametric; @diaz2023lmtp). Let $A_t$ denote the treatment -- monthly frequency of religious service. There are three time points: $t\in{0,1,2}$, where $t=0$ denotes the baseline wave, $t=1$, the treatment wave, and $t=2$ at the end of the study. $\mathbf{d}(\cdot)$ denotes a modified treatment policy $f_\mathbf{d}$. When a treatment is fixed to a level defined by the modified treatment policy, perhaps contrary to a participant's observed level of treatment, we use the lowercase symbol $a_1$. Here, the functions defined by modified treatment policies $f_\mathbf{d}$ are interventions that fix $A_1$ to $a_1$.

1. **Regular Religious Service Treatment**: Administer treatment that leads to a +1 unit greater perfectionism to everyone in the adult population from 1-7 on the perfectionism scale. If an individual's perfectionism is within one unit of the top of the range, adminster the maximum value at the range:

$$
\mathbf{d}^\lambda (a_1) = \begin{cases} 7 & \text{if } a_1 <  6 \\ 
a_1 + 1 & \text{otherwise} \end{cases}
$$

<!-- 2. **Zero Religious Service Treatment**: Ensure no religious service attendance for everyone in the adult population of New Zealand. If an individual's religious service attendance is greater than zero, shift to zero; otherwise, make no change: -->

<!-- $$ -->
<!-- \mathbf{d}^\phi (a_1) = \begin{cases} 0 & \text{if } a_1 > 0 \\  -->
<!-- a_1 & \text{otherwise} \end{cases} -->
<!-- $$ -->

3. **Status Quo -- No Treatment**: Apply no treatment. Each expected mean outcome is calculated using each individual's natural (observed) value of religious service attendance.


$$
\mathbf{d}(a_1) = a_1
$$


### Causal Contrasts

From these policies, we compute the following causal contrasts.


**Target Contrast B: 'Regular vs. Status Quo'**: What is the marginal effect of the treatment in New Zealand compared with its status quo?

$$ \text{Regular Religious Service vs. No Treatment} = E[Y(\mathbf{d}^\lambda) - Y(\mathbf{d})] $$

This contrast reflects a policy-relevant hypothetical experiment examining the effect of shifting everyone's perfectionism up by one point, allowing us to quantitatively assess how much a society in which everyone attends would differ from a society in its current state. 

<!-- **Target Contrast C: 'Zero vs. Status Quo'**: What are the social consequences for society of zero religious service attendance compared to its status quo? -->

<!-- $$ \text{Zero Religious Service vs. No Treatment} = E[Y(\mathbf{d}^\phi) - Y(\mathbf{d})] $$ -->

<!-- This contrast investigates the policy implications of eliminating religious services entirely, questioning whether such a shift would meaningfully affect average levels of charitable donations and volunteering. -->

### Identification Assumptions

To consistently estimate a causal effect, investigators must satisfy three assumptions:

1. **Causal consistency:** potential outcomes must correspond with observed outcomes under the treatments in the data. Essentially, we assume potential outcomes do not depend on how the treatment was administered, conditional on measured covariates [@vanderweele2009; @vanderweele2013]. 

2. **Exchangeability**: given observed covariates, we assume treatment assignment is independent of the potential outcomes to be contrasted. In other words, there is "no unmeasured confounding" [@hernan2024WHATIF; @chatton2020].

3. **Positivity:** every individual must have a non-zero chance of receiving the treatment, regardless of their covariate values @westreich2010. We evaluate this assumption in each study by examining changes in religious service attendance from baseline (NZAVS time 10) to the treatment wave (NZAVS time 11). For further discussion of these assumptions in the context of NZAVS studies, see @bulbulia2023a.


### Target Population

The target population for this study comprises New Zealand residents as represented in the baseline wave of the **SIMULATED** New Zealand Attitudes and Values Study (NZAVS) during the years 2018-2019, weighted by New Zealand Census weights for age, gender, and ethnicity (refer to @sibley2021). The NZAVS is a national probability study designed to reflect the broader New Zealand population accurately. Despite its comprehensive scope, the NZAVS does have some limitations in its demographic representation. Notably, it tends to slightly under-sample males and individuals of Asian descent while slightly over-sampling females and Māori (the indigenous peoples of New Zealand). To address these disparities and enhance the accuracy of our findings, we apply constructed survey weights to address the gender imbalance, which was presented largest of threat to external validity. These sample weights were integrated into statistical models using the `weights` option in `lmtp` [@williams2021], following protocols stated in @bulbulia2024PRACTICAL.


### Eligibility Criteria

To be included in the analysis of this study, participants needed to meet the following eligibility criteria:

### Inclusion Criteria

- Enrolled in the **SIMULATED** 2018 wave of the New Zealand Attitudes and Values Study (NZAVS time 10).
- Missing covariate data at baseline was permitted, and the data was subjected to imputation methods to reduce bias. Only information obtained at baseline was used for such imputation (refer to @zhang2023shouldMultipleImputation).
Participants may have been lost to follow-up the end of study NZAVS time 11 or 12. We constructed inverse probability of censoring weights for missing responses at time 11. We adjusted for attrition and non-response at time 12 automatically by specifying a censoring indicator to `lmtp` when estimating outcomes as described below.

### Exclusion Criteria

- Missing data in the perfectionism scale at baseline, wave 10 of the **SIMULATED** New Zealand Attitudes and Values Study.


A total of `r n_participants` **SIMULATED** individuals met these criteria and were included in the study.


###  Causal Identification 

::: {#tbl-02}
```{=latex}
\examplelongitudinal
```
This table presents a three-wave panel design as described in @vanderweele2020. By adjusting for a rich array of baseline covariates, includeing baseline treatment and baseline outcomes, we reduce the threats to confounding control in a three-wave panel design. @bulbulia2024PRACTICAL.
:::


@tbl-02 presents three Single World Intervention Graphs (SWIGs) that describe our confounding control  (identification strategy) [@robins2010alternative; @richardson2013swigsprimer; @shpitser2022multivariate; @richardson2023nested; @richardson2023potential; @shpitser2016causal]. Our approach consistently applies the same identification strategy across all functions estimated in this study. Unlike standard causal diagrams, SWIGs allow us to *separately* read the factorisation of the conditional dependencies for the distribution of each set of counterfactual outcomes under each modified treatment policy [@richardson2013swigsprimer]. Note, that the natural value of the treatment $A$ is obtained both from its observed instances and from baseline historical data, including the baseline treatment. This method ensures that our analysis accurately captures the causal effects of flexible treatment regimes that rely on levels of religious service attendance at the treatment wave, while ensuring balance for each treatment function that we compare [@diaz2012population; @young2014identification; @diaz2021nonparametric]. 


### Confounding Control

To manage confounding in our analysis, we implement @vanderweele2019's *modified disjunctive cause criterion* by following these steps:

  1. **Identified all common causes** of both the treatment and outcomes to ensure a comprehensive approach to confounding control.
  2. **Excluded instrumental variables** that affect the exposure but not the outcome. Instrumental variables do not contribute to controlling confounding and can reduce the efficiency of the estimates.
  3. **Included proxies for unmeasured confounders** affecting both exposure and outcome. According to the principles of d-separation, using proxies allows us to control for their associated unmeasured confounders indirectly.
  4. **Controlled for baseline exposure** and **baseline outcome**. Both are used as proxies for unmeasured common causes, enhancing the robustness of our causal estimates.

[Appendix B](#appendix-demographics) details the covariates we included for confounding control. These methods adhere to the guidelines provided in [@bulbulia2024PRACTICAL] and were pre-specified in our study protocol [https://osf.io/ce4t9/](https://osf.io/ce4t9/).



### Missing Data
To mitigate bias from missing data, we implement the following strategies:

**Baseline missingness**: we employed the `ppm` algorithm from the `mice` package in R [@vanbuuren2018] to impute missing baseline data. This method allowed us to reconstruct incomplete datasets by estimating a plausible value for missing observation. Because we could only pass one data set to the `lmtp`, we employed single imputation. About 2% of covariate values were missing at baseline. Eligibility for the study required fully observed baseline treatment measures as well as treatment wave treatment measures. Again, we only used baseline data to impute baseline missingness (refer to @zhang2023shouldMultipleImputation).

**treatment-wave missingness in time 11 (treatment wave)**: to adjust for censoring in the treatment wave, we estimated inverse probability of censoring weights by predicting loss-to follow up from all indicators, including the baseline values of the treatment and outcomes. We used same superlearners employed in the causal estimation models (`ranger`, `xgboost`, `glmnet`) and impliented 10-fold cross validation.  

**Outcome missingness in time 12 (outcome wave)**: to address confounding and selection bias arising from missing responses and panel attrition, we applied censoring weights obtained using nonparametric machine learning ensembles afforded by the `lmtp` package (and its dependencies) in R [@williams2021]. 

### Statistical Estimator

<!-- We use a Sequentially Doubly-Robust (SDR) estimator designed for the analysis of longitudinal data within causal inference frameworks [@díaz2021]. The estimator is grounded in the principles of robust semi-parametric statistics and is characterised first by its sequential approach to handling time-varying treatments and outcomes and, secondly, its double robustness property. -->

<!-- Fundamentally, the SDR estimator operates by iteratively regressing pseudo-outcomes on observed treatments and covariates at each time point, starting from the end of the observation period and proceeding backwards. This iterative process employs the concept of pseudo-outcomes, which are updated at each step based on the outcome of the regression, incorporating information from both the treatment mechanism and the outcome model. -->

<!-- A key feature of the SDR estimator is its 'multiply robust' property, implying that the estimator remains consistent if, for each time point, either the model for the treatment assignment or the model for the outcome, conditional on past treatments and covariates, is correctly specified. This property significantly enhances the estimator's applicability to real-world scenarios such as ours, where model misspecification is a common challenge. Furthermore, the marriage of SDR and machine learning reduces the dependence of inference on restrictive modelling assumptions and introduces an additional layer of robustness. For further details see [@hoffman2022; @hoffman2023; @díaz2021]. Estimation was performed using the `lmtp` package [@williams2021].  -->


We perform statistical estimation using semi-parametric Targeted Learning, specifically a Targeted Minimum Loss-based Estimation (TMLE) estimator. TMLE is a robust method that combines machine learning techniques with traditional statistical models to estimate causal effects while providing valid statistical uncertainty measures for these estimates [@van2014targeted; @van2012targeted].

TMLE operates through a two-step process that involves modelling both the outcome and treatment (exposure). Initially, TMLE employs machine learning algorithms to flexibly model the relationship between treatments, covariates, and outcomes. This flexibility allows TMLE to account for complex, high-dimensional covariate spaces *efficiently* without imposing restrictive model assumptions [@van2014discussion; @vanderlaan2011; @vanderlaan2018]. The outcome of this step is a set of initial estimates for these relationships.

The second step of TMLE involves "targeting" these initial estimates by incorporating information about the observed data distribution to improve the accuracy of the causal effect estimate. TMLE achieves this precision through an iterative updating process, which adjusts the initial estimates towards the true causal effect. This updating process is guided by the efficient influence function, ensuring that the final TMLE estimate is as close as possible, given the measures and data, to the targeted causal effect while still being robust to model-misspecification in either the outcome or the treatment model [@van2014discussion].

Again, a central feature of TMLE is its double-robustness property. If either the treatment model or the outcome model is correctly specified, the TMLE estimator will consistently estimate the causal effect. Additionally, we used cross-validation to avoid over-fitting, following the pre-stated protocols in @bulbulia2024PRACTICAL.  The integration of TMLE and machine learning technologies reduces the dependence on restrictive modelling assumptions and introduces an additional layer of robustness. For further details of the specific targeted learning strategy we favour, see [@hoffman2022; @hoffman2023; @díaz2021]. We perform estimation using the `lmtp` package [@williams2021]. We used the `superlearner` library for semi-parametric estimation with the predefined libraries `SL.ranger`, `SL.glmnet`, and `SL.xgboost` [@polley2023; @xgboost2023; @Ranger2017]. We created graphs, tables and output reports using the `margot` package [@margot2024]. 



### Sensitivity Analysis Using the E-value

To assess the sensitivity of results to unmeasured confounding, we report VanderWeele and Ding's "E-value" in all analyses [@vanderweele2017]. The E-value quantifies the minimum strength of association (on the risk ratio scale) that an unmeasured confounder would need to have with both the exposure and the outcome (after considering the measured covariates) to explain away the observed exposure-outcome association [@vanderweele2020; @linden2020EVALUE]. To evaluate the strength of evidence, we use the bound of the E-value 95% confidence interval closest to 1.


### Scope of Interventions

To illustrate the magnitude of the shift interventions we contrast, we provide histograms in @fig-hist, that display the distribution of treatments during the treatment wave. @fig-hist: The intervention less than one unit at the top of the range is presented in colour.


```{r}
#| label: fig-hist
#| fig-cap: "This figure shows a histogram of responses to religious service frequency in the baseline + 1 wave. Responses above eight were assigned to eight, and values were rounded to the nearest whole number. The red dashed line shows the population average. (A) Responses in the gold bars are shifted to four on the Regular Religious Service intervention. All those responses in grey (four and above) remain unchanged. (B) On the zero-intervention, responses in the blue bars denote those shifted under the zero-intervention treatment."
#| eval: true
#| include: true
#| echo: false
#| fig-width: 10
#| fig-height: 12

graph_density_shift_function <- margot::here_read("graph_density_shift_function")
graph_density_shift_function + theme_classic()
```
{{< pagebreak >}}
### Evidence for Change in the Treatment Variable

@tbl-transition clarifies the change in the treatment variable from the baseline wave to the baseline + 1 wave across the sample.  Assessing change in a variable is essential for evaluating the positivity assumption and recovering evidence for the incident exposure effect of the treatment variable [@vanderweele2020; @danaei2012; @hernan2024WHATIF]. We find that state 4 (weekly attendance) and state 0 present the highest overall. However, movement between these states reveals they are not deterministic. States 1, 2, 3, and 5 exhibit more frequent jumps in and out of these states, suggesting lower stability and/or measurement error.  

```{r}
#| label: tbl-transition
#| tbl-cap: "This transition matrix captures shifts in states across across the treatment intervals. Each cell in the matrix represents the count of individuals transitioning from one state to another. The rows correspond to the treatment at baseline (From), and the columns correspond to the state at the following wave (To). **Diagonal entries** (in **bold**) correspond to the number of individuals who remained in their initial state across both waves. **Off-diagonal entries** correspond to the transitions of individuals from their baseline state to a different state in the treatment wave.\nA higher number on the diagonal relative to the off-diagonal entries in the same row indicates greater stability in a state. Conversely, higher off-diagonal numbers suggest more frequent shifts from the baseline state to other states."
#| eval: true
#| echo: false


transition_table <- margot::here_read("transition_table")

# explanation here: transition_table$explanation
transition_table$table

```


{{< pagebreak >}}


## Results

### Study 1: Causal Effects of Perfectionism on Anxiety and Depression 

Results for the treatment contrasts between perfectionism and the status quo on mental health are displayed in @fig-1_1 and @tbl-1_1. These results are measured on the causal difference scale.


```{r}
#| label: fig-1_1
#| fig-cap: "This figure reports the results of model estimates for the causal effects of a one unit increase in perfectionism vs the status quo depression and anxiety at the end of the study. Contrasts are expressed in standard deviation units."
#| eval: true
#| include: true
#| echo: false
#| fig-width: 10
#| fig-height: 12


plot_group_tab_marginal_outcomes
```


```{r}
#| label: tbl-1_1
#| tbl-cap: "This table reports the results of model estimates for the causal effects of a one unit increase in perfectionism vs the status quo depression and anxiety at the end of the study. Contrasts are expressed in standard deviation units."
#| eval: true
#| include: true
#| echo: false

tab_marginal_outcomes |>
  mutate(across(where(is.numeric), ~ round(., 3))) %>%
  kbl(format = "markdown")

#margot::margot_interpret_table(group_tab_marginal_outcomes, "causal_difference", "LMTP")

```

A Longitudinal Modified Treatment Policy (LMTP) calculates the expected outcome difference between treatment and contrast conditions over a sequential regime of treatments for a prespecified target population.

For 'marginal: depression', the effect estimate is 0.141 [0.12, 0.162]. The E-value for this estimate is 1.531, with a lower bound of 1.473. At this lower bound, unmeasured confounders would need a minimum association strength with both the intervention sequence and outcome of 1.473 to negate the observed effect. Weaker confounding would not overturn it. We infer **evidence for causality**.

For 'marginal: anxiety', the effect estimate is 0.115 [0.096, 0.135]. The E-value for this estimate is 1.46, with a lower bound of 1.405. At this lower bound, unmeasured confounders would need a minimum association strength with both the intervention sequence and outcome of 1.405 to negate the observed effect. Weaker confounding would not overturn it. We infer **evidence for causality**.

{{< pagebreak >}}


#### Subgroup Analysis: Those Born in NZ 

@fig-2_1 present results for the treatment contrasts within the two subgroups, evaluating the effect of a one unit increase in perfectionism vs the status qu. These results are presented on the difference scale in standardized units.

@tbl-2_1 presents the results for those born in New Zealand. @tbl-2_2 presents results for those born overseas.


```{r}
#| label: fig-2_1
#| fig-cap: "This figure reports the results of for each sub-group analysis for the causal effects of a one unit increase in perfectionism vs the status quo depression and anxiety at the end of the study. Contrasts are expressed in standard deviation units."
#| eval: true
#| include: true
#| echo: false
#| fig-width: 10
#| fig-height: 12


plot_combo_conditional
```

```{r}
#| label: tbl-2_1
#| tbl-cap: "This table reports the results of model estimates for in the population of residents born in New Zealand. We again estimate the causal effects of a one unit increase in perfectionism vs the status quo depression and anxiety at the end of the study. Contrasts are expressed in standard deviation units.."
#| eval: true
#| include: true
#| echo: false

tab_born_nz_outcomes |>
  mutate(across(where(is.numeric), ~ round(., 3))) %>%
  kbl(format = "markdown")

# uncomment to get interpretation 
#margot::margot_interpret_table(group_tab_born_nz_outcomes, "causal_difference", "LMTP")

```

For 'born NZ: depression', the effect estimate is 0.145 [0.121, 0.168]. The E-value for this estimate is 1.542, with a lower bound of 1.478. At this lower bound, unmeasured confounders would need a minimum association strength with both the intervention sequence and outcome of 1.478 to negate the observed effect. Weaker confounding would not overturn it. We infer **evidence for causality**.

For 'born NZ: anxiety', the effect estimate is 0.113 [0.093, 0.134]. The E-value for this estimate is 1.455, with a lower bound of 1.394. At this lower bound, unmeasured confounders would need a minimum association strength with both the intervention sequence and outcome of 1.394 to negate the observed effect. Weaker confounding would not overturn it. We infer **evidence for causality**.

```{r}
#| label: tbl-2_2
#| tbl-cap: "This table reports the results of model estimates for in the population of residents not born in New Zealand (born overseas). We again estimate the causal effects of a one unit increase in perfectionism vs the status quo depression and anxiety at the end of the study. Contrasts are expressed in standard deviation units."
#| eval: true
#| include: true
#| echo: false



tab_born_overseas_outcomes |>
  mutate(across(where(is.numeric), ~ round(., 3))) %>%
  kbl(format = "markdown")

# uncomment to get interpretation 
#margot::margot_interpret_table(group_tab_born_overseas_outcomes, "causal_difference", "LMTP")

```
For 'born overseas: depression', the effect estimate is 0.143 [0.101, 0.185]. The E-value for this estimate is 1.537, with a lower bound of 1.424. At this lower bound, unmeasured confounders would need a minimum association strength with both the intervention sequence and outcome of 1.424 to negate the observed effect. Weaker confounding would not overturn it. We infer **evidence for causality**.

For 'born overseas: anxiety', the effect estimate is 0.113 [0.075, 0.152]. The E-value for this estimate is 1.455, with a lower bound of 1.342. At this lower bound, unmeasured confounders would need a minimum association strength with both the intervention sequence and outcome of 1.342 to negate the observed effect. Weaker confounding would not overturn it. We infer **evidence for causality**.


## Findings

Comparing the difference in the mean outcomes between to the two groups for anxiety:  `r difference_in_group_means_anxiety$interpretation`. We therefore do not detect a reliable difference between those born in New Zealand and those born elsewhere. 

Comparing the difference in the mean outcomes between to the two groups for depression: `r difference_in_group_means_depression$interpretation`. We therefore do not detect a reliable difference between those born in New Zealand and those born elsewhere. 


{{< pagebreak >}}
### Additional Study: Comparison of Causal Inference Results with Cross-Sectional Regressions


```{r}
#| label: regressions
#| eval: true
#| include: false
#| echo: false
# regression 
# b_church_on_hours_charity<-margot::here_read("b_church_on_hours_charity")
# b_church_on_hours_charity
# lm_coef_fit_church_on_charity_donate
# verify

# contrast for charity

```


To better evaluate the contributions of our methodology to current practice, we conducted a series of cross-sectional analyses using the baseline wave data. We quantified the statistical associations between religious service attendance and our focal prosocial outcomes. We included all regression covariates from the causal models (including sample weights) for each analysis, obviously omitting the outcome measured at baseline, i.e. the response variable.

**Cross-sectional anxiety result**: the change in expected kessler-6 anxiety for a one-unit increase in perfectionism is `r b_lm_fit_kessler_latent_anxiety`. This result is `r percent_greater_regression_anxiety` per cent greater than the effect estimated from the '+1 vs. status quo' causal contrast (`r marginal_eff_anxiety`), indicating an **overstatement in the cross-sectional regression model.**

**Cross-sectional depression result**: the change in expected kessler-6 depression for a one-unit increase in perfectionism is `r b_lm_fit_kessler_latent_depression`. This result is `r percent_greater_regression_depression` per cent greater than the effect estimated from the '+1 vs. status quo' causal contrast (`r marginal_eff_depression`), indicating an **overstatement in the cross-sectional regression model.**


These findings underscore that the results of cross-sectional regressions, although suggestive, can considerably diverge from those obtained from the causal analysis of panel data.


{{< pagebreak >}}


## Discussion 

### Considerations

First, as stated above, our causal inferences turn on three assumptions, which are worth revisiting: 

(i). **Unmeasured confounding**: although we employ robust methods for causal inference, our results depend on the effectiveness of our strategy to control for confounding. Our sensitivity analyses address the potential impacts of unmeasured confounders. Nevertheless, the presence and influence of such confounders are uncertain and unverifiable from our data.

(ii). **Causal consistency**: the observed outcomes must correspond to the counterfactual treatments contrasted. Although "religious service attendance" may appear conditionally independent of the outcomes given baseline covariates, interpreting these interventions remains challenging. "Religious service attendance" varies widely, encompassing everything from informal gatherings at homes to formal services in cathedrals across New Zealand's religious diversity. This type of "treatment" does not mirror a straightforward medical intervention like a vaccine. The heterogeneity of "religious service" limits the clarity of our results, an issue no amount of data or analysis can resolve because "religious service" reflects a broad spectrum of community activities.

(iii). **Positivity**: we have confirmed that religious service attendance varies within our sample and have used semi-parametric models with ensemble learning and cross-validation to prevent data over-extrapolation and model over-fitting. Conceptually, it is crucial for valid causal inference that every potential level of "treatment" to religious services is realistically possible (refer to discussion in @vanderweele2017causaleffectsService). Although there are instances realised in our data of secular individuals initiating religious service and frequent attendees stopping (refer to @tbl-transition), it might stretch credulity too far to imagine that such changes are possible for everyone.


Second, our study confronts the spectre of **measurement error**: both direct and correlated measurement errors can introduce biases, either by implying effects where none exist or by attenuating true effects [@vanderweele2012MEASUREMENT]. Importantly, evaluating prosociality using multiple measures while also controlling for these measures and the treatment at baseline helps to mitigate measurement error concerns. Nevertheless, unknown combinations of measurement error might nevertheless bias our results. The outcomes and estimates we report here are best-considered approximations.

Third, we do not examine **treatment effect heterogeneity**: identifying which subgroups experience the strongest responses remains a task for future research. Such investigations are crucial for making informed policy decisions and tailoring advice relevant to those subgroups of the population who might benefit most. Perhaps the most obvious stratum is religious affiliates [@vanderweele2017causaleffectsService].

Fourth, the **transportability of our findings remains unclear**: New Zealand is our target population. Our findings generalise to this population. However, the transportability of our findings to other settings—whether our results generalise beyond our targeted New Zealand population—remains an open question, a matter for future investigations. 


### Observations and Recommendations


{{< pagebreak >}}

### Ethics

 {**authors blinded**} 

### Data Availability

{**authors blinded**} 


### Acknowledgements

 {**authors blinded**} 


### Author Statement

 {**authors blinded**} 


{{< pagebreak >}}

## Appendix A: Measures {#appendix-measures}

#### Age (waves: 1-15)

We asked participants' ages in an open-ended question ("What is your age?" or "What is your date of birth?").


#### Born in New Zealand


#### Charitable Donations  (Study 1 outcome)

Using one item from @hoverd_religious_2010, we asked participants, "How much money have you donated to charity in the last year?". 

<!-- To stabilise this indicator, we took the natural log of the response + 1. -->


#### Charitable Volunteering  (Study 1 outcome)


We measured hours of volunteering using one item from @sibley2011: "Hours spent … voluntary/charitable work."

<!-- To stabilise this indicator, we took the natural log of the response + 1. -->

#### Children Number (waves: 1-3, 4-15)

We measured the number of children using one item from @Bulbulia_2015. We asked participants, "How many children have you given birth to, fathered, or adopted. How many children have you given birth to, fathered, or adopted?" or "How many children have you given birth to, fathered, or adopted. How many children have you given birth to, fathered, and/or parented?" (waves: 12-15).

<!-- Here, we used responses to create a binary indicator for parenthood: Parent Yes = 1/ No = 0.  -->



<!-- #### Community: Sense of Community (Study 2 outcome) -->

<!-- We measured a sense of community with a single item from @sengupta2013: "I feel a sense of community with others in my local neighbourhood." Participants answered on a scale of 1 (strongly disagree) to 7 (strongly agree). -->


<!-- #### Community: Felt Belongingness  (Study 2 outcome) -->

<!-- We assessed felt belongingness with three items adapted from the Sense of Belonging Instrument [@hagerty1995]: (1) "Know that people in my life accept and value me"; (2) "Feel like an outsider"; (3) "Know that people around me share my attitudes and beliefs". Participants responded on a scale from 1 (Very Inaccurate) to 7 (Very Accurate). The second item was reversely coded. -->

<!-- #### Community: Social Support (Study 2 outcome) -->

<!-- Participants perceived social support was measured using three items from @cutrona1987 and @williams_cyberostracism_2000: (1) "There are people I can depend on to help me if I really need it"; (2) "There is no one I can turn to for guidance in times of stress"; (3) "I know there are people I can turn to when I need help." Participants indicated how much they agreed with those items (1 = Strongly Disagree to 7 = Strongly Agree). The second item was negatively worded, so we reversely recorded the responses to this item. -->

#### Disability

We assessed disability with a one-item indicator adapted from @verbrugge1997. It asks, "Do you have a health condition or disability that limits you and that has lasted for 6+ months?" (1 = Yes, 0 = No).


#### Education Attainment (waves: 1, 4-15)

We asked participants, "What is your highest level of qualification?". We coded participants' highest finished degree according to the New Zealand Qualifications Authority. Ordinal-Rank 0-10 NZREG codes (with overseas school quals coded as Level 3, and all other ancillary categories coded as missing) See:https://www.nzqa.govt.nz/assets/Studying-in-NZ/New-Zealand-Qualification-Framework/requirements-nzqf.pdf

#### Employment (waves: 1-3, 4-11)

We asked participants, "Are you currently employed? (This includes self-employed or casual work)".

<!-- #### European (waves: 1-15) -->

<!-- Participants were asked, "Which ethnic group do you belong to (NZ census question)?" or "Which ethnic group(s) do you belong to? (Open-ended)" (wave: 3). Europeans were coded as 1, whereas other ethnicities were coded as 0. -->

#### Ethnicity

Based on the New Zealand Census, we asked participants, "Which ethnic group(s) do you belong to?". The responses were: (1) New Zealand European; (2) Māori; (3) Samoan; (4) Cook Island Māori; (5) Tongan; (6) Niuean; (7) Chinese; (8) Indian; (9) Other such as DUTCH, JAPANESE, TOKELAUAN. Please state:. We coded their answers into four groups: Maori, Pacific, Asian, and Euro (except for Time 3, which used an open-ended measure).


#### Fatigue

We assessed subjective fatigue by asking participants, "During the last 30 days, how often did ... you feel exhausted?" Responses were collected on an ordinal scale (0 = None of The Time, 1 = A little of The Time, 2 = Some of The Time, 3 = Most of The Time, 4 = All of The Time).


#### Honesty-Humility-Modesty Facet (waves: 10-14)

Participants indicated the extent to which they agree with the following four statements from @campbell2004 , and @sibley2011 (1 = Strongly Disagree to 7 = Strongly Agree)

```
i.  I want people to know that I am an important person of high status, (Waves: 1, 10-14)
ii. I am an ordinary person who is no better than others.
iii. I wouldn't want people to treat me as though I were superior to them.
iv. I think that I am entitled to more respect than the average person is.
```

<!-- #### Has Siblings -->

<!-- "Do you have siblings?" [@stronge2019onlychild] -->

#### Hours of Childcare

We measured hours of exercising using one item from @sibley2011: 'Hours spent … looking after children."

To stabilise this indicator, we took the natural log of the response + 1.


#### Hours of Housework

We measured hours of exercising using one item from @sibley2011: "Hours spent … housework/cooking"

To stabilise this indicator, we took the natural log of the response + 1.

#### Hours of Exercise

We measured hours of exercising using one item from @sibley2011: "Hours spent … exercising/physical activity" 

To stabilise this indicator, we took the natural log of the response + 1.

<!-- #### Hours Volunteering -->

<!-- We measured hours of volunteering using one item from @sibley2011: "Hours spent … voluntary/charitable work." -->

<!-- To stabilise this indicator, we took the natural log of the response + 1. -->

#### Hours of Childcare

We measured hours of exercising using one item from @sibley2011: 'Hours spent … looking after children."

To stabilise this indicator, we took the natural log of the response + 1.


#### Hours of Exercise

We measured hours of exercising using one item from @sibley2011: "Hours spent … exercising/physical activity" 

To stabilise this indicator, we took the natural log of the response + 1.


#### Hours of Housework

We measured hours of exercising using one item from @sibley2011: "Hours spent … housework/cooking"

To stabilise this indicator, we took the natural log of the response + 1.


#### Hours of Sleep

Participants were asked, "During the past month, on average, how many hours of *actual sleep* did you get per night?".


#### Hours of Work

We measured work hours using one item from @sibley2011: "Hours spent … working in paid employment."

To stabilise this indicator, we took the natural log of the response + 1.


#### Income (waves: 1-3, 4-15)

Participants were asked, "Please estimate your total household income (before tax) for the year XXXX". To stabilise this indicator, we first took the natural log of the response + 1, and then centred and standardised the log-transformed indicator.

<!-- #### Job Security (waves: 1-3,4-7,9-15) -->

<!-- Participants indicated their feeling of job security by answering "How secure do you feel in your current job?" on a scale from 1 (not secure) to 7 (very secure). -->


#### Kessler-6: Psychological Distress  (waves: 2-3,4-15)

We measured psychological distress using the Kessler-6 scale (kessler2002?), which exhibits
strong diagnostic concordance for moderate and severe psychological distress in large, crosscultural
samples (kessler2010?; prochaska2012?). Participants rated during the past 30
days, how often did… (1) “… you feel hopeless”; (2) “… you feel so depressed that nothing
could cheer you up”; (3) “… you feel restless or fidgety”; (4)“… you feel that everything was
an effort”; (5) “… you feel worthless”; (6) ” you feel nervous?” Ordinal response alternatives
for the Kessler-6 are: “None of the time”; “A little of the time”; “Some of the time”; “Most of
the time”; “All of the time.”


#### Male Gender (waves: 1-15)

We asked participants' gender in an open-ended question: "what is your gender?" or "Are you male or female?" (waves: 1-5). Female was coded as 0, Male as 1, and gender diverse coded as 3 [@fraser_coding_2020]. (or 0.5 = neither female nor male)

Here, we coded all those who responded as Male as 1, and those who did not as 0.


#### Mini-IPIP 6 (waves: 1-3,4-15)

We measured participants' personalities with the Mini International Personality Item Pool 6 (Mini-IPIP6) [@sibley2011], which consists of six dimensions and each dimension is measured with four items:

1.  agreeableness,

    i.  I sympathize with others' feelings.
    ii. I am not interested in other people's problems. (r)
    iii. I feel others' emotions.
    iv. I am not really interested in others. (r)

2.  conscientiousness,

    i.  I get chores done right away.
    ii. I like order.
    iii. I make a mess of things. (r)
    iv. I often forget to put things back in their proper place. (r)

3.  extraversion,

    i.  I am the life of the party.
    ii. I don't talk a lot. (r)
    iii. I keep in the background. (r)
    iv. I talk to a lot of different people at parties.

4.  honesty-humility,

    i.  I feel entitled to more of everything. (r)
    ii. I deserve more things in life. (r)
    iii. I would like to be seen driving around in a very expensive car. (r)
    iv. I would get a lot of pleasure from owning expensive luxury goods. (r)

5.  neuroticism, and

    i.  I have frequent mood swings.
    ii. I am relaxed most of the time. (r)
    iii. I get upset easily.
    iv. I seldom feel blue. (r)

6.  openness to experience

    i.  I have a vivid imagination.
    ii. I have difficulty understanding abstract ideas. (r)
    iii. I do not have a good imagination. (r)
    iv. I am not interested in abstract ideas. (r)

Each dimension was assessed with four items and participants rated the accuracy of each item as it applies to them from 1 (Very Inaccurate) to 7 (Very Accurate). Items marked with (r) are reverse coded.


#### NZ-Born (waves: 1-2,4-15)

We asked participants, "Which country were you born in?" or "Where were you born? (please be specific, e.g., which town/city?)" (waves: 6-15).


#### NZ Deprivation Index (waves: 1-15)

We used the NZ Deprivation Index to assign each participant a score based on where they live [@atkinson2019]. This score combines data such as income, home ownership, employment, qualifications, family structure, housing, and access to transport and communication for an area into one deprivation score.


#### NZSEI Occupational Prestige and Status (waves: 8-15)

We assessed occupational prestige and status using the New Zealand Socio-economic Index 13 (NZSEI-13) [@fahy2017a]. This index uses the income, age, and education of a reference group, in this case the 2013 New Zealand census, to calculate a score for each occupational group. Scores range from 10 (Lowest) to 90 (Highest). This list of index scores for occupational groups was used to assign each participant an NZSEI-13 score based on their occupation.

We assessed occupational prestige and status using the New Zealand Socio-economic Index 13 (NZSEI-13) [@fahy2017]. This index uses the income, age, and education of a reference group, in this case, the 2013 New Zealand census, to calculate a score for each occupational group. Scores range from 10 (Lowest) to 90 (Highest). This list of index scores for occupational groups was used to assign each participant an NZSEI-13 score based on their occupation.

<!-- We asked participants, "If you are a parent, what is the birth date of your eldest child?". -->
<!-- #### Parent (waves: 5-15) -->

<!-- We asked participants, "If you are a parent, what is the birth date of your eldest child?" or "If you are a parent, in which year was your eldest child born?" (waves: 10-15). Parents were coded as 1, while the others were coded as 0. --> 



#### Opt-in

The New Zealand Attitudes and Values Study allows opt-ins to the study. Because the opt-in population may differ from those sampled randomly from the New Zealand electoral roll; although the opt-in rate is low, we include an indicator (yes/no) for this variable.



#### Partner (No/Yes)

"What is your relationship status?" (e.g., single, married, de-facto, civil union, widowed, living together, etc.)


#### Politically Conservative 

We measured participants' political conservative orientation using a single item adapted from @jost_end_2006-1.

"Please rate how politically liberal versus conservative you see yourself as being."

(1 = Extremely Liberal to 7 = Extremely Conservative)


##### Religious Service Attendance

If participants answered *yes* to "Do you identify with a religion and/or spiritual group?" we measured their frequency of church attendence using one item from @sibley2012: "how many times did you attend a church or place of worship in the last month?". Those participants who were not religious were imputed a score of "0".

#### Rural/Urban Codes

Participants residence locations were coded according to a five-level ordinal categorisation ranging from "Urban" to Rural, see @sibley2021.

<!-- #### Politically Right Wing  -->

<!-- We measured participants' political right-wing orientation using a single item adapted from @jost_end_2006-1. -->

<!-- "Please rate how politically left-wing versus right-wing you see yourself as being." -->

<!-- (1 = Extremely left-wing to 7 = Extremely right-wing) -->


<!-- #### Religion Affiliation -->

<!-- Participants were asked to indicate their religion identification ("Do you identify with a religion and/or spiritual group?") on a binary response (1 = Yes, 0 = No). We then asked, "What religion or spiritual group?" These questions are used in the New Zealand Census -->


<!-- #### Support -->

<!-- Participants' perceived social support was measured using three items from @cutrona1987 and @williams_cyberostracism_2000: (1) "There are people I can depend on to help me if I really need it"; (2) "There is no one I can turn to for guidance in times of stress"; (3) "I know there are people I can turn to when I need help." Participants indicated how much they agreed with those items (1 = Strongly Disagree to 7 = Strongly Agree). The second item was negatively worded, so we reversely recorded the responses to this item. -->

#### Short-Form Health

Participants' subjective health was measured using one item ("Do you have a health condition or disability that limits you, and that has lasted for 6+ months?"; 1 = Yes, 0 = No) adapted from @verbrugge1997.


#### Sample Origin

Wave enrolled in NZAVS, see @sibley2021.

<!-- #### Socialising (time 10, time 11) -->

<!-- As part of the time usage measures, participants were asked to state how many hour the spent in activities related to socialising with the following groups: -->

<!--   - Hours spent … socialising with family -->
<!--   - Hours spent … socialising with friends -->
<!--   - Hours spent … socialising with community groups -->

<!--   <!-- - Hours spent … socialising with religious groups -->


#### Support received: money (waves 10-12) (Study 4 outcomes)

The NZAVS has a 'revealed' measure of received help and support measured in hours of support in the previous week. The items are: 


*Please estimate how much help you have received from the following sources in the last week?*

- *family...MONEY (hours)*
- *friends...MONEY (hours)*
- *members of my community...MONEY (hours)*


Because this measure is highly variable, we convert responses to binary indicators: *0 = none/1 any*


#### Support received: time (waves 10-13) (Study 3 outcomes)

*Please estimate how much help you have received from the following sources in the last week.*

- *family...TIME (hours)*
- *friends...TIME (hours)*
- *members of my community...TIME (hours)*

Because this measure is highly variable, we convert responses to binary indicators: *0 = none/1 any*
  

#### Total Siblings

Participants were asked the following questions related to sibling counts: 
 
 - Were you the 1st born, 2nd born, or 3rd born, etc, child of your mother?
 - Do you have siblings?
 - How many older sisters do you have?
 - How many younger sisters do you have?
 - How many older brothers do you have?
 - How many younger brothers do you have?

A single score was obtained from sibling counts by summing responses to the "How many..." items. From these scores, an ordered factor was created ranging from 0 to 7, where participants with more than 7 siblings were grouped into the highest category. 


<!-- #### Volunteers -->

<!-- We asked participants,"Please estimate how many hours you spent doing each of the following things last week" and responded to an item ("voluntary/charitable work") from [@sibley2011]. -->


{{< pagebreak >}}

## Appendix B. Baseline Demographic Statistics {#appendix-demographics}


```{r}
#| label: tbl-table-demography
#| tbl-cap: "Baseline demographic statistics"
#| eval: true
#| include: true
#| echo: false

table_baseline <- margot::here_read("table_baseline")
table_baseline |>  kbl(format = "markdown")
```


@tbl-table-demography baseline demographic statistics for couples who met inclusion criteria.

{{< pagebreak >}}


##  Appendix C: Treatment Statistics {#appendix-exposures}


```{r}
#| label: tbl-table-exposures-code
#| tbl-cap: "Exposures at baseline and baseline + 1 (treatment) wave"
#| eval: true
#| include: true
#| echo: false

table_exposures <-margot::here_read("table_exposures")
table_exposures |>  kbl(format = "markdown")
```



tbl-table-exposures-code presents baseline (NZAVS time 10) and exposure wave (NZAVS time 11) statistics for the exposure variable: perfectionism (range 1-7). 

<!-- Responses coded as eight or above were coded as "8". This decision to avoid spare treatments was based on theoretical grounds, namely, that daily exposure would be similar in its effects to more than daily exposure. We note that causal contrasts were obtained for projects with either no attendance or four or more visits per month. Hence this simplification of the measure is unlikely to affect theoretical and practical inferences. All models adjusted for the pandemic alert level because the treatment wave (NZAVS time 11) occurred during New Zealand's COVID-19 pandemic. The pandemic is not a "confounder" because a confounder must be related to the treatment and the outcome. At the end of the study, all participants had been exposed to the pandemic.  However, to satisfy the causal consistency assumption, all treatments must be conditionally equivalent within levels of all covariates [@vanderweele2013]. Because COVID affected the ability or willingness of individuals to attend religious service, we included the lockdown condition as a covariate [@sibley2021]. To better enable conditional independence within levels of the treatment variable, we conditioned on the lead value of COVID-alert level at baseline. To mitigate systematic biases arising from attrition and missingness, the `lmtp` package uses inverse probability of censoring weights, which were used when estimating the causal effects of the exposure on the outcome.  -->



<!-- ### Binary Transition Table for The Treatment -->

<!-- ```{r} -->
<!-- #| label: tbl-transition-tablegain -->
<!-- #| tbl-cap: "Transition table for stability and change in regular religious service (4x per month) between baseline and treatment wave." -->
<!-- #| eval: true -->
<!-- #| include: true -->
<!-- #| echo: false -->

<!-- transition_table_binary_gain <-margot::here_read("transition_table_binary_gain") -->

<!-- transition_table_binary_gain$table -->
<!-- ``` -->

<!-- @tbl-transition-tablegain presents a transition matrix to evaluate treatment shifts between baseline and treatment wave. Here, we focus on the shift from/to monthly attendance at four or more visits per month. Entries along the diagonal (in bold) indicate the number of individuals who **stayed** in their initial state. By contrast, the off-diagonal shows the transitions from the initial state (bold) to another state in the following wave (off diagonal). Thus the cell located at the intersection of row $i$ and column $j$, where $i \neq j$, gives us the counts of individuals moving from state $i$ to state $j$. -->





<!-- ```{r} -->
<!-- #| label: tbl-transition-tableloss -->
<!-- #| tbl-cap:  "Transition table for stability and change in zero religious service (0 x per month) between baseline and treatment wave." -->
<!-- #| eval: true -->
<!-- #| include: true -->
<!-- #| echo: false -->

<!-- transition_table_binary_zero <-margot::here_read("transition_table_binary_zero") -->
<!-- transition_table_binary_zero$table -->
<!-- ``` -->

<!-- @tbl-transition-tableloss presents a transition matrix to evaluate treatment shifts between baseline and treatment wave. Here, we focus on the shift from/to zero religious service attendance. Again, entries along the diagonal (in bold) indicate the number of individuals who **stayed** in their initial state. By contrast, the off-diagonal shows the transitions from the initial state (bold) to another state in the following wave (off diagonal). Thus the cell located at the intersection of row $i$ and column $j$, where $i \neq j$, gives us the counts of individuals moving from state $i$ to state $j$. -->


### Imbalance of Confounding Covariates Treatments 

@fig-match_1 shows imbalance of covariates on the treatment at the treatment wave. The variable on which there is strongest imbalance is the baseline measure of religious service attendance. It is important to adjust for this measure both for confounding control and to better estimate an incident exposure effect for the religious service at the treatment wave (in contrast to merely estimating a prevalence effect). See @vanderweele2020.

```{r}
#| label: fig-match_1
#| fig-cap: "This figure shows the imbalance in covariates on the treatment"
#| eval: true
#| include: true
#| echo: false
#| fig-width: 10
#| fig-height: 10

love_plot_marginal <- margot::here_read("love_plot_marginal")
love_plot_marginal
```


##  Appendix D: Baseline and End of Study Outcome Statistics {#appendix-outcomes}


```{r}
#| label: tbl-table-outcomes
#| tbl-cap: "Outcomes at baseline and end-of-study"
#| eval: true
#| include: true
#| echo: false
table_outcomes <-margot::here_read("table_outcomes")
table_outcomes |>  kbl(format = "markdown")
```



@tbl-table-outcomes presents baseline and end-of-study descriptive statistics for the outcome variables.  


{{< pagebreak >}}



## References {.appendix}










